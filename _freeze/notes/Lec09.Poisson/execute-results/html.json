{
  "hash": "95857a19d0e1f360a01c78e4b90c1430",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Poisson Regression\"\nsubtitle: \"Lecture 09\"\nname: Lec09.Poisson.qmd\n---\n\n::: {.cell}\n\n:::\n\n\n## Count Data and Event Rates\n\n-   Sometimes a random variable measures the number of events occurring over some space and time interval\n\n-   Examples include\n\n    -   Number of polyps recurring in the three year interval between colonoscopies\n\n    -   Number of pulmonary exacerbations experienced by a cystic fibrosis patient in a year\n\n    -   Number of reflux events in a 24-hour period\n\n-   Count data have (in theory) no upper limit, although very large counts can be highly improbable\n\n-   When a response variable measures counts over space and time, we often summarize by considering the event rate\n\n    -   \"Event rate\" is the expected number of events per unit of space-time\n\n    -   The rate is thus a mean count\n\n    -   In most statistical problems, we know the interval of time and the volume of space sampled\n\n        -   Poisson models allow us to take into account the known interval of time/space using an \"offset\"\n\n## Poisson Model\n\n### Poisson distribution\n\n-   Often we assume that counts follow a Poisson distribution\n\n-   The Poisson distribution can be derived from the following assumptions\n\n    -   The expected number of events in an interval is proportional to the size of the interval\n\n    -   The probability that two events occur with an infinitesimally small interval of space-time is zero\n\n    -   The number of events occurring in disjoint (separate) intervals of space-time are independent\n\n-   (Note that the assumption of a constant rate with independence over space-time is pretty strong and rarely holds completely)\n\n-   Poisson distribution\n\n    -   Counts the events occurring at a constant rate $\\lambda$ in a specified time (and space) $t$\n\n        -   Independent intervals of time and space\n\n    -   Probability distribution has parameter $\\lambda > 0$\n\n        -   For $k = 0, 1, 2, \\ldots$\n\n            $$\\textrm{Pr}(Y = k) = \\frac{e^{-\\lambda t} (\\lambda t)^k}{k!}$$\n\n        -   Mean: $E[Y] = \\lambda t$\n\n        -   Var: $V[Y] = \\lambda t$\n\n        -   (Mean-variance relationship, like binary data)\n\n### Regression Model\n\n-   When the response variable represent counts of some event, we usually model using the (log) rate with Poisson regression\n\n    -   Compares rates of response per space-time (e.g. person-years) across groups\n\n    -   \"Rate ratio\"\n\n-   Why not use linear regression? The reasons are primarily statistical\n\n    -   The rate is in fact a mean\n\n    -   For Poisson $Y$ having event rate $\\lambda$ measured over time $t$\n\n        -   The mean is equal to the variance (both are $\\lambda t$)\n\n    -   We want to be able to account for\n\n        -   Different areas of space or length of time for measuring counts\n\n        -   Mean-variance relationship (if not using robust standard errors)\n\n-   In Poisson regression, we tend to use a log link when modeling the event rate\n\n    -   As in other models, a log link means that we are assuming a multiplicative modeling\n\n        -   Multiplicative model $\\rightarrow$ comparisons between groups based on ratios\n\n        -   Additive model $\\rightarrow$ comparisons between groups based on differences\n\n    -   Log link also has the best technical statistical properties\n\n        -   Log rate is the \"canonical parameter\" for the Poisson distribution\n\n        -   Being the canonical parameter makes the calculus and mathematical properties easier to derive, and thus easier to understand from a theoretical perspective\n\n-   Poisson regression\n\n    -   Response variable is count of event over space-time (often person-years)\n\n    -   Offset variable specifies amount of space-time\n\n    -   Allows continuous or multiple grouping variables\n\n        -   But will also work with binary grouping variables\n\n-   Simple Poisson Regression\n\n    -   Modeling rate of count response $Y$ on predictor $X$\n\n        -   Distribution: $\\textrm{Pr}(Y_i = k | T_i = t_i) = \\frac{e^{-\\lambda_i t_i} (\\lambda_i t_i)^k}{k!}$\n\n        -   Model: $\\textrm{log } E[Y_i | T_i, X_i] = \\textrm{log}\\left(\\lambda_i T_i\\right) = \\textrm{log}(T_i) + \\beta_0 + \\beta_1 \\times X_i$\n\n        -   $X_i = 0$: log $\\lambda_i = \\beta_0$\n\n        -   $X_i = x$: log $\\lambda_i = \\beta_0 + \\beta_1 \\times x$\n\n        -   $X_i = x+1$: log $\\lambda_i = \\beta_0 + \\beta_1 \\times x + \\beta_1$\n\n    -   To interpret as rates, exponentiate the parameters\n\n        -   Distribution: $\\textrm{Pr}(Y_i = k | T_i = t_i) = \\frac{e^{-\\lambda_i t_i} (\\lambda_i t_i)^k}{k!}$\n\n        -   Model: $\\textrm{log } E[Y_i | T_i, X_i] = \\textrm{log}\\left(\\lambda_i T_i\\right) = \\textrm{log}(T_i) + \\beta_0 + \\beta_1 \\times X_i$\n\n        -   $X_i = 0$: $\\lambda_i = e^{\\beta_0}$\n\n        -   $X_i = x$: $\\lambda_i = e^{\\beta_0 + \\beta_1 \\times x}$\n\n        -   $X_i = x+1$: $\\lambda_i = e^{\\beta_0 + \\beta_1 \\times x + \\beta_1}$\n\n-   Interpretation of the model\n\n    -   Intercept\n\n        -   Rate when the predictor is $0$ is found by exponentiation of the intercept from Poisson regression: $e^{\\beta_0}$\n\n    -   Slope\n\n        -   Rate ratio between groups differing in the value of the predictor by 1 unit is found by exponentiation of the slope from Poisson regression: $e^{\\beta_1}$\n\n## Example: Acid reflux and BMI\n\n### Data description\n\n-   Research question: Are the number of acid reflux events in a day related to body mass index (BMI)?\n\n-   Each subject pH in the esophagus in monitored continuously for about 24 hours\n\n-   Count the number of time pH drop below 4, which is called a \"reflux event\"\n\n-   Analysis (statistical) goals\n\n    -   Primary goal: Determine if there is an association between BMI and acid reflux rate\n\n    -   Secondary goal: Describe the (mean) trend in reflux rates as a function of BMI\n\n-   Variables\n\n    -   Response: Number of acid reflux events\n\n    -   Offset: Number of minutes subject was monitored\n\n    -   Predictor of interest: BMI\n\n    -   Other covariates: Presence of esophagitis at baseline\n\n### Descriptive Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmi.data <- read.csv(\"data/bmi.csv\", header=TRUE)\n# Events are pH less than 4\nbmi.data$events <- bmi.data$totalmins4\n\nggplot(bmi.data, aes(x=bmi, y=events)) + geom_point() + geom_smooth() + theme_bw() + xlab(\"BMI\") + ylab(\"Number of reflux events\")\n```\n\n::: {.cell-output-display}\n![BMI by number of reflux events](Lec09.Poisson_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmi.data$rate <- bmi.data$totalmins4/bmi.data$totalmins*60*24\nggplot(bmi.data, aes(x=bmi, y=rate)) + geom_point() + geom_smooth() + theme_bw() + xlab(\"BMI\") + ylab(\"Reflux events per day\")\n```\n\n::: {.cell-output-display}\n![BMI by number of reflux events per day](Lec09.Poisson_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n-   Characterization of plots\n\n    -   Plots are visually similar if we consider the rate (events per day) or the raw number of events\n\n    -   First order trend: Event rate increases with increasing BMI\n\n    -   Second order trend: Event rate increase until BMI of 32 (or so) and then flattens out\n\n    -   Within-group variability\n\n        -   Hard to visualize from the plots\n\n        -   Model assumes increasing variability with increasing BMI, which looks reasonable\n\n### Regression commands\n\n-   As before, but need to specify the offset\n\n    -   Offset is the log of the exposure time\n\n    -   In Stata, can alternatively specify the \"exposure\" and it will take the log for you\n\n-   Stata\n\n    -   `poisson respvar predvar, exposure(time) [robust]`\n\n    -   `poisson respvar predvar, offset(logtime) [robust]`\n\n-   R\n\n    -   One method to fit Poisson models\n\n        -   Uses the `sandwich` and `lmtest` libraries\n\n        -   Must install the above two libraries using `install.packages(\"lmtest\")` and `install.packages(\"sandwich\")`\n\n        -   `model.poisson <- glm(response ~ predictors + offset(log(time)), data=data, family=\"poisson\")`\n\n        -   `coeftest(model.poisson, vcov=sandwich)`\n\n    -   Another method to fit Poisson models using the `Design` package\n\n        -   `m1 <- glmD(response ~ predictors + offset(log(time)), data=data, family=\"poisson\", x=TRUE, y=TRUE)`\n\n        -   `bootcov(m1)` for robust (bootstrap) confidence intervals\n\n    -   Can also use methods within the `gee` library\n\n### Estimation of the regression model\n\n-   Regression model for number of reflux events on BMI\n\n    -   Answer primary research question: Is there an *association* between BMI and the acid reflux event rate?\n\n    -   Estimate the best fitting line to (log) number of reflux events within BMI groups using an offset of log time\n\n        -   $\\textrm{log}(\\textrm{Events} | \\textrm{BMI}) = \\beta_0 + \\beta_1 \\times \\textrm{BMI} + \\textrm{log}(\\textrm{time})$\n\n    -   An association will exist if the slope $\\beta_1$ is nonzero\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lmtest)\nlibrary(sandwich)\nm1.poisson <- glm(events ~ bmi + offset(log(totalmins)), data=bmi.data, family=\"poisson\")\nm1.poisson\n```\n\n::: {.cell-output-display}\n\n----------------------------------------------------------------\n     &nbsp;        Estimate    Std. Error   z value    Pr(>|z|) \n----------------- ----------- ------------ ---------- ----------\n **(Intercept)**   -3.119991   0.01887934   -165.260      0     \n\n     **bmi**       0.022319    0.00061713    36.166       0     \n----------------------------------------------------------------\n\nTable: Fitting generalized (poisson/log) linear model: events ~ bmi + offset(log(totalmins))\n\n\n------------------- -----------------\n   **Degrees of      278 Total (i.e. \n     Freedom**            Null)      \n\n   **Degrees of       277 Residual   \n     Freedom**                       \n\n **Null Deviance**       22040.9     \n\n    **Residual           20794.6     \n    Deviance**                       \n\n      **AIC**            22725.8     \n------------------- -----------------\n\n\n:::\n\n```{.r .cell-code}\ncoeftest(m1.poisson, vcov=sandwich)\n```\n\n::: {.cell-output-display}\n\n----------------------------------------------------------------\n     &nbsp;        Estimate    Std. Error   z value   Pr(>|z|)  \n----------------- ----------- ------------ --------- -----------\n **(Intercept)**   -3.119991   0.1392708    -22.402   0.000e+00 \n\n     **bmi**       0.022319    0.0046038     4.848    1.247e-06 \n----------------------------------------------------------------\n\nTable: z test of coefficients\n\n\n:::\n\n```{.r .cell-code}\nconfint(coeftest(m1.poisson, vcov=sandwich))\n```\n\n::: {.cell-output-display}\n\n-----------------------------------------\n     &nbsp;          2.5 %      97.5 %   \n----------------- ----------- -----------\n **(Intercept)**   -3.392957   -2.847026 \n\n     **bmi**       0.013296    0.031343  \n-----------------------------------------\n\n\n:::\n:::\n\n\n```stata         \n. poisson events bmi, offset(logmins) robust\n\nIteration 0:   log pseudolikelihood =  -11360.89  \nIteration 1:   log pseudolikelihood =  -11360.89  \n\nPoisson regression                                Number of obs   =        279\n                                                  Wald chi2(1)    =      23.42\n                                                  Prob > chi2     =     0.0000\nLog pseudolikelihood =  -11360.89                 Pseudo R2       =     0.0520\n\n------------------------------------------------------------------------------\n             |               Robust\n      events |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n         bmi |   .0223194   .0046121     4.84   0.000     .0132799    .0313589\n       _cons |  -3.119991    .139521   -22.36   0.000    -3.393448   -2.846535\n     logmins |   (offset)\n------------------------------------------------------------------------------\n```\n\n-   Interpretation of output\n\n    -   $\\textrm{log rate} = -3.119991 + 0.0223194 \\times \\textrm{BMI}$\n\n-   Interpretation of intercept\n\n    -   Estimated event rate when BMI is 0 is found by exponentiation: $e^{-3.12} = 0.044$\n\n    -   This is the rate per 2-minute interval. This unusual time interval is an artifact of the way in pH data is sampled\n\n        -   To convert to events per day, multiply by 720 (there are 720 2-minute intervals in a day)\n\n        -   $720 \\times e^{-3.12} = 31.7 \\textrm{ events per day}$\n\n-   Interpretation of slope\n\n    -   Estimated ratio of rates for two subjects differing by 1 in their BMI\n\n    -   Interpretation by exponentiation of slope\n\n        -   A subject with a 1 $\\textrm{kg} / m^2$ higher BMI will have an acid reflux event rate that is $2.3\\%$ higher. (calc: $e^{0.0223} = 1.023$)\n\n        -   We are 95% confident that the increase in event rate is between $1.3\\%$ higher and $3.2\\%$ higher\n\n        -   There is a significant association between BMI and reflux events $p < 0.001$\n\n## Example: Acid reflux and BMI by esophagitis status\n\n### BMI modeled as a linear term\n\n-   The following results compare using a Poisson model to a linear regression model\n\n-   Both models will control for Esophagitis status, so any interpretation must involve \"Holding esophagitis status constant...\" (\"Among subjects with the same Esophagitis status...\")\n\n-   Note the different (numerical) estimates for the coefficients and standard errors for BMI and esophagitis, but the similar statistical significance\n\n-   Also if we plot the predicted number of events per day versus BMI, the results are similar from either model\n\n#### R: Poisson regression of events with offset for log(total time monitored)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2.poisson <- glm(events ~ bmi + esop + offset(log(totalmins)), data=bmi.data, family=\"poisson\")\nm2.poisson\n```\n\n::: {.cell-output-display}\n\n----------------------------------------------------------------\n     &nbsp;        Estimate    Std. Error   z value    Pr(>|z|) \n----------------- ----------- ------------ ---------- ----------\n **(Intercept)**   -3.089033   0.01905614   -162.102      0     \n\n     **bmi**       0.019747    0.00063195    31.247       0     \n\n    **esop**       0.262217    0.01064106    24.642       0     \n----------------------------------------------------------------\n\nTable: Fitting generalized (poisson/log) linear model: events ~ bmi + esop + offset(log(totalmins))\n\n\n------------------- -----------------\n   **Degrees of      278 Total (i.e. \n     Freedom**            Null)      \n\n   **Degrees of       276 Residual   \n     Freedom**                       \n\n **Null Deviance**       22040.9     \n\n    **Residual           20217.5     \n    Deviance**                       \n\n      **AIC**            22150.7     \n------------------- -----------------\n\n\n:::\n\n```{.r .cell-code}\ncoeftest(m2.poisson, vcov=sandwich)\n```\n\n::: {.cell-output-display}\n\n------------------------------------------------------------------\n     &nbsp;        Estimate    Std. Error   z value     Pr(>|z|)  \n----------------- ----------- ------------ ---------- ------------\n **(Intercept)**   -3.089033   0.1420486    -21.7463   0.0000e+00 \n\n     **bmi**       0.019747    0.0047636     4.1453    3.3932e-05 \n\n    **esop**       0.262217    0.0830528     3.1572    1.5927e-03 \n------------------------------------------------------------------\n\nTable: z test of coefficients\n\n\n:::\n\n```{.r .cell-code}\nconfint(coeftest(m2.poisson, vcov=sandwich))\n```\n\n::: {.cell-output-display}\n\n-----------------------------------------\n     &nbsp;          2.5 %      97.5 %   \n----------------- ----------- -----------\n **(Intercept)**   -3.367443   -2.810623 \n\n     **bmi**       0.010410    0.029083  \n\n    **esop**       0.099437    0.424998  \n-----------------------------------------\n\n\n:::\n\n```{.r .cell-code}\n# Equivalent command\n#coefci(m2.poisson, vcov=sandwich)\n```\n:::\n\n\n#### R: Linear regression of rate (events/time) as outcome\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmi.data$rate <- bmi.data$events / bmi.data$totalmins\nm2.lm <-  lm(rate ~ bmi + esop, data=bmi.data)\nm2.lm\n```\n\n::: {.cell-output-display}\n\n---------------------------------------------------------------\n     &nbsp;        Estimate   Std. Error   t value   Pr(>|t|)  \n----------------- ---------- ------------ --------- -----------\n **(Intercept)**   0.027846   0.01460831   1.9062    0.0576652 \n\n     **bmi**       0.001839   0.00050133   3.6683    0.0002929 \n\n    **esop**       0.025104   0.00884648   2.8377    0.0048805 \n---------------------------------------------------------------\n\nTable: Fitting linear model: rate ~ bmi + esop\n\n\n:::\n\n```{.r .cell-code}\ncoeftest(m2.lm, vcov=sandwich)\n```\n\n::: {.cell-output-display}\n\n----------------------------------------------------------------\n     &nbsp;        Estimate   Std. Error   t value    Pr(>|t|)  \n----------------- ---------- ------------ --------- ------------\n **(Intercept)**   0.027846   0.01283576   2.1694    3.0905e-02 \n\n     **bmi**       0.001839   0.00045933   4.0037    8.0196e-05 \n\n    **esop**       0.025104   0.00849883   2.9538    3.4091e-03 \n----------------------------------------------------------------\n\nTable: t test of coefficients\n\n\n:::\n\n```{.r .cell-code}\nconfint(coeftest(m2.lm, vcov=sandwich))\n```\n\n::: {.cell-output-display}\n\n-----------------------------------------\n     &nbsp;          2.5 %      97.5 %   \n----------------- ----------- -----------\n **(Intercept)**   0.0025777   0.0531145 \n\n     **bmi**       0.0009348   0.0027433 \n\n    **esop**       0.0083732   0.0418348 \n-----------------------------------------\n\n\n:::\n:::\n\n\n#### Stata Output\n\n```stata\n. poisson events bmi esop, offset(logmins) robust\n\nPoisson regression                                Number of obs   =        279\n                                                  Wald chi2(2)    =      30.30\n                                                  Prob > chi2     =     0.0000\nLog pseudolikelihood = -11072.339                 Pseudo R2       =     0.0761\n\n------------------------------------------------------------------------------\n             |               Robust\n      events |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n         bmi |   .0197465   .0047721     4.14   0.000     .0103934    .0290997\n        esop |   .2622171    .083202     3.15   0.002     .0991442      .42529\n       _cons |  -3.089033   .1423038   -21.71   0.000    -3.367944   -2.810123\n     logmins |   (offset)\n------------------------------------------------------------------------------\n\n\n. gen eventsmins = events / mins\n. regress eventsmins bmi esop, robust\n\nLinear regression                                      Number of obs =     279\n                                                       F(  2,   276) =   14.16\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.0856\n                                                       Root MSE      =  .05102\n\n------------------------------------------------------------------------------\n             |               Robust\n  eventsmins |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n         bmi |    .001839   .0004618     3.98   0.000     .0009299    .0027482\n        esop |    .025104   .0085449     2.94   0.004     .0082826    .0419254\n       _cons |   .0278461   .0129053     2.16   0.032     .0024407    .0532515\n------------------------------------------------------------------------------\n```\n\n#### Comparison of predicted number of events from linear regression and Poisson regression models\n\n-   Example prediction calculations: BMI=30, with esophagitis\n\n    -   Linear regression: $0.0278461 + .025104 + .001839 \\times 30 = 0.108$\n\n        -   Stata: `adjust bmi=30 esop=1`\n\n    -   Poisson regression: $e^{-3.089033 + 0.2622171 + .01975465 \\times 30} = 0.107$\n\n        -   Stata: `adjust bmi=30 esop=1, nooffset exp`\n\n    -   Remember the above rates are for a 2-minute time interval. To convert to daily rates, multiply by 720\n\n\n        ::: {.cell}\n        \n        ```{.r .cell-code}\n        # Predicted events per two minute time interval\n        predict(m2.lm, newdata=data.frame(bmi=30,esop=1))\n        ```\n        \n        ::: {.cell-output .cell-output-stdout}\n        \n        ```\n               1 \n        0.108121 \n        ```\n        \n        \n        :::\n        \n        ```{.r .cell-code}\n        exp(predict(m2.poisson, newdata=data.frame(bmi=30,esop=1,totalmins=1), type=\"link\"))\n        ```\n        \n        ::: {.cell-output .cell-output-stdout}\n        \n        ```\n                1 \n        0.1070542 \n        ```\n        \n        \n        :::\n        \n        ```{.r .cell-code}\n        # Predicted events per day (720 2-minute time intervals per day)\n        predict(m2.lm, newdata=data.frame(bmi=30,esop=1))*720\n        ```\n        \n        ::: {.cell-output .cell-output-stdout}\n        \n        ```\n               1 \n        77.84713 \n        ```\n        \n        \n        :::\n        \n        ```{.r .cell-code}\n        exp(predict(m2.poisson, newdata=data.frame(bmi=30,esop=1,totalmins=720), type=\"link\"))\n        ```\n        \n        ::: {.cell-output .cell-output-stdout}\n        \n        ```\n               1 \n        77.07901 \n        ```\n        \n        \n        :::\n        :::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmi.data$esop.factor <- factor(bmi.data$esop, levels=0:1, labels=c(\"Esop Neg\", \"Esop Pos\"))\nm.spline2.adj <- glm(events ~ bmi + offset(log(totalmins)) + esop, data=bmi.data, family=\"poisson\")\nm.spline3.adj <- lm(events / totalmins ~ bmi + esop, data=bmi.data)\npar(mfrow=c(1,2), mar=c(5,4,4,0.5))\nplot(18:40, exp(predict(m.spline2.adj, newdata=data.frame(bmi=18:40, totalmins=720, esop=1), type=\"link\")), type='l', ylab=\"Predicted number of events per day\", xlab=\"BMI\", ylim=c(30,100), main=\"Poisson Reg\")\naxis(4, labels=FALSE, ticks=TRUE)\nlegend(\"bottomright\", c(\"Esophagitis Pos\",\"Esophagitis Neg\"), inset=0.05, col=1, lty=1:2)\nlines(18:40, exp(predict(m.spline2.adj, newdata=data.frame(bmi=18:40, totalmins=720, esop=0), type=\"link\")), lty=2)\nplot(18:40, 720*predict(m.spline3.adj, newdata=data.frame(bmi=18:40, esop=1), type=\"response\"), type='l', col='Blue', ylab=\"\", xlab=\"BMI\", ylim=c(30,100), main=\"Linear Reg\", axes=FALSE)\naxis(1)\naxis(4)\naxis(2, labels=FALSE, ticks=TRUE)\nbox()\nlines(18:40, 720*predict(m.spline3.adj, newdata=data.frame(bmi=18:40, esop=0), type=\"response\"), type='l', col='Blue', lty=2)\nlegend(\"bottomright\", c(\"Esophagitis Pos\",\"Esophagitis Neg\"), inset=0.05, col=\"Blue\", lty=1:2)\n```\n\n::: {.cell-output-display}\n![](Lec09.Poisson_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### BMI modeled using splines\n\n-   Regression splines are handled more naturally in R than in Stata\n\n    -   `glm(events ~ ns(bmi,4) + esop + offset(log(totalmins)), data=bmi.data, family=\"poisson\")`\n\n    -   `ns(bmi, 4)` specified a natural spline for bmi with 4 degrees of freedom\n\n-   Note that there is an optical illusion in the following plots\n\n    -   For both plots, it appears as if the lines are closer in the middle ranges of BMI\n\n    -   For the Poisson regression, the true distance between lines is increasing with increasing with BMI\n\n    -   For the Linear regrression, the true distance between lines is constant\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm.spline2.adj <- glm(events ~ ns(bmi,4) + offset(log(totalmins)) + esop, data=bmi.data, family=\"poisson\")\nm.spline3.adj <- lm(events / totalmins ~ ns(bmi,4) + esop, data=bmi.data)\npar(mfrow=c(1,2), mar=c(5,4,4,0.5))\nplot(18:40, exp(predict(m.spline2.adj, newdata=data.frame(bmi=18:40, totalmins=720, esop=1), type=\"link\")), type='l', ylab=\"Predicted number of events per day\", xlab=\"BMI\", ylim=c(0,100), main=\"Poisson Reg\")\naxis(4, labels=FALSE, ticks=TRUE)\nlegend(\"bottomright\", c(\"Esophagitis Pos\",\"Esophagitis Neg\"), inset=0.05, col=1, lty=1:2)\nlines(18:40, exp(predict(m.spline2.adj, newdata=data.frame(bmi=18:40, totalmins=720, esop=0), type=\"link\")), lty=2)\nplot(18:40, 720*predict(m.spline3.adj, newdata=data.frame(bmi=18:40, esop=1), type=\"response\"), type='l', col='Blue', ylab=\"\", xlab=\"BMI\", ylim=c(0,100), main=\"Linear Reg\", axes=FALSE)\naxis(1)\naxis(4)\naxis(2, labels=FALSE, ticks=TRUE)\nbox()\nlines(18:40, 720*predict(m.spline3.adj, newdata=data.frame(bmi=18:40, esop=0), type=\"response\"), type='l', col='Blue', lty=2)\nlegend(\"bottomright\", c(\"Esophagitis Pos\",\"Esophagitis Neg\"), inset=0.05, col=\"Blue\", lty=1:2)\n```\n\n::: {.cell-output-display}\n![](Lec09.Poisson_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Comparison of modeling linear BMI to using spline function\n\n-   For all regression models, we are more confident modeling associations than predicting means\n\n-   When we use a linear term (i.e. a straight line) for the predictor, we are modeling a first-order association\n\n    -   Most power to detect this type of association\n\n    -   Always need to check that a first-order association answers the scientific question\n\n        -   Counter example: Interested in seasonal trends in air pollution. A linear effect of time would only answer if air pollution levels are increasing/decreasing over time, not how they are changing from month to month\n\n-   Flexible functions for predictors, including splines, are, in general, more useful if we care about predicting means or individual observations\n\n-   Acid reflux example: Which model you choose depends on the scientific goals\n\n    -   Primary goal: Is there an association between BMI and the rate of acid reflux?\n\n        -   Fitting the linear BMI term answers this question\n\n    -   Secondary goal: Describe the (mean) trend in reflux rates as a function of BMI\n\n        -   A priori, I would be less inclined to believe a linear function captures the true mean relationship\n\n        -   To answer this scientific question, a spline analysis is preferred\n",
    "supporting": [
      "Lec09.Poisson_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}