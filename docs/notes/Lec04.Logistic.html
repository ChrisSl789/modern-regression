<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Slaughter">
<meta name="dcterms.date" content="2026-02-02">

<title>Logistic Regression – BIOS 6312 - Spring 2026</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/Lec05.Precision.html" rel="next">
<link href="../notes/Lec03.SimpleLinearRegression.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Logistic Regression – BIOS 6312 - Spring 2026">
<meta property="og:description" content="Lecture 04">
<meta property="og:site_name" content="BIOS 6312 - Spring 2026">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec04.Logistic.html">Logistic Regression</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">BIOS 6312 - Spring 2026</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Course Information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/Lec01.Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductory Slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../officehours.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Office Hours</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec02.review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review of Key Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec03.SimpleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec04.Logistic.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec05.Precision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precision of Statistical Intefence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec06.ConfoundingEffectModificationMediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confouding, Effect Modification, and Mediation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec07.MultivariableModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariable Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/EstimationAndInference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frequentist Estimation and Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set6.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec08.Survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec09.Poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec10.Modeling.Effect.Modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set8.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial and Ordinal Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec11.DoseResponse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Flexible Modeling of Continuous Predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec12.ANOVA.Model.Choice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA and Model Choice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec13.Prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Based Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/BayesDiagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Model Diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set13.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set14.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Bootstrap</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab1-linearregression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Linear regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab2-linearassumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Assumption in Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab3-logistic-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab4-precision-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Precision and adjustment for baseline</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab-weighted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(Mini) Lab: Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab5-multivariable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5: Multivariable Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab6-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 6: Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab7-effectmodification-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7: Poisson Regression and Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab-DiscreteOutcomeRegression.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 8: Discrete Outcomes Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vanderbilt.box.com/s/rpftvmc9vua2w3gz3jy16phlnsojs6on" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Box folder with .qmd files</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Supplemental notes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/slr-derivations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SLR derivations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-diagnostics-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/mlr-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLR matrix notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/log-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Log transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-selection-criteria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model selection criteria</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/ReviewMatrixAlgebra.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrix algebra review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/Baseline_Change_MACH.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Change from baseline and precision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/log-transform-interpretations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interpreting Regression Coefficients: Log Transformations and Scale</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Statcomp2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Main directory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/data" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#general-regression-setting" id="toc-general-regression-setting" class="nav-link active" data-scroll-target="#general-regression-setting"><span class="header-section-number">1</span> General Regression Setting</a>
  <ul>
  <li><a href="#uses-of-general-regression" id="toc-uses-of-general-regression" class="nav-link" data-scroll-target="#uses-of-general-regression"><span class="header-section-number">1.1</span> Uses of General Regression</a></li>
  </ul></li>
  <li><a href="#simple-logistic-regression" id="toc-simple-logistic-regression" class="nav-link" data-scroll-target="#simple-logistic-regression"><span class="header-section-number">2</span> Simple Logistic Regression</a>
  <ul>
  <li><a href="#uses-of-logistic-regression" id="toc-uses-of-logistic-regression" class="nav-link" data-scroll-target="#uses-of-logistic-regression"><span class="header-section-number">2.1</span> Uses of logistic regression</a></li>
  <li><a href="#reasons-to-use-logistic-regression" id="toc-reasons-to-use-logistic-regression" class="nav-link" data-scroll-target="#reasons-to-use-logistic-regression"><span class="header-section-number">2.2</span> Reasons to use logistic regression</a></li>
  <li><a href="#the-simple-logistic-regression-model" id="toc-the-simple-logistic-regression-model" class="nav-link" data-scroll-target="#the-simple-logistic-regression-model"><span class="header-section-number">2.3</span> The simple logistic regression model</a></li>
  </ul></li>
  <li><a href="#example-survival-on-the-titanic-and-age" id="toc-example-survival-on-the-titanic-and-age" class="nav-link" data-scroll-target="#example-survival-on-the-titanic-and-age"><span class="header-section-number">3</span> Example: Survival on the Titanic and Age</a>
  <ul>
  <li><a href="#descriptive-plots" id="toc-descriptive-plots" class="nav-link" data-scroll-target="#descriptive-plots"><span class="header-section-number">3.1</span> Descriptive Plots</a></li>
  <li><a href="#regression-model" id="toc-regression-model" class="nav-link" data-scroll-target="#regression-model"><span class="header-section-number">3.2</span> Regression Model</a></li>
  <li><a href="#comments-on-interpretation" id="toc-comments-on-interpretation" class="nav-link" data-scroll-target="#comments-on-interpretation"><span class="header-section-number">3.3</span> Comments on Interpretation</a>
  <ul class="collapse">
  <li><a href="#sec-bayeslogistic" id="toc-sec-bayeslogistic" class="nav-link" data-scroll-target="#sec-bayeslogistic"><span class="header-section-number">3.3.1</span> Bayesian Estimates and Interpretation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#inference-with-logistic-regression" id="toc-inference-with-logistic-regression" class="nav-link" data-scroll-target="#inference-with-logistic-regression"><span class="header-section-number">4</span> Inference with Logistic Regression</a>
  <ul>
  <li><a href="#interpreting-positive-results" id="toc-interpreting-positive-results" class="nav-link" data-scroll-target="#interpreting-positive-results"><span class="header-section-number">4.1</span> Interpreting “Positive” Results</a></li>
  <li><a href="#interpreting-negative-results" id="toc-interpreting-negative-results" class="nav-link" data-scroll-target="#interpreting-negative-results"><span class="header-section-number">4.2</span> Interpreting “Negative” Results</a></li>
  </ul></li>
  <li><a href="#model-diagnostics-for-understanding-results" id="toc-model-diagnostics-for-understanding-results" class="nav-link" data-scroll-target="#model-diagnostics-for-understanding-results"><span class="header-section-number">5</span> Model Diagnostics for Understanding Results</a>
  <ul>
  <li><a href="#diagnostic-examples-using-titanic-data" id="toc-diagnostic-examples-using-titanic-data" class="nav-link" data-scroll-target="#diagnostic-examples-using-titanic-data"><span class="header-section-number">5.1</span> Diagnostic examples using Titanic data</a>
  <ul class="collapse">
  <li><a href="#binned-residuals" id="toc-binned-residuals" class="nav-link" data-scroll-target="#binned-residuals"><span class="header-section-number">5.1.1</span> (Binned) residuals</a></li>
  <li><a href="#predicted-versus-observed-probabilities-of-survival" id="toc-predicted-versus-observed-probabilities-of-survival" class="nav-link" data-scroll-target="#predicted-versus-observed-probabilities-of-survival"><span class="header-section-number">5.1.2</span> Predicted versus observed probabilities of survival</a></li>
  <li><a href="#influential-observations-using-delta-betas" id="toc-influential-observations-using-delta-betas" class="nav-link" data-scroll-target="#influential-observations-using-delta-betas"><span class="header-section-number">5.1.3</span> Influential observations using delta-betas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#example-analysis-revisited-effect-modification" id="toc-example-analysis-revisited-effect-modification" class="nav-link" data-scroll-target="#example-analysis-revisited-effect-modification"><span class="header-section-number">6</span> Example analysis revisited: Effect Modification</a>
  <ul>
  <li><a href="#stratified-analysis-by-sex" id="toc-stratified-analysis-by-sex" class="nav-link" data-scroll-target="#stratified-analysis-by-sex"><span class="header-section-number">6.1</span> Stratified analysis by sex</a>
  <ul class="collapse">
  <li><a href="#odds-ratios-and-confidence-intervals-for-age-effect-by-sex" id="toc-odds-ratios-and-confidence-intervals-for-age-effect-by-sex" class="nav-link" data-scroll-target="#odds-ratios-and-confidence-intervals-for-age-effect-by-sex"><span class="header-section-number">6.1.1</span> Odds ratios and confidence intervals for age effect by sex</a></li>
  </ul></li>
  <li><a href="#effect-modification-using-interaction-terms" id="toc-effect-modification-using-interaction-terms" class="nav-link" data-scroll-target="#effect-modification-using-interaction-terms"><span class="header-section-number">6.2</span> Effect modification using interaction terms</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header">

<div class="right">
<!--
<a href="https://github.com/chrissl789/modern-regression/raw/main/Lec04.Logistic.qmd" target="_blank">View Code</a>
-->
<a href="https://statcomp2.app.vumc.org/modern-regression/lectures/Lec04.Logistic.qmd" target="_blank">Download Code</a>

</div>

<div class="quarto-title-block d-none d-lg-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec04.Logistic.html">Logistic Regression</a></li></ol></nav><div><h1 class="title">Logistic Regression</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lecture 04</p>
<p class="author">Chris Slaughter</p>

<p class="date">February 2, 2026</p>

</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">source</span>(<span class="st">'pander_registry.R'</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">invisible</span>(e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="general-regression-setting" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="general-regression-setting"><span class="header-section-number">1</span> General Regression Setting</h2>
<ul>
<li><p>Types of variables</p>
<ul>
<li><p>Binary data: e.g.&nbsp;sex, death</p></li>
<li><p>Nominal (unordered categorical) data: e.g.&nbsp;race, marital status</p></li>
<li><p>Ordinal (ordered categorical data): e.g.&nbsp;cancer stage, asthma severity</p></li>
<li><p>Quantitative data: e.g.&nbsp;age, blood pressure</p></li>
<li><p>Right censored data: e.g.&nbsp;time to death</p></li>
</ul></li>
<li><p>The measures used to summarize and compare distributions vary according to the type of variable</p>
<ul>
<li><p>Means: Binary, quantitative</p></li>
<li><p>Medians: Ordered, quantitative, censored</p></li>
<li><p>Proportions: Binary, nominal, ordinal</p></li>
<li><p>Odds: Binary, nominal, ordinal</p></li>
<li><p>Hazards: Censored</p></li>
</ul></li>
<li><p>Which regression model you choose to use is based on the parameter being compared across groups</p></li>
</ul>
<div class="center">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Approach</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Means</td>
<td style="text-align: left;">Linear regression</td>
</tr>
<tr class="even">
<td style="text-align: left;">Geometric means</td>
<td style="text-align: left;">Linear regression on log scale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Odds</td>
<td style="text-align: left;">Logistic regression</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rates</td>
<td style="text-align: left;">Poisson regression</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hazards</td>
<td style="text-align: left;">Proportional Hazards (Cox) regression</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>General notation for variables and parameters</li>
</ul>
<div class="center">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(Y_i\)</span></td>
<td style="text-align: left;">Response measured on the <span class="math inline">\(i\)</span>th subject</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(X_i\)</span></td>
<td style="text-align: left;">Value of the predictor measured on the <span class="math inline">\(i\)</span>th subject</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\theta_i\)</span></td>
<td style="text-align: left;">Parameter summarizing distribution of <span class="math inline">\(Y_i \mid X_i\)</span></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>The parameter (<span class="math inline">\(\theta_i\)</span>) might be the mean, geometric mean, odds, rate, instantaneous risk of an event (hazard), etc.</p></li>
<li><p>In linear regression on means, <span class="math inline">\(\theta_i = E[Y_i | X_i]\)</span></p></li>
<li><p>Choice of correct <span class="math inline">\(\theta_i\)</span> should be based on scientific understanding of problem</p></li>
<li><p>General notation for simple regression model</p></li>
</ul>
<p><span class="math display">\[g(\theta_i) = \beta_0 + \beta_1 \times X_i\]</span></p>
<div class="center">
<p>General notation for regression model with one predictor</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(g( )\)</span></td>
<td style="text-align: left;">Link function used for modeling</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_0\)</span></td>
<td style="text-align: left;">Intercept</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_1\)</span></td>
<td style="text-align: left;">Slope for predictor <span class="math inline">\(X\)</span></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>The link function is often either the identity function (for modeling means) or log (for modeling geometric means, odds, hazards)</p>
<ul>
<li>Identity function: <span class="math inline">\(f(x) = x\)</span></li>
</ul></li>
</ul>
<section id="uses-of-general-regression" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="uses-of-general-regression"><span class="header-section-number">1.1</span> Uses of General Regression</h3>
<ul>
<li><p>Borrowing information</p>
<ul>
<li><p>Use other groups to make estimates in groups with sparse data</p></li>
<li><p>Intuitively, 67 and 69 year olds would provide some relevant information about 68 year olds</p></li>
<li><p>Assuming a straight line relationship tells us about other, even more distant, individuals</p></li>
<li><p>If we do not want to assume a straight line, we may only want to borrow information from nearby groups</p></li>
</ul></li>
<li><p>Defining “Contrasts”</p>
<ul>
<li><p>Define a comparison across groups to use when answering scientific questions</p></li>
<li><p>If the straight line relationship holds, the slope is the difference in parameter between groups differing by 1 unit in <span class="math inline">\(X\)</span></p></li>
<li><p>If a non-linear relationship in parameter, the slope is still the average difference in parameter between groups differing by 1 unit in <span class="math inline">\(X\)</span></p></li>
<li><p>Slope is a (first order or linear) test for trend in the parameter</p></li>
<li><p>Statistical jargon: “a contrast” across groups</p></li>
</ul></li>
<li><p>The major difference between different regression models is the interpretation of the parameters</p>
<ul>
<li><p>How do I want to summarize the outcome?</p></li>
<li><p>Mean, geometric mean, odds, hazard</p></li>
</ul></li>
<li><p>How do I want to compare groups?</p>
<ul>
<li>Difference, ratio</li>
</ul></li>
<li><p>Answering these two simple questions provides a starting road-map as to which regression model to choose</p></li>
<li><p>Issues related to the inclusion of covariates remains the same</p>
<ul>
<li><p>Address the scientific question: Predictor of interest, effect modification</p></li>
<li><p>Address confounding</p></li>
<li><p>Increase precision</p></li>
</ul></li>
<li><p>The remainder of these notes will focus on logistic regression for binary outcomes</p>
<ul>
<li><p>We will apply the general regression framework described above, where <span class="math inline">\(\theta_i\)</span> represents the odds of the outcome and <span class="math inline">\(g()\)</span> is the logit (log odds) link function</p></li>
<li><p>The principles of borrowing information, defining contrasts, and addressing confounding remain the same as in linear regression</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="simple-logistic-regression" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="simple-logistic-regression"><span class="header-section-number">2</span> Simple Logistic Regression</h2>
<section id="uses-of-logistic-regression" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="uses-of-logistic-regression"><span class="header-section-number">2.1</span> Uses of logistic regression</h3>
<ul>
<li><p>Use logistic regression when you want to make inference about the odds</p>
<ul>
<li><p>Allows for continuous (or multiple) grouping variables</p></li>
<li><p>Is OK with binary grouping variables too</p></li>
<li><p>Compares odds of responses across groups using ratios</p>
<ul>
<li>“Odds ratio”</li>
</ul></li>
</ul></li>
<li><p>Binary response variable</p></li>
<li><p>When using regression with binary response variables, we typically model the (log) odds using logistic regression</p>
<ul>
<li><p>Conceptually there should be no problem modeling the proportion (which is the mean of the distribution) using linear regression. In this case, measures of associations would be the risk difference.</p></li>
<li><p>However, there are several technical reasons why we do not use linear regression very often with binary responses</p></li>
</ul></li>
<li><p>Technical problems with linear regression for binary responses:</p>
<ul>
<li><p>Predicted probabilities can fall outside [0,1] range</p></li>
<li><p>Heteroskedasticity: Variance of binary outcome depends on the mean, <span class="math inline">\(\text{Var}(Y|X) = p(X)(1-p(X))\)</span></p>
<ul>
<li><p>Variance is not constant across values of X</p></li>
<li><p>Maximum variance occurs when <span class="math inline">\(p=0.5\)</span>, minimum when <span class="math inline">\(p\)</span> is near 0 or 1</p></li>
<li><p>If the scientific goal is association, less problematic with large sample size and robust SEs</p></li>
</ul></li>
<li><p>Non-normal residuals (also less problematic with large samples and robust SEs)</p></li>
<li><p>Effect of predictor on probability is constrained to be linear (constant across range)</p>
<ul>
<li><p>A 10-year age increase has same effect on probability regardless of starting age</p></li>
<li><p>This may be implausible when probabilities approach 0 or 1</p></li>
</ul></li>
</ul></li>
<li><p>Why model odds instead of probabilities or risk differences?</p>
<ul>
<li><p>Scientific basis</p>
<ul>
<li><p>Odds ratios are estimable in case-control studies (as shown above)</p></li>
<li><p>Linear trends in log odds may be more plausible than linear trends in probabilities</p>
<ul>
<li><p>Logit transformation naturally constrains predictions to [0,1]</p></li>
<li><p>Effect modification on the odds ratio scale may be less common than on the probability scale</p></li>
</ul></li>
</ul></li>
<li><p>Statistical basis</p>
<ul>
<li><p>The mean-variance relationship for binary data is naturally incorporated in the logistic regression likelihood</p>
<ul>
<li><p>Classical logistic regression accounts for heteroskedasticity through the binomial variance structure</p></li>
<li><p>Can still use robust SEs if you want to relax distributional assumptions</p></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="reasons-to-use-logistic-regression" class="level3 page-columns page-full" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="reasons-to-use-logistic-regression"><span class="header-section-number">2.2</span> Reasons to use logistic regression</h3>
<ul>
<li><p>First (scientific) reason: Case-Control Studies</p>
<ul>
<li><p>Studying a rare disease, so we do study in reverse</p>
<ul>
<li><p>e.g.&nbsp;find subjects with cancer (and suitable controls) and then ascertain exposure of interest</p></li>
<li><p>Estimate distribution of the “effect” across groups defined by “cause”</p></li>
<li><p>Proportion (or odds) of smokers among people with or without lung cancer</p></li>
</ul></li>
</ul>
<table class="caption-top table">
<caption>Case-Control or Cohort 2x2 Table. In the Case-Control design, the total number of subjects with Cancer <span class="math inline">\((a+c)\)</span> and without cancer <span class="math inline">\((b+d)\)</span> are fixed by design.</caption>
<tbody>
<tr class="odd">
<td></td>
<td>Lung Cancer +</td>
<td>Lung Cancer -</td>
</tr>
<tr class="even">
<td>Smoker</td>
<td>a</td>
<td>b</td>
</tr>
<tr class="odd">
<td>Non-Smoker</td>
<td>c</td>
<td>d</td>
</tr>
</tbody>
</table>
<ul>
<li><p>In contrast, a cohort study samples by exposure (smoking) and then estimates the distribution of the effect in exposure groups</p></li>
<li><p>In a case-control study, we cannot estimate prevalence (without knowing selection probabilities)</p>
<ul>
<li>e.g.&nbsp;if doing a 1:1 case-control study, <span class="math inline">\((a+c) = b+d\)</span> so it would look like <span class="math inline">\(50\%\)</span> of the subjects have cancer</li>
</ul></li>
<li><p>Odds ratios are estimable in either case-control or cohort sampling scheme</p>
<ul>
<li><p>Cohort study: Odds of cancer among smoker compared to odds of cancer among nonsmokers</p></li>
<li><p>Case-control study: Odds of smoking among cancer compared to odds of smoking among non-cancer</p></li>
</ul></li>
<li><p>Mathematically, these two odds ratios are the same</p></li>
</ul></li>
</ul>
<p><span class="math display">\[\text{OR}_{\text{cohort}} = \frac{\text{Odds of disease in exposed}}{\text{Odds of disease in unexposed}} = \frac{P(D=1|E=1)/P(D=0|E=1)}{P(D=1|E=0)/P(D=0|E=0)}\]</span></p>
<p><span class="math display">\[= \frac{P(D=1|E=1) \times P(D=0|E=0)}{P(D=0|E=1) \times P(D=1|E=0)}\]</span></p>
<p><span class="math display">\[\text{OR}_{\text{case-control}} = \frac{\text{Odds of exposure in diseased}}{\text{Odds of exposure in non-diseased}} = \frac{P(E=1|D=1)/P(E=0|D=1)}{P(E=1|D=0)/P(E=0|D=0)}\]</span></p>
<p><span class="math display">\[= \frac{P(E=1|D=1) \times P(E=0|D=0)}{P(E=0|D=1) \times P(E=1|D=0)}\]</span></p>
<p>By Bayes’ theorem, <span class="math inline">\(P(D=1|E=1) = \frac{P(E=1|D=1) \times P(D=1)}{P(E=1)}\)</span>, and similarly for the other conditional probabilities. Substituting these into the cohort odds ratio:</p>
<p><span class="math display">\[\text{OR}_{\text{cohort}} = \frac{\frac{P(E=1|D=1) \times P(D=1)}{P(E=1)} \times \frac{P(E=0|D=0) \times P(D=0)}{P(E=0)}}{\frac{P(E=0|D=1) \times P(D=1)}{P(E=0)} \times \frac{P(E=1|D=0) \times P(D=0)}{P(E=1)}}\]</span></p>
<p><span class="math display">\[= \frac{P(E=1|D=1) \times P(E=0|D=0)}{P(E=0|D=1) \times P(E=1|D=0)} = \text{OR}_{\text{case-control}}\]</span></p>
<ul>
<li><p>Thus, the disease odds ratio equals the exposure odds ratio, making the odds ratio estimable from either study design.</p>
<ul>
<li><p>Odds ratios are easy to interpret when investigating rare events</p>
<ul>
<li><p>Odds = prob / (1 - prob)</p></li>
<li><p>For rare events, (1 - prob) is approximately 1</p>
<ul>
<li><p>Odds is approximately the probability</p></li>
<li><p>Odds ratios are approximately risk ratios</p></li>
</ul></li>
<li><p>Case-control studies usually used when events are rare</p></li>
</ul></li>
</ul></li>
<li><p>Second (scientific) reason: Linearity</p>
<ul>
<li><p>Proportions are bounded by 0 and 1</p></li>
<li><p>It is thus unlikely that a straight line relationship would exists between a proportion and a predictor</p>
<ul>
<li><p>Unless the predictor itself is bounded</p></li>
<li><p>Otherwise, there eventually must be a threshold above which the probability does not increase (or only increases a little)</p></li>
</ul></li>
</ul></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))}</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cf">function</span>(x) <span class="fu">expit</span>(x), <span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>, <span class="at">ylab=</span><span class="st">"Probabilty"</span>, <span class="at">xlab=</span><span class="st">"Predictor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Logistic function will bound probabilities between 0 and 1</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Third (scientific) reason: Effect modification</p>
<ul>
<li><p>The restriction on ranges for probabilities makes it likely that effect modification <em>must</em> be present with proportions</p></li>
<li><p>Example: Is the association between 2-year relapse rates and having a positive scan modified by gender?</p>
<ul>
<li><p>Women relapse 40% of the time when the scan is negative, and 95% of the time when the scan is positive (an increase of 55%)</p>
<ul>
<li><p>If men relapse 75% of the time when the scan is negative, then a positive scan can increase the relapse rate to at most 100%, which is only a 25% increase</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td><strong>Proportions</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Women</td>
<td>Men</td>
</tr>
<tr class="odd">
<td>Negative Scan</td>
<td>40%</td>
<td>75%</td>
</tr>
<tr class="even">
<td>Positive Scan</td>
<td>95%</td>
<td>(up to 100%)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Difference</td>
<td>55%</td>
<td>Up to 25%</td>
</tr>
<tr class="odd">
<td>Ratio</td>
<td>2.38</td>
<td><span class="math inline">\(\leq 1.33\)</span></td>
</tr>
</tbody>
</table></li>
<li><p>With the odds, the association can hold without effect modification</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td><strong>Odds</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Women</td>
<td>Men</td>
</tr>
<tr class="odd">
<td>Negative Scan</td>
<td>0.67</td>
<td>3</td>
</tr>
<tr class="even">
<td>Positive Scan</td>
<td>19</td>
<td>(up to <span class="math inline">\(\infty\)</span>)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Ratio</td>
<td>28.5</td>
<td><span class="math inline">\(&lt; \infty\)</span></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>If the odds of positive scan in men was 85.5, then the odds ratio would be exactly 28.5 (no effect modification)</p></li>
<li><p>Fourth (statistics) reason:</p>
<ul>
<li><p>Classical linear regression requires equal variances across each predictor group</p></li>
<li><p>But, with binary data, the variance within a group depends on the mean</p></li>
<li><p>For binary <span class="math inline">\(Y\)</span>, <span class="math inline">\(E(Y) = p\)</span> and <span class="math inline">\(Var(Y) = p(1-p)\)</span></p></li>
<li><p>With robust standard errors, the mean-variance relationship is not a major problem. However, a logistic model that correctly models the mean-variance relationship will be more efficient.</p></li>
</ul></li>
</ul>
</section>
<section id="the-simple-logistic-regression-model" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="the-simple-logistic-regression-model"><span class="header-section-number">2.3</span> The simple logistic regression model</h3>
<ul>
<li><p>Modeling the odds of binary response variable <span class="math inline">\(Y\)</span> on predictor <span class="math inline">\(X\)</span></p>
<ul>
<li><p>Distribution: <span class="math inline">\(\textrm{Pr}(Y_i = 1) = p_i\)</span></p></li>
<li><p>Model: <span class="math inline">\(\textrm{logit}(p_i) = \textrm{log}\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 \times X_i\)</span></p></li>
<li><p>When <span class="math inline">\(X_i = 0\)</span>: log odds = <span class="math inline">\(\beta_0\)</span></p></li>
<li><p>When <span class="math inline">\(X_i = x\)</span>: log odds = <span class="math inline">\(\beta_0 + \beta_1 \times x\)</span></p></li>
<li><p>When <span class="math inline">\(X_i = x+1\)</span>: log odds = <span class="math inline">\(\beta_0 + \beta_1 \times x + \beta_1\)</span></p></li>
</ul></li>
<li><p>To interpret as odds, exponentiate the regression parameters</p>
<ul>
<li>Distribution: <span class="math inline">\(\textrm{Pr}(Y_i = 1) = p_i\)</span></li>
<li>Model: <span class="math inline">\(\frac{p_i}{1-p_i} = \exp(\beta_0 + \beta_1 \times X_i) = e^{\beta_0} \times e^{\beta_1 \times X_i}\)</span></li>
<li>When <span class="math inline">\(X_i = 0\)</span>: odds = <span class="math inline">\(e^{\beta_0}\)</span></li>
<li>When <span class="math inline">\(X_i = x\)</span>: odds = <span class="math inline">\(e^{\beta_0} \times e^{\beta_1 \times x}\)</span></li>
<li>When <span class="math inline">\(X_i = x+1\)</span>: odds = <span class="math inline">\(e^{\beta_0} \times e^{\beta_1 \times x} \times e^{\beta_1}\)</span></li>
</ul></li>
<li><p>To interpret as proportions (remember proportion = odds / (1 + odds))</p>
<ul>
<li>Distribution: <span class="math inline">\(\textrm{Pr}(Y_i = 1) = p_i\)</span></li>
<li>Model: <span class="math inline">\(p_i = \frac{e^{\beta_0} e^{\beta_1 \times X_i}}{1 + e^{\beta_0} e^{\beta_1 \times X_i}}\)</span></li>
<li>When <span class="math inline">\(X_i = 0\)</span>: <span class="math inline">\(p_i = \frac{e^{\beta_0}}{1 + e^{\beta_0}}\)</span><br>
</li>
<li>When <span class="math inline">\(X_i = x\)</span>: <span class="math inline">\(p_i = \frac{e^{\beta_0} e^{\beta_1 \times x}}{1 + e^{\beta_0} e^{\beta_1 \times x}}\)</span></li>
<li>When <span class="math inline">\(X_i = x+1\)</span>: <span class="math inline">\(p_i = \frac{e^{\beta_0} e^{\beta_1 \times x} e^{\beta_1}}{1 + e^{\beta_0} e^{\beta_1 \times x}e^{\beta_1}}\)</span></li>
</ul></li>
<li><p>Most common interpretations found by exponentiating the coefficients</p>
<ul>
<li><p>Odds when predictor is 0 found by exponentiating the intercept: <span class="math inline">\(\exp(\beta_0)\)</span></p></li>
<li><p>Odds ratio between groups differing in the values of the predictor by 1 unit found by exponentiating the slope: <span class="math inline">\(\exp(\beta_1)\)</span></p></li>
</ul></li>
<li><p>Stata commands</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> respvar predvar, [<span class="kw">robust</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Provides regression parameter estimates an inference on the log odds scale (both coefficients with CIs, SEs, p-values)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">logistic</span> respvar predvar, [<span class="kw">robust</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Provides regression parameter estimates and inference on the odds ratio scale (only slope with CIs, SEs, p-values)</li>
</ul></li>
<li><p>R Commands</p>
<ul>
<li><p>With rms package, <code>lrm(respvar ~ predvar, ...)</code></p></li>
<li><p><code>robcov(fit)</code> gives robust standard error estimates in `lrm’</p></li>
<li><p>In general, <code>glm(respvar ~ predvar, family=“binomial”)</code></p></li>
<li><p><code>sandwich()</code> in the sandwich library can give robust standard errors when using <code>glm</code></p></li>
</ul></li>
</ul>
</section>
</section>
<section id="example-survival-on-the-titanic-and-age" class="level2 page-columns page-full" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="example-survival-on-the-titanic-and-age"><span class="header-section-number">3</span> Example: Survival on the Titanic and Age</h2>
<ul>
<li><p>Dataset at <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/data/" class="uri">https://statcomp2.app.vumc.org/modern-regression/lectures/data/</a></p></li>
<li><p>Describes the survival status of individual passengers on the Titanic</p></li>
<li><p>Data on age available for many, but not all, subjects (data continually being updated)</p></li>
<li><p>Response variables is Survival</p>
<ul>
<li>Binary variable: 1=Survived, 0=Died</li>
</ul></li>
<li><p>Predictor variable is Age</p>
<ul>
<li>Continuous grouping variable</li>
</ul></li>
<li><p>Possibly different age effects by sex (effect modification by sex)</p></li>
</ul>
<section id="descriptive-plots" class="level3 page-columns page-full" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="descriptive-plots"><span class="header-section-number">3.1</span> Descriptive Plots</h3>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">"data/titanic3.csv"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">naclus</span>(titanic)) <span class="co"># study patterns of missing values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Missing data patterns in the Tianic dataset</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>survived)) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="dv">0</span>, <span class="at">height=</span>.<span class="dv">02</span>, <span class="at">alpha=</span>.<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Scatterplot of age versus survival in the Titanic data with lowess smooth. This simple plot is not very useful because survival is either 0 or 1, making it hard to visualize any trends.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(titanic, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plsmo</span>(age, survived, <span class="at">group=</span>sex, <span class="at">datadensity=</span>T, <span class="at">ylab=</span><span class="st">"Survived (1=Yes, 0=No)"</span>, <span class="at">xlab=</span><span class="st">"Age (years)"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Age versus survival by sex in the Titanic data by age using a super smoother. The trends are clearer with this smoothing approach.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Comments on the plots</p>
<ul>
<li><p>Age is missing for many subjects, which we will not worry about in the following analysis</p></li>
<li><p>The simple scatterplot, even with superimposes lowess smooth, is worthless. I have jittered the point and altered their opacity to help visualize overlapping point.</p></li>
<li><p>More advanced plotting available in R (in this case, the plsmo() function) can help to visualize the data</p></li>
</ul></li>
</ul>
</section>
<section id="regression-model" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="regression-model"><span class="header-section-number">3.2</span> Regression Model</h3>
<ul>
<li><p>Regression model for survival on age (ignoring possible effect modification for now)</p></li>
<li><p>Answer question by assessing linear trends in log odds of survival by age</p></li>
<li><p>Estimate the best fitting line to log odds of survival within age groups</p></li>
</ul>
<p><span class="math display">\[\textrm{logodds}(\textrm{Survival} | \textrm{Age}) = \beta_0 + \beta_1 \times \textrm{Age}\]</span></p>
<ul>
<li><p>An association will exist if the slope <span class="math inline">\(\beta_1\)</span> is nonzero</p></li>
<li><p>In that case, the odds (and probability) of survival will be different across different age groups</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m.titanic <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z value</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-0.1365340</td>
<td style="text-align: center;">0.1447153</td>
<td style="text-align: center;">-0.94347</td>
<td style="text-align: center;">0.345443</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.0078985</td>
<td style="text-align: center;">0.0044065</td>
<td style="text-align: center;">-1.79246</td>
<td style="text-align: center;">0.073059</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for binomial family taken to be 1 )</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 29%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;">Null deviance:</td>
<td style="text-align: center;">1414.6 on 1045 degrees of freedom</td>
</tr>
<tr class="even">
<td style="text-align: center;">Residual deviance:</td>
<td style="text-align: center;">1411.4 on 1044 degrees of freedom</td>
</tr>
</tbody>
</table>
<p>(263 observations deleted due to missingness)</p>
<p>AIC: 1415.38</p>
<p>Number of Fisher Scoring Iterations: 4</p>
</div>
</div>
<p><span class="math inline">\(\textrm{logodds}(\textrm{Survival} | \textrm{Age}) = -0.1365 - 0.007899 \times \textrm{Age}\)</span></p>
<ul>
<li><p>General interpretation</p>
<ul>
<li><p>Intercept is labeled “(Intercept)”</p></li>
<li><p>Slope for age is labeled “age”</p></li>
</ul></li>
<li><p>Interpretation of intercept</p>
<p>*Estimated log odds for newborns (age=0) is <span class="math inline">\(-0.136534\)</span></p>
<ul>
<li><p>Odds of survival for newborns is <span class="math inline">\(e^{-0.136534} = 0.8724\)</span></p></li>
<li><p>Probability of survival</p>
<ul>
<li><p>Prob = odds / (1 + odds)</p></li>
<li><p><span class="math inline">\(0.8724 / (1 + .8724) = 0.4659\)</span></p></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(m.titanic, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">'response'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.4659194 </code></pre>
</div>
</div>
<ul>
<li><p>Interpretation of slope</p>
<ul>
<li><p>Estimate difference in the log odds of survival for two groups differing by one year in age is <span class="math inline">\(-0.0078985\)</span></p></li>
<li><p>This estimate averages over males and females</p></li>
<li><p>Older groups tend to have lower log odds</p></li>
<li><p>Odds Ratio: <span class="math inline">\(e^{-0.0078985} = 0.9921\)</span></p></li>
<li><p>For five year difference in age: <span class="math inline">\(e^{-0.0078985 \times 5} = 0.9612\)</span></p></li>
<li><p>In Stata use “lincom age, or” or “lincom 5*age, or”</p></li>
</ul></li>
</ul>
<p>Note that if the straight line relationship does not hold true, we interpret the slope as an average difference in the log odds of survival per one year difference in age</p>
<p>There are several ways to get the odds ratio and confidence interval in R</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The coefficient and confidence interval (on the log-odds scale)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         age 
-0.007898504 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.016535</td>
<td style="text-align: center;">0.00073809</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratio for age and confidence interval for age (1 year increase)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      age 
0.9921326 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.9836</td>
<td style="text-align: center;">1.0007</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratio for age and confidence interval for age (5 year increase)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      age 
0.9612771 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.92065</td>
<td style="text-align: center;">1.0037</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Using finalfit to create a nicer output table of the coefficients and confidence intervals</p>
<ul>
<li>For finalfit to use a logistic regression model by default, survived must be defined as a factor variable with two levels</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finalfit)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>explanatory <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>survived.factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic<span class="sc">$</span>survived, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Died"</span>,<span class="st">"Survived"</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>dependent <span class="ot">=</span> <span class="st">'survived.factor'</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(titanic<span class="sc">$</span>age) <span class="ot">&lt;-</span> <span class="st">"Age (years)"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">finalfit</span>(<span class="at">.data =</span> titanic, dependent, explanatory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Dependent: survived.factor</th>
<th></th>
<th style="text-align: center;">Died</th>
<th style="text-align: center;">Survived</th>
<th style="text-align: center;">OR (univariable)</th>
<th style="text-align: center;">OR (multivariable)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Age (years)</td>
<td>Mean (SD)</td>
<td style="text-align: center;">30.5 (13.9)</td>
<td style="text-align: center;">28.9 (15.1)</td>
<td style="text-align: center;">0.99 (0.98-1.00, p=0.073)</td>
<td style="text-align: center;">0.99 (0.98-1.00, p=0.073)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comments-on-interpretation" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="comments-on-interpretation"><span class="header-section-number">3.3</span> Comments on Interpretation</h3>
<ul>
<li><p>The slope for age is expressed as a difference in group means, not the difference due to aging. We did not do a longitudinal study in which repeated measurements were taken on the same subject.</p></li>
<li><p>If the group log odds are truly linear, then the slope has an exact interpretation as the change in survival due to a one year change in (any) age</p></li>
<li><p>Otherwise, the slope estimates the first order trend of the sample data and we should not treat the estimates of group odds or probabilities as accurate</p></li>
<li><p>It is difficult to see in the above example, but the CIs around the odds ratios are not symmetric</p>
<ul>
<li>(Symmetric) CIs are calculated on the log odds scale, and then transformed to the odds scale by expoenentiating the lower and upper limits of the CI</li>
</ul></li>
<li><p>“From logistic regression analysis, we estimate that for each 5 year difference in age, the odds of survival on the Titanic decreased by 3.9%, though this estimate is not statistically significant (<span class="math inline">\(p = 0.07\)</span>). A 95% CI suggests that this observation is not unusual if a group that is five years older might have an odds of survival that was anywhere between 7.9% lower and 0.4% higher than the younger group.”</p></li>
<li><p>The confidence interval and statistical test given in the output is called a Wald test. Other tests (Score, Likelihood Ratio) are also possible.</p>
<ul>
<li><p>All tests are asymptotically equivalent</p></li>
<li><p>The Wald test is easiest to obtain, but generally performs the poorest in small sample sizes</p></li>
<li><p>The Likelihood Ratio test performs the best in small samples. We will discuss it later, including how to obtain the test using post-estimation commands.</p></li>
<li><p>The Score test is not bad in small samples, but is often hard to obtain from software. It is exactly equal to the Chi-squared test for binary outcomes and categorical predictors.</p></li>
</ul></li>
</ul>
<section id="sec-bayeslogistic" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="sec-bayeslogistic"><span class="header-section-number">3.3.1</span> Bayesian Estimates and Interpretation</h4>
<ul>
<li><p>Bayesian approach to the logistic model requires specifying the model, prior distributions, and the likelihood</p></li>
<li><p>The model</p>
<ul>
<li>e.g.&nbsp;a model for the log odds of survival that is linear in the parameters with an intercept and slope for age</li>
</ul></li>
<li><p>Prior distributions on parameters</p>
<ul>
<li><p>For the simple logistic regression model, we have parameters <span class="math inline">\(\beta_0\)</span>, and <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>For now, we will use default prior distributions that are are intended to be <em>weakly informative</em> in that they provide moderate regularization and help stabilize computation. See the <a href="https://mc-stan.org/rstanarm/reference/priors.html">STAN documentation</a> for more details</p></li>
<li><p>Appropriate priors can be based on scientific considerations</p></li>
<li><p>Sensitivity analyses can evaluate the the robustness of finding to different prior assumptions</p></li>
</ul></li>
<li><p>The likelihood</p>
<ul>
<li>For a binomial GLM the likelihood for one observation <span class="math inline">\(y\)</span> can be written as a conditionally binomial probability mass function</li>
</ul></li>
</ul>
<p><span class="math display">\[\binom{n}{y} \pi^{y} (1 - \pi)^{n - y},\]</span></p>
<ul>
<li><span class="math inline">\(n\)</span> is the known number of trials, <span class="math inline">\(\pi = g^{-1}(\eta)\)</span> is the probability of success and <span class="math inline">\(\eta = \alpha + \mathbf{x}^\top \boldsymbol{\beta}\)</span> is a linear predictor</li>
</ul>
<!-- -->
<ul>
<li>For a sample of size <span class="math inline">\(N\)</span>, the likelihood of the entire sample is the product of <span class="math inline">\(N\)</span> individual likelihood contributions.</li>
</ul>
<!-- -->
<ul>
<li><p>Because <span class="math inline">\(\pi\)</span> is a probability, for a binomial model the <em>link</em> function <span class="math inline">\(g\)</span> maps between the unit interval (the support of <span class="math inline">\(\pi\)</span>) and the set of all real numbers <span class="math inline">\(\mathbb{R}\)</span>. When applied to a linear predictor <span class="math inline">\(\eta\)</span> with values in <span class="math inline">\(\mathbb{R}\)</span>, the inverse link function <span class="math inline">\(g^{-1}(\eta)\)</span> therefore returns a valid probability between 0 and 1.</p></li>
<li><p>The two most common link functions used for binomial GLMs are the</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Logit">logit</a> and</li>
<li><a href="https://en.wikipedia.org/wiki/Probit">probit</a></li>
</ul></li>
<li><p>With the logit (or log-odds) link function <span class="math inline">\(g(x) = \ln{\left(\frac{x}{1-x}\right)}\)</span>, the likelihood for a single observation becomes</p></li>
</ul>
<p><span class="math display">\[\binom{n}{y}\left(\text{logit}^{-1}(\eta)\right)^y
\left(1 - \text{logit}^{-1}(\eta)\right)^{n-y} =
\binom{n}{y} \left(\frac{e^{\eta}}{1 + e^{\eta}}\right)^{y}
\left(\frac{1}{1 + e^{\eta}}\right)^{n - y}\]</span></p>
<ul>
<li>With the probit link function <span class="math inline">\(g(x) = \Phi^{-1}(x)\)</span> yields the likelihood</li>
</ul>
<p><span class="math display">\[\binom{n}{y} \left(\Phi(\eta)\right)^{y}
\left(1 - \Phi(\eta)\right)^{n - y},\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the CDF of the standard normal distribution.</p>
<ul>
<li>Output from Bayesian logistic regression using logit link function</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(survived <span class="sc">~</span> age,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>titanic, <span class="at">family=</span><span class="fu">binomial</span>(),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed=</span><span class="dv">1234</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2, <span class="at">digits=</span><span class="dv">4</span>, <span class="at">prob=</span><span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">5</span>, .<span class="dv">975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Info</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 19%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">function</th>
<th style="text-align: center;">family</th>
<th style="text-align: center;">formula</th>
<th style="text-align: center;">algorithm</th>
<th style="text-align: center;">sample</th>
<th style="text-align: center;">observations</th>
<th style="text-align: center;">predictors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">stan_glm</td>
<td style="text-align: center;">binomial [logit]</td>
<td style="text-align: center;">survived ~ age</td>
<td style="text-align: center;">sampling</td>
<td style="text-align: center;">4000</td>
<td style="text-align: center;">1046</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<caption>Estimates</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">mean</th>
<th style="text-align: center;">sd</th>
<th style="text-align: center;">2.5%</th>
<th style="text-align: center;">50%</th>
<th style="text-align: center;">97.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-0.1343122</td>
<td style="text-align: center;">0.145938</td>
<td style="text-align: center;">-0.413530</td>
<td style="text-align: center;">-0.1336335</td>
<td style="text-align: center;">0.15599526</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.0079361</td>
<td style="text-align: center;">0.004433</td>
<td style="text-align: center;">-0.016909</td>
<td style="text-align: center;">-0.0077841</td>
<td style="text-align: center;">0.00035338</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<caption>Fit Diagnostics</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">mean</th>
<th style="text-align: center;">sd</th>
<th style="text-align: center;">2.5%</th>
<th style="text-align: center;">50%</th>
<th style="text-align: center;">97.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>mean_PPD</strong></td>
<td style="text-align: center;">0.40887</td>
<td style="text-align: center;">0.02167</td>
<td style="text-align: center;">0.3652</td>
<td style="text-align: center;">0.40918</td>
<td style="text-align: center;">0.45124</td>
</tr>
</tbody>
</table>
<p>The mean_ppd is the sample average posterior predictive distribution of the outcome variable.</p>
<table class="caption-top table table-sm table-striped small">
<caption>MCMC diagnostics</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">mcse</th>
<th style="text-align: center;">Rhat</th>
<th style="text-align: center;">n_eff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">0.00290</td>
<td style="text-align: center;">0.99941</td>
<td style="text-align: center;">2533</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.00009</td>
<td style="text-align: center;">0.99964</td>
<td style="text-align: center;">2570</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>mean_PPD</strong></td>
<td style="text-align: center;">0.00039</td>
<td style="text-align: center;">1.00042</td>
<td style="text-align: center;">3073</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>log-posterior</strong></td>
<td style="text-align: center;">0.02844</td>
<td style="text-align: center;">1.00475</td>
<td style="text-align: center;">1340</td>
</tr>
</tbody>
</table>
<p>For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</p>
</div>
</div>
<ul>
<li>And a summary of the prior distributions used</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fit2, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Priors for model ‘fit2’</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Specified prior</th>
<th style="text-align: center;">Adjusted prior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Intercept (after predictors centered)</strong></td>
<td style="text-align: center;">~ normal(location = 0, scale = 2.50000)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Coefficients</strong></td>
<td style="text-align: center;">~ normal(location = 0, scale = 2.50000)</td>
<td style="text-align: center;">~ normal(location = 0, scale = 0.17345)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Interpretation</p>
<ul>
<li><p>Slope for age is of primary scientific importance</p></li>
<li><p><em>A priori</em> we assume that no association between age and survival. Specifically, we assumed a Normal prior with location (mean) of 0 and scale (standard devation) of 0.17 for <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>Conditional on the data, we estimate that for every 1 year increase in age, the log odds of decreases by -0.0079 (95% credible interval -0.0169 to 0.0004).</p></li>
<li><p>To obtain the posterior odds ratio and 95% credible intervals, some additional commands are needed</p></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 year change in age</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      age 
0.9922461 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>)) <span class="co"># 95% credible interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5%</th>
<th style="text-align: center;">97.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">0.66131</td>
<td style="text-align: center;">1.1688</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.98323</td>
<td style="text-align: center;">1.0004</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 year increase in age</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      age 
0.9618272 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>))[<span class="dv">2</span>,] <span class="co"># 95% credible interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%     97.5% 
0.9189294 1.0017684 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Could also flip (invert) these odds ratios to interpret as decrease in age being associated with increased survival</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 year decrease in age</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     age 
1.039688 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>))[<span class="dv">2</span>,] <span class="co"># 95% credible interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     2.5%     97.5% 
1.0882228 0.9982347 </code></pre>
</div>
</div>
<ul>
<li><p>The association between age and probability of survival was estimated using a Bayesian logistic regression model. The model did not adjust for other covariates and assumed a logit link function and Binomial likelihood. We assumed a weakly informative prior distribution for the log odds of survival given age (Normal prior with mean 0 and scale 0.17 for <span class="math inline">\(\beta_1\)</span>). Conditional on the data, the posterior mean estimate indicates that comparing two subjects who differ in age by 5 years, the younger subject has a 1.04 fold increased odds of survival compared to the older subject. A 95% credible interval for this posterior odds ratio is from 1.00 to 1.09.</p></li>
<li><p>Note that this model does not consider gender, so it is averaging over the males and females. We will revisit this analysis where the age effect is analyzed separately in males and females.</p></li>
</ul>
</section>
</section>
</section>
<section id="inference-with-logistic-regression" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="inference-with-logistic-regression"><span class="header-section-number">4</span> Inference with Logistic Regression</h2>
<ul>
<li><p>As with linear regression, we organize the assumptions needed for valid inference into categories based on what type of inference we wish to make</p>
<ul>
<li>The structure of these assumptions parallels those discussed for linear regression, though the specifics differ due to the binary nature of the outcome</li>
</ul></li>
<li><p>The ideas of Signal and Noise found in simple linear regression do not translate well to logistic regression because of the implicit mean-variance relationship</p>
<ul>
<li>We do not tend to quantify an error distribution with logistic regression</li>
</ul></li>
<li><p>Valid statistical inference (CIs, p-values) about <em>associations</em> requires three general assumptions</p></li>
<li><p>Assumption 1: Approximately Normal distributions for the parameter estimates</p>
<ul>
<li><p>Large N</p></li>
<li><p>Need for either robust standard errors or classical logistic regression</p></li>
<li><p>Definition of large depends on the underlying probabilities (odds)</p></li>
<li><p>Recall the rule of thumb for chi-squared tests based on the expected number of events</p></li>
</ul></li>
<li><p>Assumption 2: Assumptions about the independence of observations</p>
<ul>
<li><p>Classical regression: Independence of all observation</p></li>
<li><p>Robust standard errors: Correlated observations within identified clusters</p></li>
</ul></li>
<li><p>Assumption 3: Assumptions about variance of observations within groups</p>
<ul>
<li><p>Classical regression: Mean-variance relationship for binary data</p>
<ul>
<li><p>Classical logistic regression estimates SE using model based estimates</p></li>
<li><p>Hence in order to satisfy this requirement, linearity of log odds across groups must hold</p></li>
</ul></li>
<li><p>Robust standard errors</p>
<ul>
<li><p>Allows unequal variance across groups</p></li>
<li><p>Hence, do not need linearity of log odds across groups to hold</p></li>
</ul></li>
</ul></li>
<li><p>Valid statistical inference (CIs, p-values) about <em>odds of response in specific groups</em> requires a further assumption</p></li>
<li><p>Assumption 4: Adequacy of the linear model</p>
<ul>
<li><p>If we are trying to borrow information about the log odds from neighboring groups, and we are assuming a straight line relationship, the straight line needs to be true</p>
<ul>
<li><p>Needed for either classical or robust standard errors</p></li>
<li><p>Note that we can model transformations of the measured predictor if we feel a straight line is not appropriate</p></li>
</ul></li>
</ul></li>
<li><p>For inference about <em>individual observations</em> (prediction intervals, P-values) in specific groups requires no further assumptions because we have binary data</p>
<ul>
<li><p>For binary data, if we know the mean (proportion), we know everything about the distribution including the variance</p></li>
<li><p>This differs from linear regression where we needed Assumption 5 about the error distribution.</p></li>
<li><p>With binary outcomes, once we correctly specify the mean (Assumption 4), the variance is automatically determined: <span class="math inline">\(\text{Var}(Y|X) = p(X)(1-p(X))\)</span></p></li>
</ul></li>
</ul>
<section id="interpreting-positive-results" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="interpreting-positive-results"><span class="header-section-number">4.1</span> Interpreting “Positive” Results</h3>
<ul>
<li><p>Slope is statistically different from 0 using robust standard errors</p></li>
<li><p>Observed data is atypical of a setting with no linear trend in odds of response across groups</p></li>
<li><p>Data suggests evidence of a trend toward larger (or smaller) odds in groups having larger values of the predictor</p></li>
<li><p>(To the extent the data appears linear, estimates of the group odds or probabilities will be reliable)</p></li>
</ul>
</section>
<section id="interpreting-negative-results" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="interpreting-negative-results"><span class="header-section-number">4.2</span> Interpreting “Negative” Results</h3>
<ul>
<li><p>Many possible reasons why the slope is not statistically different from 0 using robust standard errors</p>
<ul>
<li><p>There may be no association between the response and predictor</p></li>
<li><p>There may be an association in the parameter considered, but the best fitting line has zero slope</p></li>
<li><p>There may be a first order trend in the log odds, but we lacked the precision to be confident that it truly exists (a type II error)</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="model-diagnostics-for-understanding-results" class="level2 page-columns page-full" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="model-diagnostics-for-understanding-results"><span class="header-section-number">5</span> Model Diagnostics for Understanding Results</h2>
<ul>
<li><p>As with linear regression, diagnostics are tools for understanding the model and results, not for data-driven model modification</p></li>
<li><p>Key differences from linear regression diagnostics</p>
<ul>
<li><p>With binary outcomes, traditional residual plots are less informative</p></li>
<li><p>Individual residuals are not very meaningful (outcome is always 0 or 1)</p></li>
<li><p>Binned residuals can help visualize model fit</p></li>
</ul></li>
<li><p>Useful diagnostics for understanding logistic regression models</p>
<ul>
<li><p>Binned residual plots: Group observations by predicted probability and examine average residuals within bins</p></li>
<li><p>Influence diagnostics: Identify observations that have large impact on parameter estimates</p></li>
<li><p>Predicted probabilities: Plot predicted probabilities across range of predictor to see if model behavior is sensible</p></li>
</ul></li>
<li><p>The goal remains understanding whether the model assumptions are plausible and whether results are sensitive to specific observations</p>
<ul>
<li><p>Not to iteratively modify the model until diagnostics “look good”</p></li>
<li><p>Pre-specification of the scientific model remains paramount</p></li>
</ul></li>
</ul>
<section id="diagnostic-examples-using-titanic-data" class="level3 page-columns page-full" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="diagnostic-examples-using-titanic-data"><span class="header-section-number">5.1</span> Diagnostic examples using Titanic data</h3>
<ul>
<li>Recall our simple model of survival by age</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit.age <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z value</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-0.1365340</td>
<td style="text-align: center;">0.1447153</td>
<td style="text-align: center;">-0.94347</td>
<td style="text-align: center;">0.345443</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.0078985</td>
<td style="text-align: center;">0.0044065</td>
<td style="text-align: center;">-1.79246</td>
<td style="text-align: center;">0.073059</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for binomial family taken to be 1 )</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 29%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;">Null deviance:</td>
<td style="text-align: center;">1414.6 on 1045 degrees of freedom</td>
</tr>
<tr class="even">
<td style="text-align: center;">Residual deviance:</td>
<td style="text-align: center;">1411.4 on 1044 degrees of freedom</td>
</tr>
</tbody>
</table>
<p>(263 observations deleted due to missingness)</p>
<p>AIC: 1415.38</p>
<p>Number of Fisher Scoring Iterations: 4</p>
</div>
</div>
<section id="binned-residuals" class="level4 page-columns page-full" data-number="5.1.1">
<h4 data-number="5.1.1" class="anchored" data-anchor-id="binned-residuals"><span class="header-section-number">5.1.1</span> (Binned) residuals</h4>
<ul>
<li><p>Binned residual plot</p>
<ul>
<li><p>Groups observations into bins based on their predicted probabilities</p></li>
<li><p>Within each bin, calculates the average residual (observed - predicted)</p></li>
<li><p>If the model fits well, average residuals should be close to zero across all bins</p></li>
<li><p>Gray lines show the expected 95% bounds (±2 SE) under the model</p></li>
<li><p>Points outside these bounds suggest potential model misfit in those regions</p></li>
</ul></li>
<li><p>Why we need binned residuals for binary outcomes</p>
<ul>
<li><p>With binary data, individual residuals are not very informative</p></li>
<li><p>Each observation has <span class="math inline">\(Y_i = 0\)</span> or <span class="math inline">\(Y_i = 1\)</span>, so residuals are either <span class="math inline">\(0 - \hat{p}_i\)</span> or <span class="math inline">\(1 - \hat{p}_i\)</span></p></li>
<li><p>A plot of raw residuals shows two bands corresponding to the two possible outcomes</p></li>
</ul></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> titanic<span class="sc">$</span>survived[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age)] <span class="sc">-</span> pred_prob</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>resid_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred_prob =</span> pred_prob, <span class="at">resid =</span> resid)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw (unbinned) residuals</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Raw Residual"</span>,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Raw Residuals (Not Binned)"</span>) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Raw residual plot (Titanic data)</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The two bands in the plot correspond to survivors (<span class="math inline">\(Y=1\)</span>, upper band) and non-survivors (<span class="math inline">\(Y=0\)</span>, lower band)</p></li>
<li><p>This plot provides little information about model fit - we cannot easily assess systematic deviations</p></li>
<li><p>Binning the residuals by predicted probability allows us to see average deviations from the model</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> titanic<span class="sc">$</span>survived[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age)] <span class="sc">-</span> pred_prob</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>resid_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred_prob =</span> pred_prob, <span class="at">resid =</span> resid)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins for visualization</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>bin_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(pred_prob), <span class="fu">max</span>(pred_prob), <span class="at">length.out =</span> n_bins <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>resid_data<span class="sc">$</span>bin <span class="ot">&lt;-</span> <span class="fu">cut</span>(resid_data<span class="sc">$</span>pred_prob, <span class="at">breaks =</span> bin_breaks)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate binned statistics</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>binned_data <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(resid, pred_prob) <span class="sc">~</span> bin, </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> resid_data, </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> mean)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create rectangles for shading alternating bins</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>bin_rects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmin =</span> bin_breaks[<span class="sc">-</span><span class="fu">length</span>(bin_breaks)],</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmax =</span> bin_breaks[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">shade =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">length.out =</span> n_bins)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw residuals with shaded bins</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded rectangles for alternating bins</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> bin_rects[bin_rects<span class="sc">$</span>shade, ], </span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> xmin, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>),</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw residuals</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines to show bin boundaries</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> bin_breaks,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add average residual within each bin</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid),</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid),</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Raw Residual"</span>) <span class="sc">+</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Raw residuals from the logistic regression model of survival by age in the Titanic data. Individual residuals (gray points) form two bands corresponding to survivors (upper) and non-survivors (lower). Vertical boundaries divide predictions into 20 bins of equal width. Red points show the average residual within each bin, connected by a red line. This binning process, shown by the alternating shaded regions, transforms the uninformative raw residual plot into a more interpretable binned residual plot by averaging within prediction ranges.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>resid_data<span class="sc">$</span>bin <span class="ot">&lt;-</span> <span class="fu">cut</span>(resid_data<span class="sc">$</span>pred_prob, <span class="at">breaks =</span> n_bins)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average residual and predicted probability within each bin</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>binned_data <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(resid, pred_prob) <span class="sc">~</span> bin, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> resid_data, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> mean)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>binned_data<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="fu">table</span>(resid_data<span class="sc">$</span>bin)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>binned_data<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(binned_data<span class="sc">$</span>pred_prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> binned_data<span class="sc">$</span>pred_prob) <span class="sc">/</span> binned_data<span class="sc">$</span>n)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot binned residuals</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>se, <span class="at">ymax =</span> <span class="dv">2</span><span class="sc">*</span>se), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Residual"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Binned Residual Plot"</span>) <span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Binned residual plot (Titanic data)</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Interpretation of the binned residual plot</p>
<ul>
<li><p>Most points fall within the gray bands, suggesting reasonable model fit</p></li>
<li><p>Any systematic patterns (e.g., all positive residuals at low predictions, all negative at high predictions) would indicate the linear logit assumption may not hold</p></li>
<li><p>Individual points outside the bands are not necessarily problematic - we expect about 5% of bins to fall outside</p></li>
<li><p>Look for systematic deviations rather than isolated points</p></li>
<li><p>In this example, the binned residuals show no strong systematic pattern, supporting the linear relationship between age and log odds of survival</p></li>
</ul></li>
</ul>
</section>
<section id="predicted-versus-observed-probabilities-of-survival" class="level4 page-columns page-full" data-number="5.1.2">
<h4 data-number="5.1.2" class="anchored" data-anchor-id="predicted-versus-observed-probabilities-of-survival"><span class="header-section-number">5.1.2</span> Predicted versus observed probabilities of survival</h4>
<ul>
<li>Plot of predicted probabilities across age range</li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequence of ages for model prediction</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(titanic<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(titanic<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict probabilities from model</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age_seq)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">newdata=</span>pred_data, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data points</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> titanic_complete, </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> survived),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plsmo smoothed line</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> smooth_data, </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> prob, <span class="at">color =</span> <span class="st">"Observed (smoothed)"</span>),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model prediction line</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> prob, <span class="at">color =</span> <span class="st">"Model prediction"</span>),</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed (smoothed)"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Model prediction"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (years)"</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probability of Survival"</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Predicted probability of survival versus age in the Titanic data. Gray points show individual observations (0 = died, 1 = survived). The black line shows a smoothed estimate of the observed survival probability using a super smoother. The blue line shows predictions from the logistic regression model assuming a linear relationship between age and log odds of survival. Close agreement between the two lines suggests the linear logit assumption is reasonable across the observed age range.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>These plots help us understand how well the linear logit assumption fits the data and whether the model predictions are reasonable across the range of ages</li>
</ul>
</section>
<section id="influential-observations-using-delta-betas" class="level4" data-number="5.1.3">
<h4 data-number="5.1.3" class="anchored" data-anchor-id="influential-observations-using-delta-betas"><span class="header-section-number">5.1.3</span> Influential observations using delta-betas</h4>
<ul>
<li><p>Delta-beta measures the change in a parameter estimate when a single observation is removed from the analysis</p></li>
<li><p>For observation <span class="math inline">\(i\)</span> and parameter <span class="math inline">\(\beta_j\)</span>:</p></li>
<li><p><span class="math inline">\(\Delta\beta_{ij} = \hat{\beta}_j - \hat{\beta}_{j(-i)}\)</span></p>
<ul>
<li><p><span class="math inline">\(\hat{\beta}_j\)</span> is the estimate using all data</p></li>
<li><p><span class="math inline">\(\hat{\beta}_{j(-i)}\)</span> is the estimate with observation <span class="math inline">\(i\)</span> removed</p></li>
</ul></li>
<li><p>Large delta-betas indicate observations with substantial influence on parameter estimates</p></li>
<li><p>Delta-betas are a general concept applicable to any regression model (linear, logistic, Cox, etc.)</p></li>
<li><p>Can calculate delta-betas for any parameter of interest (intercept, slopes, interactions)</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate delta-betas for the age coefficient</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>delta_beta_age <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get full model coefficient</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>beta_full <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate delta-beta for each observation</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>titanic_complete <span class="ot">&lt;-</span> titanic[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age), ]</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  fit_minus_i <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>titanic_complete[<span class="sc">-</span>i, ], </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  delta_beta_age[i] <span class="ot">&lt;-</span> beta_full <span class="sc">-</span> <span class="fu">coef</span>(fit_minus_i)[<span class="st">"age"</span>]</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot delta-betas</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>n, delta_beta_age, </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Observation Number"</span>, </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Delta-Beta for Age Coefficient"</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Influence on Age Effect"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify potentially influential observations</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(delta_beta_age)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">c</span>(<span class="sc">-</span>threshold, threshold), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>influential <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(delta_beta_age) <span class="sc">&gt;</span> threshold)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(influential, delta_beta_age[influential], </span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span>influential, <span class="at">pos=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Interpretation of delta-betas</p>
<ul>
<li><p>Observations with large positive delta-betas increase the age coefficient estimate when included</p></li>
<li><p>Observations with large negative delta-betas decrease the age coefficient estimate when included</p></li>
<li><p>Influential observations are not necessarily “bad” or errors - they may represent legitimate extreme cases</p></li>
<li><p>The goal is to understand which observations influence the results, not to automatically exclude influential points</p></li>
</ul></li>
<li><p>For brevity, identify and examine the most influential observation</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify observation with largest absolute delta-beta</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>max_influence_index <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">abs</span>(delta_beta_age))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>max_delta_beta <span class="ot">&lt;-</span> delta_beta_age[max_influence_index]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model without this observation</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>fit_minus_max <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>titanic_complete[<span class="sc">-</span>max_influence_index, ], </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show details and comparison</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Most influential observation:</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="st">  Observation number: %d</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="st">  Age: %.1f</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="st">  Survived: %d</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="st">  Delta-beta: %.6f</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="st">Age coefficient (full model): %.6f</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="st">Age coefficient (without observation %d): %.6f</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="st">Difference (delta-beta): %.6f</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>max_influence_index,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>titanic_complete<span class="sc">$</span>age[max_influence_index],</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>titanic_complete<span class="sc">$</span>survived[max_influence_index],</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>max_delta_beta,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>],</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>max_influence_index,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit_minus_max)[<span class="st">"age"</span>],</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>] <span class="sc">-</span> <span class="fu">coef</span>(fit_minus_max)[<span class="st">"age"</span>]</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Most influential observation:
  Observation number: 15
  Age: 80.0
  Survived: 1
  Delta-beta: 0.000678

Age coefficient (full model): -0.007899
Age coefficient (without observation 15): -0.008577
Difference (delta-beta): 0.000678</code></pre>
</div>
</div>
<ul>
<li><p>This explicitly shows how removing a single influential observation changes the age coefficient estimate</p></li>
<li><p>Here, this is an old subject (80) who survived; the model predicts low survival probability at that age, so this point has a relatively strong influence on the age effect estimate.</p></li>
</ul>
</section>
</section>
</section>
<section id="example-analysis-revisited-effect-modification" class="level2 page-columns page-full" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="example-analysis-revisited-effect-modification"><span class="header-section-number">6</span> Example analysis revisited: Effect Modification</h2>
<ul>
<li><p>Recall in our Titanic example that the effect of age appeared to differ by sex</p>
<ul>
<li><p>We ignored this difference earlier, so our estimated age effect was a (weighted) average of the age effect in males and the age effect in female</p></li>
<li><p>Here is the plot again describing the trends we see in survival by age and sex (using plsmo).</p></li>
</ul></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(titanic, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plsmo</span>(age, survived, <span class="at">group=</span>sex, <span class="at">datadensity=</span>T, <span class="at">ylab=</span><span class="st">"Survived (1=Yes, 0=No)"</span>, <span class="at">xlab=</span><span class="st">"Age (years)"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec04.Logistic_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Age versus survival by gender in the Titanic data by age using a super smoother.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>We could describe the observed differences in two way, both being correct</p>
<ul>
<li><p>Gender modifies the age effect</p>
<ul>
<li>In males, the probability of survival decreased with age while in female the probability of survival increased with age</li>
<li>Emphasizes that the female age slope is positive while the male age slope is negative</li>
</ul></li>
<li><p>Age modifies the gender effect</p>
<ul>
<li>The survival rates of male and females were more similar at younger ages than older ages</li>
<li>Could specify the odds ratio of survival comparing females to males at specific ages</li>
</ul></li>
</ul></li>
</ul>
<section id="stratified-analysis-by-sex" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="stratified-analysis-by-sex"><span class="header-section-number">6.1</span> Stratified analysis by sex</h3>
<ul>
<li>The log odds of survival in females</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fit.titanic.female <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">subset=</span>sex<span class="sc">==</span><span class="st">"female"</span>, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fit.titanic.female</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Fitting generalized (binomial/logit) linear model: survived ~ age</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z value</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">0.493374</td>
<td style="text-align: center;">0.2541885</td>
<td style="text-align: center;">1.9410</td>
<td style="text-align: center;">0.0522612</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.022516</td>
<td style="text-align: center;">0.0085354</td>
<td style="text-align: center;">2.6379</td>
<td style="text-align: center;">0.0083415</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Degrees of Freedom</strong></td>
<td style="text-align: center;">387 Total (i.e. Null)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Degrees of Freedom</strong></td>
<td style="text-align: center;">386 Residual</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Null Deviance</strong></td>
<td style="text-align: center;">434.161</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Residual Deviance</strong></td>
<td style="text-align: center;">426.878</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>AIC</strong></td>
<td style="text-align: center;">430.878</td>
</tr>
</tbody>
</table>
<p>(78 observations deleted due to missingness)</p>
</div>
</div>
<ul>
<li>The log odds of survival in males</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fit.titanic.male <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">subset=</span>sex<span class="sc">==</span><span class="st">"male"</span>, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fit.titanic.male</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Fitting generalized (binomial/logit) linear model: survived ~ age</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z value</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-0.66076</td>
<td style="text-align: center;">0.2248071</td>
<td style="text-align: center;">-2.9392</td>
<td style="text-align: center;">0.0032902</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.02376</td>
<td style="text-align: center;">0.0072757</td>
<td style="text-align: center;">-3.2657</td>
<td style="text-align: center;">0.0010921</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Degrees of Freedom</strong></td>
<td style="text-align: center;">657 Total (i.e. Null)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Degrees of Freedom</strong></td>
<td style="text-align: center;">656 Residual</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Null Deviance</strong></td>
<td style="text-align: center;">667.847</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Residual Deviance</strong></td>
<td style="text-align: center;">656.557</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>AIC</strong></td>
<td style="text-align: center;">660.557</td>
</tr>
</tbody>
</table>
<p>(185 observations deleted due to missingness)</p>
</div>
</div>
<section id="odds-ratios-and-confidence-intervals-for-age-effect-by-sex" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="odds-ratios-and-confidence-intervals-for-age-effect-by-sex"><span class="header-section-number">6.1.1</span> Odds ratios and confidence intervals for age effect by sex</h4>
<ul>
<li>Consider a 5 year change in age</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Females</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit.titanic.female)[<span class="st">"age"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     age 
1.119161 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(fit.titanic.female,<span class="st">"age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">1.0294</td>
<td style="text-align: center;">1.2168</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Males</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit.titanic.male)[<span class="st">"age"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      age 
0.8879858 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(fit.titanic.male,<span class="st">"age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">0.82688</td>
<td style="text-align: center;">0.95361</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="effect-modification-using-interaction-terms" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="effect-modification-using-interaction-terms"><span class="header-section-number">6.2</span> Effect modification using interaction terms</h3>
<ul>
<li>Instead of fitting two separate models for male and females, we could estimate all parameters in a single regression model
<ul>
<li>Let <span class="math inline">\(p_i\)</span> be the probability of survival for passenger <span class="math inline">\(i\)</span> and <span class="math inline">\(\textrm{logit}(p)= \textrm{log}\left(\frac{p}{1-p}\right)\)</span></li>
<li>Let <span class="math inline">\(X_{1i}\)</span> be the age of subject <span class="math inline">\(i\)</span></li>
<li>Let <span class="math inline">\(X_{2i}\)</span> be an indicator variable for female sex. <span class="math inline">\(X_{2i}=1\)</span> if a subject is female and <span class="math inline">\(X_{2i} = 0\)</span> if a subject is male</li>
</ul></li>
</ul>
<p><span class="math display">\[\textrm{logit}(p_i | X_{1i},X_{2i}) = \beta_0 + \beta_1 * X_{1i} + \beta_{2} * X_{2i} + \beta_3*X_{1i}*X_{2i}\]</span></p>
<ul>
<li>In males, <span class="math inline">\(X_{2i} = 0\)</span>, this model reduces to</li>
</ul>
<p><span class="math display">\[\textrm{logit}(p_i | X_{1i}, X_{2i}=0) = \beta_0 + \beta_1 * X_{1i}\]</span></p>
<ul>
<li>In females, <span class="math inline">\(X_{2i} = 1\)</span>, this model can be expressed as</li>
</ul>
<p><span class="math display">\[\textrm{logit}(p_i | X_{1i}, X_{2i}=1) = (\beta_0+\beta_2) + (\beta_1+\beta_3) * X_{1i}\]</span></p>
<ul>
<li><span class="math inline">\(\hat{\beta_1}\)</span> is the estimate age effect in males</li>
<li><span class="math inline">\(\hat{\beta_1} + \hat{\beta_3}\)</span> is the estimated age effect in females</li>
<li><span class="math inline">\(\hat{\beta_3}\)</span> is the estimated <em>difference</em> between the age effect in females and the age effect in males</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># female has already been defined in the dataset, but if I wanted to create this variable I could do so</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>female <span class="ot">&lt;-</span> (titanic<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fit.titanic.interact <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age <span class="sc">+</span> female <span class="sc">+</span> age<span class="sc">*</span>female, <span class="at">data=</span>titanic, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.titanic.interact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z value</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-0.660761</td>
<td style="text-align: center;">0.2248071</td>
<td style="text-align: center;">-2.9392</td>
<td style="text-align: center;">3.2902e-03</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age</strong></td>
<td style="text-align: center;">-0.023760</td>
<td style="text-align: center;">0.0072757</td>
<td style="text-align: center;">-3.2657</td>
<td style="text-align: center;">1.0921e-03</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>female</strong></td>
<td style="text-align: center;">1.154134</td>
<td style="text-align: center;">0.3393376</td>
<td style="text-align: center;">3.4011</td>
<td style="text-align: center;">6.7106e-04</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>age:female</strong></td>
<td style="text-align: center;">0.046276</td>
<td style="text-align: center;">0.0112156</td>
<td style="text-align: center;">4.1260</td>
<td style="text-align: center;">3.6909e-05</td>
</tr>
</tbody>
</table>
<p>(Dispersion parameter for binomial family taken to be 1 )</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 29%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;">Null deviance:</td>
<td style="text-align: center;">1414.6 on 1045 degrees of freedom</td>
</tr>
<tr class="even">
<td style="text-align: center;">Residual deviance:</td>
<td style="text-align: center;">1083.4 on 1042 degrees of freedom</td>
</tr>
</tbody>
</table>
<p>(263 observations deleted due to missingness)</p>
<p>AIC: 1091.44</p>
<p>Number of Fisher Scoring Iterations: 4</p>
</div>
</div>
<ul>
<li>We can see that the parameter estimates from the interaction model are the same as the estimates from the two stratified models</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age      female  age:female 
-0.66076066 -0.02375991  1.15413441  0.04627571 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit just on male subjects</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.male)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age 
-0.66076066 -0.02375991 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit just on female subjects</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.female)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age 
 0.49337375  0.02251581 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear combinations from the interaction model give the female intercept and age slope</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.4933738 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       age 
0.02251581 </code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/modern-regression\.chris-slaughter\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/Lec03.SimpleLinearRegression.html" class="pagination-link" aria-label="Simple Linear Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Simple Linear Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/Lec05.Precision.html" class="pagination-link" aria-label="Precision of Statistical Intefence">
        <span class="nav-page-text">Precision of Statistical Intefence</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb62" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Logistic Regression"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Lecture 04"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="an">name:</span><span class="co"> Lec04.Logistic.qmd</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">source</span>(<span class="st">'pander_registry.R'</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">invisible</span>(e))</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## General Regression Setting</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Types of variables</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Binary data: e.g. sex, death</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Nominal (unordered categorical) data: e.g. race, marital status</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Ordinal (ordered categorical data): e.g. cancer stage, asthma severity</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Quantitative data: e.g. age, blood pressure</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Right censored data: e.g. time to death</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The measures used to summarize and compare distributions vary according to the type of variable</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Means: Binary, quantitative</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Medians: Ordered, quantitative, censored</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Proportions: Binary, nominal, ordinal</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds: Binary, nominal, ordinal</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Hazards: Censored</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Which regression model you choose to use is based on the parameter being compared across groups</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>| Parameter       | Approach                              |</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>|:----------------|:--------------------------------------|</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>| Means           | Linear regression                     |</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>| Geometric means | Linear regression on log scale        |</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>| Odds            | Logistic regression                   |</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>| Rates           | Poisson regression                    |</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>| Hazards         | Proportional Hazards (Cox) regression |</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>General notation for variables and parameters</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>|            |                                                      |</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>|:-----------|:-----------------------------------------------------|</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>| $Y_i$      | Response measured on the $i$th subject               |</span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>| $X_i$      | Value of the predictor measured on the $i$th subject |</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>| $\theta_i$ | Parameter summarizing distribution of $Y_i \mid X_i$    |</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The parameter ($\theta_i$) might be the mean, geometric mean, odds, rate, instantaneous risk of an event (hazard), etc.</span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In linear regression on means, $\theta_i = E<span class="co">[</span><span class="ot">Y_i | X_i</span><span class="co">]</span>$</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choice of correct $\theta_i$ should be based on scientific understanding of problem</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>General notation for simple regression model</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>$$g(\theta_i) = \beta_0 + \beta_1 \times X_i$$</span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>General notation for regression model with one predictor</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>|           |                                 |</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a>|:----------|:--------------------------------|</span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>| $g( )$    | Link function used for modeling |</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a>| $\beta_0$ | Intercept                       |</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>| $\beta_1$ | Slope for predictor $X$         |</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The link function is often either the identity function (for modeling means) or log (for modeling geometric means, odds, hazards)</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Identity function: $f(x) = x$</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Uses of General Regression</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Borrowing information</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Use other groups to make estimates in groups with sparse data</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Intuitively, 67 and 69 year olds would provide some relevant information about 68 year olds</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assuming a straight line relationship tells us about other, even more distant, individuals</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If we do not want to assume a straight line, we may only want to borrow information from nearby groups</span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Defining "Contrasts"</span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Define a comparison across groups to use when answering scientific questions</span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If the straight line relationship holds, the slope is the difference in parameter between groups differing by 1 unit in $X$</span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If a non-linear relationship in parameter, the slope is still the average difference in parameter between groups differing by 1 unit in $X$</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope is a (first order or linear) test for trend in the parameter</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Statistical jargon: "a contrast" across groups</span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The major difference between different regression models is the interpretation of the parameters</span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>How do I want to summarize the outcome?</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Mean, geometric mean, odds, hazard</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How do I want to compare groups?</span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Difference, ratio</span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Answering these two simple questions provides a starting road-map as to which regression model to choose</span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Issues related to the inclusion of covariates remains the same</span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Address the scientific question: Predictor of interest, effect modification</span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Address confounding</span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Increase precision</span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The remainder of these notes will focus on logistic regression for binary outcomes</span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We will apply the general regression framework described above, where $\theta_i$ represents the odds of the outcome and $g()$ is the logit (log odds) link function</span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The principles of borrowing information, defining contrasts, and addressing confounding remain the same as in linear regression</span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simple Logistic Regression</span></span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a><span class="fu">### Uses of logistic regression</span></span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use logistic regression when you want to make inference about the odds</span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Allows for continuous (or multiple) grouping variables</span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Is OK with binary grouping variables too</span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Compares odds of responses across groups using ratios</span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>"Odds ratio"</span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Binary response variable</span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When using regression with binary response variables, we typically model the (log) odds using logistic regression</span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Conceptually there should be no problem modeling the proportion (which is the mean of the distribution) using linear regression.  In this case, measures of associations would be the risk difference.</span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>However, there are several technical reasons why we do not use linear regression very often with binary responses</span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Technical problems with linear regression for binary responses:</span>
<span id="cb62-163"><a href="#cb62-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-164"><a href="#cb62-164" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Predicted probabilities can fall outside <span class="co">[</span><span class="ot">0,1</span><span class="co">]</span> range</span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Heteroskedasticity: Variance of binary outcome depends on the mean, $\text{Var}(Y|X) = p(X)(1-p(X))$</span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Variance is not constant across values of X</span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Maximum variance occurs when $p=0.5$, minimum when $p$ is near 0 or 1</span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If the scientific goal is association, less problematic with large sample size and robust SEs</span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Non-normal residuals (also less problematic with large samples and robust SEs)</span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Effect of predictor on probability is constrained to be linear (constant across range)</span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>A 10-year age increase has same effect on probability regardless of starting age</span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>This may be implausible when probabilities approach 0 or 1</span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why model odds instead of probabilities or risk differences?</span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Scientific basis</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Odds ratios are estimable in case-control studies (as shown above)</span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Linear trends in log odds may be more plausible than linear trends in probabilities</span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Logit transformation naturally constrains predictions to <span class="co">[</span><span class="ot">0,1</span><span class="co">]</span></span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-192"><a href="#cb62-192" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Effect modification on the odds ratio scale may be less common than on the probability scale</span>
<span id="cb62-193"><a href="#cb62-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Statistical basis</span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>The mean-variance relationship for binary data is naturally incorporated in the logistic regression likelihood</span>
<span id="cb62-197"><a href="#cb62-197" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-198"><a href="#cb62-198" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Classical logistic regression accounts for heteroskedasticity through the binomial variance structure</span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Can still use robust SEs if you want to relax distributional assumptions</span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reasons to use logistic regression</span></span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>First (scientific) reason: Case-Control Studies</span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Studying a rare disease, so we do study in reverse</span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>e.g. find subjects with cancer (and suitable controls) and then ascertain exposure of interest</span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Estimate distribution of the "effect" across groups defined by "cause"</span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Proportion (or odds) of smokers among people with or without lung cancer</span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a>    |            |               |               |</span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a>    |------------|---------------|---------------|</span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a>    |            | Lung Cancer + | Lung Cancer - |</span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a>    | Smoker     | a             | b             |</span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a>    | Non-Smoker | c             | d             |</span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a><span class="in">    : Case-Control or Cohort 2x2 Table. In the Case-Control design, the total number of subjects with Cancer $(a+c)$ and without cancer $(b+d)$ are fixed by design.</span></span>
<span id="cb62-221"><a href="#cb62-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-222"><a href="#cb62-222" aria-hidden="true" tabindex="-1"></a><span class="in">    -   In contrast, a cohort study samples by exposure (smoking) and then estimates the distribution of the effect in exposure groups</span></span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a><span class="in">    -   In a case-control study, we cannot estimate prevalence (without knowing selection probabilities)</span></span>
<span id="cb62-225"><a href="#cb62-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-226"><a href="#cb62-226" aria-hidden="true" tabindex="-1"></a><span class="in">        -   e.g. if doing a 1:1 case-control study, $(a+c) = b+d$ so it would look like $50\%$ of the subjects have cancer</span></span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Odds ratios are estimable in either case-control or cohort sampling scheme</span></span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a><span class="in">        -   Cohort study: Odds of cancer among smoker compared to odds of cancer among nonsmokers</span></span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a><span class="in">        -   Case-control study: Odds of smoking among cancer compared to odds of smoking among non-cancer</span></span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Mathematically, these two odds ratios are the same</span></span>
<span id="cb62-235"><a href="#cb62-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-236"><a href="#cb62-236" aria-hidden="true" tabindex="-1"></a>$$\text{OR}_{\text{cohort}} = \frac{\text{Odds of disease in exposed}}{\text{Odds of disease in unexposed}} = \frac{P(D=1|E=1)/P(D=0|E=1)}{P(D=1|E=0)/P(D=0|E=0)}$$</span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a>$$= \frac{P(D=1|E=1) \times P(D=0|E=0)}{P(D=0|E=1) \times P(D=1|E=0)}$$</span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a>$$\text{OR}_{\text{case-control}} = \frac{\text{Odds of exposure in diseased}}{\text{Odds of exposure in non-diseased}} = \frac{P(E=1|D=1)/P(E=0|D=1)}{P(E=1|D=0)/P(E=0|D=0)}$$</span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a>$$= \frac{P(E=1|D=1) \times P(E=0|D=0)}{P(E=0|D=1) \times P(E=1|D=0)}$$</span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a>By Bayes' theorem, $P(D=1|E=1) = \frac{P(E=1|D=1) \times P(D=1)}{P(E=1)}$, and similarly for the other conditional probabilities. Substituting these into the cohort odds ratio:</span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a>$$\text{OR}_{\text{cohort}} = \frac{\frac{P(E=1|D=1) \times P(D=1)}{P(E=1)} \times \frac{P(E=0|D=0) \times P(D=0)}{P(E=0)}}{\frac{P(E=0|D=1) \times P(D=1)}{P(E=0)} \times \frac{P(E=1|D=0) \times P(D=0)}{P(E=1)}}$$</span>
<span id="cb62-247"><a href="#cb62-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-248"><a href="#cb62-248" aria-hidden="true" tabindex="-1"></a>$$= \frac{P(E=1|D=1) \times P(E=0|D=0)}{P(E=0|D=1) \times P(E=1|D=0)} = \text{OR}_{\text{case-control}}$$</span>
<span id="cb62-249"><a href="#cb62-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-250"><a href="#cb62-250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus, the disease odds ratio equals the exposure odds ratio, making the odds ratio estimable from either study design.</span>
<span id="cb62-251"><a href="#cb62-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-252"><a href="#cb62-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-253"><a href="#cb62-253" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds ratios are easy to interpret when investigating rare events</span>
<span id="cb62-254"><a href="#cb62-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-255"><a href="#cb62-255" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Odds = prob / (1 - prob)</span>
<span id="cb62-256"><a href="#cb62-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-257"><a href="#cb62-257" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>For rare events, (1 - prob) is approximately 1</span>
<span id="cb62-258"><a href="#cb62-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-259"><a href="#cb62-259" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Odds is approximately the probability</span>
<span id="cb62-260"><a href="#cb62-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-261"><a href="#cb62-261" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Odds ratios are approximately risk ratios</span>
<span id="cb62-262"><a href="#cb62-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-263"><a href="#cb62-263" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Case-control studies usually used when events are rare</span>
<span id="cb62-264"><a href="#cb62-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-265"><a href="#cb62-265" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Second (scientific) reason: Linearity</span>
<span id="cb62-266"><a href="#cb62-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-267"><a href="#cb62-267" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Proportions are bounded by 0 and 1</span>
<span id="cb62-268"><a href="#cb62-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-269"><a href="#cb62-269" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is thus unlikely that a straight line relationship would exists between a proportion and a predictor</span>
<span id="cb62-270"><a href="#cb62-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-271"><a href="#cb62-271" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Unless the predictor itself is bounded</span>
<span id="cb62-272"><a href="#cb62-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-273"><a href="#cb62-273" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Otherwise, there eventually must be a threshold above which the probability does not increase (or only increases a little)</span>
<span id="cb62-274"><a href="#cb62-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-277"><a href="#cb62-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-278"><a href="#cb62-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Logistic function will bound probabilities between 0 and 1</span></span>
<span id="cb62-279"><a href="#cb62-279" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))}</span>
<span id="cb62-280"><a href="#cb62-280" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cf">function</span>(x) <span class="fu">expit</span>(x), <span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>, <span class="at">ylab=</span><span class="st">"Probabilty"</span>, <span class="at">xlab=</span><span class="st">"Predictor"</span>)</span>
<span id="cb62-281"><a href="#cb62-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-282"><a href="#cb62-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-283"><a href="#cb62-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Third (scientific) reason: Effect modification</span>
<span id="cb62-284"><a href="#cb62-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-285"><a href="#cb62-285" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The restriction on ranges for probabilities makes it likely that effect modification *must* be present with proportions</span>
<span id="cb62-286"><a href="#cb62-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-287"><a href="#cb62-287" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Example: Is the association between 2-year relapse rates and having a positive scan modified by gender?</span>
<span id="cb62-288"><a href="#cb62-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-289"><a href="#cb62-289" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Women relapse 40% of the time when the scan is negative, and 95% of the time when the scan is positive (an increase of 55%)</span>
<span id="cb62-290"><a href="#cb62-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-291"><a href="#cb62-291" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>If men relapse 75% of the time when the scan is negative, then a positive scan can increase the relapse rate to at most 100%, which is only a 25% increase</span>
<span id="cb62-292"><a href="#cb62-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-293"><a href="#cb62-293" aria-hidden="true" tabindex="-1"></a>                |                 |       |              |</span>
<span id="cb62-294"><a href="#cb62-294" aria-hidden="true" tabindex="-1"></a>                |-----------------|-------|--------------|</span>
<span id="cb62-295"><a href="#cb62-295" aria-hidden="true" tabindex="-1"></a>                | **Proportions** |       |              |</span>
<span id="cb62-296"><a href="#cb62-296" aria-hidden="true" tabindex="-1"></a>                |                 | Women | Men          |</span>
<span id="cb62-297"><a href="#cb62-297" aria-hidden="true" tabindex="-1"></a>                | Negative Scan   | 40%   | 75%          |</span>
<span id="cb62-298"><a href="#cb62-298" aria-hidden="true" tabindex="-1"></a>                | Positive Scan   | 95%   | (up to 100%) |</span>
<span id="cb62-299"><a href="#cb62-299" aria-hidden="true" tabindex="-1"></a>                |                 |       |              |</span>
<span id="cb62-300"><a href="#cb62-300" aria-hidden="true" tabindex="-1"></a>                | Difference      | 55%   | Up to 25%    |</span>
<span id="cb62-301"><a href="#cb62-301" aria-hidden="true" tabindex="-1"></a>                | Ratio           | 2.38  | $\leq 1.33$  |</span>
<span id="cb62-302"><a href="#cb62-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-303"><a href="#cb62-303" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>With the odds, the association can hold without effect modification</span>
<span id="cb62-304"><a href="#cb62-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-305"><a href="#cb62-305" aria-hidden="true" tabindex="-1"></a>                |               |       |                  |</span>
<span id="cb62-306"><a href="#cb62-306" aria-hidden="true" tabindex="-1"></a>                |---------------|-------|------------------|</span>
<span id="cb62-307"><a href="#cb62-307" aria-hidden="true" tabindex="-1"></a>                | **Odds**      |       |                  |</span>
<span id="cb62-308"><a href="#cb62-308" aria-hidden="true" tabindex="-1"></a>                |               | Women | Men              |</span>
<span id="cb62-309"><a href="#cb62-309" aria-hidden="true" tabindex="-1"></a>                | Negative Scan | 0.67  | 3                |</span>
<span id="cb62-310"><a href="#cb62-310" aria-hidden="true" tabindex="-1"></a>                | Positive Scan | 19    | (up to $\infty$) |</span>
<span id="cb62-311"><a href="#cb62-311" aria-hidden="true" tabindex="-1"></a>                |               |       |                  |</span>
<span id="cb62-312"><a href="#cb62-312" aria-hidden="true" tabindex="-1"></a>                | Ratio         | 28.5  | $&lt; \infty$       |</span>
<span id="cb62-313"><a href="#cb62-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-314"><a href="#cb62-314" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the odds of positive scan in men was 85.5, then the odds ratio would be exactly 28.5 (no effect modification)</span>
<span id="cb62-315"><a href="#cb62-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-316"><a href="#cb62-316" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fourth (statistics) reason:</span>
<span id="cb62-317"><a href="#cb62-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-318"><a href="#cb62-318" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Classical linear regression requires equal variances across each predictor group</span>
<span id="cb62-319"><a href="#cb62-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-320"><a href="#cb62-320" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>But, with binary data, the variance within a group depends on the mean</span>
<span id="cb62-321"><a href="#cb62-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-322"><a href="#cb62-322" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For binary $Y$, $E(Y) = p$ and $Var(Y) = p(1-p)$</span>
<span id="cb62-323"><a href="#cb62-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-324"><a href="#cb62-324" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>With robust standard errors, the mean-variance relationship is not a major problem. However, a logistic model that correctly models the mean-variance relationship will be more efficient.</span>
<span id="cb62-325"><a href="#cb62-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-326"><a href="#cb62-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### The simple logistic regression model</span></span>
<span id="cb62-327"><a href="#cb62-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-328"><a href="#cb62-328" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modeling the odds of binary response variable $Y$ on predictor $X$</span>
<span id="cb62-329"><a href="#cb62-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-330"><a href="#cb62-330" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Distribution: $\textrm{Pr}(Y_i = 1) = p_i$</span>
<span id="cb62-331"><a href="#cb62-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-332"><a href="#cb62-332" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Model: $\textrm{logit}(p_i) = \textrm{log}\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 \times X_i$</span>
<span id="cb62-333"><a href="#cb62-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-334"><a href="#cb62-334" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = 0$: log odds = $\beta_0$</span>
<span id="cb62-335"><a href="#cb62-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-336"><a href="#cb62-336" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x$: log odds = $\beta_0 + \beta_1 \times x$</span>
<span id="cb62-337"><a href="#cb62-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-338"><a href="#cb62-338" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x+1$: log odds = $\beta_0 + \beta_1 \times x + \beta_1$</span>
<span id="cb62-339"><a href="#cb62-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-340"><a href="#cb62-340" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To interpret as odds, exponentiate the regression parameters</span>
<span id="cb62-341"><a href="#cb62-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-342"><a href="#cb62-342" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Distribution: $\textrm{Pr}(Y_i = 1) = p_i$</span>
<span id="cb62-343"><a href="#cb62-343" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Model: $\frac{p_i}{1-p_i} = \exp(\beta_0 + \beta_1 \times X_i) = e^{\beta_0} \times e^{\beta_1 \times X_i}$</span>
<span id="cb62-344"><a href="#cb62-344" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = 0$: odds = $e^{\beta_0}$</span>
<span id="cb62-345"><a href="#cb62-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x$: odds = $e^{\beta_0} \times e^{\beta_1 \times x}$</span>
<span id="cb62-346"><a href="#cb62-346" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x+1$: odds = $e^{\beta_0} \times e^{\beta_1 \times x} \times e^{\beta_1}$</span>
<span id="cb62-347"><a href="#cb62-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-348"><a href="#cb62-348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To interpret as proportions (remember proportion = odds / (1 + odds))</span>
<span id="cb62-349"><a href="#cb62-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-350"><a href="#cb62-350" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Distribution: $\textrm{Pr}(Y_i = 1) = p_i$</span>
<span id="cb62-351"><a href="#cb62-351" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Model: $p_i = \frac{e^{\beta_0} e^{\beta_1 \times X_i}}{1 + e^{\beta_0} e^{\beta_1 \times X_i}}$</span>
<span id="cb62-352"><a href="#cb62-352" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = 0$: $p_i = \frac{e^{\beta_0}}{1 + e^{\beta_0}}$\</span>
<span id="cb62-353"><a href="#cb62-353" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x$: $p_i = \frac{e^{\beta_0} e^{\beta_1 \times x}}{1 + e^{\beta_0} e^{\beta_1 \times x}}$</span>
<span id="cb62-354"><a href="#cb62-354" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When $X_i = x+1$: $p_i = \frac{e^{\beta_0} e^{\beta_1 \times x} e^{\beta_1}}{1 + e^{\beta_0} e^{\beta_1 \times x}e^{\beta_1}}$</span>
<span id="cb62-355"><a href="#cb62-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-356"><a href="#cb62-356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Most common interpretations found by exponentiating the coefficients</span>
<span id="cb62-357"><a href="#cb62-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-358"><a href="#cb62-358" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds when predictor is 0 found by exponentiating the intercept: $\exp(\beta_0)$</span>
<span id="cb62-359"><a href="#cb62-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-360"><a href="#cb62-360" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds ratio between groups differing in the values of the predictor by 1 unit found by exponentiating the slope: $\exp(\beta_1)$</span>
<span id="cb62-361"><a href="#cb62-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-362"><a href="#cb62-362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stata commands</span>
<span id="cb62-363"><a href="#cb62-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-364"><a href="#cb62-364" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` stata</span></span>
<span id="cb62-365"><a href="#cb62-365" aria-hidden="true" tabindex="-1"></a><span class="in">    logit respvar predvar, [robust]</span></span>
<span id="cb62-366"><a href="#cb62-366" aria-hidden="true" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb62-367"><a href="#cb62-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-368"><a href="#cb62-368" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Provides regression parameter estimates an inference on the log odds scale (both coefficients with CIs, SEs, p-values)</span>
<span id="cb62-369"><a href="#cb62-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-370"><a href="#cb62-370" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` stata</span></span>
<span id="cb62-371"><a href="#cb62-371" aria-hidden="true" tabindex="-1"></a><span class="in">    logistic respvar predvar, [robust]</span></span>
<span id="cb62-372"><a href="#cb62-372" aria-hidden="true" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb62-373"><a href="#cb62-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-374"><a href="#cb62-374" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Provides regression parameter estimates and inference on the odds ratio scale (only slope with CIs, SEs, p-values)</span></span>
<span id="cb62-375"><a href="#cb62-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-376"><a href="#cb62-376" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>R Commands</span>
<span id="cb62-377"><a href="#cb62-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-378"><a href="#cb62-378" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>With rms package, <span class="in">`lrm(respvar ~ predvar, ...)`</span></span>
<span id="cb62-379"><a href="#cb62-379" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-380"><a href="#cb62-380" aria-hidden="true" tabindex="-1"></a><span class="ss">       - </span><span class="in">`robcov(fit)`</span> gives robust standard error estimates in `lrm'</span>
<span id="cb62-381"><a href="#cb62-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-382"><a href="#cb62-382" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In general, <span class="in">`glm(respvar ~ predvar, family=“binomial”)`</span></span>
<span id="cb62-383"><a href="#cb62-383" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-384"><a href="#cb62-384" aria-hidden="true" tabindex="-1"></a><span class="ss">       - </span><span class="in">`sandwich()`</span> in the sandwich library can give robust standard errors when using <span class="in">`glm`</span></span>
<span id="cb62-385"><a href="#cb62-385" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-386"><a href="#cb62-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-387"><a href="#cb62-387" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example: Survival on the Titanic and Age</span></span>
<span id="cb62-388"><a href="#cb62-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-389"><a href="#cb62-389" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dataset at <span class="ot">&lt;https://statcomp2.app.vumc.org/modern-regression/lectures/data/&gt;</span></span>
<span id="cb62-390"><a href="#cb62-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-391"><a href="#cb62-391" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Describes the survival status of individual passengers on the Titanic</span>
<span id="cb62-392"><a href="#cb62-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-393"><a href="#cb62-393" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data on age available for many, but not all, subjects (data continually being updated)</span>
<span id="cb62-394"><a href="#cb62-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-395"><a href="#cb62-395" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Response variables is Survival</span>
<span id="cb62-396"><a href="#cb62-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-397"><a href="#cb62-397" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Binary variable: 1=Survived, 0=Died</span>
<span id="cb62-398"><a href="#cb62-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-399"><a href="#cb62-399" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Predictor variable is Age</span>
<span id="cb62-400"><a href="#cb62-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-401"><a href="#cb62-401" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Continuous grouping variable</span>
<span id="cb62-402"><a href="#cb62-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-403"><a href="#cb62-403" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Possibly different age effects by sex (effect modification by sex)</span>
<span id="cb62-404"><a href="#cb62-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-405"><a href="#cb62-405" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive Plots</span></span>
<span id="cb62-406"><a href="#cb62-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-409"><a href="#cb62-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-410"><a href="#cb62-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Missing data patterns in the Tianic dataset</span></span>
<span id="cb62-411"><a href="#cb62-411" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb62-412"><a href="#cb62-412" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-413"><a href="#cb62-413" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">"data/titanic3.csv"</span>)</span>
<span id="cb62-414"><a href="#cb62-414" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">naclus</span>(titanic)) <span class="co"># study patterns of missing values</span></span>
<span id="cb62-415"><a href="#cb62-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-416"><a href="#cb62-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-419"><a href="#cb62-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-420"><a href="#cb62-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Scatterplot of age versus survival in the Titanic data with lowess smooth.  This simple plot is not very useful because survival is either 0 or 1, making it hard to visualize any trends.</span></span>
<span id="cb62-421"><a href="#cb62-421" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>survived)) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="dv">0</span>, <span class="at">height=</span>.<span class="dv">02</span>, <span class="at">alpha=</span>.<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb62-422"><a href="#cb62-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-423"><a href="#cb62-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-426"><a href="#cb62-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-427"><a href="#cb62-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Age versus survival by sex in the Titanic data by age using a super smoother.  The trends are clearer with this smoothing approach.</span></span>
<span id="cb62-428"><a href="#cb62-428" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(titanic, </span>
<span id="cb62-429"><a href="#cb62-429" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plsmo</span>(age, survived, <span class="at">group=</span>sex, <span class="at">datadensity=</span>T, <span class="at">ylab=</span><span class="st">"Survived (1=Yes, 0=No)"</span>, <span class="at">xlab=</span><span class="st">"Age (years)"</span>)</span>
<span id="cb62-430"><a href="#cb62-430" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-431"><a href="#cb62-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-432"><a href="#cb62-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-435"><a href="#cb62-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-436"><a href="#cb62-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-437"><a href="#cb62-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-438"><a href="#cb62-438" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comments on the plots</span>
<span id="cb62-439"><a href="#cb62-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-440"><a href="#cb62-440" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Age is missing for many subjects, which we will not worry about in the following analysis</span>
<span id="cb62-441"><a href="#cb62-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-442"><a href="#cb62-442" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The simple scatterplot, even with superimposes lowess smooth, is worthless. I have jittered the point and altered their opacity to help visualize overlapping point.</span>
<span id="cb62-443"><a href="#cb62-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-444"><a href="#cb62-444" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>More advanced plotting available in R (in this case, the plsmo() function) can help to visualize the data</span>
<span id="cb62-445"><a href="#cb62-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-446"><a href="#cb62-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression Model</span></span>
<span id="cb62-447"><a href="#cb62-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-448"><a href="#cb62-448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Regression model for survival on age (ignoring possible effect modification for now)</span>
<span id="cb62-449"><a href="#cb62-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-450"><a href="#cb62-450" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Answer question by assessing linear trends in log odds of survival by age</span>
<span id="cb62-451"><a href="#cb62-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-452"><a href="#cb62-452" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the best fitting line to log odds of survival within age groups</span>
<span id="cb62-453"><a href="#cb62-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-454"><a href="#cb62-454" aria-hidden="true" tabindex="-1"></a>$$\textrm{logodds}(\textrm{Survival} | \textrm{Age}) = \beta_0 + \beta_1 \times \textrm{Age}$$</span>
<span id="cb62-455"><a href="#cb62-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-456"><a href="#cb62-456" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>An association will exist if the slope $\beta_1$ is nonzero</span>
<span id="cb62-457"><a href="#cb62-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-458"><a href="#cb62-458" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In that case, the odds (and probability) of survival will be different across different age groups</span>
<span id="cb62-459"><a href="#cb62-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-462"><a href="#cb62-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-463"><a href="#cb62-463" aria-hidden="true" tabindex="-1"></a>m.titanic <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb62-464"><a href="#cb62-464" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.titanic)</span>
<span id="cb62-465"><a href="#cb62-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-466"><a href="#cb62-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-467"><a href="#cb62-467" aria-hidden="true" tabindex="-1"></a>$\textrm{logodds}(\textrm{Survival} | \textrm{Age}) = -0.1365 - 0.007899 \times \textrm{Age}$</span>
<span id="cb62-468"><a href="#cb62-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-469"><a href="#cb62-469" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>General interpretation</span>
<span id="cb62-470"><a href="#cb62-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-471"><a href="#cb62-471" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Intercept is labeled "(Intercept)"</span>
<span id="cb62-472"><a href="#cb62-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-473"><a href="#cb62-473" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope for age is labeled "age"</span>
<span id="cb62-474"><a href="#cb62-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-475"><a href="#cb62-475" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of intercept</span>
<span id="cb62-476"><a href="#cb62-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-477"><a href="#cb62-477" aria-hidden="true" tabindex="-1"></a>    <span class="sc">\*</span>Estimated log odds for newborns (age=0) is $-0.136534$</span>
<span id="cb62-478"><a href="#cb62-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-479"><a href="#cb62-479" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds of survival for newborns is $e^{-0.136534} = 0.8724$</span>
<span id="cb62-480"><a href="#cb62-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-481"><a href="#cb62-481" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Probability of survival</span>
<span id="cb62-482"><a href="#cb62-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-483"><a href="#cb62-483" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Prob = odds / (1 + odds)</span>
<span id="cb62-484"><a href="#cb62-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-485"><a href="#cb62-485" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$0.8724 / (1 + .8724) = 0.4659$</span>
<span id="cb62-486"><a href="#cb62-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-489"><a href="#cb62-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-490"><a href="#cb62-490" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(m.titanic, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb62-491"><a href="#cb62-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-492"><a href="#cb62-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-493"><a href="#cb62-493" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of slope</span>
<span id="cb62-494"><a href="#cb62-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-495"><a href="#cb62-495" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Estimate difference in the log odds of survival for two groups differing by one year in age is $-0.0078985$</span>
<span id="cb62-496"><a href="#cb62-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-497"><a href="#cb62-497" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This estimate averages over males and females</span>
<span id="cb62-498"><a href="#cb62-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-499"><a href="#cb62-499" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Older groups tend to have lower log odds</span>
<span id="cb62-500"><a href="#cb62-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-501"><a href="#cb62-501" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Odds Ratio: $e^{-0.0078985} = 0.9921$</span>
<span id="cb62-502"><a href="#cb62-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-503"><a href="#cb62-503" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For five year difference in age: $e^{-0.0078985 \times 5} = 0.9612$</span>
<span id="cb62-504"><a href="#cb62-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-505"><a href="#cb62-505" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In Stata use "lincom age, or" or "lincom 5<span class="sc">\*</span>age, or"</span>
<span id="cb62-506"><a href="#cb62-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-507"><a href="#cb62-507" aria-hidden="true" tabindex="-1"></a>Note that if the straight line relationship does not hold true, we interpret the slope as an average difference in the log odds of survival per one year difference in age</span>
<span id="cb62-508"><a href="#cb62-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-509"><a href="#cb62-509" aria-hidden="true" tabindex="-1"></a>There are several ways to get the odds ratio and confidence interval in R</span>
<span id="cb62-510"><a href="#cb62-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-513"><a href="#cb62-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-514"><a href="#cb62-514" aria-hidden="true" tabindex="-1"></a><span class="co"># The coefficient and confidence interval (on the log-odds scale)</span></span>
<span id="cb62-515"><a href="#cb62-515" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>]</span>
<span id="cb62-516"><a href="#cb62-516" aria-hidden="true" tabindex="-1"></a><span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>)</span>
<span id="cb62-517"><a href="#cb62-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-518"><a href="#cb62-518" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratio for age and confidence interval for age (1 year increase)</span></span>
<span id="cb62-519"><a href="#cb62-519" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>])</span>
<span id="cb62-520"><a href="#cb62-520" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>))</span>
<span id="cb62-521"><a href="#cb62-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-522"><a href="#cb62-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-523"><a href="#cb62-523" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratio for age and confidence interval for age (5 year increase)</span></span>
<span id="cb62-524"><a href="#cb62-524" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(m.titanic)[<span class="st">"age"</span>])</span>
<span id="cb62-525"><a href="#cb62-525" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(m.titanic, <span class="st">"age"</span>))</span>
<span id="cb62-526"><a href="#cb62-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-527"><a href="#cb62-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-528"><a href="#cb62-528" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using finalfit to create a nicer output table of the coefficients and confidence intervals</span>
<span id="cb62-529"><a href="#cb62-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-530"><a href="#cb62-530" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For finalfit to use a logistic regression model by default, survived must be defined as a factor variable with two levels</span>
<span id="cb62-531"><a href="#cb62-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-534"><a href="#cb62-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-535"><a href="#cb62-535" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finalfit)</span>
<span id="cb62-536"><a href="#cb62-536" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb62-537"><a href="#cb62-537" aria-hidden="true" tabindex="-1"></a>explanatory <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>)</span>
<span id="cb62-538"><a href="#cb62-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-539"><a href="#cb62-539" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>survived.factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic<span class="sc">$</span>survived, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Died"</span>,<span class="st">"Survived"</span>))</span>
<span id="cb62-540"><a href="#cb62-540" aria-hidden="true" tabindex="-1"></a>dependent <span class="ot">=</span> <span class="st">'survived.factor'</span></span>
<span id="cb62-541"><a href="#cb62-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-542"><a href="#cb62-542" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(titanic<span class="sc">$</span>age) <span class="ot">&lt;-</span> <span class="st">"Age (years)"</span></span>
<span id="cb62-543"><a href="#cb62-543" aria-hidden="true" tabindex="-1"></a><span class="fu">finalfit</span>(<span class="at">.data =</span> titanic, dependent, explanatory)</span>
<span id="cb62-544"><a href="#cb62-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-545"><a href="#cb62-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-546"><a href="#cb62-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comments on Interpretation</span></span>
<span id="cb62-547"><a href="#cb62-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-548"><a href="#cb62-548" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The slope for age is expressed as a difference in group means, not the difference due to aging. We did not do a longitudinal study in which repeated measurements were taken on the same subject.</span>
<span id="cb62-549"><a href="#cb62-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-550"><a href="#cb62-550" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the group log odds are truly linear, then the slope has an exact interpretation as the change in survival due to a one year change in (any) age</span>
<span id="cb62-551"><a href="#cb62-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-552"><a href="#cb62-552" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Otherwise, the slope estimates the first order trend of the sample data and we should not treat the estimates of group odds or probabilities as accurate</span>
<span id="cb62-553"><a href="#cb62-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-554"><a href="#cb62-554" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is difficult to see in the above example, but the CIs around the odds ratios are not symmetric</span>
<span id="cb62-555"><a href="#cb62-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-556"><a href="#cb62-556" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>(Symmetric) CIs are calculated on the log odds scale, and then transformed to the odds scale by expoenentiating the lower and upper limits of the CI</span>
<span id="cb62-557"><a href="#cb62-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-558"><a href="#cb62-558" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"From logistic regression analysis, we estimate that for each 5 year difference in age, the odds of survival on the Titanic decreased by 3.9%, though this estimate is not statistically significant ($p = 0.07$). A 95% CI suggests that this observation is not unusual if a group that is five years older might have an odds of survival that was anywhere between 7.9% lower and 0.4% higher than the younger group."</span>
<span id="cb62-559"><a href="#cb62-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-560"><a href="#cb62-560" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The confidence interval and statistical test given in the output is called a Wald test. Other tests (Score, Likelihood Ratio) are also possible.</span>
<span id="cb62-561"><a href="#cb62-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-562"><a href="#cb62-562" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>All tests are asymptotically equivalent</span>
<span id="cb62-563"><a href="#cb62-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-564"><a href="#cb62-564" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Wald test is easiest to obtain, but generally performs the poorest in small sample sizes</span>
<span id="cb62-565"><a href="#cb62-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-566"><a href="#cb62-566" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Likelihood Ratio test performs the best in small samples. We will discuss it later, including how to obtain the test using post-estimation commands.</span>
<span id="cb62-567"><a href="#cb62-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-568"><a href="#cb62-568" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Score test is not bad in small samples, but is often hard to obtain from software. It is exactly equal to the Chi-squared test for binary outcomes and categorical predictors.</span>
<span id="cb62-569"><a href="#cb62-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-570"><a href="#cb62-570" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Bayesian Estimates and Interpretation {#sec-bayeslogistic}</span></span>
<span id="cb62-571"><a href="#cb62-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-572"><a href="#cb62-572" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Bayesian approach to the logistic model requires specifying the model, prior distributions, and the likelihood</span>
<span id="cb62-573"><a href="#cb62-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-574"><a href="#cb62-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The model</span>
<span id="cb62-575"><a href="#cb62-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-576"><a href="#cb62-576" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. a model for the log odds of survival that is linear in the parameters with an intercept and slope for age</span>
<span id="cb62-577"><a href="#cb62-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-578"><a href="#cb62-578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prior distributions on parameters</span>
<span id="cb62-579"><a href="#cb62-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-580"><a href="#cb62-580" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For the simple logistic regression model, we have parameters $\beta_0$, and $\beta_1$.</span>
<span id="cb62-581"><a href="#cb62-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-582"><a href="#cb62-582" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For now, we will use default prior distributions that are are intended to be *weakly informative* in that they provide moderate regularization and help stabilize computation. See the <span class="co">[</span><span class="ot">STAN documentation</span><span class="co">](https://mc-stan.org/rstanarm/reference/priors.html)</span> for more details</span>
<span id="cb62-583"><a href="#cb62-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-584"><a href="#cb62-584" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Appropriate priors can be based on scientific considerations</span>
<span id="cb62-585"><a href="#cb62-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-586"><a href="#cb62-586" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sensitivity analyses can evaluate the the robustness of finding to different prior assumptions</span>
<span id="cb62-587"><a href="#cb62-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-588"><a href="#cb62-588" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The likelihood</span>
<span id="cb62-589"><a href="#cb62-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-590"><a href="#cb62-590" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For a binomial GLM the likelihood for one observation $y$ can be written as a conditionally binomial probability mass function</span>
<span id="cb62-591"><a href="#cb62-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-592"><a href="#cb62-592" aria-hidden="true" tabindex="-1"></a>$$\binom{n}{y} \pi^{y} (1 - \pi)^{n - y},$$</span>
<span id="cb62-593"><a href="#cb62-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-594"><a href="#cb62-594" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the known number of trials, $\pi = g^{-1}(\eta)$ is the probability of success and $\eta = \alpha + \mathbf{x}^\top \boldsymbol{\beta}$ is a linear predictor</span>
<span id="cb62-595"><a href="#cb62-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-596"><a href="#cb62-596" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb62-597"><a href="#cb62-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-598"><a href="#cb62-598" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For a sample of size $N$, the likelihood of the entire sample is the product of $N$ individual likelihood contributions.</span>
<span id="cb62-599"><a href="#cb62-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-600"><a href="#cb62-600" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb62-601"><a href="#cb62-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-602"><a href="#cb62-602" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Because $\pi$ is a probability, for a binomial model the *link* function $g$ maps between the unit interval (the support of $\pi$) and the set of all real numbers $\mathbb{R}$. When applied to a linear predictor $\eta$ with values in $\mathbb{R}$, the inverse link function $g^{-1}(\eta)$ therefore returns a valid probability between 0 and 1.</span>
<span id="cb62-603"><a href="#cb62-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-604"><a href="#cb62-604" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The two most common link functions used for binomial GLMs are the</span>
<span id="cb62-605"><a href="#cb62-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-606"><a href="#cb62-606" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">logit</span><span class="co">](https://en.wikipedia.org/wiki/Logit)</span> and</span>
<span id="cb62-607"><a href="#cb62-607" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">probit</span><span class="co">](https://en.wikipedia.org/wiki/Probit)</span></span>
<span id="cb62-608"><a href="#cb62-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-609"><a href="#cb62-609" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>With the logit (or log-odds) link function $g(x) = \ln{\left(\frac{x}{1-x}\right)}$, the likelihood for a single observation becomes</span>
<span id="cb62-610"><a href="#cb62-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-611"><a href="#cb62-611" aria-hidden="true" tabindex="-1"></a>$$\binom{n}{y}\left(\text{logit}^{-1}(\eta)\right)^y </span>
<span id="cb62-612"><a href="#cb62-612" aria-hidden="true" tabindex="-1"></a>\left(1 - \text{logit}^{-1}(\eta)\right)^{n-y} = </span>
<span id="cb62-613"><a href="#cb62-613" aria-hidden="true" tabindex="-1"></a>\binom{n}{y} \left(\frac{e^{\eta}}{1 + e^{\eta}}\right)^{y}</span>
<span id="cb62-614"><a href="#cb62-614" aria-hidden="true" tabindex="-1"></a>\left(\frac{1}{1 + e^{\eta}}\right)^{n - y}$$</span>
<span id="cb62-615"><a href="#cb62-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-616"><a href="#cb62-616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>With the probit link function $g(x) = \Phi^{-1}(x)$ yields the likelihood</span>
<span id="cb62-617"><a href="#cb62-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-618"><a href="#cb62-618" aria-hidden="true" tabindex="-1"></a>$$\binom{n}{y} \left(\Phi(\eta)\right)^{y}</span>
<span id="cb62-619"><a href="#cb62-619" aria-hidden="true" tabindex="-1"></a>\left(1 - \Phi(\eta)\right)^{n - y},$$</span>
<span id="cb62-620"><a href="#cb62-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-621"><a href="#cb62-621" aria-hidden="true" tabindex="-1"></a>where $\Phi$ is the CDF of the standard normal distribution.</span>
<span id="cb62-622"><a href="#cb62-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-623"><a href="#cb62-623" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Output from Bayesian logistic regression using logit link function</span>
<span id="cb62-624"><a href="#cb62-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-627"><a href="#cb62-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-628"><a href="#cb62-628" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb62-629"><a href="#cb62-629" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb62-630"><a href="#cb62-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-631"><a href="#cb62-631" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(survived <span class="sc">~</span> age,</span>
<span id="cb62-632"><a href="#cb62-632" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>titanic, <span class="at">family=</span><span class="fu">binomial</span>(),</span>
<span id="cb62-633"><a href="#cb62-633" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed=</span><span class="dv">1234</span>,</span>
<span id="cb62-634"><a href="#cb62-634" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-635"><a href="#cb62-635" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2, <span class="at">digits=</span><span class="dv">4</span>, <span class="at">prob=</span><span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">5</span>, .<span class="dv">975</span>))</span>
<span id="cb62-636"><a href="#cb62-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-637"><a href="#cb62-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-638"><a href="#cb62-638" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>And a summary of the prior distributions used</span>
<span id="cb62-639"><a href="#cb62-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-642"><a href="#cb62-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-643"><a href="#cb62-643" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fit2, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb62-644"><a href="#cb62-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-645"><a href="#cb62-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-646"><a href="#cb62-646" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation</span>
<span id="cb62-647"><a href="#cb62-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-648"><a href="#cb62-648" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope for age is of primary scientific importance</span>
<span id="cb62-649"><a href="#cb62-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-650"><a href="#cb62-650" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*A priori* we assume that no association between age and survival. Specifically, we assumed a Normal prior with location (mean) of 0 and scale (standard devation) of 0.17 for $\beta_1$.</span>
<span id="cb62-651"><a href="#cb62-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-652"><a href="#cb62-652" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Conditional on the data, we estimate that for every 1 year increase in age, the log odds of decreases by -0.0079 (95% credible interval -0.0169 to 0.0004).</span>
<span id="cb62-653"><a href="#cb62-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-654"><a href="#cb62-654" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>To obtain the posterior odds ratio and 95% credible intervals, some additional commands are needed</span>
<span id="cb62-655"><a href="#cb62-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-658"><a href="#cb62-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-659"><a href="#cb62-659" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 year change in age</span></span>
<span id="cb62-660"><a href="#cb62-660" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span>
<span id="cb62-661"><a href="#cb62-661" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>)) <span class="co"># 95% credible interval</span></span>
<span id="cb62-662"><a href="#cb62-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-663"><a href="#cb62-663" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 year increase in age</span></span>
<span id="cb62-664"><a href="#cb62-664" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span>
<span id="cb62-665"><a href="#cb62-665" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>))[<span class="dv">2</span>,] <span class="co"># 95% credible interval</span></span>
<span id="cb62-666"><a href="#cb62-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-667"><a href="#cb62-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Could also flip (invert) these odds ratios to interpret as decrease in age being associated with increased survival</span></span>
<span id="cb62-668"><a href="#cb62-668" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 year decrease in age</span></span>
<span id="cb62-669"><a href="#cb62-669" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit2)[<span class="st">"age"</span>]) <span class="co"># Posterior Odds Ratio</span></span>
<span id="cb62-670"><a href="#cb62-670" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">posterior_interval</span>(fit2, <span class="at">prob =</span> <span class="fl">0.95</span>))[<span class="dv">2</span>,] <span class="co"># 95% credible interval</span></span>
<span id="cb62-671"><a href="#cb62-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-672"><a href="#cb62-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-673"><a href="#cb62-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-674"><a href="#cb62-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-675"><a href="#cb62-675" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The association between age and probability of survival was estimated using a Bayesian logistic regression model. The model did not adjust for other covariates and assumed a logit link function and Binomial likelihood. We assumed a weakly informative prior distribution for the log odds of survival given age (Normal prior with mean 0 and scale 0.17 for $\beta_1$). Conditional on the data, the posterior mean estimate indicates that comparing two subjects who differ in age by 5 years, the younger subject has a 1.04 fold increased odds of survival compared to the older subject. A 95% credible interval for this posterior odds ratio is from 1.00 to 1.09.</span>
<span id="cb62-676"><a href="#cb62-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-677"><a href="#cb62-677" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that this model does not consider gender, so it is averaging over the males and females. We will revisit this analysis where the age effect is analyzed separately in males and females.</span>
<span id="cb62-678"><a href="#cb62-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-679"><a href="#cb62-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inference with Logistic Regression</span></span>
<span id="cb62-680"><a href="#cb62-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-681"><a href="#cb62-681" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As with linear regression, we organize the assumptions needed for valid inference into categories based on what type of inference we wish to make</span>
<span id="cb62-682"><a href="#cb62-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-683"><a href="#cb62-683" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The structure of these assumptions parallels those discussed for linear regression, though the specifics differ due to the binary nature of the outcome</span>
<span id="cb62-684"><a href="#cb62-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-685"><a href="#cb62-685" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The ideas of Signal and Noise found in simple linear regression do not translate well to logistic regression because of the implicit mean-variance relationship</span>
<span id="cb62-686"><a href="#cb62-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-687"><a href="#cb62-687" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We do not tend to quantify an error distribution with logistic regression</span>
<span id="cb62-688"><a href="#cb62-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-689"><a href="#cb62-689" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Valid statistical inference (CIs, p-values) about *associations* requires three general assumptions</span>
<span id="cb62-690"><a href="#cb62-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-691"><a href="#cb62-691" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assumption 1: Approximately Normal distributions for the parameter estimates</span>
<span id="cb62-692"><a href="#cb62-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-693"><a href="#cb62-693" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Large N</span>
<span id="cb62-694"><a href="#cb62-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-695"><a href="#cb62-695" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Need for either robust standard errors or classical logistic regression</span>
<span id="cb62-696"><a href="#cb62-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-697"><a href="#cb62-697" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Definition of large depends on the underlying probabilities (odds)</span>
<span id="cb62-698"><a href="#cb62-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-699"><a href="#cb62-699" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Recall the rule of thumb for chi-squared tests based on the expected number of events</span>
<span id="cb62-700"><a href="#cb62-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-701"><a href="#cb62-701" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assumption 2: Assumptions about the independence of observations</span>
<span id="cb62-702"><a href="#cb62-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-703"><a href="#cb62-703" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Classical regression: Independence of all observation</span>
<span id="cb62-704"><a href="#cb62-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-705"><a href="#cb62-705" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Robust standard errors: Correlated observations within identified clusters</span>
<span id="cb62-706"><a href="#cb62-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-707"><a href="#cb62-707" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assumption 3: Assumptions about variance of observations within groups</span>
<span id="cb62-708"><a href="#cb62-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-709"><a href="#cb62-709" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Classical regression: Mean-variance relationship for binary data</span>
<span id="cb62-710"><a href="#cb62-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-711"><a href="#cb62-711" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Classical logistic regression estimates SE using model based estimates</span>
<span id="cb62-712"><a href="#cb62-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-713"><a href="#cb62-713" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Hence in order to satisfy this requirement, linearity of log odds across groups must hold</span>
<span id="cb62-714"><a href="#cb62-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-715"><a href="#cb62-715" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Robust standard errors</span>
<span id="cb62-716"><a href="#cb62-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-717"><a href="#cb62-717" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Allows unequal variance across groups</span>
<span id="cb62-718"><a href="#cb62-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-719"><a href="#cb62-719" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Hence, do not need linearity of log odds across groups to hold</span>
<span id="cb62-720"><a href="#cb62-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-721"><a href="#cb62-721" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Valid statistical inference (CIs, p-values) about *odds of response in specific groups* requires a further assumption</span>
<span id="cb62-722"><a href="#cb62-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-723"><a href="#cb62-723" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assumption 4: Adequacy of the linear model</span>
<span id="cb62-724"><a href="#cb62-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-725"><a href="#cb62-725" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If we are trying to borrow information about the log odds from neighboring groups, and we are assuming a straight line relationship, the straight line needs to be true</span>
<span id="cb62-726"><a href="#cb62-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-727"><a href="#cb62-727" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Needed for either classical or robust standard errors</span>
<span id="cb62-728"><a href="#cb62-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-729"><a href="#cb62-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Note that we can model transformations of the measured predictor if we feel a straight line is not appropriate</span>
<span id="cb62-730"><a href="#cb62-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-731"><a href="#cb62-731" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For inference about *individual observations* (prediction intervals, P-values) in specific groups requires no further assumptions because we have binary data</span>
<span id="cb62-732"><a href="#cb62-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-733"><a href="#cb62-733" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For binary data, if we know the mean (proportion), we know everything about the distribution including the variance</span>
<span id="cb62-734"><a href="#cb62-734" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-735"><a href="#cb62-735" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This differs from linear regression where we needed Assumption 5 about the error distribution.</span>
<span id="cb62-736"><a href="#cb62-736" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-737"><a href="#cb62-737" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>With binary outcomes, once we correctly specify the mean (Assumption 4), the variance is automatically determined: $\text{Var}(Y|X) = p(X)(1-p(X))$</span>
<span id="cb62-738"><a href="#cb62-738" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-739"><a href="#cb62-739" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-740"><a href="#cb62-740" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting "Positive" Results</span></span>
<span id="cb62-741"><a href="#cb62-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-742"><a href="#cb62-742" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Slope is statistically different from 0 using robust standard errors</span>
<span id="cb62-743"><a href="#cb62-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-744"><a href="#cb62-744" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Observed data is atypical of a setting with no linear trend in odds of response across groups</span>
<span id="cb62-745"><a href="#cb62-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-746"><a href="#cb62-746" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data suggests evidence of a trend toward larger (or smaller) odds in groups having larger values of the predictor</span>
<span id="cb62-747"><a href="#cb62-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-748"><a href="#cb62-748" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>(To the extent the data appears linear, estimates of the group odds or probabilities will be reliable)</span>
<span id="cb62-749"><a href="#cb62-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-750"><a href="#cb62-750" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting "Negative" Results</span></span>
<span id="cb62-751"><a href="#cb62-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-752"><a href="#cb62-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Many possible reasons why the slope is not statistically different from 0 using robust standard errors</span>
<span id="cb62-753"><a href="#cb62-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-754"><a href="#cb62-754" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There may be no association between the response and predictor</span>
<span id="cb62-755"><a href="#cb62-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-756"><a href="#cb62-756" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There may be an association in the parameter considered, but the best fitting line has zero slope</span>
<span id="cb62-757"><a href="#cb62-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-758"><a href="#cb62-758" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There may be a first order trend in the log odds, but we lacked the precision to be confident that it truly exists (a type II error)</span>
<span id="cb62-759"><a href="#cb62-759" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-760"><a href="#cb62-760" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-761"><a href="#cb62-761" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Diagnostics for Understanding Results</span></span>
<span id="cb62-762"><a href="#cb62-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-763"><a href="#cb62-763" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As with linear regression, diagnostics are tools for understanding the model and results, not for data-driven model modification</span>
<span id="cb62-764"><a href="#cb62-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-765"><a href="#cb62-765" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Key differences from linear regression diagnostics</span>
<span id="cb62-766"><a href="#cb62-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-767"><a href="#cb62-767" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>With binary outcomes, traditional residual plots are less informative</span>
<span id="cb62-768"><a href="#cb62-768" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-769"><a href="#cb62-769" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Individual residuals are not very meaningful (outcome is always 0 or 1)</span>
<span id="cb62-770"><a href="#cb62-770" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-771"><a href="#cb62-771" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Binned residuals can help visualize model fit</span>
<span id="cb62-772"><a href="#cb62-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-773"><a href="#cb62-773" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Useful diagnostics for understanding logistic regression models</span>
<span id="cb62-774"><a href="#cb62-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-775"><a href="#cb62-775" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Binned residual plots: Group observations by predicted probability and examine average residuals within bins</span>
<span id="cb62-776"><a href="#cb62-776" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-777"><a href="#cb62-777" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Influence diagnostics: Identify observations that have large impact on parameter estimates</span>
<span id="cb62-778"><a href="#cb62-778" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-779"><a href="#cb62-779" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Predicted probabilities: Plot predicted probabilities across range of predictor to see if model behavior is sensible</span>
<span id="cb62-780"><a href="#cb62-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-781"><a href="#cb62-781" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The goal remains understanding whether the model assumptions are plausible and whether results are sensitive to specific observations</span>
<span id="cb62-782"><a href="#cb62-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-783"><a href="#cb62-783" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Not to iteratively modify the model until diagnostics "look good"</span>
<span id="cb62-784"><a href="#cb62-784" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-785"><a href="#cb62-785" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pre-specification of the scientific model remains paramount</span>
<span id="cb62-786"><a href="#cb62-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-787"><a href="#cb62-787" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnostic examples using Titanic data</span></span>
<span id="cb62-788"><a href="#cb62-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-789"><a href="#cb62-789" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall our simple model of survival by age</span>
<span id="cb62-792"><a href="#cb62-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-793"><a href="#cb62-793" aria-hidden="true" tabindex="-1"></a>fit.age <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-794"><a href="#cb62-794" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.age)</span>
<span id="cb62-795"><a href="#cb62-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-796"><a href="#cb62-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-797"><a href="#cb62-797" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (Binned) residuals</span></span>
<span id="cb62-798"><a href="#cb62-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-799"><a href="#cb62-799" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Binned residual plot</span>
<span id="cb62-800"><a href="#cb62-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-801"><a href="#cb62-801" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Groups observations into bins based on their predicted probabilities</span>
<span id="cb62-802"><a href="#cb62-802" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-803"><a href="#cb62-803" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Within each bin, calculates the average residual (observed - predicted)</span>
<span id="cb62-804"><a href="#cb62-804" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-805"><a href="#cb62-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-806"><a href="#cb62-806" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If the model fits well, average residuals should be close to zero across all bins</span>
<span id="cb62-807"><a href="#cb62-807" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-808"><a href="#cb62-808" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Gray lines show the expected 95% bounds (±2 SE) under the model</span>
<span id="cb62-809"><a href="#cb62-809" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-810"><a href="#cb62-810" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Points outside these bounds suggest potential model misfit in those regions</span>
<span id="cb62-811"><a href="#cb62-811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-812"><a href="#cb62-812" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-813"><a href="#cb62-813" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why we need binned residuals for binary outcomes</span>
<span id="cb62-814"><a href="#cb62-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-815"><a href="#cb62-815" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>With binary data, individual residuals are not very informative</span>
<span id="cb62-816"><a href="#cb62-816" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-817"><a href="#cb62-817" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each observation has $Y_i = 0$ or $Y_i = 1$, so residuals are either $0 - \hat{p}_i$ or $1 - \hat{p}_i$</span>
<span id="cb62-818"><a href="#cb62-818" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-819"><a href="#cb62-819" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A plot of raw residuals shows two bands corresponding to the two possible outcomes</span>
<span id="cb62-822"><a href="#cb62-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-823"><a href="#cb62-823" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Raw residual plot (Titanic data)</span></span>
<span id="cb62-824"><a href="#cb62-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-825"><a href="#cb62-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb62-826"><a href="#cb62-826" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb62-827"><a href="#cb62-827" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> titanic<span class="sc">$</span>survived[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age)] <span class="sc">-</span> pred_prob</span>
<span id="cb62-828"><a href="#cb62-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-829"><a href="#cb62-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb62-830"><a href="#cb62-830" aria-hidden="true" tabindex="-1"></a>resid_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred_prob =</span> pred_prob, <span class="at">resid =</span> resid)</span>
<span id="cb62-831"><a href="#cb62-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-832"><a href="#cb62-832" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw (unbinned) residuals</span></span>
<span id="cb62-833"><a href="#cb62-833" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb62-834"><a href="#cb62-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb62-835"><a href="#cb62-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-836"><a href="#cb62-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb62-837"><a href="#cb62-837" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Raw Residual"</span>,</span>
<span id="cb62-838"><a href="#cb62-838" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Raw Residuals (Not Binned)"</span>) <span class="sc">+</span></span>
<span id="cb62-839"><a href="#cb62-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb62-840"><a href="#cb62-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-841"><a href="#cb62-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-842"><a href="#cb62-842" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The two bands in the plot correspond to survivors ($Y=1$, upper band) and non-survivors ($Y=0$, lower band)</span>
<span id="cb62-843"><a href="#cb62-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-844"><a href="#cb62-844" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This plot provides little information about model fit - we cannot easily assess systematic deviations</span>
<span id="cb62-845"><a href="#cb62-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-846"><a href="#cb62-846" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Binning the residuals by predicted probability allows us to see average deviations from the model</span>
<span id="cb62-847"><a href="#cb62-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-848"><a href="#cb62-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-851"><a href="#cb62-851" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-852"><a href="#cb62-852" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Raw residuals from the logistic regression model of survival by age in the Titanic data. Individual residuals (gray points) form two bands corresponding to survivors (upper) and non-survivors (lower). Vertical boundaries divide predictions into 20 bins of equal width. Red points show the average residual within each bin, connected by a red line. This binning process, shown by the alternating shaded regions, transforms the uninformative raw residual plot into a more interpretable binned residual plot by averaging within prediction ranges."</span></span>
<span id="cb62-853"><a href="#cb62-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-854"><a href="#cb62-854" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-855"><a href="#cb62-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-856"><a href="#cb62-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb62-857"><a href="#cb62-857" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb62-858"><a href="#cb62-858" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> titanic<span class="sc">$</span>survived[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age)] <span class="sc">-</span> pred_prob</span>
<span id="cb62-859"><a href="#cb62-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-860"><a href="#cb62-860" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb62-861"><a href="#cb62-861" aria-hidden="true" tabindex="-1"></a>resid_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred_prob =</span> pred_prob, <span class="at">resid =</span> resid)</span>
<span id="cb62-862"><a href="#cb62-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-863"><a href="#cb62-863" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins for visualization</span></span>
<span id="cb62-864"><a href="#cb62-864" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb62-865"><a href="#cb62-865" aria-hidden="true" tabindex="-1"></a>bin_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(pred_prob), <span class="fu">max</span>(pred_prob), <span class="at">length.out =</span> n_bins <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb62-866"><a href="#cb62-866" aria-hidden="true" tabindex="-1"></a>resid_data<span class="sc">$</span>bin <span class="ot">&lt;-</span> <span class="fu">cut</span>(resid_data<span class="sc">$</span>pred_prob, <span class="at">breaks =</span> bin_breaks)</span>
<span id="cb62-867"><a href="#cb62-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-868"><a href="#cb62-868" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate binned statistics</span></span>
<span id="cb62-869"><a href="#cb62-869" aria-hidden="true" tabindex="-1"></a>binned_data <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(resid, pred_prob) <span class="sc">~</span> bin, </span>
<span id="cb62-870"><a href="#cb62-870" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> resid_data, </span>
<span id="cb62-871"><a href="#cb62-871" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> mean)</span>
<span id="cb62-872"><a href="#cb62-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-873"><a href="#cb62-873" aria-hidden="true" tabindex="-1"></a><span class="co"># Create rectangles for shading alternating bins</span></span>
<span id="cb62-874"><a href="#cb62-874" aria-hidden="true" tabindex="-1"></a>bin_rects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb62-875"><a href="#cb62-875" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmin =</span> bin_breaks[<span class="sc">-</span><span class="fu">length</span>(bin_breaks)],</span>
<span id="cb62-876"><a href="#cb62-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmax =</span> bin_breaks[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb62-877"><a href="#cb62-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">shade =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">length.out =</span> n_bins)</span>
<span id="cb62-878"><a href="#cb62-878" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-879"><a href="#cb62-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-880"><a href="#cb62-880" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw residuals with shaded bins</span></span>
<span id="cb62-881"><a href="#cb62-881" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb62-882"><a href="#cb62-882" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded rectangles for alternating bins</span></span>
<span id="cb62-883"><a href="#cb62-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> bin_rects[bin_rects<span class="sc">$</span>shade, ], </span>
<span id="cb62-884"><a href="#cb62-884" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> xmin, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>),</span>
<span id="cb62-885"><a href="#cb62-885" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb62-886"><a href="#cb62-886" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw residuals</span></span>
<span id="cb62-887"><a href="#cb62-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb62-888"><a href="#cb62-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-889"><a href="#cb62-889" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines to show bin boundaries</span></span>
<span id="cb62-890"><a href="#cb62-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> bin_breaks,</span>
<span id="cb62-891"><a href="#cb62-891" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb62-892"><a href="#cb62-892" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add average residual within each bin</span></span>
<span id="cb62-893"><a href="#cb62-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid),</span>
<span id="cb62-894"><a href="#cb62-894" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb62-895"><a href="#cb62-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid),</span>
<span id="cb62-896"><a href="#cb62-896" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-897"><a href="#cb62-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb62-898"><a href="#cb62-898" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Raw Residual"</span>) <span class="sc">+</span></span>
<span id="cb62-899"><a href="#cb62-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb62-900"><a href="#cb62-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-901"><a href="#cb62-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-902"><a href="#cb62-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-905"><a href="#cb62-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-906"><a href="#cb62-906" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Binned residual plot (Titanic data)</span></span>
<span id="cb62-907"><a href="#cb62-907" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted probabilities and residuals for complete cases</span></span>
<span id="cb62-908"><a href="#cb62-908" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb62-909"><a href="#cb62-909" aria-hidden="true" tabindex="-1"></a>resid_data<span class="sc">$</span>bin <span class="ot">&lt;-</span> <span class="fu">cut</span>(resid_data<span class="sc">$</span>pred_prob, <span class="at">breaks =</span> n_bins)</span>
<span id="cb62-910"><a href="#cb62-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-911"><a href="#cb62-911" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average residual and predicted probability within each bin</span></span>
<span id="cb62-912"><a href="#cb62-912" aria-hidden="true" tabindex="-1"></a>binned_data <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(resid, pred_prob) <span class="sc">~</span> bin, </span>
<span id="cb62-913"><a href="#cb62-913" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> resid_data, </span>
<span id="cb62-914"><a href="#cb62-914" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> mean)</span>
<span id="cb62-915"><a href="#cb62-915" aria-hidden="true" tabindex="-1"></a>binned_data<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="fu">table</span>(resid_data<span class="sc">$</span>bin)</span>
<span id="cb62-916"><a href="#cb62-916" aria-hidden="true" tabindex="-1"></a>binned_data<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(binned_data<span class="sc">$</span>pred_prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> binned_data<span class="sc">$</span>pred_prob) <span class="sc">/</span> binned_data<span class="sc">$</span>n)</span>
<span id="cb62-917"><a href="#cb62-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-918"><a href="#cb62-918" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot binned residuals</span></span>
<span id="cb62-919"><a href="#cb62-919" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(binned_data, <span class="fu">aes</span>(<span class="at">x =</span> pred_prob, <span class="at">y =</span> resid)) <span class="sc">+</span></span>
<span id="cb62-920"><a href="#cb62-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb62-921"><a href="#cb62-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-922"><a href="#cb62-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>se, <span class="at">ymax =</span> <span class="dv">2</span><span class="sc">*</span>se), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-923"><a href="#cb62-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb62-924"><a href="#cb62-924" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Residual"</span>,</span>
<span id="cb62-925"><a href="#cb62-925" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Binned Residual Plot"</span>) <span class="sc">+</span></span>
<span id="cb62-926"><a href="#cb62-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb62-927"><a href="#cb62-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-928"><a href="#cb62-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-929"><a href="#cb62-929" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of the binned residual plot</span>
<span id="cb62-930"><a href="#cb62-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-931"><a href="#cb62-931" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Most points fall within the gray bands, suggesting reasonable model fit</span>
<span id="cb62-932"><a href="#cb62-932" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-933"><a href="#cb62-933" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Any systematic patterns (e.g., all positive residuals at low predictions, all negative at high predictions) would indicate the linear logit assumption may not hold</span>
<span id="cb62-934"><a href="#cb62-934" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-935"><a href="#cb62-935" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Individual points outside the bands are not necessarily problematic - we expect about 5% of bins to fall outside</span>
<span id="cb62-936"><a href="#cb62-936" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-937"><a href="#cb62-937" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Look for systematic deviations rather than isolated points</span>
<span id="cb62-938"><a href="#cb62-938" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-939"><a href="#cb62-939" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In this example, the binned residuals show no strong systematic pattern, supporting the linear relationship between age and log odds of survival</span>
<span id="cb62-940"><a href="#cb62-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-941"><a href="#cb62-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-942"><a href="#cb62-942" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predicted versus observed probabilities of survival</span></span>
<span id="cb62-943"><a href="#cb62-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-944"><a href="#cb62-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-945"><a href="#cb62-945" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot of predicted probabilities across age range</span>
<span id="cb62-946"><a href="#cb62-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-949"><a href="#cb62-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-950"><a href="#cb62-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb62-951"><a href="#cb62-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-952"><a href="#cb62-952" aria-hidden="true" tabindex="-1"></a><span class="co"># Get plsmo smoothed estimates (and hide plot)</span></span>
<span id="cb62-953"><a href="#cb62-953" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame from plsmo output</span></span>
<span id="cb62-954"><a href="#cb62-954" aria-hidden="true" tabindex="-1"></a>titanic_complete <span class="ot">&lt;-</span> titanic[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age), ]</span>
<span id="cb62-955"><a href="#cb62-955" aria-hidden="true" tabindex="-1"></a>plsmo_fit <span class="ot">&lt;-</span> <span class="fu">with</span>(titanic_complete, </span>
<span id="cb62-956"><a href="#cb62-956" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">invisible</span>(<span class="fu">plsmo</span>(age, survived)))</span>
<span id="cb62-957"><a href="#cb62-957" aria-hidden="true" tabindex="-1"></a>smooth_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> plsmo_fit<span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span><span class="sc">$</span>x, <span class="at">prob =</span> plsmo_fit<span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span><span class="sc">$</span>y)</span>
<span id="cb62-958"><a href="#cb62-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-959"><a href="#cb62-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-960"><a href="#cb62-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-963"><a href="#cb62-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-964"><a href="#cb62-964" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Predicted probability of survival versus age in the Titanic data. Gray points show individual observations (0 = died, 1 = survived). The black line shows a smoothed estimate of the observed survival probability using a super smoother. The blue line shows predictions from the logistic regression model assuming a linear relationship between age and log odds of survival. Close agreement between the two lines suggests the linear logit assumption is reasonable across the observed age range."</span></span>
<span id="cb62-965"><a href="#cb62-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-966"><a href="#cb62-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequence of ages for model prediction</span></span>
<span id="cb62-967"><a href="#cb62-967" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(titanic<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb62-968"><a href="#cb62-968" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(titanic<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb62-969"><a href="#cb62-969" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb62-970"><a href="#cb62-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-971"><a href="#cb62-971" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict probabilities from model</span></span>
<span id="cb62-972"><a href="#cb62-972" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age_seq)</span>
<span id="cb62-973"><a href="#cb62-973" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.age, <span class="at">newdata=</span>pred_data, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb62-974"><a href="#cb62-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-975"><a href="#cb62-975" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb62-976"><a href="#cb62-976" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-977"><a href="#cb62-977" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data points</span></span>
<span id="cb62-978"><a href="#cb62-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> titanic_complete, </span>
<span id="cb62-979"><a href="#cb62-979" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> survived),</span>
<span id="cb62-980"><a href="#cb62-980" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-981"><a href="#cb62-981" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plsmo smoothed line</span></span>
<span id="cb62-982"><a href="#cb62-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> smooth_data, </span>
<span id="cb62-983"><a href="#cb62-983" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> prob, <span class="at">color =</span> <span class="st">"Observed (smoothed)"</span>),</span>
<span id="cb62-984"><a href="#cb62-984" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-985"><a href="#cb62-985" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model prediction line</span></span>
<span id="cb62-986"><a href="#cb62-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb62-987"><a href="#cb62-987" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> prob, <span class="at">color =</span> <span class="st">"Model prediction"</span>),</span>
<span id="cb62-988"><a href="#cb62-988" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-989"><a href="#cb62-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Observed (smoothed)"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb62-990"><a href="#cb62-990" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Model prediction"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb62-991"><a href="#cb62-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (years)"</span>,</span>
<span id="cb62-992"><a href="#cb62-992" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probability of Survival"</span>,</span>
<span id="cb62-993"><a href="#cb62-993" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb62-994"><a href="#cb62-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-995"><a href="#cb62-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb62-996"><a href="#cb62-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb62-997"><a href="#cb62-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-998"><a href="#cb62-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-999"><a href="#cb62-999" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These plots help us understand how well the linear logit assumption fits the data and whether the model predictions are reasonable across the range of ages</span>
<span id="cb62-1000"><a href="#cb62-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1001"><a href="#cb62-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1002"><a href="#cb62-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1003"><a href="#cb62-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1004"><a href="#cb62-1004" aria-hidden="true" tabindex="-1"></a><span class="fu">####   Influential observations using delta-betas</span></span>
<span id="cb62-1005"><a href="#cb62-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1006"><a href="#cb62-1006" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Delta-beta measures the change in a parameter estimate when a single observation is removed from the analysis</span>
<span id="cb62-1007"><a href="#cb62-1007" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1008"><a href="#cb62-1008" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For observation $i$ and parameter $\beta_j$:</span>
<span id="cb62-1009"><a href="#cb62-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1010"><a href="#cb62-1010" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>$\Delta\beta_{ij} = \hat{\beta}_j - \hat{\beta}_{j(-i)}$</span>
<span id="cb62-1011"><a href="#cb62-1011" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1012"><a href="#cb62-1012" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span>$\hat{\beta}_j$ is the estimate using all data</span>
<span id="cb62-1013"><a href="#cb62-1013" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-1014"><a href="#cb62-1014" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span>$\hat{\beta}_{j(-i)}$ is the estimate with observation $i$ removed</span>
<span id="cb62-1015"><a href="#cb62-1015" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1016"><a href="#cb62-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Large delta-betas indicate observations with substantial influence on parameter estimates</span>
<span id="cb62-1017"><a href="#cb62-1017" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1018"><a href="#cb62-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Delta-betas are a general concept applicable to any regression model (linear, logistic, Cox, etc.)</span>
<span id="cb62-1019"><a href="#cb62-1019" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1020"><a href="#cb62-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Can calculate delta-betas for any parameter of interest (intercept, slopes, interactions)</span>
<span id="cb62-1021"><a href="#cb62-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1022"><a href="#cb62-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1025"><a href="#cb62-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1026"><a href="#cb62-1026" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate delta-betas for the age coefficient</span></span>
<span id="cb62-1027"><a href="#cb62-1027" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age))</span>
<span id="cb62-1028"><a href="#cb62-1028" aria-hidden="true" tabindex="-1"></a>delta_beta_age <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb62-1029"><a href="#cb62-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1030"><a href="#cb62-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># Get full model coefficient</span></span>
<span id="cb62-1031"><a href="#cb62-1031" aria-hidden="true" tabindex="-1"></a>beta_full <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>]</span>
<span id="cb62-1032"><a href="#cb62-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1033"><a href="#cb62-1033" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate delta-beta for each observation</span></span>
<span id="cb62-1034"><a href="#cb62-1034" aria-hidden="true" tabindex="-1"></a>titanic_complete <span class="ot">&lt;-</span> titanic[<span class="sc">!</span><span class="fu">is.na</span>(titanic<span class="sc">$</span>age), ]</span>
<span id="cb62-1035"><a href="#cb62-1035" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb62-1036"><a href="#cb62-1036" aria-hidden="true" tabindex="-1"></a>  fit_minus_i <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, </span>
<span id="cb62-1037"><a href="#cb62-1037" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>titanic_complete[<span class="sc">-</span>i, ], </span>
<span id="cb62-1038"><a href="#cb62-1038" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-1039"><a href="#cb62-1039" aria-hidden="true" tabindex="-1"></a>  delta_beta_age[i] <span class="ot">&lt;-</span> beta_full <span class="sc">-</span> <span class="fu">coef</span>(fit_minus_i)[<span class="st">"age"</span>]</span>
<span id="cb62-1040"><a href="#cb62-1040" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-1041"><a href="#cb62-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1042"><a href="#cb62-1042" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot delta-betas</span></span>
<span id="cb62-1043"><a href="#cb62-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>n, delta_beta_age, </span>
<span id="cb62-1044"><a href="#cb62-1044" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Observation Number"</span>, </span>
<span id="cb62-1045"><a href="#cb62-1045" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Delta-Beta for Age Coefficient"</span>,</span>
<span id="cb62-1046"><a href="#cb62-1046" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Influence on Age Effect"</span>,</span>
<span id="cb62-1047"><a href="#cb62-1047" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb62-1048"><a href="#cb62-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb62-1049"><a href="#cb62-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1050"><a href="#cb62-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify potentially influential observations</span></span>
<span id="cb62-1051"><a href="#cb62-1051" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">*</span><span class="fu">sd</span>(delta_beta_age)</span>
<span id="cb62-1052"><a href="#cb62-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">c</span>(<span class="sc">-</span>threshold, threshold), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb62-1053"><a href="#cb62-1053" aria-hidden="true" tabindex="-1"></a>influential <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(delta_beta_age) <span class="sc">&gt;</span> threshold)</span>
<span id="cb62-1054"><a href="#cb62-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(influential, delta_beta_age[influential], </span>
<span id="cb62-1055"><a href="#cb62-1055" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span>influential, <span class="at">pos=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb62-1056"><a href="#cb62-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1057"><a href="#cb62-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1058"><a href="#cb62-1058" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of delta-betas</span>
<span id="cb62-1059"><a href="#cb62-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1060"><a href="#cb62-1060" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Observations with large positive delta-betas increase the age coefficient estimate when included</span>
<span id="cb62-1061"><a href="#cb62-1061" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1062"><a href="#cb62-1062" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Observations with large negative delta-betas decrease the age coefficient estimate when included</span>
<span id="cb62-1063"><a href="#cb62-1063" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1064"><a href="#cb62-1064" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Influential observations are not necessarily "bad" or errors - they may represent legitimate extreme cases</span>
<span id="cb62-1065"><a href="#cb62-1065" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-1066"><a href="#cb62-1066" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The goal is to understand which observations influence the results, not to automatically exclude influential points</span>
<span id="cb62-1067"><a href="#cb62-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1068"><a href="#cb62-1068" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For brevity, identify and examine the most influential observation</span>
<span id="cb62-1069"><a href="#cb62-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1072"><a href="#cb62-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1073"><a href="#cb62-1073" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify observation with largest absolute delta-beta</span></span>
<span id="cb62-1074"><a href="#cb62-1074" aria-hidden="true" tabindex="-1"></a>max_influence_index <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">abs</span>(delta_beta_age))</span>
<span id="cb62-1075"><a href="#cb62-1075" aria-hidden="true" tabindex="-1"></a>max_delta_beta <span class="ot">&lt;-</span> delta_beta_age[max_influence_index]</span>
<span id="cb62-1076"><a href="#cb62-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1077"><a href="#cb62-1077" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model without this observation</span></span>
<span id="cb62-1078"><a href="#cb62-1078" aria-hidden="true" tabindex="-1"></a>fit_minus_max <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, </span>
<span id="cb62-1079"><a href="#cb62-1079" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>titanic_complete[<span class="sc">-</span>max_influence_index, ], </span>
<span id="cb62-1080"><a href="#cb62-1080" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-1081"><a href="#cb62-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1082"><a href="#cb62-1082" aria-hidden="true" tabindex="-1"></a><span class="co"># Show details and comparison</span></span>
<span id="cb62-1083"><a href="#cb62-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Most influential observation:</span></span>
<span id="cb62-1084"><a href="#cb62-1084" aria-hidden="true" tabindex="-1"></a><span class="st">  Observation number: %d</span></span>
<span id="cb62-1085"><a href="#cb62-1085" aria-hidden="true" tabindex="-1"></a><span class="st">  Age: %.1f</span></span>
<span id="cb62-1086"><a href="#cb62-1086" aria-hidden="true" tabindex="-1"></a><span class="st">  Survived: %d</span></span>
<span id="cb62-1087"><a href="#cb62-1087" aria-hidden="true" tabindex="-1"></a><span class="st">  Delta-beta: %.6f</span></span>
<span id="cb62-1088"><a href="#cb62-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1089"><a href="#cb62-1089" aria-hidden="true" tabindex="-1"></a><span class="st">Age coefficient (full model): %.6f</span></span>
<span id="cb62-1090"><a href="#cb62-1090" aria-hidden="true" tabindex="-1"></a><span class="st">Age coefficient (without observation %d): %.6f</span></span>
<span id="cb62-1091"><a href="#cb62-1091" aria-hidden="true" tabindex="-1"></a><span class="st">Difference (delta-beta): %.6f</span></span>
<span id="cb62-1092"><a href="#cb62-1092" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb62-1093"><a href="#cb62-1093" aria-hidden="true" tabindex="-1"></a>max_influence_index,</span>
<span id="cb62-1094"><a href="#cb62-1094" aria-hidden="true" tabindex="-1"></a>titanic_complete<span class="sc">$</span>age[max_influence_index],</span>
<span id="cb62-1095"><a href="#cb62-1095" aria-hidden="true" tabindex="-1"></a>titanic_complete<span class="sc">$</span>survived[max_influence_index],</span>
<span id="cb62-1096"><a href="#cb62-1096" aria-hidden="true" tabindex="-1"></a>max_delta_beta,</span>
<span id="cb62-1097"><a href="#cb62-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>],</span>
<span id="cb62-1098"><a href="#cb62-1098" aria-hidden="true" tabindex="-1"></a>max_influence_index,</span>
<span id="cb62-1099"><a href="#cb62-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit_minus_max)[<span class="st">"age"</span>],</span>
<span id="cb62-1100"><a href="#cb62-1100" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.age)[<span class="st">"age"</span>] <span class="sc">-</span> <span class="fu">coef</span>(fit_minus_max)[<span class="st">"age"</span>]</span>
<span id="cb62-1101"><a href="#cb62-1101" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb62-1102"><a href="#cb62-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1103"><a href="#cb62-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1104"><a href="#cb62-1104" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This explicitly shows how removing a single influential observation changes the age coefficient estimate</span>
<span id="cb62-1105"><a href="#cb62-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1106"><a href="#cb62-1106" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Here, this is an old subject (80) who survived; the model predicts low survival probability at that age, so this point has a relatively strong influence on the age effect estimate.</span>
<span id="cb62-1107"><a href="#cb62-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1108"><a href="#cb62-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example analysis revisited: Effect Modification</span></span>
<span id="cb62-1109"><a href="#cb62-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1110"><a href="#cb62-1110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall in our Titanic example that the effect of age appeared to differ by sex</span>
<span id="cb62-1111"><a href="#cb62-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1112"><a href="#cb62-1112" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We ignored this difference earlier, so our estimated age effect was a (weighted) average of the age effect in males and the age effect in female</span>
<span id="cb62-1113"><a href="#cb62-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1114"><a href="#cb62-1114" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Here is the plot again describing the trends we see in survival by age and sex (using plsmo).</span>
<span id="cb62-1115"><a href="#cb62-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1118"><a href="#cb62-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1119"><a href="#cb62-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Age versus survival by gender in the Titanic data by age using a super smoother.</span></span>
<span id="cb62-1120"><a href="#cb62-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(titanic, </span>
<span id="cb62-1121"><a href="#cb62-1121" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plsmo</span>(age, survived, <span class="at">group=</span>sex, <span class="at">datadensity=</span>T, <span class="at">ylab=</span><span class="st">"Survived (1=Yes, 0=No)"</span>, <span class="at">xlab=</span><span class="st">"Age (years)"</span>)</span>
<span id="cb62-1122"><a href="#cb62-1122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1123"><a href="#cb62-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1124"><a href="#cb62-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1125"><a href="#cb62-1125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We could describe the observed differences in two way, both being correct</span>
<span id="cb62-1126"><a href="#cb62-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1127"><a href="#cb62-1127" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Gender modifies the age effect</span>
<span id="cb62-1128"><a href="#cb62-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1129"><a href="#cb62-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>In males, the probability of survival decreased with age while in female the probability of survival increased with age</span>
<span id="cb62-1130"><a href="#cb62-1130" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Emphasizes that the female age slope is positive while the male age slope is negative</span>
<span id="cb62-1131"><a href="#cb62-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1132"><a href="#cb62-1132" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Age modifies the gender effect</span>
<span id="cb62-1133"><a href="#cb62-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1134"><a href="#cb62-1134" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>The survival rates of male and females were more similar at younger ages than older ages</span>
<span id="cb62-1135"><a href="#cb62-1135" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Could specify the odds ratio of survival comparing females to males at specific ages</span>
<span id="cb62-1136"><a href="#cb62-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1137"><a href="#cb62-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stratified analysis by sex</span></span>
<span id="cb62-1138"><a href="#cb62-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1139"><a href="#cb62-1139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The log odds of survival in females</span>
<span id="cb62-1140"><a href="#cb62-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1143"><a href="#cb62-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1144"><a href="#cb62-1144" aria-hidden="true" tabindex="-1"></a>fit.titanic.female <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">subset=</span>sex<span class="sc">==</span><span class="st">"female"</span>, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-1145"><a href="#cb62-1145" aria-hidden="true" tabindex="-1"></a>fit.titanic.female</span>
<span id="cb62-1146"><a href="#cb62-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1147"><a href="#cb62-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1148"><a href="#cb62-1148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The log odds of survival in males</span>
<span id="cb62-1149"><a href="#cb62-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1152"><a href="#cb62-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1153"><a href="#cb62-1153" aria-hidden="true" tabindex="-1"></a>fit.titanic.male <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age, <span class="at">data=</span>titanic, <span class="at">subset=</span>sex<span class="sc">==</span><span class="st">"male"</span>, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-1154"><a href="#cb62-1154" aria-hidden="true" tabindex="-1"></a>fit.titanic.male</span>
<span id="cb62-1155"><a href="#cb62-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1156"><a href="#cb62-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1157"><a href="#cb62-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds ratios and confidence intervals for age effect by sex</span></span>
<span id="cb62-1158"><a href="#cb62-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1159"><a href="#cb62-1159" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider a 5 year change in age</span>
<span id="cb62-1160"><a href="#cb62-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1163"><a href="#cb62-1163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1164"><a href="#cb62-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># Females</span></span>
<span id="cb62-1165"><a href="#cb62-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit.titanic.female)[<span class="st">"age"</span>])</span>
<span id="cb62-1166"><a href="#cb62-1166" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(fit.titanic.female,<span class="st">"age"</span>))</span>
<span id="cb62-1167"><a href="#cb62-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1168"><a href="#cb62-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># Males</span></span>
<span id="cb62-1169"><a href="#cb62-1169" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">coef</span>(fit.titanic.male)[<span class="st">"age"</span>])</span>
<span id="cb62-1170"><a href="#cb62-1170" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">5</span><span class="sc">*</span><span class="fu">confint.default</span>(fit.titanic.male,<span class="st">"age"</span>))</span>
<span id="cb62-1171"><a href="#cb62-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1172"><a href="#cb62-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1173"><a href="#cb62-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect modification using interaction terms</span></span>
<span id="cb62-1174"><a href="#cb62-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1175"><a href="#cb62-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Instead of fitting two separate models for male and females, we could estimate all parameters in a single regression model</span>
<span id="cb62-1176"><a href="#cb62-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Let $p_i$ be the probability of survival for passenger $i$ and $\textrm{logit}(p)= \textrm{log}\left(\frac{p}{1-p}\right)$</span>
<span id="cb62-1177"><a href="#cb62-1177" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Let $X_{1i}$ be the age of subject $i$</span>
<span id="cb62-1178"><a href="#cb62-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Let $X_{2i}$ be an indicator variable for female sex. $X_{2i}=1$ if a subject is female and $X_{2i} = 0$ if a subject is male</span>
<span id="cb62-1179"><a href="#cb62-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1180"><a href="#cb62-1180" aria-hidden="true" tabindex="-1"></a>$$\textrm{logit}(p_i | X_{1i},X_{2i}) = \beta_0 + \beta_1 * X_{1i} + \beta_{2} * X_{2i} + \beta_3*X_{1i}*X_{2i}$$</span>
<span id="cb62-1181"><a href="#cb62-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1182"><a href="#cb62-1182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In males, $X_{2i} = 0$, this model reduces to</span>
<span id="cb62-1183"><a href="#cb62-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1184"><a href="#cb62-1184" aria-hidden="true" tabindex="-1"></a>$$\textrm{logit}(p_i | X_{1i}, X_{2i}=0) = \beta_0 + \beta_1 * X_{1i}$$</span>
<span id="cb62-1185"><a href="#cb62-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1186"><a href="#cb62-1186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In females, $X_{2i} = 1$, this model can be expressed as</span>
<span id="cb62-1187"><a href="#cb62-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1188"><a href="#cb62-1188" aria-hidden="true" tabindex="-1"></a>$$\textrm{logit}(p_i | X_{1i}, X_{2i}=1) = (\beta_0+\beta_2) + (\beta_1+\beta_3) * X_{1i}$$</span>
<span id="cb62-1189"><a href="#cb62-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1190"><a href="#cb62-1190" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{\beta_1}$ is the estimate age effect in males</span>
<span id="cb62-1191"><a href="#cb62-1191" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{\beta_1} + \hat{\beta_3}$ is the estimated age effect in females</span>
<span id="cb62-1192"><a href="#cb62-1192" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{\beta_3}$ is the estimated *difference* between the age effect in females and the age effect in males</span>
<span id="cb62-1193"><a href="#cb62-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1196"><a href="#cb62-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1197"><a href="#cb62-1197" aria-hidden="true" tabindex="-1"></a><span class="co"># female has already been defined in the dataset, but if I wanted to create this variable I could do so</span></span>
<span id="cb62-1198"><a href="#cb62-1198" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>female <span class="ot">&lt;-</span> (titanic<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb62-1199"><a href="#cb62-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1200"><a href="#cb62-1200" aria-hidden="true" tabindex="-1"></a>fit.titanic.interact <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age <span class="sc">+</span> female <span class="sc">+</span> age<span class="sc">*</span>female, <span class="at">data=</span>titanic, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-1201"><a href="#cb62-1201" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.titanic.interact)</span>
<span id="cb62-1202"><a href="#cb62-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1203"><a href="#cb62-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1204"><a href="#cb62-1204" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can see that the parameter estimates from the interaction model are the same as the estimates from the two stratified models</span>
<span id="cb62-1205"><a href="#cb62-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1208"><a href="#cb62-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1209"><a href="#cb62-1209" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction model</span></span>
<span id="cb62-1210"><a href="#cb62-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)</span>
<span id="cb62-1211"><a href="#cb62-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1212"><a href="#cb62-1212" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit just on male subjects</span></span>
<span id="cb62-1213"><a href="#cb62-1213" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.male)</span>
<span id="cb62-1214"><a href="#cb62-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1215"><a href="#cb62-1215" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit just on female subjects</span></span>
<span id="cb62-1216"><a href="#cb62-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.female)</span>
<span id="cb62-1217"><a href="#cb62-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1218"><a href="#cb62-1218" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear combinations from the interaction model give the female intercept and age slope</span></span>
<span id="cb62-1219"><a href="#cb62-1219" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">3</span>]</span>
<span id="cb62-1220"><a href="#cb62-1220" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">coef</span>(fit.titanic.interact)[<span class="dv">4</span>]</span>
<span id="cb62-1221"><a href="#cb62-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024-2026, James C Slaughter</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>