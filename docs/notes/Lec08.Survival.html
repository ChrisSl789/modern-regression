<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Slaughter">
<meta name="dcterms.date" content="2025-04-10">

<title>Introduction to Survival Analysis – BIOS 6312 - Spring 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/Lec09.Poisson.html" rel="next">
<link href="../notes/Set6.pdf" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Introduction to Survival Analysis – BIOS 6312 - Spring 2025">
<meta property="og:description" content="Lecture 08">
<meta property="og:site_name" content="BIOS 6312 - Spring 2025">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec08.Survival.html">Introduction to Survival Analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">BIOS 6312 - Spring 2025</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Course Information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/Lec01.Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductory Slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus BIOS 6312</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../officehours.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Office Hours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec02.review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review of Key Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec03.SimpleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec04.Logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec05.Precision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precision of Statistical Intefence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec06.ConfoundingEffectModificationMediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confouding, Effect Modification, and Mediation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec07.MultivariableModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariable Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set2.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set6.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec08.Survival.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Introduction to Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec09.Poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec10.Modeling.Effect.Modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set8.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial and Ordinal Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec11.DoseResponse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Flexible Modeling of Continuous Predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec12.ANOVA.Model.Choice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA and Model Choice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec13.Prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Based Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/BayesDiagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Model Diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set13.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set14.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Bootstrap</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab1-linearregression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Linear regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab2-linearassumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Assumption in Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab3-logistic-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab4-precision-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Precision and adjustment for baseline</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab-weighted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(Mini) Lab: Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab5-multivariable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5: Multivariable Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab6-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 6: Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab7-effectmodification-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7: Poisson Regression and Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab-DiscreteOutcomeRegression.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 8: Discrete Outcomes Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vanderbilt.box.com/s/rpftvmc9vua2w3gz3jy16phlnsojs6on" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Box folder with .qmd files</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Supplemental notes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/slr-derivations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SLR derivations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-diagnostics-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/mlr-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLR matrix notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/log-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Log transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-selection-criteria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model selection criteria</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/ReviewMatrixAlgebra.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrix algebra review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/Baseline_Change_MACH.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Change from baseline and precision</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Statcomp2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Main directory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/data" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link active" data-scroll-target="#acknowledgments"><span class="header-section-number">1</span> Acknowledgments</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">2</span> Background</a>
  <ul>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">2.1</span> Examples</a></li>
  <li><a href="#the-survival-time-response" id="toc-the-survival-time-response" class="nav-link" data-scroll-target="#the-survival-time-response"><span class="header-section-number">2.2</span> The survival time response</a></li>
  <li><a href="#analysis-issues" id="toc-analysis-issues" class="nav-link" data-scroll-target="#analysis-issues"><span class="header-section-number">2.3</span> Analysis issues</a></li>
  <li><a href="#censoring" id="toc-censoring" class="nav-link" data-scroll-target="#censoring"><span class="header-section-number">2.4</span> Censoring</a></li>
  <li><a href="#types-of-right-censoring" id="toc-types-of-right-censoring" class="nav-link" data-scroll-target="#types-of-right-censoring"><span class="header-section-number">2.5</span> Types of right-censoring</a></li>
  <li><a href="#terminology-and-notation" id="toc-terminology-and-notation" class="nav-link" data-scroll-target="#terminology-and-notation"><span class="header-section-number">2.6</span> Terminology and notation</a>
  <ul class="collapse">
  <li><a href="#hazard-cumulative-hazard-and-survival" id="toc-hazard-cumulative-hazard-and-survival" class="nav-link" data-scroll-target="#hazard-cumulative-hazard-and-survival"><span class="header-section-number">2.6.1</span> Hazard, cumulative hazard, and survival</a></li>
  <li><a href="#outcome-definition" id="toc-outcome-definition" class="nav-link" data-scroll-target="#outcome-definition"><span class="header-section-number">2.6.2</span> Outcome definition</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#non-parametric-estimation-of-the-survival-curve" id="toc-non-parametric-estimation-of-the-survival-curve" class="nav-link" data-scroll-target="#non-parametric-estimation-of-the-survival-curve"><span class="header-section-number">3</span> Non-parametric estimation of the survival curve</a>
  <ul>
  <li><a href="#example-the-lung-dataset" id="toc-example-the-lung-dataset" class="nav-link" data-scroll-target="#example-the-lung-dataset"><span class="header-section-number">3.1</span> Example: The <code>lung</code> dataset</a></li>
  <li><a href="#creating-survival-objects-and-curves" id="toc-creating-survival-objects-and-curves" class="nav-link" data-scroll-target="#creating-survival-objects-and-curves"><span class="header-section-number">3.2</span> Creating survival objects and curves</a></li>
  <li><a href="#kaplan-meier-estimates" id="toc-kaplan-meier-estimates" class="nav-link" data-scroll-target="#kaplan-meier-estimates"><span class="header-section-number">3.3</span> Kaplan-Meier estimates</a></li>
  <li><a href="#kaplan-meier-plot" id="toc-kaplan-meier-plot" class="nav-link" data-scroll-target="#kaplan-meier-plot"><span class="header-section-number">3.4</span> Kaplan-Meier plot</a></li>
  <li><a href="#estimating-x-year-survival" id="toc-estimating-x-year-survival" class="nav-link" data-scroll-target="#estimating-x-year-survival"><span class="header-section-number">3.5</span> Estimating <span class="math inline">\(x\)</span>-year survival</a></li>
  <li><a href="#estimating-median-survival-time" id="toc-estimating-median-survival-time" class="nav-link" data-scroll-target="#estimating-median-survival-time"><span class="header-section-number">3.6</span> Estimating median survival time</a></li>
  <li><a href="#non-parametric-test-for-comparing-survival-times-between-groups" id="toc-non-parametric-test-for-comparing-survival-times-between-groups" class="nav-link" data-scroll-target="#non-parametric-test-for-comparing-survival-times-between-groups"><span class="header-section-number">3.7</span> Non-parametric test for comparing survival times between groups</a></li>
  </ul></li>
  <li><a href="#semi-parametric-regression-cox-proportional-hazards-model" id="toc-semi-parametric-regression-cox-proportional-hazards-model" class="nav-link" data-scroll-target="#semi-parametric-regression-cox-proportional-hazards-model"><span class="header-section-number">4</span> Semi-parametric regression (Cox proportional hazards model)</a>
  <ul>
  <li><a href="#proportional-hazards-regression" id="toc-proportional-hazards-regression" class="nav-link" data-scroll-target="#proportional-hazards-regression"><span class="header-section-number">4.1</span> Proportional Hazards Regression</a></li>
  <li><a href="#the-simple-ph-regression-model" id="toc-the-simple-ph-regression-model" class="nav-link" data-scroll-target="#the-simple-ph-regression-model"><span class="header-section-number">4.2</span> The simple PH regression model</a></li>
  <li><a href="#descriptive-plots" id="toc-descriptive-plots" class="nav-link" data-scroll-target="#descriptive-plots"><span class="header-section-number">4.3</span> Descriptive Plots</a>
  <ul class="collapse">
  <li><a href="#hazard" id="toc-hazard" class="nav-link" data-scroll-target="#hazard"><span class="header-section-number">4.3.1</span> Hazard</a></li>
  <li><a href="#cumulative-hazard" id="toc-cumulative-hazard" class="nav-link" data-scroll-target="#cumulative-hazard"><span class="header-section-number">4.3.2</span> Cumulative hazard</a></li>
  <li><a href="#survival" id="toc-survival" class="nav-link" data-scroll-target="#survival"><span class="header-section-number">4.3.3</span> Survival</a></li>
  <li><a href="#proportional-hazards-assumption" id="toc-proportional-hazards-assumption" class="nav-link" data-scroll-target="#proportional-hazards-assumption"><span class="header-section-number">4.3.4</span> Proportional hazards assumption</a></li>
  <li><a href="#proportional-hazards-assumption-on-log-scale" id="toc-proportional-hazards-assumption-on-log-scale" class="nav-link" data-scroll-target="#proportional-hazards-assumption-on-log-scale"><span class="header-section-number">4.3.5</span> Proportional hazards assumption on log scale</a></li>
  </ul></li>
  <li><a href="#software" id="toc-software" class="nav-link" data-scroll-target="#software"><span class="header-section-number">4.4</span> Software</a></li>
  <li><a href="#example-analysis" id="toc-example-analysis" class="nav-link" data-scroll-target="#example-analysis"><span class="header-section-number">4.5</span> Example Analysis</a>
  <ul class="collapse">
  <li><a href="#descriptives" id="toc-descriptives" class="nav-link" data-scroll-target="#descriptives"><span class="header-section-number">4.5.1</span> Descriptives</a></li>
  <li><a href="#regression-model" id="toc-regression-model" class="nav-link" data-scroll-target="#regression-model"><span class="header-section-number">4.5.2</span> Regression model</a></li>
  <li><a href="#interpretation-of-output" id="toc-interpretation-of-output" class="nav-link" data-scroll-target="#interpretation-of-output"><span class="header-section-number">4.5.3</span> Interpretation of output</a></li>
  <li><a href="#robust-standard-errors" id="toc-robust-standard-errors" class="nav-link" data-scroll-target="#robust-standard-errors"><span class="header-section-number">4.5.4</span> Robust standard errors</a></li>
  </ul></li>
  <li><a href="#inference-with-ph-regression" id="toc-inference-with-ph-regression" class="nav-link" data-scroll-target="#inference-with-ph-regression"><span class="header-section-number">4.6</span> Inference with PH Regression</a>
  <ul class="collapse">
  <li><a href="#log-transformed-nadir-psa" id="toc-log-transformed-nadir-psa" class="nav-link" data-scroll-target="#log-transformed-nadir-psa"><span class="header-section-number">4.6.1</span> Log-transformed nadir PSA</a></li>
  </ul></li>
  <li><a href="#review-interpretation-of-slopes" id="toc-review-interpretation-of-slopes" class="nav-link" data-scroll-target="#review-interpretation-of-slopes"><span class="header-section-number">4.7</span> Review: Interpretation of Slopes</a>
  <ul class="collapse">
  <li><a href="#additive-models" id="toc-additive-models" class="nav-link" data-scroll-target="#additive-models"><span class="header-section-number">4.7.1</span> Additive models</a></li>
  <li><a href="#multiplicative-models" id="toc-multiplicative-models" class="nav-link" data-scroll-target="#multiplicative-models"><span class="header-section-number">4.7.2</span> Multiplicative models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#parametric-regression" id="toc-parametric-regression" class="nav-link" data-scroll-target="#parametric-regression"><span class="header-section-number">5</span> Parametric regression</a>
  <ul>
  <li><a href="#weibull-model" id="toc-weibull-model" class="nav-link" data-scroll-target="#weibull-model"><span class="header-section-number">5.1</span> Weibull model</a></li>
  <li><a href="#weibull-example" id="toc-weibull-example" class="nav-link" data-scroll-target="#weibull-example"><span class="header-section-number">5.2</span> Weibull example</a>
  <ul class="collapse">
  <li><a href="#compare-fit-of-weibull-parametric-to-kaplan-meier-non-parametric" id="toc-compare-fit-of-weibull-parametric-to-kaplan-meier-non-parametric" class="nav-link" data-scroll-target="#compare-fit-of-weibull-parametric-to-kaplan-meier-non-parametric"><span class="header-section-number">5.2.1</span> Compare fit of Weibull (parametric) to Kaplan-Meier (non-parametric)</a></li>
  <li><a href="#interpretation-of-weibull-parameters" id="toc-interpretation-of-weibull-parameters" class="nav-link" data-scroll-target="#interpretation-of-weibull-parameters"><span class="header-section-number">5.2.2</span> Interpretation of Weibull parameters</a></li>
  </ul></li>
  <li><a href="#other-parametric-models" id="toc-other-parametric-models" class="nav-link" data-scroll-target="#other-parametric-models"><span class="header-section-number">5.3</span> Other parametric models</a></li>
  </ul></li>
  <li><a href="#bayesian-time-to-event-models" id="toc-bayesian-time-to-event-models" class="nav-link" data-scroll-target="#bayesian-time-to-event-models"><span class="header-section-number">6</span> Bayesian Time to Event Models</a>
  <ul>
  <li><a href="#review-bayesian-analysis" id="toc-review-bayesian-analysis" class="nav-link" data-scroll-target="#review-bayesian-analysis"><span class="header-section-number">6.1</span> Review: Bayesian Analysis</a></li>
  <li><a href="#review-linear-regression" id="toc-review-linear-regression" class="nav-link" data-scroll-target="#review-linear-regression"><span class="header-section-number">6.2</span> Review: Linear Regression</a>
  <ul class="collapse">
  <li><a href="#likelihood" id="toc-likelihood" class="nav-link" data-scroll-target="#likelihood"><span class="header-section-number">6.2.1</span> Likelihood</a></li>
  <li><a href="#prior-distributions" id="toc-prior-distributions" class="nav-link" data-scroll-target="#prior-distributions"><span class="header-section-number">6.2.2</span> Prior Distributions</a></li>
  <li><a href="#posterior-distribution" id="toc-posterior-distribution" class="nav-link" data-scroll-target="#posterior-distribution"><span class="header-section-number">6.2.3</span> Posterior distribution</a></li>
  </ul></li>
  <li><a href="#review-logistic-regression" id="toc-review-logistic-regression" class="nav-link" data-scroll-target="#review-logistic-regression"><span class="header-section-number">6.3</span> Review: Logistic Regression</a></li>
  <li><a href="#bayesian-parametric-survival-analysis" id="toc-bayesian-parametric-survival-analysis" class="nav-link" data-scroll-target="#bayesian-parametric-survival-analysis"><span class="header-section-number">6.4</span> Bayesian Parametric Survival Analysis</a>
  <ul class="collapse">
  <li><a href="#example-weibull-model-bayesian-approach" id="toc-example-weibull-model-bayesian-approach" class="nav-link" data-scroll-target="#example-weibull-model-bayesian-approach"><span class="header-section-number">6.4.1</span> Example: Weibull model, Bayesian approach</a></li>
  <li><a href="#prior-distributions-1" id="toc-prior-distributions-1" class="nav-link" data-scroll-target="#prior-distributions-1"><span class="header-section-number">6.4.2</span> Prior Distributions</a></li>
  </ul></li>
  <li><a href="#bayesian-cox-type-models-for-time-to-event-data" id="toc-bayesian-cox-type-models-for-time-to-event-data" class="nav-link" data-scroll-target="#bayesian-cox-type-models-for-time-to-event-data"><span class="header-section-number">6.5</span> Bayesian Cox-type Models for Time to Event Data</a></li>
  <li><a href="#r-related-software-for-bayesian-survival-analysis" id="toc-r-related-software-for-bayesian-survival-analysis" class="nav-link" data-scroll-target="#r-related-software-for-bayesian-survival-analysis"><span class="header-section-number">6.6</span> R-Related Software for Bayesian Survival Analysis</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/chrissl789/modern-regression/edit/main/notes/Lec08.Survival.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header">

<div class="right">
<!--
<a href="https://github.com/chrissl789/modern-regression/raw/main/Lec08.Survival.qmd" target="_blank">View Code</a>
-->
<a href="https://statcomp2.app.vumc.org/modern-regression/lectures/Lec08.Survival.qmd" target="_blank">Download Code</a>

</div>

<div class="quarto-title-block d-none d-lg-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec08.Survival.html">Introduction to Survival Analysis</a></li></ol></nav><div><h1 class="title">Introduction to Survival Analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lecture 08</p>
<p class="author">Chris Slaughter</p>

<p class="date">April 10, 2025</p>

</header>


<section id="acknowledgments" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="acknowledgments"><span class="header-section-number">1</span> Acknowledgments</h2>
<p>Parts of the introductory material are borrowed from Emily Zabor’s <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">introduction to survival analysis in R</a>.</p>
</section>
<section id="background" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="background"><span class="header-section-number">2</span> Background</h2>
<p>In logistic regression, we were interested in studying how risk factors were associated with presence or absence of disease. Sometimes, though, we are interested in how a risk factor or treatment affects time to disease or some other event. Or we may have study dropout, and therefore subjects who we are not sure if they had disease or not. In these cases, logistic regression is not appropriate.</p>
<p>Survival analysis is used to analyze data in which the time until the event is of interest. The response is often referred to as a failure time, survival time, or event time.</p>
<section id="examples" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="examples"><span class="header-section-number">2.1</span> Examples</h3>
<ul>
<li><p>Time from randomization until cardiovascular death after some treatment intervention</p></li>
<li><p>Time from diagnosis until tumor recurrence</p></li>
<li><p>Time from diagnosis until AIDS for HIV patients</p></li>
<li><p>Time from production until a machine part fails</p></li>
<li><p>Note that there needs to be a clearly defined starting and ending point</p></li>
</ul>
</section>
<section id="the-survival-time-response" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="the-survival-time-response"><span class="header-section-number">2.2</span> The survival time response</h3>
<ul>
<li>Usually continuous</li>
<li>May be incompletely determined for some subjects
<ul>
<li>i.e.&nbsp;For some subjects we may know that their survival time was at least equal to some time t. Whereas, for other subjects, we will know their exact time of event.</li>
</ul></li>
<li>Incompletely observed responses are <em>censored</em></li>
<li>Time is always <span class="math inline">\(&gt;0\)</span></li>
</ul>
</section>
<section id="analysis-issues" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="analysis-issues"><span class="header-section-number">2.3</span> Analysis issues</h3>
<ul>
<li>If there is no censoring, standard regression procedures could be used</li>
<li>However, these may be inadequate because
<ul>
<li>Time to event is restricted to be positive and has a skewed distribution.</li>
<li>The probability of surviving past a certain point in time may be of more interest than the expected time of event. Linear regression models means.</li>
<li>A multiplicative model for the hazard may be a better fit</li>
<li>May desire an interpretation that is similar to a relative risk</li>
</ul></li>
</ul>
</section>
<section id="censoring" class="level3 page-columns page-full" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="censoring"><span class="header-section-number">2.4</span> Censoring</h3>
<p>Censoring is present when we have some information about a subject’s event time, but we don’t know the exact event time. For the analysis methods we will discuss to be valid, censoring mechanism must be independent of the survival mechanism.</p>
<p>There are generally three reasons why censoring might occur:</p>
<ul>
<li>A subject does not experience the event before the study ends</li>
<li>A person is lost to follow-up during the study period</li>
<li>A person withdraws from the study</li>
</ul>
<p>These are all examples of right-censoring.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figures/trial_anatomy.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Trial Anatomy</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>RICH JT, NEELY JG, PANIELLO RC, VOELKER CCJ, NUSSENBAUM B, WANG EW. A PRACTICAL GUIDE TO UNDERSTANDING KAPLAN-MEIER CURVES. Otolaryngology head and neck surgery: official journal of American Academy of Otolaryngology Head and Neck Surgery. 2010;143(3):331-336. doi:10.1016/j.otohns.2010.05.007.</p>
</blockquote>
<p>To illustrate the impact of censoring, suppose we have the following data:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/swimmer-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>How would we compute the proportion who are event-free at 10 years?</p>
<ul>
<li>Subjects 6 and 7 were <strong>event-free at 10 years</strong>.</li>
<li>Subjects 2, 9, and 10 had the <strong>event before 10 years</strong>.</li>
<li>Subjects 1, 3, 4, 5, and 8 were <strong>censored before 10 years</strong>, so we don’t know whether they had the event or not at 10 years. But we know something about them - that they were each followed for a certain amount of time without the event of interest prior to being censored.</li>
</ul>
<p><em>Survival analysis techniques provide a way to appropriately account for censored patients in the analysis.</em></p>
</section>
<section id="types-of-right-censoring" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="types-of-right-censoring"><span class="header-section-number">2.5</span> Types of right-censoring</h3>
<ul>
<li>Fixed type I censoring occurs when a study is designed to end after C years of follow-up. In this case, everyone who does not have an event observed during the course of the study is censored at C years.</li>
<li>In random type I censoring, the study is designed to end after C years, but censored subjects do not all have the same censoring time. This is the main type of right-censoring we will be concerned with.</li>
<li>In type II censoring, a study ends when there is a pre- specified number of events.</li>
</ul>
<p>Regardless of the type of censoring, we must assume that it is non-informative about the event; that is, the censoring is caused by something other than the impending failure.</p>
</section>
<section id="terminology-and-notation" class="level3 page-columns page-full" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="terminology-and-notation"><span class="header-section-number">2.6</span> Terminology and notation</h3>
<ul>
<li><span class="math inline">\(T\)</span> denotes the response variable, <span class="math inline">\(T &gt; 0\)</span></li>
<li>The survival function is</li>
</ul>
<p><span class="math display">\[
S(t) = \textrm{Pr}(T &gt; t) = 1− F(t)
\]</span></p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cf">function</span>(t) <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>t), <span class="dv">0</span>, <span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>, <span class="at">xlab=</span><span class="st">"Time (years)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Example survival function. Survival is 1 at time 0 and decreases over time.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>All subjects are at risk (and event free) at time 0. Thus, the survival estimate at 0 is always 1</li>
<li>Survival decreases over time. If we observe for a long enough period of time, survival eventually decreases to 0.</li>
<li>The survival function gives the probability that a subject will survive past time t.</li>
<li>Specifically, as t ranges from 0 to <span class="math inline">\(\infty\)</span>, the survival function has the following properties
<ul>
<li><p>It is non-increasing</p></li>
<li><p>At time t = 0, S(t) = 1. In other words, the probability of surviving past time 0 is 1.</p></li>
<li><p>At time <span class="math inline">\(t = \infty\)</span>, <span class="math inline">\(S(t) = S(\infty) = 0\)</span>. As time goes to infinity, the survival curve goes to 0.</p></li>
</ul></li>
<li>In theory, the survival function is smooth. In practice, we observe events on a discrete time scale (days, weeks, etc.)</li>
</ul>
<section id="hazard-cumulative-hazard-and-survival" class="level4" data-number="2.6.1">
<h4 data-number="2.6.1" class="anchored" data-anchor-id="hazard-cumulative-hazard-and-survival"><span class="header-section-number">2.6.1</span> Hazard, cumulative hazard, and survival</h4>
<ul>
<li><p>The hazard function, h(t), is the instantaneous rate at which events occur, given no previous events. <span class="math display">\[
h(t) = \lim_{{\Delta t} \to 0} \frac{P(t \leq T &lt; t + \Delta t | T \geq t)}{\Delta t}
\]</span></p></li>
<li><p><span class="math inline">\(T\)</span> is a random variable denoting the time until the event (for example, failure or death) occurs. The numerator in the fraction is the conditional probability that the event occurs in the small time interval <span class="math inline">\([t, t + Δt]\)</span> given that it has not occurred before time <span class="math inline">\(t\)</span>. The denominator <span class="math inline">\(\Delta t\)</span> is the length of this time interval. As <span class="math inline">\(\Delta t\)</span> goes to 0, this ratio gives the instantaneous rate of occurrence of the event at time <span class="math inline">\(t\)</span>, which is the hazard function <span class="math inline">\(h(t)\)</span>.</p></li>
<li><p>The cumulative hazard</p></li>
</ul>
<p><span class="math display">\[
H(t) = \int_{0}^{t} h(u) du
\]</span></p>
<ul>
<li><p>Here, h(u) is the hazard function and u is the variable of integration. This integral represents the accumulated risk of the event (for example, failure or death) over the time interval <span class="math inline">\([0, t]\)</span>.</p></li>
<li><p>The relationship between the survival function <span class="math inline">\(S(t)\)</span> and the cumulative hazard function <span class="math inline">\(H(t)\)</span></p></li>
</ul>
<p><span class="math display">\[
S(t) = \exp(-H(t))
\]</span></p>
<ul>
<li>Key point: Survival function, cumulative hazard function, and hazard function are interconnected. If we know any one of the functions <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(H(t)\)</span>, or <span class="math inline">\(h(t)\)</span>, we can derive the other two functions.</li>
</ul>
</section>
<section id="outcome-definition" class="level4" data-number="2.6.2">
<h4 data-number="2.6.2" class="anchored" data-anchor-id="outcome-definition"><span class="header-section-number">2.6.2</span> Outcome definition</h4>
<ul>
<li><p>To analyze survival data, we need to know the observed time <span class="math inline">\(Y_i\)</span> and the event indicator <span class="math inline">\(\delta_i\)</span>. For subject <span class="math inline">\(i\)</span>:</p></li>
<li><p>Observed time <span class="math inline">\(Y_i = \min(T_i, C_i)\)</span> where <span class="math inline">\(T_i\)</span> = event time and <span class="math inline">\(C_i\)</span> = censoring time</p></li>
<li><p>Event indicator <span class="math inline">\(\delta_i\)</span> = 1 if event observed (i.e.&nbsp;<span class="math inline">\(T_i \leq C_i\)</span>), = 0 if censored (i.e.&nbsp;<span class="math inline">\(T_i &gt; C_i\)</span>)</p></li>
</ul>
</section>
</section>
</section>
<section id="non-parametric-estimation-of-the-survival-curve" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="non-parametric-estimation-of-the-survival-curve"><span class="header-section-number">3</span> Non-parametric estimation of the survival curve</h2>
<ul>
<li><p>In theory the survival function is smooth; in practice we observe events on a discrete time scale.</p></li>
<li><p>The <strong>survival probability</strong> at a certain time, <span class="math inline">\(S(t)\)</span>, is a conditional probability of surviving beyond that time, given that an individual has survived just prior to that time. The survival probability can be estimated as the number of patients who are alive without loss to follow-up at that time, divided by the number of patients who were alive just prior to that time.</p></li>
<li><p>The <strong>Kaplan-Meier</strong> estimate of survival probability at a given time is the product of these conditional probabilities up until that given time</p></li>
</ul>
<p><span class="math display">\[
\hat{S}(t) = \prod_{i: t_i \leq t} (1 - \frac{d_i}{n_i})
\]</span></p>
<ul>
<li><span class="math inline">\(\hat{S}(t)\)</span> is the estimated survival function at time (t),</li>
<li><span class="math inline">\(t_i\)</span> are the observed event times,</li>
<li><span class="math inline">\(d_i\)</span> is the number of events (e.g.&nbsp;deaths) at time (<span class="math inline">\(t_i\)</span>),</li>
<li><span class="math inline">\(n_i\)</span> is the number of individuals known to have survived (are at risk) up to time (<span class="math inline">\(t_i\)</span>).</li>
</ul>
<section id="example-the-lung-dataset" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="example-the-lung-dataset"><span class="header-section-number">3.1</span> Example: The <code>lung</code> dataset</h3>
<p>The <code>lung</code> dataset is available from the {survival} package. The data contain subjects with advanced lung cancer from the North Central Cancer Treatment Group. We will focus on the following variables throughout this tutorial:</p>
<ul>
<li>time: Observed survival time in days</li>
<li>status: censoring status 1=censored, 2=dead</li>
<li>sex: 1=Male, 2=Female</li>
</ul>
<p><em>Note that the status is coded in a non-standard way in this dataset. Typically you will see 1=event, 0=censored</em>. Let’s recode it to avoid confusion:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>lung <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  lung <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">recode</span>(status, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have:</p>
<ul>
<li>time: Observed survival time in days</li>
<li>status: censoring status 0=censored, 1=dead</li>
<li>sex: 1=Male, 2=Female</li>
</ul>
<p>Here are the first 6 observations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lung[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"status"</span>, <span class="st">"sex"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">time</th>
<th style="text-align: center;">status</th>
<th style="text-align: center;">sex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">306</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">455</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1010</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">210</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">883</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">1022</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><em>Note</em>: the <code>Surv()</code> function in the {survival} package accepts by default TRUE/FALSE, where TRUE is event and FALSE is censored; 1/0 where 1 is event and 0 is censored; or 2/1 where 2 is event and 1 is censored. <strong>Please take care to ensure the event indicator is properly formatted.</strong></p>
</section>
<section id="creating-survival-objects-and-curves" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="creating-survival-objects-and-curves"><span class="header-section-number">3.2</span> Creating survival objects and curves</h3>
<p>The Kaplan-Meier method is the most common way to estimate survival times and probabilities. It is a non-parametric approach that results in a step function, where there is a step down each time an event occurs.</p>
<p>The <code>Surv()</code> function from the {survival} package creates a survival object for use as the response in a model formula. There will be one entry for each subject that is the survival time, which is followed by a <code>+</code> if the subject was censored. Let’s look at the first 10 observations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Surv</span>(lung<span class="sc">$</span>time, lung<span class="sc">$</span>status)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  306   455  1010+  210   883  1022+  310   361   218   166 </code></pre>
</div>
</div>
<p>We see that subject 1 had an event at time 306 days, subject 2 had an event at time 455 days, subject 3 was censored at time 1010 days, etc.</p>
<p>The <code>survfit()</code> function creates survival curves using the Kaplan-Meier method based on a formula. Let’s generate the overall survival curve for the entire cohort, assign it to object <code>s1</code>, and look at the structure using <code>str()</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> lung)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(s1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 16
 $ n        : int 228
 $ time     : num [1:186] 5 11 12 13 15 26 30 31 53 54 ...
 $ n.risk   : num [1:186] 228 227 224 223 221 220 219 218 217 215 ...
 $ n.event  : num [1:186] 1 3 1 2 1 1 1 1 2 1 ...
 $ n.censor : num [1:186] 0 0 0 0 0 0 0 0 0 0 ...
 $ surv     : num [1:186] 0.996 0.982 0.978 0.969 0.965 ...
 $ std.err  : num [1:186] 0.0044 0.00885 0.00992 0.01179 0.01263 ...
 $ cumhaz   : num [1:186] 0.00439 0.0176 0.02207 0.03103 0.03556 ...
 $ std.chaz : num [1:186] 0.00439 0.0088 0.00987 0.01173 0.01257 ...
 $ type     : chr "right"
 $ logse    : logi TRUE
 $ conf.int : num 0.95
 $ conf.type: chr "log"
 $ lower    : num [1:186] 0.987 0.966 0.959 0.947 0.941 ...
 $ upper    : num [1:186] 1 1 0.997 0.992 0.989 ...
 $ call     : language survfit(formula = Surv(time, status) ~ 1, data = lung)
 - attr(*, "class")= chr "survfit"</code></pre>
</div>
</div>
<p>Some key components of this <code>survfit</code> object that will be used to create survival curves include:</p>
<ul>
<li><code>time</code>: the timepoints at which the curve has a step, i.e.&nbsp;at least one event occurred</li>
<li><code>surv</code>: the estimate of survival at the corresponding <code>time</code></li>
</ul>
</section>
<section id="kaplan-meier-estimates" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="kaplan-meier-estimates"><span class="header-section-number">3.3</span> Kaplan-Meier estimates</h3>
<div style="height:400px;overflow:auto;">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(s1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p>Call:</p>
<p>survfit(formula = Surv(time, status) ~ 1, data = lung)</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">time</th>
<th style="text-align: center;">n.risk</th>
<th style="text-align: center;">n.event</th>
<th style="text-align: center;">survival</th>
<th style="text-align: center;">std.err</th>
<th style="text-align: center;">lower 95% CI</th>
<th style="text-align: center;">upper 95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">228</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.995614</td>
<td style="text-align: center;">0.0043763</td>
<td style="text-align: center;">0.987073</td>
<td style="text-align: center;">1.00000</td>
</tr>
<tr class="even">
<td style="text-align: center;">11</td>
<td style="text-align: center;">227</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.982456</td>
<td style="text-align: center;">0.0086946</td>
<td style="text-align: center;">0.965562</td>
<td style="text-align: center;">0.99965</td>
</tr>
<tr class="odd">
<td style="text-align: center;">12</td>
<td style="text-align: center;">224</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.978070</td>
<td style="text-align: center;">0.0096992</td>
<td style="text-align: center;">0.959244</td>
<td style="text-align: center;">0.99727</td>
</tr>
<tr class="even">
<td style="text-align: center;">13</td>
<td style="text-align: center;">223</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.969298</td>
<td style="text-align: center;">0.0114246</td>
<td style="text-align: center;">0.947163</td>
<td style="text-align: center;">0.99195</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">221</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.964912</td>
<td style="text-align: center;">0.0121858</td>
<td style="text-align: center;">0.941322</td>
<td style="text-align: center;">0.98909</td>
</tr>
<tr class="even">
<td style="text-align: center;">26</td>
<td style="text-align: center;">220</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.960526</td>
<td style="text-align: center;">0.0128956</td>
<td style="text-align: center;">0.935581</td>
<td style="text-align: center;">0.98614</td>
</tr>
<tr class="odd">
<td style="text-align: center;">30</td>
<td style="text-align: center;">219</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.956140</td>
<td style="text-align: center;">0.0135621</td>
<td style="text-align: center;">0.929925</td>
<td style="text-align: center;">0.98309</td>
</tr>
<tr class="even">
<td style="text-align: center;">31</td>
<td style="text-align: center;">218</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.951754</td>
<td style="text-align: center;">0.0141914</td>
<td style="text-align: center;">0.924342</td>
<td style="text-align: center;">0.97998</td>
</tr>
<tr class="odd">
<td style="text-align: center;">53</td>
<td style="text-align: center;">217</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.942982</td>
<td style="text-align: center;">0.0153564</td>
<td style="text-align: center;">0.913360</td>
<td style="text-align: center;">0.97357</td>
</tr>
<tr class="even">
<td style="text-align: center;">54</td>
<td style="text-align: center;">215</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.938596</td>
<td style="text-align: center;">0.0158990</td>
<td style="text-align: center;">0.907947</td>
<td style="text-align: center;">0.97028</td>
</tr>
<tr class="odd">
<td style="text-align: center;">59</td>
<td style="text-align: center;">214</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.934211</td>
<td style="text-align: center;">0.0164185</td>
<td style="text-align: center;">0.902579</td>
<td style="text-align: center;">0.96695</td>
</tr>
<tr class="even">
<td style="text-align: center;">60</td>
<td style="text-align: center;">213</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.925439</td>
<td style="text-align: center;">0.0173966</td>
<td style="text-align: center;">0.891962</td>
<td style="text-align: center;">0.96017</td>
</tr>
<tr class="odd">
<td style="text-align: center;">61</td>
<td style="text-align: center;">211</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.921053</td>
<td style="text-align: center;">0.0178584</td>
<td style="text-align: center;">0.886707</td>
<td style="text-align: center;">0.95673</td>
</tr>
<tr class="even">
<td style="text-align: center;">62</td>
<td style="text-align: center;">210</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.916667</td>
<td style="text-align: center;">0.0183041</td>
<td style="text-align: center;">0.881484</td>
<td style="text-align: center;">0.95325</td>
</tr>
<tr class="odd">
<td style="text-align: center;">65</td>
<td style="text-align: center;">209</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.907895</td>
<td style="text-align: center;">0.0191510</td>
<td style="text-align: center;">0.871125</td>
<td style="text-align: center;">0.94622</td>
</tr>
<tr class="even">
<td style="text-align: center;">71</td>
<td style="text-align: center;">207</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.903509</td>
<td style="text-align: center;">0.0195543</td>
<td style="text-align: center;">0.865985</td>
<td style="text-align: center;">0.94266</td>
</tr>
<tr class="odd">
<td style="text-align: center;">79</td>
<td style="text-align: center;">206</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.899123</td>
<td style="text-align: center;">0.0199452</td>
<td style="text-align: center;">0.860869</td>
<td style="text-align: center;">0.93908</td>
</tr>
<tr class="even">
<td style="text-align: center;">81</td>
<td style="text-align: center;">205</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.890351</td>
<td style="text-align: center;">0.0206926</td>
<td style="text-align: center;">0.850704</td>
<td style="text-align: center;">0.93185</td>
</tr>
<tr class="odd">
<td style="text-align: center;">88</td>
<td style="text-align: center;">203</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.881579</td>
<td style="text-align: center;">0.0213982</td>
<td style="text-align: center;">0.840621</td>
<td style="text-align: center;">0.92453</td>
</tr>
<tr class="even">
<td style="text-align: center;">92</td>
<td style="text-align: center;">201</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.877193</td>
<td style="text-align: center;">0.0217366</td>
<td style="text-align: center;">0.835608</td>
<td style="text-align: center;">0.92085</td>
</tr>
<tr class="odd">
<td style="text-align: center;">93</td>
<td style="text-align: center;">199</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.872785</td>
<td style="text-align: center;">0.0220698</td>
<td style="text-align: center;">0.830583</td>
<td style="text-align: center;">0.91713</td>
</tr>
<tr class="even">
<td style="text-align: center;">95</td>
<td style="text-align: center;">198</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.863969</td>
<td style="text-align: center;">0.0227102</td>
<td style="text-align: center;">0.820585</td>
<td style="text-align: center;">0.90965</td>
</tr>
<tr class="odd">
<td style="text-align: center;">105</td>
<td style="text-align: center;">196</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.859561</td>
<td style="text-align: center;">0.0230182</td>
<td style="text-align: center;">0.815610</td>
<td style="text-align: center;">0.90588</td>
</tr>
<tr class="even">
<td style="text-align: center;">107</td>
<td style="text-align: center;">194</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.850700</td>
<td style="text-align: center;">0.0236183</td>
<td style="text-align: center;">0.805645</td>
<td style="text-align: center;">0.89827</td>
</tr>
<tr class="odd">
<td style="text-align: center;">110</td>
<td style="text-align: center;">192</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.846269</td>
<td style="text-align: center;">0.0239073</td>
<td style="text-align: center;">0.800685</td>
<td style="text-align: center;">0.89445</td>
</tr>
<tr class="even">
<td style="text-align: center;">116</td>
<td style="text-align: center;">191</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.841838</td>
<td style="text-align: center;">0.0241892</td>
<td style="text-align: center;">0.795738</td>
<td style="text-align: center;">0.89061</td>
</tr>
<tr class="odd">
<td style="text-align: center;">118</td>
<td style="text-align: center;">190</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.837407</td>
<td style="text-align: center;">0.0244643</td>
<td style="text-align: center;">0.790805</td>
<td style="text-align: center;">0.88676</td>
</tr>
<tr class="even">
<td style="text-align: center;">122</td>
<td style="text-align: center;">189</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.832977</td>
<td style="text-align: center;">0.0247329</td>
<td style="text-align: center;">0.785885</td>
<td style="text-align: center;">0.88289</td>
</tr>
<tr class="odd">
<td style="text-align: center;">131</td>
<td style="text-align: center;">188</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.828546</td>
<td style="text-align: center;">0.0249950</td>
<td style="text-align: center;">0.780977</td>
<td style="text-align: center;">0.87901</td>
</tr>
<tr class="even">
<td style="text-align: center;">132</td>
<td style="text-align: center;">187</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.819684</td>
<td style="text-align: center;">0.0255010</td>
<td style="text-align: center;">0.771197</td>
<td style="text-align: center;">0.87122</td>
</tr>
<tr class="odd">
<td style="text-align: center;">135</td>
<td style="text-align: center;">185</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.815254</td>
<td style="text-align: center;">0.0257452</td>
<td style="text-align: center;">0.766324</td>
<td style="text-align: center;">0.86731</td>
</tr>
<tr class="even">
<td style="text-align: center;">142</td>
<td style="text-align: center;">184</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.810823</td>
<td style="text-align: center;">0.0259838</td>
<td style="text-align: center;">0.761462</td>
<td style="text-align: center;">0.86338</td>
</tr>
<tr class="odd">
<td style="text-align: center;">144</td>
<td style="text-align: center;">183</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.806392</td>
<td style="text-align: center;">0.0262168</td>
<td style="text-align: center;">0.756611</td>
<td style="text-align: center;">0.85945</td>
</tr>
<tr class="even">
<td style="text-align: center;">145</td>
<td style="text-align: center;">182</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.797531</td>
<td style="text-align: center;">0.0266670</td>
<td style="text-align: center;">0.746940</td>
<td style="text-align: center;">0.85155</td>
</tr>
<tr class="odd">
<td style="text-align: center;">147</td>
<td style="text-align: center;">180</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.793100</td>
<td style="text-align: center;">0.0268844</td>
<td style="text-align: center;">0.742120</td>
<td style="text-align: center;">0.84758</td>
</tr>
<tr class="even">
<td style="text-align: center;">153</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.788669</td>
<td style="text-align: center;">0.0270969</td>
<td style="text-align: center;">0.737309</td>
<td style="text-align: center;">0.84361</td>
</tr>
<tr class="odd">
<td style="text-align: center;">156</td>
<td style="text-align: center;">178</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.779808</td>
<td style="text-align: center;">0.0275074</td>
<td style="text-align: center;">0.727716</td>
<td style="text-align: center;">0.83563</td>
</tr>
<tr class="even">
<td style="text-align: center;">163</td>
<td style="text-align: center;">176</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.766516</td>
<td style="text-align: center;">0.0280886</td>
<td style="text-align: center;">0.713394</td>
<td style="text-align: center;">0.82359</td>
</tr>
<tr class="odd">
<td style="text-align: center;">166</td>
<td style="text-align: center;">173</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.757654</td>
<td style="text-align: center;">0.0284542</td>
<td style="text-align: center;">0.703888</td>
<td style="text-align: center;">0.81553</td>
</tr>
<tr class="even">
<td style="text-align: center;">167</td>
<td style="text-align: center;">171</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.753224</td>
<td style="text-align: center;">0.0286307</td>
<td style="text-align: center;">0.699148</td>
<td style="text-align: center;">0.81148</td>
</tr>
<tr class="odd">
<td style="text-align: center;">170</td>
<td style="text-align: center;">170</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.748793</td>
<td style="text-align: center;">0.0288031</td>
<td style="text-align: center;">0.694415</td>
<td style="text-align: center;">0.80743</td>
</tr>
<tr class="even">
<td style="text-align: center;">175</td>
<td style="text-align: center;">167</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.744309</td>
<td style="text-align: center;">0.0289775</td>
<td style="text-align: center;">0.689627</td>
<td style="text-align: center;">0.80333</td>
</tr>
<tr class="odd">
<td style="text-align: center;">176</td>
<td style="text-align: center;">165</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.739798</td>
<td style="text-align: center;">0.0291509</td>
<td style="text-align: center;">0.684814</td>
<td style="text-align: center;">0.79920</td>
</tr>
<tr class="even">
<td style="text-align: center;">177</td>
<td style="text-align: center;">164</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.735287</td>
<td style="text-align: center;">0.0293201</td>
<td style="text-align: center;">0.680009</td>
<td style="text-align: center;">0.79506</td>
</tr>
<tr class="odd">
<td style="text-align: center;">179</td>
<td style="text-align: center;">162</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.726209</td>
<td style="text-align: center;">0.0296524</td>
<td style="text-align: center;">0.670357</td>
<td style="text-align: center;">0.78672</td>
</tr>
<tr class="even">
<td style="text-align: center;">180</td>
<td style="text-align: center;">160</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.721671</td>
<td style="text-align: center;">0.0298124</td>
<td style="text-align: center;">0.665542</td>
<td style="text-align: center;">0.78253</td>
</tr>
<tr class="odd">
<td style="text-align: center;">181</td>
<td style="text-align: center;">159</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.712593</td>
<td style="text-align: center;">0.0301205</td>
<td style="text-align: center;">0.655937</td>
<td style="text-align: center;">0.77414</td>
</tr>
<tr class="even">
<td style="text-align: center;">182</td>
<td style="text-align: center;">157</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.708054</td>
<td style="text-align: center;">0.0302687</td>
<td style="text-align: center;">0.651146</td>
<td style="text-align: center;">0.76994</td>
</tr>
<tr class="odd">
<td style="text-align: center;">183</td>
<td style="text-align: center;">156</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.703515</td>
<td style="text-align: center;">0.0304131</td>
<td style="text-align: center;">0.646362</td>
<td style="text-align: center;">0.76572</td>
</tr>
<tr class="even">
<td style="text-align: center;">186</td>
<td style="text-align: center;">154</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.698947</td>
<td style="text-align: center;">0.0305567</td>
<td style="text-align: center;">0.641551</td>
<td style="text-align: center;">0.76148</td>
</tr>
<tr class="odd">
<td style="text-align: center;">189</td>
<td style="text-align: center;">152</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.694349</td>
<td style="text-align: center;">0.0306998</td>
<td style="text-align: center;">0.636712</td>
<td style="text-align: center;">0.75720</td>
</tr>
<tr class="even">
<td style="text-align: center;">194</td>
<td style="text-align: center;">149</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.689689</td>
<td style="text-align: center;">0.0308454</td>
<td style="text-align: center;">0.631807</td>
<td style="text-align: center;">0.75287</td>
</tr>
<tr class="odd">
<td style="text-align: center;">197</td>
<td style="text-align: center;">147</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.684997</td>
<td style="text-align: center;">0.0309903</td>
<td style="text-align: center;">0.626872</td>
<td style="text-align: center;">0.74851</td>
</tr>
<tr class="even">
<td style="text-align: center;">199</td>
<td style="text-align: center;">145</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.680273</td>
<td style="text-align: center;">0.0311346</td>
<td style="text-align: center;">0.621907</td>
<td style="text-align: center;">0.74412</td>
</tr>
<tr class="odd">
<td style="text-align: center;">201</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.670825</td>
<td style="text-align: center;">0.0314108</td>
<td style="text-align: center;">0.612001</td>
<td style="text-align: center;">0.73530</td>
</tr>
<tr class="even">
<td style="text-align: center;">202</td>
<td style="text-align: center;">142</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.666101</td>
<td style="text-align: center;">0.0315428</td>
<td style="text-align: center;">0.607060</td>
<td style="text-align: center;">0.73088</td>
</tr>
<tr class="odd">
<td style="text-align: center;">207</td>
<td style="text-align: center;">139</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.661308</td>
<td style="text-align: center;">0.0316778</td>
<td style="text-align: center;">0.602046</td>
<td style="text-align: center;">0.72640</td>
</tr>
<tr class="even">
<td style="text-align: center;">208</td>
<td style="text-align: center;">138</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.656516</td>
<td style="text-align: center;">0.0318087</td>
<td style="text-align: center;">0.597041</td>
<td style="text-align: center;">0.72192</td>
</tr>
<tr class="odd">
<td style="text-align: center;">210</td>
<td style="text-align: center;">137</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.651724</td>
<td style="text-align: center;">0.0319354</td>
<td style="text-align: center;">0.592044</td>
<td style="text-align: center;">0.71742</td>
</tr>
<tr class="even">
<td style="text-align: center;">212</td>
<td style="text-align: center;">135</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.646897</td>
<td style="text-align: center;">0.0320617</td>
<td style="text-align: center;">0.587013</td>
<td style="text-align: center;">0.71289</td>
</tr>
<tr class="odd">
<td style="text-align: center;">218</td>
<td style="text-align: center;">134</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.642069</td>
<td style="text-align: center;">0.0321838</td>
<td style="text-align: center;">0.581990</td>
<td style="text-align: center;">0.70835</td>
</tr>
<tr class="even">
<td style="text-align: center;">222</td>
<td style="text-align: center;">132</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.637205</td>
<td style="text-align: center;">0.0323055</td>
<td style="text-align: center;">0.576932</td>
<td style="text-align: center;">0.70378</td>
</tr>
<tr class="odd">
<td style="text-align: center;">223</td>
<td style="text-align: center;">130</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.632303</td>
<td style="text-align: center;">0.0324267</td>
<td style="text-align: center;">0.571838</td>
<td style="text-align: center;">0.69916</td>
</tr>
<tr class="even">
<td style="text-align: center;">226</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.627285</td>
<td style="text-align: center;">0.0325553</td>
<td style="text-align: center;">0.566616</td>
<td style="text-align: center;">0.69445</td>
</tr>
<tr class="odd">
<td style="text-align: center;">229</td>
<td style="text-align: center;">125</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.622267</td>
<td style="text-align: center;">0.0326794</td>
<td style="text-align: center;">0.561403</td>
<td style="text-align: center;">0.68973</td>
</tr>
<tr class="even">
<td style="text-align: center;">230</td>
<td style="text-align: center;">124</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.617248</td>
<td style="text-align: center;">0.0327989</td>
<td style="text-align: center;">0.556198</td>
<td style="text-align: center;">0.68500</td>
</tr>
<tr class="odd">
<td style="text-align: center;">239</td>
<td style="text-align: center;">121</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.607046</td>
<td style="text-align: center;">0.0330406</td>
<td style="text-align: center;">0.545622</td>
<td style="text-align: center;">0.67538</td>
</tr>
<tr class="even">
<td style="text-align: center;">245</td>
<td style="text-align: center;">117</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.601858</td>
<td style="text-align: center;">0.0331631</td>
<td style="text-align: center;">0.540246</td>
<td style="text-align: center;">0.67050</td>
</tr>
<tr class="odd">
<td style="text-align: center;">246</td>
<td style="text-align: center;">116</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.596669</td>
<td style="text-align: center;">0.0332806</td>
<td style="text-align: center;">0.534879</td>
<td style="text-align: center;">0.66560</td>
</tr>
<tr class="even">
<td style="text-align: center;">267</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.591342</td>
<td style="text-align: center;">0.0334071</td>
<td style="text-align: center;">0.529360</td>
<td style="text-align: center;">0.66058</td>
</tr>
<tr class="odd">
<td style="text-align: center;">268</td>
<td style="text-align: center;">111</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.586014</td>
<td style="text-align: center;">0.0335282</td>
<td style="text-align: center;">0.523851</td>
<td style="text-align: center;">0.65555</td>
</tr>
<tr class="even">
<td style="text-align: center;">269</td>
<td style="text-align: center;">110</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.580687</td>
<td style="text-align: center;">0.0336440</td>
<td style="text-align: center;">0.518352</td>
<td style="text-align: center;">0.65052</td>
</tr>
<tr class="odd">
<td style="text-align: center;">270</td>
<td style="text-align: center;">108</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.575310</td>
<td style="text-align: center;">0.0337594</td>
<td style="text-align: center;">0.512806</td>
<td style="text-align: center;">0.64543</td>
</tr>
<tr class="even">
<td style="text-align: center;">283</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.569778</td>
<td style="text-align: center;">0.0338850</td>
<td style="text-align: center;">0.507090</td>
<td style="text-align: center;">0.64022</td>
</tr>
<tr class="odd">
<td style="text-align: center;">284</td>
<td style="text-align: center;">103</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.564247</td>
<td style="text-align: center;">0.0340045</td>
<td style="text-align: center;">0.501385</td>
<td style="text-align: center;">0.63499</td>
</tr>
<tr class="even">
<td style="text-align: center;">285</td>
<td style="text-align: center;">101</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.553073</td>
<td style="text-align: center;">0.0342367</td>
<td style="text-align: center;">0.489882</td>
<td style="text-align: center;">0.62442</td>
</tr>
<tr class="odd">
<td style="text-align: center;">286</td>
<td style="text-align: center;">99</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.547487</td>
<td style="text-align: center;">0.0343437</td>
<td style="text-align: center;">0.484148</td>
<td style="text-align: center;">0.61911</td>
</tr>
<tr class="even">
<td style="text-align: center;">288</td>
<td style="text-align: center;">98</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.541900</td>
<td style="text-align: center;">0.0344446</td>
<td style="text-align: center;">0.478426</td>
<td style="text-align: center;">0.61380</td>
</tr>
<tr class="odd">
<td style="text-align: center;">291</td>
<td style="text-align: center;">97</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.536314</td>
<td style="text-align: center;">0.0345396</td>
<td style="text-align: center;">0.472716</td>
<td style="text-align: center;">0.60847</td>
</tr>
<tr class="even">
<td style="text-align: center;">293</td>
<td style="text-align: center;">94</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.530608</td>
<td style="text-align: center;">0.0346402</td>
<td style="text-align: center;">0.466879</td>
<td style="text-align: center;">0.60304</td>
</tr>
<tr class="odd">
<td style="text-align: center;">301</td>
<td style="text-align: center;">91</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.524777</td>
<td style="text-align: center;">0.0347468</td>
<td style="text-align: center;">0.460909</td>
<td style="text-align: center;">0.59750</td>
</tr>
<tr class="even">
<td style="text-align: center;">303</td>
<td style="text-align: center;">89</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.518881</td>
<td style="text-align: center;">0.0348531</td>
<td style="text-align: center;">0.454876</td>
<td style="text-align: center;">0.59189</td>
</tr>
<tr class="odd">
<td style="text-align: center;">305</td>
<td style="text-align: center;">87</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.512917</td>
<td style="text-align: center;">0.0349590</td>
<td style="text-align: center;">0.448778</td>
<td style="text-align: center;">0.58622</td>
</tr>
<tr class="even">
<td style="text-align: center;">306</td>
<td style="text-align: center;">86</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.506953</td>
<td style="text-align: center;">0.0350576</td>
<td style="text-align: center;">0.442694</td>
<td style="text-align: center;">0.58054</td>
</tr>
<tr class="odd">
<td style="text-align: center;">310</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.495024</td>
<td style="text-align: center;">0.0352327</td>
<td style="text-align: center;">0.430570</td>
<td style="text-align: center;">0.56913</td>
</tr>
<tr class="even">
<td style="text-align: center;">320</td>
<td style="text-align: center;">82</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.488987</td>
<td style="text-align: center;">0.0353165</td>
<td style="text-align: center;">0.424444</td>
<td style="text-align: center;">0.56335</td>
</tr>
<tr class="odd">
<td style="text-align: center;">329</td>
<td style="text-align: center;">81</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.482951</td>
<td style="text-align: center;">0.0353927</td>
<td style="text-align: center;">0.418334</td>
<td style="text-align: center;">0.55755</td>
</tr>
<tr class="even">
<td style="text-align: center;">337</td>
<td style="text-align: center;">79</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.476837</td>
<td style="text-align: center;">0.0354687</td>
<td style="text-align: center;">0.412150</td>
<td style="text-align: center;">0.55168</td>
</tr>
<tr class="odd">
<td style="text-align: center;">340</td>
<td style="text-align: center;">78</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.470724</td>
<td style="text-align: center;">0.0355369</td>
<td style="text-align: center;">0.405981</td>
<td style="text-align: center;">0.54579</td>
</tr>
<tr class="even">
<td style="text-align: center;">345</td>
<td style="text-align: center;">77</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.464611</td>
<td style="text-align: center;">0.0355973</td>
<td style="text-align: center;">0.399827</td>
<td style="text-align: center;">0.53989</td>
</tr>
<tr class="odd">
<td style="text-align: center;">348</td>
<td style="text-align: center;">76</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.458497</td>
<td style="text-align: center;">0.0356500</td>
<td style="text-align: center;">0.393688</td>
<td style="text-align: center;">0.53398</td>
</tr>
<tr class="even">
<td style="text-align: center;">350</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.452384</td>
<td style="text-align: center;">0.0356950</td>
<td style="text-align: center;">0.387564</td>
<td style="text-align: center;">0.52804</td>
</tr>
<tr class="odd">
<td style="text-align: center;">351</td>
<td style="text-align: center;">74</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.446271</td>
<td style="text-align: center;">0.0357323</td>
<td style="text-align: center;">0.381455</td>
<td style="text-align: center;">0.52210</td>
</tr>
<tr class="even">
<td style="text-align: center;">353</td>
<td style="text-align: center;">73</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.434044</td>
<td style="text-align: center;">0.0357839</td>
<td style="text-align: center;">0.369282</td>
<td style="text-align: center;">0.51016</td>
</tr>
<tr class="odd">
<td style="text-align: center;">361</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.427844</td>
<td style="text-align: center;">0.0358059</td>
<td style="text-align: center;">0.363119</td>
<td style="text-align: center;">0.50411</td>
</tr>
<tr class="even">
<td style="text-align: center;">363</td>
<td style="text-align: center;">69</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.415442</td>
<td style="text-align: center;">0.0358258</td>
<td style="text-align: center;">0.350838</td>
<td style="text-align: center;">0.49194</td>
</tr>
<tr class="odd">
<td style="text-align: center;">364</td>
<td style="text-align: center;">67</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.409242</td>
<td style="text-align: center;">0.0358236</td>
<td style="text-align: center;">0.344722</td>
<td style="text-align: center;">0.48584</td>
</tr>
<tr class="even">
<td style="text-align: center;">371</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.396650</td>
<td style="text-align: center;">0.0358108</td>
<td style="text-align: center;">0.332321</td>
<td style="text-align: center;">0.47343</td>
</tr>
<tr class="odd">
<td style="text-align: center;">387</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.390039</td>
<td style="text-align: center;">0.0358190</td>
<td style="text-align: center;">0.325790</td>
<td style="text-align: center;">0.46696</td>
</tr>
<tr class="even">
<td style="text-align: center;">390</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.383428</td>
<td style="text-align: center;">0.0358167</td>
<td style="text-align: center;">0.319280</td>
<td style="text-align: center;">0.46046</td>
</tr>
<tr class="odd">
<td style="text-align: center;">394</td>
<td style="text-align: center;">58</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.376817</td>
<td style="text-align: center;">0.0358041</td>
<td style="text-align: center;">0.312789</td>
<td style="text-align: center;">0.45395</td>
</tr>
<tr class="even">
<td style="text-align: center;">426</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.369966</td>
<td style="text-align: center;">0.0358026</td>
<td style="text-align: center;">0.306047</td>
<td style="text-align: center;">0.44723</td>
</tr>
<tr class="odd">
<td style="text-align: center;">428</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.363115</td>
<td style="text-align: center;">0.0357891</td>
<td style="text-align: center;">0.299329</td>
<td style="text-align: center;">0.44049</td>
</tr>
<tr class="even">
<td style="text-align: center;">429</td>
<td style="text-align: center;">53</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.356263</td>
<td style="text-align: center;">0.0357636</td>
<td style="text-align: center;">0.292633</td>
<td style="text-align: center;">0.43373</td>
</tr>
<tr class="odd">
<td style="text-align: center;">433</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.349412</td>
<td style="text-align: center;">0.0357261</td>
<td style="text-align: center;">0.285960</td>
<td style="text-align: center;">0.42694</td>
</tr>
<tr class="even">
<td style="text-align: center;">442</td>
<td style="text-align: center;">51</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.342561</td>
<td style="text-align: center;">0.0356764</td>
<td style="text-align: center;">0.279311</td>
<td style="text-align: center;">0.42013</td>
</tr>
<tr class="odd">
<td style="text-align: center;">444</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.335710</td>
<td style="text-align: center;">0.0356147</td>
<td style="text-align: center;">0.272685</td>
<td style="text-align: center;">0.41330</td>
</tr>
<tr class="even">
<td style="text-align: center;">450</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.328716</td>
<td style="text-align: center;">0.0355528</td>
<td style="text-align: center;">0.265924</td>
<td style="text-align: center;">0.40633</td>
</tr>
<tr class="odd">
<td style="text-align: center;">455</td>
<td style="text-align: center;">47</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.321722</td>
<td style="text-align: center;">0.0354776</td>
<td style="text-align: center;">0.259188</td>
<td style="text-align: center;">0.39934</td>
</tr>
<tr class="even">
<td style="text-align: center;">457</td>
<td style="text-align: center;">46</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.314728</td>
<td style="text-align: center;">0.0353890</td>
<td style="text-align: center;">0.252478</td>
<td style="text-align: center;">0.39233</td>
</tr>
<tr class="odd">
<td style="text-align: center;">460</td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.307575</td>
<td style="text-align: center;">0.0353002</td>
<td style="text-align: center;">0.245617</td>
<td style="text-align: center;">0.38516</td>
</tr>
<tr class="even">
<td style="text-align: center;">473</td>
<td style="text-align: center;">43</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.300422</td>
<td style="text-align: center;">0.0351965</td>
<td style="text-align: center;">0.238785</td>
<td style="text-align: center;">0.37797</td>
</tr>
<tr class="odd">
<td style="text-align: center;">477</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.293269</td>
<td style="text-align: center;">0.0350778</td>
<td style="text-align: center;">0.231982</td>
<td style="text-align: center;">0.37075</td>
</tr>
<tr class="even">
<td style="text-align: center;">519</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.285749</td>
<td style="text-align: center;">0.0349751</td>
<td style="text-align: center;">0.224802</td>
<td style="text-align: center;">0.36322</td>
</tr>
<tr class="odd">
<td style="text-align: center;">520</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.278230</td>
<td style="text-align: center;">0.0348537</td>
<td style="text-align: center;">0.217658</td>
<td style="text-align: center;">0.35566</td>
</tr>
<tr class="even">
<td style="text-align: center;">524</td>
<td style="text-align: center;">37</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.263190</td>
<td style="text-align: center;">0.0345541</td>
<td style="text-align: center;">0.203477</td>
<td style="text-align: center;">0.34043</td>
</tr>
<tr class="odd">
<td style="text-align: center;">533</td>
<td style="text-align: center;">34</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.255449</td>
<td style="text-align: center;">0.0343939</td>
<td style="text-align: center;">0.196200</td>
<td style="text-align: center;">0.33259</td>
</tr>
<tr class="even">
<td style="text-align: center;">550</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.247467</td>
<td style="text-align: center;">0.0342330</td>
<td style="text-align: center;">0.188698</td>
<td style="text-align: center;">0.32454</td>
</tr>
<tr class="odd">
<td style="text-align: center;">558</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.239218</td>
<td style="text-align: center;">0.0340712</td>
<td style="text-align: center;">0.180950</td>
<td style="text-align: center;">0.31625</td>
</tr>
<tr class="even">
<td style="text-align: center;">567</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.230674</td>
<td style="text-align: center;">0.0339086</td>
<td style="text-align: center;">0.172932</td>
<td style="text-align: center;">0.30770</td>
</tr>
<tr class="odd">
<td style="text-align: center;">574</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.222131</td>
<td style="text-align: center;">0.0337119</td>
<td style="text-align: center;">0.164978</td>
<td style="text-align: center;">0.29908</td>
</tr>
<tr class="even">
<td style="text-align: center;">583</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.213587</td>
<td style="text-align: center;">0.0334803</td>
<td style="text-align: center;">0.157090</td>
<td style="text-align: center;">0.29040</td>
</tr>
<tr class="odd">
<td style="text-align: center;">613</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.204688</td>
<td style="text-align: center;">0.0332471</td>
<td style="text-align: center;">0.148879</td>
<td style="text-align: center;">0.28142</td>
</tr>
<tr class="even">
<td style="text-align: center;">624</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.195788</td>
<td style="text-align: center;">0.0329711</td>
<td style="text-align: center;">0.140748</td>
<td style="text-align: center;">0.27235</td>
</tr>
<tr class="odd">
<td style="text-align: center;">641</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.186889</td>
<td style="text-align: center;">0.0326514</td>
<td style="text-align: center;">0.132700</td>
<td style="text-align: center;">0.26321</td>
</tr>
<tr class="even">
<td style="text-align: center;">643</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.177989</td>
<td style="text-align: center;">0.0322866</td>
<td style="text-align: center;">0.124735</td>
<td style="text-align: center;">0.25398</td>
</tr>
<tr class="odd">
<td style="text-align: center;">654</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.169090</td>
<td style="text-align: center;">0.0318752</td>
<td style="text-align: center;">0.116858</td>
<td style="text-align: center;">0.24467</td>
</tr>
<tr class="even">
<td style="text-align: center;">655</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.160190</td>
<td style="text-align: center;">0.0314154</td>
<td style="text-align: center;">0.109070</td>
<td style="text-align: center;">0.23527</td>
</tr>
<tr class="odd">
<td style="text-align: center;">687</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.151291</td>
<td style="text-align: center;">0.0309049</td>
<td style="text-align: center;">0.101376</td>
<td style="text-align: center;">0.22578</td>
</tr>
<tr class="even">
<td style="text-align: center;">689</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.142392</td>
<td style="text-align: center;">0.0303413</td>
<td style="text-align: center;">0.093779</td>
<td style="text-align: center;">0.21620</td>
</tr>
<tr class="odd">
<td style="text-align: center;">705</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.133492</td>
<td style="text-align: center;">0.0297215</td>
<td style="text-align: center;">0.086286</td>
<td style="text-align: center;">0.20652</td>
</tr>
<tr class="even">
<td style="text-align: center;">707</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.124593</td>
<td style="text-align: center;">0.0290419</td>
<td style="text-align: center;">0.078901</td>
<td style="text-align: center;">0.19674</td>
</tr>
<tr class="odd">
<td style="text-align: center;">728</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.115693</td>
<td style="text-align: center;">0.0282982</td>
<td style="text-align: center;">0.071632</td>
<td style="text-align: center;">0.18686</td>
</tr>
<tr class="even">
<td style="text-align: center;">731</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.106794</td>
<td style="text-align: center;">0.0274852</td>
<td style="text-align: center;">0.064487</td>
<td style="text-align: center;">0.17685</td>
</tr>
<tr class="odd">
<td style="text-align: center;">735</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.097894</td>
<td style="text-align: center;">0.0265966</td>
<td style="text-align: center;">0.057477</td>
<td style="text-align: center;">0.16673</td>
</tr>
<tr class="even">
<td style="text-align: center;">765</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.088105</td>
<td style="text-align: center;">0.0256754</td>
<td style="text-align: center;">0.049767</td>
<td style="text-align: center;">0.15598</td>
</tr>
<tr class="odd">
<td style="text-align: center;">791</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.078315</td>
<td style="text-align: center;">0.0246182</td>
<td style="text-align: center;">0.042294</td>
<td style="text-align: center;">0.14502</td>
</tr>
<tr class="even">
<td style="text-align: center;">814</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.067127</td>
<td style="text-align: center;">0.0235064</td>
<td style="text-align: center;">0.033793</td>
<td style="text-align: center;">0.13334</td>
</tr>
<tr class="odd">
<td style="text-align: center;">883</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.050346</td>
<td style="text-align: center;">0.0228480</td>
<td style="text-align: center;">0.020685</td>
<td style="text-align: center;">0.12253</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ul>
<li>Applying the formula</li>
</ul>
<p><span class="math display">\[
\hat{S}(t) = \prod_{i: t_i \leq t} (1 - \frac{d_i}{n_i})
\]</span></p>
<ul>
<li><p><span class="math inline">\(S(0) = 1\)</span></p></li>
<li><p><span class="math inline">\(S(5) = 1*(1-1/228) = 0.9956\)</span></p></li>
<li><p><span class="math inline">\(S(11) = 1*(1-1/228)*(1-3/227) = 0.9825\)</span></p></li>
<li><p>etc.</p></li>
<li><p>Number at risk is decrease by events or censored observations</p></li>
<li><p>Most early times are events, so number at risk is decreasing because of events. – The first censored observation is at 92 days. Here, the risk set decreases by the number of events and number censored (find this time point in the table to verify yourself)</p></li>
</ul>
</section>
<section id="kaplan-meier-plot" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="kaplan-meier-plot"><span class="header-section-number">3.4</span> Kaplan-Meier plot</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(s1, <span class="at">data=</span>lung, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot gives estimate of survival over time</li>
<li>Confidence interval is conditional on a given survival time (rather than being a confidence band for the entire survival curve)</li>
<li>Risk table gives the number of subjects at risk at specified time points</li>
</ul>
</section>
<section id="estimating-x-year-survival" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="estimating-x-year-survival"><span class="header-section-number">3.5</span> Estimating <span class="math inline">\(x\)</span>-year survival</h3>
<p>One quantity often of interest in a survival analysis is the probability of surviving beyond a certain number of years, <span class="math inline">\(x\)</span>.</p>
<p>For example, to estimate the probability of surviving to <span class="math inline">\(1\)</span> year, use <code>summary</code> with the <code>times</code> argument (<em>Note:</em> the <code>time</code> variable in the <code>lung</code> data is actually in days, so we need to use <code>times = 365.25</code>)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> lung), <span class="at">times =</span> <span class="fl">365.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p>Call:</p>
<p>survfit(formula = Surv(time, status) ~ 1, data = lung)</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">time</th>
<th style="text-align: center;">n.risk</th>
<th style="text-align: center;">n.event</th>
<th style="text-align: center;">survival</th>
<th style="text-align: center;">std.err</th>
<th style="text-align: center;">lower 95% CI</th>
<th style="text-align: center;">upper 95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">365.25</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">121</td>
<td style="text-align: center;">0.40924</td>
<td style="text-align: center;">0.035824</td>
<td style="text-align: center;">0.34472</td>
<td style="text-align: center;">0.48584</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We find that the <span class="math inline">\(1\)</span>-year probability of survival in this study is 41%.</p>
<p>The associated lower and upper bounds of the 95% confidence interval are also displayed.</p>
<p>The <span class="math inline">\(1\)</span>-year survival probability is the point on the y-axis that corresponds to <span class="math inline">\(1\)</span> year on the x-axis for the survival curve.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What happens if you use a “naive” estimate? Here “naive” means that the patients who were censored prior to 1-year are considered event-free and included in the denominator.</p>
<p>121 of the 228 patients in the <code>lung</code> data died by <span class="math inline">\(1\)</span> year so the “naive” estimate is calculated as:</p>
<p><span class="math display">\[\Big(1 - \frac{121}{228}\Big) \times 100 = 47\%\]</span> You get an <strong>incorrect</strong> estimate of the <span class="math inline">\(1\)</span>-year probability of survival when you ignore the fact that 42 patients were censored before <span class="math inline">\(1\)</span> year.</p>
<p>Recall the <strong>correct</strong> estimate of the <span class="math inline">\(1\)</span>-year probability of survival, accounting for censoring using the Kaplan-Meier method, was 41%.</p>
<p>Ignoring censoring leads to an <strong>overestimate</strong> of the overall survival probability. Imagine two studies, each with 228 subjects. There are 165 deaths in each study. Censoring is ignored in one , censoring is accounted for in the other. The censored subjects only contribute information for a portion of the follow-up time, and then fall out of the risk set, thus pulling down the cumulative probability of survival. Ignoring censoring erroneously treats patients who are censored as part of the risk set for the entire follow-up period.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimating-median-survival-time" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="estimating-median-survival-time"><span class="header-section-number">3.6</span> Estimating median survival time</h3>
<p>Another quantity often of interest in a survival analysis is the average survival time, which we quantify using the median. Survival times are not expected to be normally distributed so the mean is not an appropriate summary.</p>
<p>We can obtain the median survival directly from the <code>survfit</code> object:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">records</th>
<th style="text-align: center;">n.max</th>
<th style="text-align: center;">n.start</th>
<th style="text-align: center;">events</th>
<th style="text-align: center;">median</th>
<th style="text-align: center;">0.95LCL</th>
<th style="text-align: center;">0.95UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">228</td>
<td style="text-align: center;">228</td>
<td style="text-align: center;">228</td>
<td style="text-align: center;">165</td>
<td style="text-align: center;">310</td>
<td style="text-align: center;">285</td>
<td style="text-align: center;">363</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We see the median survival time is 310 days The lower and upper bounds of the 95% confidence interval are also displayed.</p>
<p>Median survival is the time corresponding to a survival probability of <span class="math inline">\(0.5\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="non-parametric-test-for-comparing-survival-times-between-groups" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="non-parametric-test-for-comparing-survival-times-between-groups"><span class="header-section-number">3.7</span> Non-parametric test for comparing survival times between groups</h3>
<ul>
<li><p>The most common test for comparing survival by groups is the log-rank test</p>
<ul>
<li><p>At each event time, constructs a 2x2 table of observed events and number at risk for each group</p></li>
<li><p>Compare observed to expected number of events under the null hypothesis that the event rates are the same in each group</p></li>
<li><p>A Chi-squared test stratifying over all event times</p></li>
<li><p>A test of the entire survival curve</p></li>
</ul></li>
<li><p>We get the log-rank p-value using the <code>survdiff</code> function. For example, we can test whether there was a difference in survival time according to sex in the <code>lung</code> data:</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Call: Surv(time, status) ~ sex Chisq = 10.326742 on 1 degrees of freedom, p = 0.001311</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 8%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">N</th>
<th style="text-align: center;">Observed</th>
<th style="text-align: center;">Expected</th>
<th style="text-align: center;">(O-E)^2/E</th>
<th style="text-align: center;">(O-E)^2/V</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>sex=1</strong></td>
<td style="text-align: center;">138</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">91.582</td>
<td style="text-align: center;">4.5523</td>
<td style="text-align: center;">10.327</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>sex=2</strong></td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">53</td>
<td style="text-align: center;">73.418</td>
<td style="text-align: center;">5.6785</td>
<td style="text-align: center;">10.327</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>We can also add the p-value to Kaplan-Meier plot by sex</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit.sex <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data=</span>lung)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit.sex, <span class="at">data=</span>lung, <span class="at">pval=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There was a significant difference in overall survival according to sex in the <code>lung</code> data, with a p-value of p = 0.0013.</p>
</section>
</section>
<section id="semi-parametric-regression-cox-proportional-hazards-model" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="semi-parametric-regression-cox-proportional-hazards-model"><span class="header-section-number">4</span> Semi-parametric regression (Cox proportional hazards model)</h2>
<ul>
<li><p>The preceding approach was very flexible in that it makes no parametric assumptions above the shape of the survival curve</p></li>
<li><p>This can work for well for categorical predictors and/or descriptive purposes</p></li>
<li><p>In a clinical trial where we have randomized to treatment groups (and presumably have minimized confounding), the Kaplan-Meier method and log-rank test can be the primary analysis method</p></li>
<li><p>Extensions are needed if we want to consider continuous predictors and multivariable models</p></li>
<li><p>Would be nice to maintain flexibility and have a readily interpret</p></li>
<li><p>Statistical methods</p>
<ul>
<li><p>Regression models we have studied to date are generally not valid for survival data</p>
<ul>
<li><p>Because of right censoring, survival time cannot be analyzed as a continuous outcome (e.g.&nbsp;linear regression)</p></li>
<li><p>Because of unequal length of followup, survival (yes/no) cannot be analyzed using logistic regression</p></li>
</ul></li>
<li><p>In the presence of censored data, the usual descriptive statistics are not appropriate</p>
<ul>
<li><p>Sample mean, sample median, simple proportions, sample standard deviation should not be used</p></li>
<li><p>Proper descriptives should be based on the Kaplan Meier estimates</p></li>
</ul></li>
<li><p>Specialized regression models are needed with censored data</p></li>
</ul></li>
<li><p>(Cox) Proportional hazards model</p>
<ul>
<li><p>Considers the instantaneous risk of failure at each time among those subjects who have not failed</p></li>
<li><p>The term “proportional hazards” assumes that the ratio of these instantaneous failure rates is constant in time between groups</p></li>
<li><p>Proportional hazards (Cox) regression treats the survival distribution within a group semi-parametrically</p>
<ul>
<li><p>The baseline hazard is estimated without making any distributional assumptions</p></li>
<li><p>The hazard ratio is the parameter of interest and is used to compare groups</p></li>
</ul></li>
</ul></li>
</ul>
<section id="proportional-hazards-regression" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="proportional-hazards-regression"><span class="header-section-number">4.1</span> Proportional Hazards Regression</h3>
<ul>
<li><p>Looks at odds of choosing subjects relative to prevalence in the population</p>
<ul>
<li><p>Can be derived as estimating the odds ratio of an event at each time that an event occurs</p></li>
<li><p>Proportional hazards model averages the odds ratio across all observed event times</p></li>
<li><p>If the odds ratio is constant over time between two groups, such an average results in a precise estimate of the hazard ratio</p></li>
</ul></li>
<li><p>Borrowing information</p>
<ul>
<li><p>Uses other groups to make estimates in groups with sparse data</p></li>
<li><p>Borrows information across predictor groups</p>
<ul>
<li>Intuitively, 67 and 69 year olds would provide some relevant information about 68 year olds</li>
</ul></li>
<li><p>Also borrows information over time</p>
<ul>
<li>Relative risk for an event at each time is presumed to be the same under proportional hazards</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="the-simple-ph-regression-model" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="the-simple-ph-regression-model"><span class="header-section-number">4.2</span> The simple PH regression model</h3>
<ul>
<li><p>Modeling the log hazard over time as a function of covariates <span class="math inline">\(X\)</span></p></li>
<li><p>“Baseline hazard” is unspecified. Baseline hazard is similar to an intercept</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;"><span class="math inline">\(\textrm{log}(\lambda(t | X_i)) = \textrm{log}(\lambda_{0}(t)) + \beta_1 \times X_i\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(X_i = 0\)</span></td>
<td style="text-align: left;">log hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\textrm{log}(\lambda_{0}(t))\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(X_i = x\)</span></td>
<td style="text-align: left;">log hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\textrm{log}(\lambda_{0}(t)) + \beta_1 \times x\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(X_i = x+1\)</span></td>
<td style="text-align: left;">log hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\textrm{log}(\lambda_{0}(t))+ \beta_1 \times x + \beta_1\)</span></td>
</tr>
</tbody>
</table></li>
<li><p>Model on the hazard scale is found by exponentiating parameters</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;"><span class="math inline">\(\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(X_i = 0\)</span></td>
<td style="text-align: left;">hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\lambda_{0}(t)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(X_i = x\)</span></td>
<td style="text-align: left;">hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\lambda_{0}(t) \times e^{\beta_1 \times x}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(X_i = x+1\)</span></td>
<td style="text-align: left;">hazard at <span class="math inline">\(t\)</span> is <span class="math inline">\(\lambda_{0}(t) \times e^{\beta_1 \times x} \times e^{\beta_1}\)</span></td>
</tr>
</tbody>
</table></li>
<li><p>Interpretation of the model</p>
<ul>
<li><p>No intercept</p>
<ul>
<li>Generally ignore the baseline hazard</li>
</ul></li>
<li><p>Slope parameter</p>
<ul>
<li><p>Hazard ratio found by exponentiating the slope from the PH regression: <span class="math inline">\(\textrm{exp}(\beta_1)\)</span></p></li>
<li><p>Hazard ratio compared groups differing in the value of the predictor by 1 unit</p></li>
</ul></li>
</ul></li>
<li><p>Relationship to survival</p>
<ul>
<li><p>Hazard function determines the survival function</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hazard</td>
<td style="text-align: left;"><span class="math inline">\(\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Cumulative Hazard</td>
<td style="text-align: left;"><span class="math inline">\(\Lambda(t | X_i) = \displaystyle\int^t_0 \lambda_{0}(u) \times e^{\beta_1 \times X_i} \ du\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Survival Function</td>
<td style="text-align: left;"><span class="math inline">\(S(t | X_i) = e^{-\Lambda(t|X_i)} = [S_0(t)]^{e^{\beta_1 \times X_i}}\)</span></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
</section>
<section id="descriptive-plots" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="descriptive-plots"><span class="header-section-number">4.3</span> Descriptive Plots</h3>
<section id="hazard" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="hazard"><span class="header-section-number">4.3.1</span> Hazard</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">55</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="sc">*</span>pi,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>lambda0 <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">sin</span>(x) <span class="sc">+</span> <span class="dv">4</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, .<span class="dv">2</span>)) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>lambda0[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, lambda0, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Baseline Hazard Over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(lambda[<span class="dv">0</span>] (t)), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cumulative-hazard" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="cumulative-hazard"><span class="header-section-number">4.3.2</span> Cumulative hazard</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">cumsum</span>(lambda0), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Cumulative Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">main=</span><span class="st">"Baseline Cumulative Hazard over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(Lambda[<span class="dv">0</span>] (t) <span class="sc">==</span> <span class="fu">integral</span>(lambda[<span class="dv">0</span>] (u)<span class="sc">*</span>du, <span class="dv">0</span>, t)), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="survival" class="level4" data-number="4.3.3">
<h4 data-number="4.3.3" class="anchored" data-anchor-id="survival"><span class="header-section-number">4.3.3</span> Survival</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">cumsum</span>(lambda0)), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Baseline Survival over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(<span class="fu">exp</span>(<span class="sc">-</span>Lambda[<span class="dv">0</span>] (t))), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="proportional-hazards-assumption" class="level4" data-number="4.3.4">
<h4 data-number="4.3.4" class="anchored" data-anchor-id="proportional-hazards-assumption"><span class="header-section-number">4.3.4</span> Proportional hazards assumption</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>lambda1 <span class="ot">&lt;-</span> lambda0<span class="sc">*</span><span class="fl">1.5</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, lambda0, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Proportional Hazards for Two Groups"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, lambda1, <span class="at">col=</span><span class="st">"Red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">c</span>(<span class="fu">expression</span>(lambda[<span class="dv">0</span>] (t)), <span class="fu">expression</span>(lambda[<span class="dv">1</span>] (t) <span class="sc">==</span> <span class="fl">1.5</span><span class="sc">*</span>lambda[<span class="dv">0</span>] (t))), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"Black"</span>,<span class="st">"Red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="proportional-hazards-assumption-on-log-scale" class="level4" data-number="4.3.5">
<h4 data-number="4.3.5" class="anchored" data-anchor-id="proportional-hazards-assumption-on-log-scale"><span class="header-section-number">4.3.5</span> Proportional hazards assumption on log scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(lambda0), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Log Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="dv">2</span>), <span class="at">main=</span><span class="st">"Proportional Hazards for Two Groups, log scale"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">log</span>(lambda1), <span class="at">col=</span><span class="st">"Red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">log</span>(lambda[<span class="dv">0</span>] (t))), <span class="fu">expression</span>(<span class="fu">log</span>(lambda[<span class="dv">1</span>] (t)) <span class="sc">==</span> <span class="fu">log</span>(<span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">log</span>(lambda[<span class="dv">0</span>] (t)))), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"Black"</span>,<span class="st">"Red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Comments on plots</p>
<ul>
<li><p>Baseline hazard can follow any functional form. This is the “non-parametric” part of the Cox proportional hazards model</p></li>
<li><p>The cumulative hazard is a non-decreasing function that starts at 0 at time 0. It is bounded by <span class="math inline">\(\infty\)</span>.</p></li>
<li><p>Survival is a function of the cumulative hazard. Survival is 1 at time 0 and decreases over time. It is bounded by <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p></li>
<li><p>For a dichotomous predictor variable (X is 0 or 1), the proportional hazards assumption is that <span class="math inline">\(\lambda_1 (t) = e^{\beta_1} \lambda_0 (t)\)</span></p>
<ul>
<li><p>In the plots I illustrated <span class="math inline">\(e^{\beta_1} = 1.5\)</span> (<span class="math inline">\(\beta_1 = 0.4054\)</span>).</p></li>
<li><p>On the hazard scale, this corresponds to <span class="math inline">\(\lambda_1(t)\)</span> always being <span class="math inline">\(1.5\)</span> times larger than <span class="math inline">\(\lambda_0(t)\)</span>.</p></li>
<li><p>On the log hazard scale, this corresponds to <span class="math inline">\(log(\lambda_1(t))\)</span> always being <span class="math inline">\(log(1.5) = 0.4054\)</span> units larger than <span class="math inline">\(log(\lambda_0(t))\)</span>.</p></li>
<li><p>The proportional hazards assumption is the “parametric” part of the Cox proportional hazards model. Hence, the Cox proportional hazards model is referred to as being “semi-parametric”.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="software" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="software"><span class="header-section-number">4.4</span> Software</h3>
<ul>
<li><p>Stata commands</p>
<ul>
<li><p>“stset time event-indicator”</p></li>
<li><p>“stcox predictor, [robust]”</p></li>
</ul></li>
<li><p>R functions</p>
<ul>
<li><p>“Surv(time, event-indicator)”</p></li>
<li><p>“coxph(Surv(time, event-indicator) ~ predictor)”</p></li>
<li><p>There is a robust option in coxph for calcluating robust standard error estimates. In my opinion the assumption of proportional hazards in the Cox model rarely (never?) holds completely, so the robust option can be a good default.</p></li>
<li><p>Lin, D. Y., and L. J. Wei. “The Robust Inference for the Cox Proportional Hazards Model.” Journal of the American Statistical Association 84, no. 408 (1989): 1074–78. https://doi.org/10.2307/2290085.</p></li>
</ul></li>
</ul>
</section>
<section id="example-analysis" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="example-analysis"><span class="header-section-number">4.5</span> Example Analysis</h3>
<section id="descriptives" class="level4" data-number="4.5.1">
<h4 data-number="4.5.1" class="anchored" data-anchor-id="descriptives"><span class="header-section-number">4.5.1</span> Descriptives</h4>
<ul>
<li><p>Prognostic values of nadir PSA relative to time in remission</p>
<ul>
<li><p>PSA dataset: 50 men who received hormonal treatment for advanced prostate cancer</p></li>
<li><p>Followed at least 24 months for clinical progression, but exact followup varies from subject to subject</p></li>
<li><p>Nadir PSA: lowest level of serum prostate specific antigen achieved post treatment</p></li>
</ul></li>
<li><p>Scatterplots of censored data are not scientifically meaningful</p>
<ul>
<li><p>It is best to not generate them unless you do something to indicate the censored dataset</p></li>
<li><p>We can label censored data, but have to remember that the true value may be anywhere larger than that</p></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>psa <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(<span class="at">file=</span><span class="st">"data/psa.dta"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>nadirpsa <span class="ot">&lt;-</span> psa<span class="sc">$</span>dirpsa</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psa, <span class="fu">aes</span>(<span class="at">y=</span>obstime, <span class="at">x=</span>nadirpsa, <span class="at">color=</span>inrem)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Characterization of plot</p>
<ul>
<li><p>Outliers: Can’t tell</p></li>
<li><p>First order trends</p>
<ul>
<li><p>Downward trending slop</p></li>
<li><p>No censoring at high nadir PSAs (high nadir PSA are all early events)</p></li>
</ul></li>
<li><p>Second order trend: Must be curvilinear (but how much?)</p></li>
<li><p>Variability within groups: Highest variability within lowest PSA groups</p></li>
</ul></li>
</ul>
</section>
<section id="regression-model" class="level4" data-number="4.5.2">
<h4 data-number="4.5.2" class="anchored" data-anchor-id="regression-model"><span class="header-section-number">4.5.2</span> Regression model</h4>
<ul>
<li>The usual coding of the outcome is survival is 1 for an event and 0 for a censored observation.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create an indicator variable for those who relapsed at any time point</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>relapse <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(psa<span class="sc">$</span>inrem<span class="sc">==</span><span class="st">"no"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(psa, <span class="fu">table</span>(relapse, inrem))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">no</th>
<th style="text-align: center;">yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>0</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">14</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>1</strong></td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Create a relapse variable to indicate if a subject has relapsed or not</p></li>
<li><p>Define the outcome using “Surv(obstime, relapse)”</p>
<ul>
<li><p>obstime: Time to event (either time to relapse or time to censored)</p></li>
<li><p>relapse: Failure indicator variable</p></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(obstime, relapse) <span class="sc">~</span> nadirpsa, <span class="at">data=</span>psa, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>m1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Fitting Proportional Hazards Regression Model: Surv(obstime, relapse) ~ nadirpsa</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">coef</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">robust se</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>nadirpsa</strong></td>
<td style="text-align: center;">0.015717</td>
<td style="text-align: center;">1.0158</td>
<td style="text-align: center;">0.0036713</td>
<td style="text-align: center;">4.281</td>
<td style="text-align: center;">2e-05</td>
</tr>
</tbody>
</table>
<p>Likelihood ratio test=11.78 on 1 df, p=0.0005989028 n= 50, number of events= 36</p>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p>Call:</p>
<p>coxph(formula = Surv(obstime, relapse) ~ nadirpsa, data = psa, robust = TRUE)</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">n</th>
<th style="text-align: center;">number of events</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">50</td>
<td style="text-align: center;">36</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">coef</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">se(coef)</th>
<th style="text-align: center;">robust se</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>nadirpsa</strong></td>
<td style="text-align: center;">0.015717</td>
<td style="text-align: center;">1.0158</td>
<td style="text-align: center;">0.0037497</td>
<td style="text-align: center;">0.0036713</td>
<td style="text-align: center;">4.281</td>
<td style="text-align: center;">1.8609e-05</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">exp(-coef)</th>
<th style="text-align: center;">lower .95</th>
<th style="text-align: center;">upper .95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>nadirpsa</strong></td>
<td style="text-align: center;">1.0158</td>
<td style="text-align: center;">0.98441</td>
<td style="text-align: center;">1.0086</td>
<td style="text-align: center;">1.0232</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Concordance</th>
<th style="text-align: center;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.75706</td>
<td style="text-align: center;">0.03671</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">test</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Likelihood ratio test</strong></td>
<td style="text-align: center;">11.78</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Wald test</strong></td>
<td style="text-align: center;">18.33</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Score (logrank) test</strong></td>
<td style="text-align: center;">24.30</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Robust score test</strong></td>
<td style="text-align: center;">6.90</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>(Note: the likelihood ratio and score tests assume independence of observations within a cluster, the Wald and robust score tests do not).</p>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>nadirpsa</strong></td>
<td style="text-align: center;">1.0086</td>
<td style="text-align: center;">1.0232</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 10-unit change in nadir PSA</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m1)<span class="sc">*</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>nadirpsa 
1.170192 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">confint.default</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>nadirpsa</strong></td>
<td style="text-align: center;">1.0889</td>
<td style="text-align: center;">1.2575</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="interpretation-of-output" class="level4" data-number="4.5.3">
<h4 data-number="4.5.3" class="anchored" data-anchor-id="interpretation-of-output"><span class="header-section-number">4.5.3</span> Interpretation of output</h4>
<ul>
<li><p>By default, R gives the hazard ratio and the coefficient for comparing groups who differ by one unit in the nadir psa covariate</p>
<ul>
<li><span class="math inline">\(\textrm{Hazard ratio} = e^{\textrm{coeff}}\)</span></li>
</ul></li>
<li><p><span class="math inline">\(\textrm{Hazard ratio} = 1.015^{\Delta nadir}\)</span></p></li>
<li><p>Estimated hazard ratio for two groups differing by 1 in nadir PSA is found by exponentiating the slope</p>
<ul>
<li><p>Groups 1 unit higher nadir PSA have instantaneous event rate <span class="math inline">\(1.0157\)</span> fold higher (1.6% higher)</p></li>
<li><p>Groups 10 units higher nadir PSA have instantaneous event rate <span class="math inline">\(1.015^{10} = 1.166\)</span> fold higher (16.6% higher)</p></li>
</ul></li>
</ul>
</section>
<section id="robust-standard-errors" class="level4" data-number="4.5.4">
<h4 data-number="4.5.4" class="anchored" data-anchor-id="robust-standard-errors"><span class="header-section-number">4.5.4</span> Robust standard errors</h4>
<p>R allows for robust standard errors in the coxph function. Note that other functions for fitting Cox models in R may or may not have this functionality.</p>
<p>“From proportional hazards regression analysis, we estimate that for each 1 ng/ml unit difference in nadir PSA, this risk of relapse is <span class="math inline">\(1.6\%\)</span> higher in the group with the higher nadir PSA. This estimate is highly statistically significant (<span class="math inline">\(p &lt; 0.001\)</span>). A 95% CI suggests that this observation is not unusual if a group that has a 1 ng/ml higher nadir PSA might have risk of relapse that was anywhere from <span class="math inline">\(0.9\%\)</span> higher to <span class="math inline">\(2.3\%\)</span> higher than the group with lower nadir PSA.”</p>
</section>
</section>
<section id="inference-with-ph-regression" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="inference-with-ph-regression"><span class="header-section-number">4.6</span> Inference with PH Regression</h3>
<ul>
<li><p>The ideas of Signal and Noise found in simple linear regression do not translate well to PH regression</p>
<ul>
<li>We do not tend to quantify an error distribution with PH regression</li>
</ul></li>
<li><p>Valid statistical inference (CIs, p-values) about <em>associations</em> requires three general assumptions</p>
<ul>
<li><p>Assumptions about approximately Normal distributions for the parameter estimates</p>
<ul>
<li><p>Large N</p>
<ul>
<li><p>Need for either robust standard errors or classical regression</p></li>
<li><p>Definition of large depends on the underlying probability distribution</p></li>
</ul></li>
</ul></li>
<li><p>Assumptions about independence of observations</p>
<ul>
<li><p>Classical regression: Independence of all observation</p></li>
<li><p>Robust standard errors: Correlated observations within identified clusters</p></li>
</ul></li>
<li><p>Assumptions about variance of observations within groups</p>
<ul>
<li><p>Classical regression: Mean-variance relationship for binary data</p>
<ul>
<li><p>Proportional hazards considers the hazard of event at every time</p></li>
<li><p>Hence in order to satisfy this requirement, need proportional hazards and linearity of predictor</p></li>
</ul></li>
<li><p>Robust standard errors</p>
<ul>
<li><p>Allows unequal variance across groups</p></li>
<li><p>Hence, do not need linearity of predictor or proportional hazards</p></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Valid statistical inference (CIs, p-values) about <em>hazard of response in specific groups</em> requires a further assumption</p>
<ul>
<li><p>Assumption about the adequacy of the linear model</p>
<ul>
<li><p>If we are trying to borrow information about the log hazards from neighboring groups, and we are assuming a straight line relationship, the straight line needs to be true</p></li>
<li><p>Needed for either classical or robust standard errors</p></li>
<li><p>Note that we can model transformations of the measured predictor</p></li>
</ul></li>
</ul></li>
<li><p>We rarely make inference about within group survival probabilities using the proportional hazards model</p>
<ul>
<li><p>Sometimes estimated survival curves are used descriptively</p>
<ul>
<li><p>Use estimates of the baseline survival function</p></li>
<li><p>Exponentiate the baseline survival to find survival curve for specific covariate patterns</p></li>
</ul></li>
</ul></li>
<li><p>Relationship to survival</p>
<ul>
<li><p>Hazard function determines the survival function.</p></li>
<li><p>For the Cox model</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hazard</td>
<td style="text-align: left;"><span class="math inline">\(\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Cumulative Hazard</td>
<td style="text-align: left;"><span class="math inline">\(\Lambda(t | X_i) = \displaystyle\int^t_0 \lambda_{0}(u) \times e^{\beta_1 \times X_i} \ du\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Survival Function</td>
<td style="text-align: left;"><span class="math inline">\(S(t | X_i) = e^{-\Lambda(t|X_i)} = [S_0(t)]^{e^{\beta_1 \times X_i}}\)</span></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
<section id="log-transformed-nadir-psa" class="level4" data-number="4.6.1">
<h4 data-number="4.6.1" class="anchored" data-anchor-id="log-transformed-nadir-psa"><span class="header-section-number">4.6.1</span> Log-transformed nadir PSA</h4>
<ul>
<li><p>Suppose that you know based on prior experience or consultation with collaborators…</p>
<ul>
<li><p>A constant difference in PSA would not be expected to confer the same increased risk</p>
<ul>
<li>Comparing 4 ng/ml to 10 ng/ml is not the same as comparing 104 ng/ml to 110 ng/ml</li>
</ul></li>
<li><p>A multiplicative effect on risk might be better</p>
<ul>
<li><p>Same increase in risk for each doubling of nadir PSA</p></li>
<li><p>Achieve this model by using log transformed nadir PSA</p></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>lognadirpsa <span class="ot">&lt;-</span> <span class="fu">log</span>(psa<span class="sc">$</span>nadirpsa)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(obstime, relapse) <span class="sc">~</span> lognadirpsa, <span class="at">data=</span>psa, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>m2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Fitting Proportional Hazards Regression Model: Surv(obstime, relapse) ~ lognadirpsa</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">coef</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">robust se</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>lognadirpsa</strong></td>
<td style="text-align: center;">0.43724</td>
<td style="text-align: center;">1.5484</td>
<td style="text-align: center;">0.072861</td>
<td style="text-align: center;">6.001</td>
<td style="text-align: center;">2e-09</td>
</tr>
</tbody>
</table>
<p>Likelihood ratio test=24.01 on 1 df, p=9.601094e-07 n= 50, number of events= 36</p>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p>Call:</p>
<p>coxph(formula = Surv(obstime, relapse) ~ lognadirpsa, data = psa, robust = TRUE)</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">n</th>
<th style="text-align: center;">number of events</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">50</td>
<td style="text-align: center;">36</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 21%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">coef</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">se(coef)</th>
<th style="text-align: center;">robust se</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>lognadirpsa</strong></td>
<td style="text-align: center;">0.43724</td>
<td style="text-align: center;">1.5484</td>
<td style="text-align: center;">0.087699</td>
<td style="text-align: center;">0.072861</td>
<td style="text-align: center;">6.001</td>
<td style="text-align: center;">2e-09</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">exp(coef)</th>
<th style="text-align: center;">exp(-coef)</th>
<th style="text-align: center;">lower .95</th>
<th style="text-align: center;">upper .95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>lognadirpsa</strong></td>
<td style="text-align: center;">1.5484</td>
<td style="text-align: center;">0.64581</td>
<td style="text-align: center;">1.3424</td>
<td style="text-align: center;">1.7861</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Concordance</th>
<th style="text-align: center;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.75706</td>
<td style="text-align: center;">0.03671</td>
</tr>
</tbody>
</table>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">test</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Likelihood ratio test</strong></td>
<td style="text-align: center;">24.01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Wald test</strong></td>
<td style="text-align: center;">36.01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Score (logrank) test</strong></td>
<td style="text-align: center;">29.02</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Robust score test</strong></td>
<td style="text-align: center;">19.76</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>(Note: the likelihood ratio and score tests assume independence of observations within a cluster, the Wald and robust score tests do not).</p>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>lognadirpsa</strong></td>
<td style="text-align: center;">1.3424</td>
<td style="text-align: center;">1.7861</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Hazard ratio is <span class="math inline">\(1.55\)</span> for a <span class="math inline">\(e\)</span>-fold difference in nadir PSA (<span class="math inline">\(e = 2.7183\)</span>)</p></li>
<li><p>It is more easy to understand doubling, tripling, 5-fold, 10-fold increases</p>
<ul>
<li><p>For doubling: <span class="math inline">\(\textrm{HR} = 1.54^{log(2)} = 1.35\)</span></p></li>
<li><p>For 5-fold: <span class="math inline">\(\textrm{HR} = 1.54^{log(5)} = 1.99\)</span></p></li>
<li><p>Can similarly transform the upper and lower limits of the confidence interval</p></li>
</ul></li>
<li><p>The confidence interval and statistical test given in the output is called a Wald test. Other tests (Score, Likelihood Ratio) are also possible.</p>
<ul>
<li><p>All tests are asymptotically equivalent</p></li>
<li><p>The Wald test is easiest to obtain, but generally performs the poorest in small sample sizes. It is based on the coefficient estimate and standard error.</p></li>
<li><p>The Likelihood Ratio test performs the best in small samples. We will discuss it later, including how to obtain the test using post-estimation commands.</p></li>
<li><p>The Score test is not bad in small samples, but is often hard to obtain from software. It is exactly equal to the logrank test for binary outcomes and categorical predictors.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="review-interpretation-of-slopes" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="review-interpretation-of-slopes"><span class="header-section-number">4.7</span> Review: Interpretation of Slopes</h3>
<section id="additive-models" class="level4" data-number="4.7.1">
<h4 data-number="4.7.1" class="anchored" data-anchor-id="additive-models"><span class="header-section-number">4.7.1</span> Additive models</h4>
<ul>
<li>Identity link function</li>
</ul>
<div class="center">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Approach</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Means</td>
<td style="text-align: left;">Linear regression</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>Interpretation of non-transformed slope: <span class="math inline">\(\theta_X = \beta_0 + \beta_1 \times X\)</span></p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> : (Average) difference in summary measure between groups per 1 unit difference in <span class="math inline">\(X\)</span></p></li>
<li><p><span class="math inline">\(\Delta \times \beta_1\)</span> : (Average) difference in summary measure between groups per <span class="math inline">\(\Delta\)</span> unit difference in <span class="math inline">\(X\)</span></p></li>
</ul></li>
<li><p>Interpretation with log transformed slope: <span class="math inline">\(\theta_X = \beta_0 + \beta_1 \times \textrm{log}(X)\)</span></p>
<ul>
<li><span class="math inline">\(\textrm{log}(k) \times \beta_1\)</span> : (Average) difference in summary measure between groups per <span class="math inline">\(k\)</span>-fold difference in <span class="math inline">\(X\)</span></li>
</ul></li>
</ul>
</section>
<section id="multiplicative-models" class="level4" data-number="4.7.2">
<h4 data-number="4.7.2" class="anchored" data-anchor-id="multiplicative-models"><span class="header-section-number">4.7.2</span> Multiplicative models</h4>
<ul>
<li>Log link function</li>
</ul>
<div class="center">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Approach</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Geometric means</td>
<td style="text-align: left;">Linear regression on log scale</td>
</tr>
<tr class="even">
<td style="text-align: left;">Odds</td>
<td style="text-align: left;">Logistic regression</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rates</td>
<td style="text-align: left;">Poisson regression</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hazards</td>
<td style="text-align: left;">Proportional Hazards (Cox) regression</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>Interpretation of non-transformed slope: <span class="math inline">\(\textrm{log}(\theta_X) = \beta_0 + \beta_1 \times X\)</span></p>
<ul>
<li><p><span class="math inline">\(e^{\beta_1}\)</span> : (Average) ratio of summary measure between groups per 1 unit difference in <span class="math inline">\(X\)</span></p></li>
<li><p><span class="math inline">\(e^{\Delta \times \beta_1}\)</span> : (Average) ratio of summary measure between groups per <span class="math inline">\(\Delta\)</span> unit difference in <span class="math inline">\(X\)</span></p></li>
</ul></li>
<li><p>Interpretation with log transformed slope: <span class="math inline">\(\textrm{log}(\theta_X) = \beta_0 + \beta_1 \times \textrm{log}(X)\)</span></p>
<ul>
<li><span class="math inline">\(e^{\textrm{log}(k) \times \beta_1} = k^{\beta_1}\)</span> : (Average) ratio of summary measure between groups per <span class="math inline">\(k\)</span>-fold difference in <span class="math inline">\(X\)</span></li>
</ul></li>
</ul>
</section>
</section>
</section>
<section id="parametric-regression" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="parametric-regression"><span class="header-section-number">5</span> Parametric regression</h2>
<ul>
<li><p>Fully-parametric models are less common than the semi-parametric Cox model because they are less flexible</p></li>
<li><p>However, if they are a good fit to a particular dataset, they may</p>
<ul>
<li><p>Estimate fewer parameters</p></li>
<li><p>Allow for better predictions (as long as the error distribution is correctly specified!)</p></li>
<li><p>Allow for comparison of survival estimates rather than hazards (accelerated failure time)</p></li>
</ul></li>
<li><p>Two fundamental models used to describe the way that some factor might affect time to event</p>
<ul>
<li><p>Proportional hazards (aka Cox model)</p></li>
<li><p>Accelerated failure time (less popular)</p></li>
</ul></li>
<li><p>Accelerated Failure Time model</p>
<ul>
<li><p>Comparisons across groups based on survival times rather than hazards</p></li>
<li><p>Assume that a factor causes some subjects to spend their lifetime too fast</p></li>
<li><p>Basic idea: For every year in a reference group’s lives, the other group ages “k” years</p>
<ul>
<li><p>e.g.&nbsp;1 human year is about 7 dog years, so a 70 year old human is the same age as a 10 year old dog</p></li>
<li><p>In AFT terminology, the probability that a human survives beyond 70 years is the same as the probability that a dog survives beyond 10 years</p></li>
<li><p>From the framework, dogs are accelerating through life 7 times faster than a human. Equivalently, the lifespan of a human is stretched out to be 7 times longer than that of a dog.</p></li>
</ul></li>
<li><p>Assumes that ratios of quantiles of survival distribution are constant across groups</p>
<ul>
<li>e.g.&nbsp;report median ratios: It takes 50% longer for half of the treated group to die than half of the control group</li>
</ul></li>
<li><p>AFT models include the parametric exponential, Weibull, and lognormal models</p></li>
</ul></li>
</ul>
<section id="weibull-model" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="weibull-model"><span class="header-section-number">5.1</span> Weibull model</h3>
<ul>
<li><p>The Weibull model can also be interpreted as either a proportional hazard or accelerated failure time model. It is one of the few models that makes both the proportional hazards and accelerated failure time assumptions.</p></li>
<li><p>The Weibull model accommodates monotonically increasing or decreasing hazards</p></li>
<li><p>The following gives the relationship between the hazard function, Survival function, distribution function and cumulative distribution function for four different shape parameters following a Weibull distribution with scale parameter held constant at 2</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plot.data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, .<span class="dv">1</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">loc =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">F (CDF)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">pweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">f (PDF)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">S =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">F (CDF)</span><span class="st">`</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">h = f / S</span><span class="st">`</span> <span class="ot">=</span> flexsurv<span class="sc">::</span><span class="fu">hweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">loc =</span> <span class="fu">paste</span>(<span class="st">"shape:"</span>, loc)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>plot.data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">t=</span><span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, .<span class="dv">1</span>),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">loc=</span><span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plot.data2 <span class="ot">&lt;-</span> <span class="fu">with</span>(plot.data, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>(<span class="at">t=</span><span class="fu">rep</span>(t,<span class="dv">4</span>),</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">loc=</span><span class="fu">rep</span>(loc,<span class="dv">4</span>),</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">value=</span><span class="cn">NA</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">type=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">each=</span><span class="fu">nrow</span>(plot.data))))</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>] <span class="ot">&lt;-</span> </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>] <span class="ot">&lt;-</span> </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">-</span><span class="fu">pweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>] <span class="ot">&lt;-</span> </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  flexsurv<span class="sc">::</span><span class="fu">hweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot.data2<span class="sc">$</span>type, <span class="at">levels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"F (CDF)"</span>,<span class="st">"f (PDF)"</span>, <span class="st">"S = 1 - F"</span>, <span class="st">"h = f / S"</span> ))</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>loc2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"shape ="</span>, plot.data2<span class="sc">$</span>loc)</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data2, <span class="fu">aes</span>(<span class="at">x=</span>t, <span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(type <span class="sc">~</span> loc2, <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Weibull hazard and cumulative hazard at time <span class="math inline">\(t\)</span> with shape <span class="math inline">\(p\)</span> and scale <span class="math inline">\(\lambda\)</span> <span class="math inline">\((\lambda &gt; 0)\)</span></li>
</ul>
<p><span class="math display">\[h(t) = λpt^{(p−1)}\]</span></p>
<ul>
<li><p><span class="math inline">\(p\)</span> is a shape parameter</p>
<ul>
<li><p><span class="math inline">\(p&gt;1\)</span> is an increasing hazard over time</p></li>
<li><p><span class="math inline">\(p=1\)</span> is a constant hazard</p></li>
<li><p><span class="math inline">\(p&lt;1\)</span> is a decreasing hazard</p></li>
</ul></li>
<li><p>We can model the scale as a function of covariates</p></li>
</ul>
<p><span class="math display">\[\textrm{where } \lambda = \textrm{exp}(\beta_0 + \beta_1 X_1 + \ldots + \beta_p X_p)\]</span></p>
<ul>
<li><p>A special case of the Weibull model is the Exponential model. The Weibull reduces to the Exponential when the shape parameter is 1 (<span class="math inline">\(p=1\)</span>). A shape parameter of 1 assumes the hazard is constant over time, and the cumulative hazard increases linearly with time.</p>
<ul>
<li>This provides a method for checking if the Weibull can be reduced to an Exponential model. If we estimate the cumulative hazard without making parametric assumptions and plot versus time, we can see if it is increasing at a constant rate.</li>
</ul></li>
<li><p>Nelson-Aalen estimator of the cumulative hazard (non-parametric)</p></li>
</ul>
<p><span class="math display">\[\hat{H}(t)=\sum_{i:t_i\leq t}\frac{d_i}{n_i}\]</span></p>
<ul>
<li><p>where <span class="math inline">\(d_i\)</span> is the number of events at time <span class="math inline">\(t_i\)</span>, and <span class="math inline">\(n_i\)</span> is the number of individuals at risk just before time <span class="math inline">\(t_i\)</span></p></li>
<li><p>Apply this to the lung cancer dataset</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the non-parametric estimate of the cumulative hazard</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>n.risk <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>n.risk</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>n.evt <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>n.event</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>time</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cumulative hazard versus time</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>na.haz <span class="ot">&lt;-</span> n.risk<span class="sc">/</span>n.evt</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>na.cumhaz <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(na.haz)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time, na.cumhaz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Cumulative hazard is increasing over time, but not at a constant rate. The Weibull may be appropriate, but the Exponential is not appropriate.</li>
</ul>
</section>
<section id="weibull-example" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="weibull-example"><span class="header-section-number">5.2</span> Weibull example</h3>
<section id="compare-fit-of-weibull-parametric-to-kaplan-meier-non-parametric" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="compare-fit-of-weibull-parametric-to-kaplan-meier-non-parametric"><span class="header-section-number">5.2.1</span> Compare fit of Weibull (parametric) to Kaplan-Meier (non-parametric)</h4>
<ul>
<li>Is the Weibull model a reasonable fit to the observed survival estimates?</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung, <span class="at">dist =</span> <span class="st">"weibull"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>pct <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">98</span><span class="sc">/</span><span class="dv">100</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>ptime1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">sex=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">'quantile'</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">p=</span>pct)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ptime2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">sex=</span><span class="dv">2</span>), <span class="at">type=</span><span class="st">'quantile'</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">p=</span>pct)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier fit</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.sex, <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ptime1, <span class="dv">1</span><span class="sc">-</span>pct, <span class="at">col=</span><span class="dv">1</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ptime2, <span class="dv">1</span><span class="sc">-</span>pct, <span class="at">col=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>), </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">"Kaplan-Meier, Male"</span>,<span class="st">"Weibull, Male"</span>,<span class="st">"Kaplan-Meier, Female"</span>,<span class="st">"Weibull, Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec08.Survival_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-of-weibull-parameters" class="level4" data-number="5.2.2">
<h4 data-number="5.2.2" class="anchored" data-anchor-id="interpretation-of-weibull-parameters"><span class="header-section-number">5.2.2</span> Interpretation of Weibull parameters</h4>
<ul>
<li><p>The Weibull model is both a proportional hazards and accelerated failure time model</p></li>
<li><p>How the model is parameterized will either give a proportional hazards or accelerated failure time interpretation</p>
<ul>
<li><p>For the Weibull proportional hazards model with one covariate (<span class="math inline">\(X\)</span>)</p>
<p><span class="math display">\[
h(t) = \lambda p t^{p-1}
\]</span></p>
<p><span class="math display">\[
\lambda = \textrm{exp}(\beta_0 + \beta_1 X)
\]</span></p></li>
<li><p>For the Weibull accelerated failure time model with one covariate (<span class="math inline">\(X\)</span>)</p>
<p><span class="math display">\[
S(t) = exp(-\lambda t^p)
\]</span></p>
<p>Solve for <span class="math inline">\(t\)</span></p>
<p><span class="math display">\[
t = (-\textrm{ln} S(t))^{1/p} \times \frac{1}{\lambda^{1/p}}
\]</span></p>
<p><span class="math display">\[
\frac{1}{\lambda^{1/p}} = \textrm{exp}(\alpha_0 + \alpha_1 X)
\]</span></p></li>
</ul></li>
<li><p>R ‘survreg’ default is to give the accelerate failure time parameterization. The acceleration factor (time ratio) is found by exponentiation of the slope as we have done with other models</p></li>
<li><p>Compare to males, females have survival quantiles that are 1.48 larger than males. That is median survival time, 25th percentile of survival time, or quantile of survival time is 1.48 times larger in females.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p>Call:</p>
<p>survreg(formula = Surv(time, status) ~ sex, data = lung, dist = “weibull”)</p>
<table class="caption-top table table-sm table-striped small">
<caption>Model statistics</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">5.48858</td>
<td style="text-align: center;">0.179029</td>
<td style="text-align: center;">30.6574</td>
<td style="text-align: center;">0.0000e+00</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>sex</strong></td>
<td style="text-align: center;">0.39558</td>
<td style="text-align: center;">0.127649</td>
<td style="text-align: center;">3.0989</td>
<td style="text-align: center;">1.9421e-03</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Log(scale)</strong></td>
<td style="text-align: center;">-0.28092</td>
<td style="text-align: center;">0.061918</td>
<td style="text-align: center;">-4.5370</td>
<td style="text-align: center;">5.7073e-06</td>
</tr>
</tbody>
</table>
<p>Scale= 0.755088</p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Loglik.model.</th>
<th style="text-align: center;">Loglik.intercept.only.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">-1148.7</td>
<td style="text-align: center;">-1153.9</td>
</tr>
</tbody>
</table>
<p>Chisq= 10.399 on 1 degrees of freedom, p= 0.0013</p>
<p>Number of Newton-Raphson Iterations: <em>5</em></p>
<p>n= 228</p>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         sex 
 241.914353    1.485242 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(fit2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">170.3223</td>
<td style="text-align: center;">343.5989</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>sex</strong></td>
<td style="text-align: center;">1.1565</td>
<td style="text-align: center;">1.9074</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 25th, 50th, and 75th percentiles of survival time in males</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ptime1[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 140.2460 272.4383 459.8036</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 25th, 50th, and 75th percentiles of survival time in females</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>ptime2[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 208.2993 404.6370 682.9198</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratios is constant (accelerated failure-time assumption)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ptime2[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)] <span class="sc">/</span> ptime1[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.485242 1.485242 1.485242</code></pre>
</div>
</div>
<ul>
<li>To obtain the hazard ratio interpretation, the Weibull model needs to be reparameterized so the output coefficients can be directly interpreted.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ConvertWeibull</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$vars
            Estimate           SE
lambda  0.0006969478 0.0003786395
gamma   1.3243489259 0.0820015808
sex    -0.5238833093 0.1667827835

$HR
           HR        LB        UB
sex 0.5922163 0.4270853 0.8211947

$ETR
         ETR       LB       UB
sex 1.485242 1.156491 1.907447</code></pre>
</div>
</div>
<ul>
<li><p>Hazard ratio (females compared to males) is 0.592</p>
<ul>
<li>Females have decreased hazard of death at all time point. Hazard of death in females divided by the hazard of death in males is 0.592 at all time points (proportional hazards)</li>
</ul></li>
<li><p>Summary interpretation of both PH and AFT</p></li>
</ul>
<p>From the Weibull regression model, we can estimate both the hazard ratio and acceleration factor.</p>
<p>Comparing females to males, females have a 0.59 fold hazard (risk) of death compared to males. We are 95% confident the true hazard ratio is between a 0.43 and 0.82 fold increase. Since the hazard ratio does not contain 1, females are at a significantly decreased hazard of death compared to males.</p>
<p>Comparing females to males, females have a median (or any other quantile) survival time that is 1.49 fold larger than the median (or other quantile) survival time in males. We are 95% confident that the true acceleration factor (time ratio) is between 1.16 and 1.91.</p>
<p>The statements are more awkward when the hard ratio is less than 1. We could flip the estimates (e.g <span class="math inline">\(0.5922^{-1}\)</span>) and say that the males have a 1.69 fold increased hazard (risk) of death compared to females.</p>
<ul>
<li>Note that a hazard ratio greater than one is harmful for survival while an acceleration factor (time ratio) greater than one is beneficial for survival. One is the null values for both interpretations.</li>
</ul>
</section>
</section>
<section id="other-parametric-models" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="other-parametric-models"><span class="header-section-number">5.3</span> Other parametric models</h3>
<ul>
<li><p>Example shown here focused on a Weibull model as an introduction. We identified the Exponential distribution (a special case of the Weibull) is not a good fit.</p></li>
<li><p>Other (parametric) distributions are possible. Some have a proportional hazards interpretation (only) or an accelerated failure time interpretation (only). Other lack either of these interpretations, but are more flexible in how they model the hazard function. There is a trade-off between interpretability and flexibility.</p></li>
<li><p>Goal is to pick a distribution with a corresponding hazard (cumulative hazard) that is appropriate model for your data, will be reproducible, and is ultimately interpretable.</p></li>
<li><p>Cox model is a good choice if you want to model associations and not concern yourself with the shape of the hazard function. This is a very common situation and why the Cox model is widely used.</p></li>
<li><p>If goal is prediction, appropriate parametric models (perhaps with additional flexibility) may outperform the Cox model</p></li>
</ul>
</section>
</section>
<section id="bayesian-time-to-event-models" class="level2 page-columns page-full" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="bayesian-time-to-event-models"><span class="header-section-number">6</span> Bayesian Time to Event Models</h2>
<ul>
<li><p>Bayesian approaches to fitting survival models are often based on parametric approaches or approaches that attempt to mimic the Cox model</p>
<ul>
<li><p>It is relatively straight forward to fit Bayesian models using parametric distributions like Weibull</p></li>
<li><p>Models that attempt to recreate a Cox-like models are more complex because it can be difficult to recreate the flexibility of the baseline hazard function needed</p></li>
</ul></li>
</ul>
<section id="review-bayesian-analysis" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="review-bayesian-analysis"><span class="header-section-number">6.1</span> Review: Bayesian Analysis</h3>
<ul>
<li><p>The Bayesian Paradigm provides a framework for incorporating prior knowledge with observed data through the use of probability models. In this approach:</p></li>
<li><p><strong>Posterior distribution</strong> is obtained by combining:</p>
<ol type="1">
<li>The <strong>Likelihood</strong>: <span class="math inline">\(L(\mathbf{\theta}; \mathbf{x})\)</span>, representing the probability of the observed data <span class="math inline">\(\mathbf{x}\)</span> given the model parameters <span class="math inline">\(\mathbf{\theta}\)</span>.</li>
<li>The <strong>Prior Distribution</strong>: <span class="math inline">\(\pi(\mathbf{\theta})\)</span>, reflecting prior beliefs or information about <span class="math inline">\(\mathbf{\theta}\)</span>.</li>
</ol></li>
<li><p>Mathematically, the posterior distribution is expressed as:</p></li>
</ul>
<p><span class="math display">\[
p(\mathbf{\theta} \mid \text{data}) \propto L(\mathbf{\theta}; \mathbf{x}) \cdot \pi(\mathbf{\theta})
\]</span></p>
<ul>
<li>This illustrates the key Bayesian principle: beliefs about <span class="math inline">\(\mathbf{\theta}\)</span> (the <strong>posterior distribution</strong>) are updated by combining new evidence (the <strong>likelihood</strong>) with prior knowledge (the <strong>prior distribution</strong>).</li>
</ul>
</section>
<section id="review-linear-regression" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="review-linear-regression"><span class="header-section-number">6.2</span> Review: Linear Regression</h3>
<ul>
<li><p>The Bayesian paradigm can be applied to the linear regression model, where the parameters of interest, <span class="math inline">\(\boldsymbol{\theta} = (\boldsymbol{\beta}, \sigma)\)</span>, consist of:</p>
<ul>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span>: The regression coefficients (bold to emphasize their vector nature).</li>
<li><span class="math inline">\(\sigma\)</span>: The standard deviation of the residuals, representing the variability not explained by the model.</li>
</ul></li>
</ul>
<section id="likelihood" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="likelihood"><span class="header-section-number">6.2.1</span> Likelihood</h4>
<ul>
<li><p>In classical linear regression, the <strong>Likelihood</strong> <span class="math inline">\(L(\boldsymbol{\theta}; \mathbf{x})\)</span> is modeled as a Normal distribution with mean <span class="math inline">\(\mathbf{X} \boldsymbol{\beta}\)</span> and variance <span class="math inline">\(\sigma^2\)</span>, where <span class="math inline">\(\mathbf{X}\)</span> is the design matrix of predictors.</p></li>
<li><p>The likelihood can be expressed as a product of individual likelihoods for each data point <span class="math inline">\(i\)</span>, given by:</p></li>
</ul>
<p><span class="math display">\[
L(\boldsymbol{\theta}; \mathbf{x}) = \prod_{i=1}^n L_i(\boldsymbol{\theta}; \mathbf{x}_i)
\]</span></p>
<ul>
<li>For classical linear regression (assuming a Normal distribution) this becomes:</li>
</ul>
<p><span class="math display">\[
L(\boldsymbol{\theta}; \mathbf{y}, \mathbf{X}) = \prod_{i=1}^n \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( -\frac{(y_i - \mathbf{x}_i^\top \boldsymbol{\beta})^2}{2 \sigma^2} \right)
\]</span></p>
<ul>
<li><span class="math inline">\(y_i\)</span>: Observed outcome for the <span class="math inline">\(i\)</span>-th data point</li>
<li><span class="math inline">\(\mathbf{x}_i^T\)</span>: Row vector of predictors for the <span class="math inline">\(i\)</span>-th data point.</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span>: Coefficients for the predictors</li>
<li><span class="math inline">\(\sigma^2\)</span>: Variance of the residuals.</li>
</ul>
</section>
<section id="prior-distributions" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="prior-distributions"><span class="header-section-number">6.2.2</span> Prior Distributions</h4>
<p>In the Bayesian framework, prior distributions are assigned to the parameters of interest to reflect prior beliefs or knowledge about their values before observing the data. For Bayesian linear regression, typical priors (but not the only priors) include:</p>
<ul>
<li><p><strong>For</strong> <span class="math inline">\(\boldsymbol{\beta}\)</span>: A multivariate Normal distribution: <span class="math display">\[
\pi(\boldsymbol{\beta}) \sim \mathcal{N}(\boldsymbol{\mu}_\beta, \mathbf{\Sigma}_\beta)
\]</span> where <span class="math inline">\(\boldsymbol{\mu}_\beta\)</span> is the mean vector and <span class="math inline">\(\mathbf{\Sigma}_\beta\)</span> is the covariance matrix, encoding the prior beliefs about <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p></li>
<li><p><strong>For</strong> <span class="math inline">\(\sigma\)</span>: An exponential distribution: <span class="math display">\[
\pi(\sigma) \sim \text{Exponential}(\lambda)
\]</span> where <span class="math inline">\(\lambda\)</span> is a rate parameter. In <strong>rstanarm</strong> and <strong>stan_glm</strong>, <span class="math inline">\(\lambda\)</span> is weakly informative and scaled based on the data, often reflecting the standard deviation of the outcome variable.</p></li>
</ul>
</section>
<section id="posterior-distribution" class="level4" data-number="6.2.3">
<h4 data-number="6.2.3" class="anchored" data-anchor-id="posterior-distribution"><span class="header-section-number">6.2.3</span> Posterior distribution</h4>
<ul>
<li><p>These priors, combined with the likelihood, form the basis for the posterior distribution, which is proportional to the product of the likelihood and the priors.</p></li>
<li><p>This model encodes several key assumptions:</p>
<p>1 <strong>Linearity</strong>: The relationship between the predictors and the outcome is linear, expressed as the expected value <span class="math inline">\(\mathbb{E}[Y] = \mathbf{X} \boldsymbol{\beta}\)</span>.</p>
<p>2 <strong>Homoskedasticity</strong>: The variance of the residuals <span class="math inline">\(\text{Var}(\varepsilon_i) = \sigma^2\)</span> is constant across all levels of the predictors.</p>
<p>3 <strong>Normality of the residuals</strong>: <span class="math inline">\(\epsilon_i \sim N(0, \sigma^2)\)</span></p></li>
</ul>
</section>
</section>
<section id="review-logistic-regression" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="review-logistic-regression"><span class="header-section-number">6.3</span> Review: Logistic Regression</h3>
<ul>
<li><p>The Bayesian Paradigm can be applied to the logistic regression model, where the parameters of interest are <span class="math inline">\(\boldsymbol{\theta} = \boldsymbol{\beta}\)</span>,</p></li>
<li><p>In logistic regression, the Bayesian approach models the probability of a binary outcome <span class="math inline">\(y_i \in \{0, 1\}\)</span> as a function of the predictors <span class="math inline">\(\mathbf{x}_i\)</span> and the regression coefficients <span class="math inline">\(\boldsymbol{\beta}\)</span>. The likelihood for the observed data is expressed as:</p></li>
</ul>
<p><span class="math display">\[
L(\boldsymbol{\beta}; \mathbf{y}, \mathbf{X}) = \prod_{i=1}^n \left( \pi_i \right)^{y_i} \left( 1 - \pi_i \right)^{1 - y_i}
\]</span></p>
<ul>
<li><span class="math inline">\(\pi_i = \text{logit}^{-1}(\mathbf{x}_i^\top \boldsymbol{\beta}) = \frac{\exp(\mathbf{x}_i^\top \boldsymbol{\beta})}{1 + \exp(\mathbf{x}_i^\top \boldsymbol{\beta})}\)</span></li>
<li><span class="math inline">\(y_i\)</span>: Observed binary outcome for the <span class="math inline">\(i\)</span>-th data point.</li>
<li><span class="math inline">\(\mathbf{x}_i^\top\)</span>: Row vector of predictors for the <span class="math inline">\(i\)</span>-th data point.</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span>: Regression coefficients.</li>
</ul>
<p>This likelihood serves as the basis for updating the posterior distribution when combined with appropriate prior distributions on <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p>
<ul>
<li>See <a href="../notes/Lec04.Logistic.html#sec-bayeslogistic">Logistic Regression Notes</a> for additional details</li>
</ul>
</section>
<section id="bayesian-parametric-survival-analysis" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="bayesian-parametric-survival-analysis"><span class="header-section-number">6.4</span> Bayesian Parametric Survival Analysis</h3>
<ul>
<li><p>The Bayesian approach to parametric survival models follow a similar procedure to linear and logistic regression</p>
<ul>
<li><p>A likelihood is specified based on the assumed underlying probability distribution</p></li>
<li><p>Prior distributions are specified for the parameters in the model</p></li>
<li><p>The posterior distribution is updated combining the likelihood and the prior</p></li>
</ul></li>
</ul>
<section id="example-weibull-model-bayesian-approach" class="level4" data-number="6.4.1">
<h4 data-number="6.4.1" class="anchored" data-anchor-id="example-weibull-model-bayesian-approach"><span class="header-section-number">6.4.1</span> Example: Weibull model, Bayesian approach</h4>
<ul>
<li><p>Suppose we assume a Weibull distribution for survival time. The parameters of interest, <span class="math inline">\(\boldsymbol{\theta}\)</span>, typically include:</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\beta}\)</span>: Regression coefficients for covariates (bold to emphasize their vector nature) to impact the scale parameter of the Weibull distribution</p></li>
<li><p><span class="math inline">\(p\)</span>: Shape parameter of the Weibull distribution.</p></li>
</ul></li>
</ul>
<p>The likelihood for the observed survival data <span class="math inline">\((t_i, \delta_i)\)</span> is expressed as:</p>
<p><span class="math display">\[
L(\boldsymbol{\theta}; \mathbf{t}, \boldsymbol{\delta}) = \prod_{i=1}^n \left[h(t_i; \lambda, p)^{\delta_i} \cdot S(t_i; \lambda, p)^{1 - \delta_i}\right],
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(t_i\)</span>: Survival time for the <span class="math inline">\(i\)</span>-th individual.</p></li>
<li><p><span class="math inline">\(\delta_i\)</span>: Censoring indicator, where <span class="math inline">\(\delta_i = 1\)</span> if the event is observed and <span class="math inline">\(\delta_i = 0\)</span> if the data is censored.</p></li>
<li><p><span class="math inline">\(\mathbf{t}\)</span> and <span class="math inline">\(\boldsymbol{\delta}\)</span>: Vectors of survival times and censoring indicators.</p></li>
<li><p><span class="math inline">\(\lambda = \exp(\mathbf{X}\boldsymbol{\beta})\)</span>: Scale parameter is modeled as a function of covariates</p></li>
</ul>
</section>
<section id="prior-distributions-1" class="level4" data-number="6.4.2">
<h4 data-number="6.4.2" class="anchored" data-anchor-id="prior-distributions-1"><span class="header-section-number">6.4.2</span> Prior Distributions</h4>
<ul>
<li><p>In the Bayesian framework, prior distributions are assigned to the model parameters:</p></li>
<li><p><strong>For <span class="math inline">\(\boldsymbol{\beta}\)</span></strong>: A multivariate Normal distribution: <span class="math display">\[
\pi(\boldsymbol{\beta}) \sim \mathcal{N}(\boldsymbol{\mu}_\beta, \mathbf{\Sigma}_\beta),
\]</span> where <span class="math inline">\(\boldsymbol{\mu}_\beta\)</span> is the mean vector and <span class="math inline">\(\mathbf{\Sigma}_\beta\)</span> is the covariance matrix.</p></li>
<li><p><strong>For <span class="math inline">\(p\)</span></strong>: Weakly informative prior, such as Gamma distributions or other appropriate priors based on prior knowledge.</p></li>
<li><p>These priors combined with the likelihood provide the posterior distribution used for inference.</p></li>
</ul>
</section>
</section>
<section id="bayesian-cox-type-models-for-time-to-event-data" class="level3 page-columns page-full" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="bayesian-cox-type-models-for-time-to-event-data"><span class="header-section-number">6.5</span> Bayesian Cox-type Models for Time to Event Data</h3>
<ul>
<li><p>There is no direct analog of the Cox model in the Bayesian paradigm. The reason for this relates to the partial likelihood.</p></li>
<li><p>Cox models are estimated by maximizing the partial likelihood, which does not include the baseline hazard function</p></li>
</ul>
<p>The partial likelihood for the Cox model is given by:</p>
<p><span class="math display">\[
L_p(\boldsymbol{\beta}) = \prod_{i:\delta_i=1} h_0(t_i) \exp(\mathbf{x}_i^\top \boldsymbol{\beta}) \Bigg/ \sum_{j \in R(t_i)} h_0(t_i) \exp(\mathbf{x}_j^\top \boldsymbol{\beta}),
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(h_0(t_i)\)</span>: Baseline hazard function at time <span class="math inline">\(t_i\)</span>.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\beta}\)</span>: Regression coefficients.</p></li>
<li><p><span class="math inline">\(\mathbf{x}_i\)</span>: Covariates for the <span class="math inline">\(i\)</span>-th individual.</p></li>
<li><p><span class="math inline">\(R(t_i)\)</span>: Risk set at time <span class="math inline">\(t_i\)</span>, i.e., individuals still at risk just before time <span class="math inline">\(t_i\)</span>.</p></li>
</ul>
<p>The baseline hazard cancels out, so the partial likelihood simplifies to:</p>
<p><span class="math display">\[
L_p(\boldsymbol{\beta}) = \prod_{i:\delta_i=1} \frac{\exp(\mathbf{x}_i^\top \boldsymbol{\beta})}{\sum_{j \in R(t_i)} \exp(\mathbf{x}_j^\top \boldsymbol{\beta})}.
\]</span></p>
<ul>
<li><p>Key point: In a frequentist analysis, <span class="math inline">\(\beta\)</span> is maximized irrespective of the baseline hazard</p></li>
<li><p>In a Bayesian analysis, the unspecified baseline hazard function <span class="math inline">\(h_0(t)\)</span> cannot be ignored. An additional approach is required to estimate the baseline hazard alongside <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p></li>
<li><p>Methods often involve modeling the baseline hazard explicitly, such as using splines or piecewise constant functions. Alternatively, latent processes can allow flexible modeling and full Bayesian inference.</p>
<ol type="1">
<li><strong>Piecewise Exponential Model</strong>: The time axis is divided into predefined intervals, and the baseline hazard is assumed to be constant within each interval. This approach offers flexibility while maintaining computational simplicity.</li>
</ol></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_time =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_time =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">0.8</span>, <span class="fl">0.3</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> from_time, <span class="at">xend =</span> to_time, <span class="at">y =</span> hazard, <span class="at">yend =</span> hazard))  <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Hazard"</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">1.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-piecewise-exponential" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-piecewise-exponential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Lec08.Survival_files/figure-html/fig-piecewise-exponential-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-piecewise-exponential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Piecewise Exponential Hazard Function
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><strong>Spline-Based Methods</strong>: The baseline hazard is modeled using splines, such as cubic splines or B-splines, allowing for a smooth and flexible representation of the hazard function over time.</li>
</ol>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time points and a base positive hazard function (example)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>time_points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>base_hazard <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time_points <span class="sc">-</span> <span class="fl">0.1</span> <span class="sc">*</span> time_points<span class="sc">^</span><span class="dv">2</span>)  <span class="co"># Ensure hazards are positive</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(time_points), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.05</span>))  <span class="co"># Add positive noise</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>hazard_values <span class="ot">&lt;-</span> base_hazard <span class="sc">+</span> noise</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a cubic spline to the hazard function</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>spline_fit <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(time_points, hazard_values)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for plotting the spline</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>spline_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> spline_fit<span class="sc">$</span>x,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> spline_fit<span class="sc">$</span>y</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the spline-based hazard function</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> spline_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard)) <span class="sc">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Hazard"</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>)  <span class="co"># Set y-axis lower bound to 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-spline-hazard" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-spline-hazard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Lec08.Survival_files/figure-html/fig-spline-hazard-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-spline-hazard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Spline-Based Hazard Function
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p><strong>Dirichlet Process Priors</strong>: The baseline hazard is modeled nonparametrically using a Dirichlet process prior. This approach provides flexibility in estimating the hazard function by letting the data inform its shape, while still incorporating prior beliefs.</p></li>
<li><p><strong>Others</strong>: Machine learning and other approaches</p></li>
</ol>
</section>
<section id="r-related-software-for-bayesian-survival-analysis" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="r-related-software-for-bayesian-survival-analysis"><span class="header-section-number">6.6</span> R-Related Software for Bayesian Survival Analysis</h3>
<p>There are several R packages that support Bayesian survival analysis.</p>
<ul>
<li><p><strong><code>stan_surv</code> in <code>rstanarm</code></strong>:</p>
<ul>
<li><p>This function implements Bayesian survival analysis using flexible parametric models. It can handle a variety of survival models, including those with user-specified baseline hazard functions</p></li>
<li><p>It is currently (March, 2025) available in the development version of <code>rstanarm</code>, so I am not demonstrating it.</p></li>
<li><p><a href="https://stan-dev.r-universe.dev/articles/rstanarm/surv.html">Estimating Survival (Time-to-Event) Models with rstanarm</a></p></li>
</ul></li>
<li><p><strong><code>brms</code></strong></p>
<ul>
<li><p>The <code>brms</code> package allows for Bayesian survival models using flexible formula syntax</p></li>
<li><p>Supports parametric survival distributions and can be used to specify custom hazard models.</p></li>
<li><p><a href="https://paul-buerkner.github.io/brms/">Bayesian Regression Models using STAN</a></p></li>
</ul></li>
<li><p>Both packages are use-friendly front ends for <a href="https://mc-stan.org/">Stan: Software for Bayesian Analysis</a></p></li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/chrissl789\.github\.io\/modern-regression\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/Set6.pdf" class="pagination-link" aria-label="Weighted Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Weighted Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/Lec09.Poisson.html" class="pagination-link" aria-label="Poisson Regression">
        <span class="nav-page-text">Poisson Regression</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb47" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Introduction to Survival Analysis"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Lecture 08"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="an">name:</span><span class="co"> Lec08.Survival.qmd</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(eha)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SurvRegCensCov)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">source</span>(<span class="st">'pander_registry.R'</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">invisible</span>(e))</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgments</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>Parts of the introductory material are borrowed from Emily Zabor's <span class="co">[</span><span class="ot">introduction to survival analysis in R</span><span class="co">](https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html)</span>.</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>In logistic regression, we were interested in studying how risk factors were associated with presence or absence of disease. Sometimes, though, we are interested in how a risk factor or treatment affects time to disease or some other event. Or we may have study dropout, and therefore subjects who we are not sure if they had disease or not. In these cases, logistic regression is not appropriate.</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>Survival analysis is used to analyze data in which the time until the event is of interest. The response is often referred to as a failure time, survival time, or event time.</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a><span class="fu">### Examples</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time from randomization until cardiovascular death after some treatment intervention</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time from diagnosis until tumor recurrence</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time from diagnosis until AIDS for HIV patients</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time from production until a machine part fails</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that there needs to be a clearly defined starting and ending point</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a><span class="fu">### The survival time response</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Usually continuous</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>May be incompletely determined for some subjects</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>i.e. For some subjects we may know that their survival time was at least equal to some time t. Whereas, for other subjects, we will know their exact time of event.</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Incompletely observed responses are *censored*</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time is always $&gt;0$</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis issues</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If there is no censoring, standard regression procedures could be used</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>However, these may be inadequate because</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Time to event is restricted to be positive and has a skewed distribution.</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The probability of surviving past a certain point in time may be of more interest than the expected time of event. Linear regression models means.</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A multiplicative model for the hazard may be a better fit</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>May desire an interpretation that is similar to a relative risk</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="fu">### Censoring</span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>Censoring is present when we have some information about a subject's event time, but we don't know the exact event time. For the analysis methods we will discuss to be valid, censoring mechanism must be independent of the survival mechanism.</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>There are generally three reasons why censoring might occur:</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A subject does not experience the event before the study ends</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A person is lost to follow-up during the study period</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A person withdraws from the study</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>These are all examples of right-censoring.</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="al">![Trial Anatomy](figures/trial_anatomy.png)</span></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; RICH JT, NEELY JG, PANIELLO RC, VOELKER CCJ, NUSSENBAUM B, WANG EW. A PRACTICAL GUIDE TO UNDERSTANDING KAPLAN-MEIER CURVES. Otolaryngology head and neck surgery: official journal of American Academy of Otolaryngology Head and Neck Surgery. 2010;143(3):331-336. doi:10.1016/j.otohns.2010.05.007.</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>To illustrate the impact of censoring, suppose we have the following data:</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r swimmer, echo = FALSE}</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a><span class="in"># make fake data</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(20180809)</span></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a><span class="in">fkdt &lt;- tibble(Subject = as.factor(1:10), </span></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a><span class="in">                   Years = sample(4:20, 10, replace = T),</span></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a><span class="in">                   censor = sample(c("Censor", rep("Event", 2)), 10, </span></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="in">                                   replace = T)) </span></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a><span class="in"># plot with shapes to indicate censoring or event</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fkdt, aes(Subject, Years)) + </span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat = "identity", width = 0.5) + </span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(data = fkdt, </span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(Subject, Years, color = censor, shape = censor), </span></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a><span class="in">               size = 6) +</span></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_flip() +</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal() + </span></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.title = element_blank(),</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = "bottom")</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a>How would we compute the proportion who are event-free at 10 years?</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Subjects 6 and 7 were **event-free at 10 years**.</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Subjects 2, 9, and 10 had the **event before 10 years**.</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Subjects 1, 3, 4, 5, and 8 were **censored before 10 years**, so we don't know whether they had the event or not at 10 years. But we know something about them - that they were each followed for a certain amount of time without the event of interest prior to being censored.</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>*Survival analysis techniques provide a way to appropriately account for censored patients in the analysis.*</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of right-censoring</span></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fixed type I censoring occurs when a study is designed to end after C years of follow-up. In this case, everyone who does not have an event observed during the course of the study is censored at C years.</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In random type I censoring, the study is designed to end after C years, but censored subjects do not all have the same censoring time. This is the main type of right-censoring we will be concerned with.</span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In type II censoring, a study ends when there is a pre- specified number of events.</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>Regardless of the type of censoring, we must assume that it is non-informative about the event; that is, the censoring is caused by something other than the impending failure.</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a><span class="fu">### Terminology and notation</span></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$T$ denotes the response variable, $T &gt; 0$</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The survival function is</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>S(t) = \textrm{Pr}(T &gt; t) = 1− F(t)</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Example survival function.  Survival is 1 at time 0 and decreases over time.</span></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cf">function</span>(t) <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>t), <span class="dv">0</span>, <span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>, <span class="at">xlab=</span><span class="st">"Time (years)"</span>)</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All subjects are at risk (and event free) at time 0. Thus, the survival estimate at 0 is always 1</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Survival decreases over time. If we observe for a long enough period of time, survival eventually decreases to 0.</span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The survival function gives the probability that a subject will survive past time t.</span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Specifically, as t ranges from 0 to $\infty$, the survival function has the following properties</span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is non-increasing</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>At time t = 0, S(t) = 1. In other words, the probability of surviving past time 0 is 1.</span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>At time $t = \infty$, $S(t) = S(\infty) = 0$. As time goes to infinity, the survival curve goes to 0.</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In theory, the survival function is smooth. In practice, we observe events on a discrete time scale (days, weeks, etc.)</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Hazard, cumulative hazard, and survival</span></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The hazard function, h(t), is the instantaneous rate at which events occur, given no previous events. $$</span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>    h(t) = \lim_{{\Delta t} \to 0} \frac{P(t \leq T &lt; t + \Delta t | T \geq t)}{\Delta t}</span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$T$ is a random variable denoting the time until the event (for example, failure or death) occurs. The numerator in the fraction is the conditional probability that the event occurs in the small time interval $<span class="co">[</span><span class="ot">t, t + Δt</span><span class="co">]</span>$ given that it has not occurred before time $t$. The denominator $\Delta t$ is the length of this time interval. As $\Delta t$ goes to 0, this ratio gives the instantaneous rate of occurrence of the event at time $t$, which is the hazard function $h(t)$.</span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The cumulative hazard</span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a>H(t) = \int_{0}^{t} h(u) du</span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Here, h(u) is the hazard function and u is the variable of integration. This integral represents the accumulated risk of the event (for example, failure or death) over the time interval $<span class="co">[</span><span class="ot">0, t</span><span class="co">]</span>$.</span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The relationship between the survival function $S(t)$ and the cumulative hazard function $H(t)$</span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a>S(t) = \exp(-H(t))</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Key point: Survival function, cumulative hazard function, and hazard function are interconnected. If we know any one of the functions $S(t)$, $H(t)$, or $h(t)$, we can derive the other two functions.</span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outcome definition</span></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To analyze survival data, we need to know the observed time $Y_i$ and the event indicator $\delta_i$. For subject $i$:</span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Observed time $Y_i = \min(T_i, C_i)$ where $T_i$ = event time and $C_i$ = censoring time</span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Event indicator $\delta_i$ = 1 if event observed (i.e. $T_i \leq C_i$), = 0 if censored (i.e. $T_i &gt; C_i$)</span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a><span class="fu">## Non-parametric estimation of the survival curve</span></span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In theory the survival function is smooth; in practice we observe events on a discrete time scale.</span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **survival probability** at a certain time, $S(t)$, is a conditional probability of surviving beyond that time, given that an individual has survived just prior to that time. The survival probability can be estimated as the number of patients who are alive without loss to follow-up at that time, divided by the number of patients who were alive just prior to that time.</span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **Kaplan-Meier** estimate of survival probability at a given time is the product of these conditional probabilities up until that given time</span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a>\hat{S}(t) = \prod_{i: t_i \leq t} (1 - \frac{d_i}{n_i})</span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{S}(t)$ is the estimated survival function at time (t),</span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$t_i$ are the observed event times,</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_i$ is the number of events (e.g. deaths) at time ($t_i$),</span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_i$ is the number of individuals known to have survived (are at risk) up to time ($t_i$).</span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: The `lung` dataset</span></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a>The <span class="in">`lung`</span> dataset is available from the {survival} package. The data contain subjects with advanced lung cancer from the North Central Cancer Treatment Group. We will focus on the following variables throughout this tutorial:</span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>time: Observed survival time in days</span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>status: censoring status 1=censored, 2=dead</span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>sex: 1=Male, 2=Female</span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a>*Note that the status is coded in a non-standard way in this dataset. Typically you will see 1=event, 0=censored*. Let's recode it to avoid confusion:</span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a>lung <span class="ot">&lt;-</span> </span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a>  lung <span class="sc">%&gt;%</span> </span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">recode</span>(status, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a>Now we have:</span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>time: Observed survival time in days</span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>status: censoring status 0=censored, 1=dead</span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>sex: 1=Male, 2=Female</span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a>Here are the first 6 observations:</span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r viewlung}</span></span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a><span class="in">head(lung[, c("time", "status", "sex")])</span></span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a>*Note*: the `Surv()` function in the {survival} package accepts by default TRUE/FALSE, where TRUE is event and FALSE is censored; 1/0 where 1 is event and 0 is censored; or 2/1 where 2 is event and 1 is censored. **Please take care to ensure the event indicator is properly formatted.**</span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating survival objects and curves</span></span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a>The Kaplan-Meier method is the most common way to estimate survival times and probabilities. It is a non-parametric approach that results in a step function, where there is a step down each time an event occurs.</span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Surv()`</span> function from the {survival} package creates a survival object for use as the response in a model formula. There will be one entry for each subject that is the survival time, which is followed by a <span class="in">`+`</span> if the subject was censored. Let's look at the first 10 observations:</span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r survfunc}</span></span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a><span class="in">Surv(lung$time, lung$status)[1:10]</span></span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a>We see that subject 1 had an event at time 306 days, subject 2 had an event at time 455 days, subject 3 was censored at time 1010 days, etc.</span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a>The <span class="in">`survfit()`</span> function creates survival curves using the Kaplan-Meier method based on a formula. Let's generate the overall survival curve for the entire cohort, assign it to object <span class="in">`s1`</span>, and look at the structure using <span class="in">`str()`</span>:</span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lung_survfit}</span></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a><span class="in">s1 &lt;- survfit(Surv(time, status) ~ 1, data = lung)</span></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="in">str(s1)</span></span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a>Some key components of this <span class="in">`survfit`</span> object that will be used to create survival curves include:</span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`time`</span>: the timepoints at which the curve has a step, i.e. at least one event occurred</span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`surv`</span>: the estimate of survival at the corresponding <span class="in">`time`</span></span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kaplan-Meier estimates</span></span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a>::: {style="height:400px;overflow:auto;"}</span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(s1)</span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Applying the formula</span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a>\hat{S}(t) = \prod_{i: t_i \leq t} (1 - \frac{d_i}{n_i})</span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$S(0) = 1$</span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$S(5) = 1*(1-1/228) = 0.9956$</span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$S(11) = 1*(1-1/228)*(1-3/227) = 0.9825$</span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>etc.</span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Number at risk is decrease by events or censored observations</span>
<span id="cb47-278"><a href="#cb47-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-279"><a href="#cb47-279" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Most early times are events, so number at risk is decreasing because of events. -- The first censored observation is at 92 days. Here, the risk set decreases by the number of events and number censored (find this time point in the table to verify yourself)</span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-281"><a href="#cb47-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kaplan-Meier plot</span></span>
<span id="cb47-282"><a href="#cb47-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(s1, <span class="at">data=</span>lung, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot gives estimate of survival over time</span>
<span id="cb47-290"><a href="#cb47-290" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Confidence interval is conditional on a given survival time (rather than being a confidence band for the entire survival curve)</span>
<span id="cb47-291"><a href="#cb47-291" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Risk table gives the number of subjects at risk at specified time points</span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimating $x$-year survival</span></span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a>One quantity often of interest in a survival analysis is the probability of surviving beyond a certain number of years, $x$.</span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a>For example, to estimate the probability of surviving to $1$ year, use <span class="in">`summary`</span> with the <span class="in">`times`</span> argument (*Note:* the <span class="in">`time`</span> variable in the <span class="in">`lung`</span> data is actually in days, so we need to use <span class="in">`times = 365.25`</span>)</span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 5yrest}</span></span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a><span class="in">summary(survfit(Surv(time, status) ~ 1, data = lung), times = 365.25)</span></span>
<span id="cb47-301"><a href="#cb47-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-302"><a href="#cb47-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-303"><a href="#cb47-303" aria-hidden="true" tabindex="-1"></a>We find that the $1$-year probability of survival in this study is <span class="in">`r round(summary(survfit(Surv(time, status) ~ 1, data = lung), times = 365.25)$surv * 100)`</span>%.</span>
<span id="cb47-304"><a href="#cb47-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a>The associated lower and upper bounds of the 95% confidence interval are also displayed.</span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a>The $1$-year survival probability is the point on the y-axis that corresponds to $1$ year on the x-axis for the survival curve.</span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, echo = FALSE, fig.height = 5}</span></span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a><span class="in">plot_main &lt;- ggsurvplot(s1, data=lung, risk.table = TRUE)</span></span>
<span id="cb47-311"><a href="#cb47-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-312"><a href="#cb47-312" aria-hidden="true" tabindex="-1"></a><span class="in">plot1 &lt;- </span></span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_main$plot + </span></span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(x = 365.25, xend = 365.25, y = -0.05, yend = 0.4092416, </span></span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a><span class="in">               linewidth = 1.5) +</span></span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(x = 365.25, xend = -40, y = 0.4092416, yend = 0.4092416,</span></span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a><span class="in">               linewidth = 1.5, </span></span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a><span class="in">               arrow = arrow(length = unit(0.2, "inches"))) </span></span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a><span class="in">plot1</span></span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a>What happens if you use a "naive" estimate? Here "naive" means that the patients who were censored prior to 1-year are considered event-free and included in the denominator.</span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a><span class="in">`r table(lung$status[lung$time &lt;= 365.25])[2]`</span> of the <span class="in">`r nrow(lung)`</span> patients in the <span class="in">`lung`</span> data died by $1$ year so the "naive" estimate is calculated as:</span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a>$$\Big(1 - \frac{121}{228}\Big) \times 100 = 47\%$$ You get an **incorrect** estimate of the $1$-year probability of survival when you ignore the fact that <span class="in">`r table(lung$status[lung$time &lt;= 365.25])[1]`</span> patients were censored before $1$ year.</span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a>Recall the **correct** estimate of the $1$-year probability of survival, accounting for censoring using the Kaplan-Meier method, was <span class="in">`r round(summary(s1, times = 365.25)$surv * 100)`</span>%.</span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-331"><a href="#cb47-331" aria-hidden="true" tabindex="-1"></a>Ignoring censoring leads to an **overestimate** of the overall survival probability. Imagine two studies, each with 228 subjects. There are 165 deaths in each study. Censoring is ignored in one , censoring is accounted for in the other. The censored subjects only contribute information for a portion of the follow-up time, and then fall out of the risk set, thus pulling down the cumulative probability of survival. Ignoring censoring erroneously treats patients who are censored as part of the risk set for the entire follow-up period.</span>
<span id="cb47-332"><a href="#cb47-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 6}</span></span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a><span class="in">fakedata2 &lt;- </span></span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a><span class="in">  lung %&gt;% </span></span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a><span class="in">    time = ifelse(status == 1, time, 1022), </span></span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a><span class="in">    group = "Ignoring censoring") %&gt;% </span></span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a><span class="in">  full_join(mutate(lung, group = "With censoring"))</span></span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a><span class="in">fit.fake &lt;- survfit(Surv(time, status) ~ group, data = fakedata2)</span></span>
<span id="cb47-342"><a href="#cb47-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-343"><a href="#cb47-343" aria-hidden="true" tabindex="-1"></a><span class="in">ggsurvplot(fit.fake, risk.table=TRUE) +</span></span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb47-345"><a href="#cb47-345" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Days",</span></span>
<span id="cb47-346"><a href="#cb47-346" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Overall survival probability"</span></span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimating median survival time</span></span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-352"><a href="#cb47-352" aria-hidden="true" tabindex="-1"></a>Another quantity often of interest in a survival analysis is the average survival time, which we quantify using the median. Survival times are not expected to be normally distributed so the mean is not an appropriate summary.</span>
<span id="cb47-353"><a href="#cb47-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a>We can obtain the median survival directly from the <span class="in">`survfit`</span> object:</span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-359"><a href="#cb47-359" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> lung)</span>
<span id="cb47-360"><a href="#cb47-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-361"><a href="#cb47-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-362"><a href="#cb47-362" aria-hidden="true" tabindex="-1"></a>We see the median survival time is <span class="in">`r round(summary(s1)$table["median"], 1)`</span> days The lower and upper bounds of the 95% confidence interval are also displayed.</span>
<span id="cb47-363"><a href="#cb47-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-364"><a href="#cb47-364" aria-hidden="true" tabindex="-1"></a>Median survival is the time corresponding to a survival probability of $0.5$:</span>
<span id="cb47-365"><a href="#cb47-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-366"><a href="#cb47-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, echo = FALSE, fig.height = 5}</span></span>
<span id="cb47-367"><a href="#cb47-367" aria-hidden="true" tabindex="-1"></a><span class="in">plot2 &lt;- </span></span>
<span id="cb47-368"><a href="#cb47-368" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_main$plot +</span></span>
<span id="cb47-369"><a href="#cb47-369" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(x = -45, xend = 310, y = 0.5, yend = 0.5,  linewidth = 1.5) +</span></span>
<span id="cb47-370"><a href="#cb47-370" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(x = 310, xend = 310, y = 0.5, yend = -0.02, linewidth = 1.5, </span></span>
<span id="cb47-371"><a href="#cb47-371" aria-hidden="true" tabindex="-1"></a><span class="in">               arrow = arrow(length = unit(0.2, "inches")))</span></span>
<span id="cb47-372"><a href="#cb47-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-373"><a href="#cb47-373" aria-hidden="true" tabindex="-1"></a><span class="in">plot2</span></span>
<span id="cb47-374"><a href="#cb47-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-375"><a href="#cb47-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-376"><a href="#cb47-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non-parametric test for comparing survival times between groups</span></span>
<span id="cb47-377"><a href="#cb47-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-378"><a href="#cb47-378" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The most common test for comparing survival by groups is the log-rank test</span>
<span id="cb47-379"><a href="#cb47-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-380"><a href="#cb47-380" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>At each event time, constructs a 2x2 table of observed events and number at risk for each group</span>
<span id="cb47-381"><a href="#cb47-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-382"><a href="#cb47-382" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Compare observed to expected number of events under the null hypothesis that the event rates are the same in each group</span>
<span id="cb47-383"><a href="#cb47-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-384"><a href="#cb47-384" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A Chi-squared test stratifying over all event times</span>
<span id="cb47-385"><a href="#cb47-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-386"><a href="#cb47-386" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A test of the entire survival curve</span>
<span id="cb47-387"><a href="#cb47-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-388"><a href="#cb47-388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We get the log-rank p-value using the <span class="in">`survdiff`</span> function. For example, we can test whether there was a difference in survival time according to sex in the <span class="in">`lung`</span> data:</span>
<span id="cb47-389"><a href="#cb47-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-392"><a href="#cb47-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-393"><a href="#cb47-393" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb47-394"><a href="#cb47-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-395"><a href="#cb47-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-396"><a href="#cb47-396" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can also add the p-value to Kaplan-Meier plot by sex</span>
<span id="cb47-397"><a href="#cb47-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-400"><a href="#cb47-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-401"><a href="#cb47-401" aria-hidden="true" tabindex="-1"></a>fit.sex <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data=</span>lung)</span>
<span id="cb47-402"><a href="#cb47-402" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit.sex, <span class="at">data=</span>lung, <span class="at">pval=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-403"><a href="#cb47-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-404"><a href="#cb47-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-405"><a href="#cb47-405" aria-hidden="true" tabindex="-1"></a>There was a significant difference in overall survival according to sex in the <span class="in">`lung`</span> data, with a p-value of p = <span class="in">`r round(1-pchisq(survdiff(Surv(time, status) ~ sex, data = lung)$chisq, 1),4)`</span>.</span>
<span id="cb47-406"><a href="#cb47-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-407"><a href="#cb47-407" aria-hidden="true" tabindex="-1"></a><span class="fu">## Semi-parametric regression (Cox proportional hazards model)</span></span>
<span id="cb47-408"><a href="#cb47-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-409"><a href="#cb47-409" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The preceding approach was very flexible in that it makes no parametric assumptions above the shape of the survival curve</span>
<span id="cb47-410"><a href="#cb47-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-411"><a href="#cb47-411" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This can work for well for categorical predictors and/or descriptive purposes</span>
<span id="cb47-412"><a href="#cb47-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-413"><a href="#cb47-413" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In a clinical trial where we have randomized to treatment groups (and presumably have minimized confounding), the Kaplan-Meier method and log-rank test can be the primary analysis method</span>
<span id="cb47-414"><a href="#cb47-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-415"><a href="#cb47-415" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Extensions are needed if we want to consider continuous predictors and multivariable models</span>
<span id="cb47-416"><a href="#cb47-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-417"><a href="#cb47-417" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Would be nice to maintain flexibility and have a readily interpret</span>
<span id="cb47-418"><a href="#cb47-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-419"><a href="#cb47-419" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Statistical methods</span>
<span id="cb47-420"><a href="#cb47-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-421"><a href="#cb47-421" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Regression models we have studied to date are generally not valid for survival data</span>
<span id="cb47-422"><a href="#cb47-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-423"><a href="#cb47-423" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Because of right censoring, survival time cannot be analyzed as a continuous outcome (e.g. linear regression)</span>
<span id="cb47-424"><a href="#cb47-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-425"><a href="#cb47-425" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Because of unequal length of followup, survival (yes/no) cannot be analyzed using logistic regression</span>
<span id="cb47-426"><a href="#cb47-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-427"><a href="#cb47-427" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In the presence of censored data, the usual descriptive statistics are not appropriate</span>
<span id="cb47-428"><a href="#cb47-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-429"><a href="#cb47-429" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Sample mean, sample median, simple proportions, sample standard deviation should not be used</span>
<span id="cb47-430"><a href="#cb47-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-431"><a href="#cb47-431" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Proper descriptives should be based on the Kaplan Meier estimates</span>
<span id="cb47-432"><a href="#cb47-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-433"><a href="#cb47-433" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Specialized regression models are needed with censored data</span>
<span id="cb47-434"><a href="#cb47-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-435"><a href="#cb47-435" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>(Cox) Proportional hazards model</span>
<span id="cb47-436"><a href="#cb47-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-437"><a href="#cb47-437" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Considers the instantaneous risk of failure at each time among those subjects who have not failed</span>
<span id="cb47-438"><a href="#cb47-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-439"><a href="#cb47-439" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The term "proportional hazards" assumes that the ratio of these instantaneous failure rates is constant in time between groups</span>
<span id="cb47-440"><a href="#cb47-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-441"><a href="#cb47-441" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Proportional hazards (Cox) regression treats the survival distribution within a group semi-parametrically</span>
<span id="cb47-442"><a href="#cb47-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-443"><a href="#cb47-443" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>The baseline hazard is estimated without making any distributional assumptions</span>
<span id="cb47-444"><a href="#cb47-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-445"><a href="#cb47-445" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>The hazard ratio is the parameter of interest and is used to compare groups</span>
<span id="cb47-446"><a href="#cb47-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-447"><a href="#cb47-447" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportional Hazards Regression</span></span>
<span id="cb47-448"><a href="#cb47-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-449"><a href="#cb47-449" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Looks at odds of choosing subjects relative to prevalence in the population</span>
<span id="cb47-450"><a href="#cb47-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-451"><a href="#cb47-451" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can be derived as estimating the odds ratio of an event at each time that an event occurs</span>
<span id="cb47-452"><a href="#cb47-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-453"><a href="#cb47-453" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Proportional hazards model averages the odds ratio across all observed event times</span>
<span id="cb47-454"><a href="#cb47-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-455"><a href="#cb47-455" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If the odds ratio is constant over time between two groups, such an average results in a precise estimate of the hazard ratio</span>
<span id="cb47-456"><a href="#cb47-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-457"><a href="#cb47-457" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Borrowing information</span>
<span id="cb47-458"><a href="#cb47-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-459"><a href="#cb47-459" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Uses other groups to make estimates in groups with sparse data</span>
<span id="cb47-460"><a href="#cb47-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-461"><a href="#cb47-461" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Borrows information across predictor groups</span>
<span id="cb47-462"><a href="#cb47-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-463"><a href="#cb47-463" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Intuitively, 67 and 69 year olds would provide some relevant information about 68 year olds</span>
<span id="cb47-464"><a href="#cb47-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-465"><a href="#cb47-465" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Also borrows information over time</span>
<span id="cb47-466"><a href="#cb47-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-467"><a href="#cb47-467" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Relative risk for an event at each time is presumed to be the same under proportional hazards</span>
<span id="cb47-468"><a href="#cb47-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-469"><a href="#cb47-469" aria-hidden="true" tabindex="-1"></a><span class="fu">### The simple PH regression model</span></span>
<span id="cb47-470"><a href="#cb47-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-471"><a href="#cb47-471" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modeling the log hazard over time as a function of covariates $X$</span>
<span id="cb47-472"><a href="#cb47-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-473"><a href="#cb47-473" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Baseline hazard" is unspecified. Baseline hazard is similar to an intercept</span>
<span id="cb47-474"><a href="#cb47-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-475"><a href="#cb47-475" aria-hidden="true" tabindex="-1"></a>    | Model       | $\textrm{log}(\lambda(t | X_i)) = \textrm{log}(\lambda_{0}(t)) + \beta_1 \times X_i$ |</span>
<span id="cb47-476"><a href="#cb47-476" aria-hidden="true" tabindex="-1"></a>    |:-------------------------|:---------------------------------------------|</span>
<span id="cb47-477"><a href="#cb47-477" aria-hidden="true" tabindex="-1"></a>    | $X_i = 0$   | log hazard at $t$ is $\textrm{log}(\lambda_{0}(t))$                                  |</span>
<span id="cb47-478"><a href="#cb47-478" aria-hidden="true" tabindex="-1"></a>    | $X_i = x$   | log hazard at $t$ is $\textrm{log}(\lambda_{0}(t)) + \beta_1 \times x$               |</span>
<span id="cb47-479"><a href="#cb47-479" aria-hidden="true" tabindex="-1"></a>    | $X_i = x+1$ | log hazard at $t$ is $\textrm{log}(\lambda_{0}(t))+ \beta_1 \times x + \beta_1$      |</span>
<span id="cb47-480"><a href="#cb47-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-481"><a href="#cb47-481" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model on the hazard scale is found by exponentiating parameters</span>
<span id="cb47-482"><a href="#cb47-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-483"><a href="#cb47-483" aria-hidden="true" tabindex="-1"></a>    | Model       | $\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}$                |</span>
<span id="cb47-484"><a href="#cb47-484" aria-hidden="true" tabindex="-1"></a>    |:-------------------------|:---------------------------------------------|</span>
<span id="cb47-485"><a href="#cb47-485" aria-hidden="true" tabindex="-1"></a>    | $X_i = 0$   | hazard at $t$ is $\lambda_{0}(t)$                                                |</span>
<span id="cb47-486"><a href="#cb47-486" aria-hidden="true" tabindex="-1"></a>    | $X_i = x$   | hazard at $t$ is $\lambda_{0}(t) \times e^{\beta_1 \times x}$                    |</span>
<span id="cb47-487"><a href="#cb47-487" aria-hidden="true" tabindex="-1"></a>    | $X_i = x+1$ | hazard at $t$ is $\lambda_{0}(t) \times e^{\beta_1 \times x} \times e^{\beta_1}$ |</span>
<span id="cb47-488"><a href="#cb47-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-489"><a href="#cb47-489" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of the model</span>
<span id="cb47-490"><a href="#cb47-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-491"><a href="#cb47-491" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No intercept</span>
<span id="cb47-492"><a href="#cb47-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-493"><a href="#cb47-493" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Generally ignore the baseline hazard</span>
<span id="cb47-494"><a href="#cb47-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-495"><a href="#cb47-495" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope parameter</span>
<span id="cb47-496"><a href="#cb47-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-497"><a href="#cb47-497" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Hazard ratio found by exponentiating the slope from the PH regression: $\textrm{exp}(\beta_1)$</span>
<span id="cb47-498"><a href="#cb47-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-499"><a href="#cb47-499" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Hazard ratio compared groups differing in the value of the predictor by 1 unit</span>
<span id="cb47-500"><a href="#cb47-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-501"><a href="#cb47-501" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Relationship to survival</span>
<span id="cb47-502"><a href="#cb47-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-503"><a href="#cb47-503" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Hazard function determines the survival function</span>
<span id="cb47-504"><a href="#cb47-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-505"><a href="#cb47-505" aria-hidden="true" tabindex="-1"></a>        |                   |                                                                                              |</span>
<span id="cb47-506"><a href="#cb47-506" aria-hidden="true" tabindex="-1"></a>        |:-------------------------|:---------------------------------------------|</span>
<span id="cb47-507"><a href="#cb47-507" aria-hidden="true" tabindex="-1"></a>        | Hazard            | $\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}$                            |</span>
<span id="cb47-508"><a href="#cb47-508" aria-hidden="true" tabindex="-1"></a>        | Cumulative Hazard | $\Lambda(t | X_i) = \displaystyle\int^t_0 \lambda_{0}(u) \times e^{\beta_1 \times X_i} \ du$ |</span>
<span id="cb47-509"><a href="#cb47-509" aria-hidden="true" tabindex="-1"></a>        | Survival Function | $S(t | X_i) = e^{-\Lambda(t|X_i)} = <span class="co">[</span><span class="ot">S_0(t)</span><span class="co">]</span>^{e^{\beta_1 \times X_i}}$                       |</span>
<span id="cb47-510"><a href="#cb47-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-511"><a href="#cb47-511" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive Plots</span></span>
<span id="cb47-512"><a href="#cb47-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-513"><a href="#cb47-513" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Hazard</span></span>
<span id="cb47-514"><a href="#cb47-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-517"><a href="#cb47-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-518"><a href="#cb47-518" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">55</span>)</span>
<span id="cb47-519"><a href="#cb47-519" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="sc">*</span>pi,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb47-520"><a href="#cb47-520" aria-hidden="true" tabindex="-1"></a>lambda0 <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">sin</span>(x) <span class="sc">+</span> <span class="dv">4</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, .<span class="dv">2</span>)) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb47-521"><a href="#cb47-521" aria-hidden="true" tabindex="-1"></a>lambda0[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb47-522"><a href="#cb47-522" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, lambda0, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Baseline Hazard Over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-523"><a href="#cb47-523" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(lambda[<span class="dv">0</span>] (t)), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-524"><a href="#cb47-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-525"><a href="#cb47-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-526"><a href="#cb47-526" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cumulative hazard</span></span>
<span id="cb47-527"><a href="#cb47-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-530"><a href="#cb47-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-531"><a href="#cb47-531" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">cumsum</span>(lambda0), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Cumulative Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">main=</span><span class="st">"Baseline Cumulative Hazard over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-532"><a href="#cb47-532" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(Lambda[<span class="dv">0</span>] (t) <span class="sc">==</span> <span class="fu">integral</span>(lambda[<span class="dv">0</span>] (u)<span class="sc">*</span>du, <span class="dv">0</span>, t)), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-533"><a href="#cb47-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-534"><a href="#cb47-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-535"><a href="#cb47-535" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Survival</span></span>
<span id="cb47-536"><a href="#cb47-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-539"><a href="#cb47-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-540"><a href="#cb47-540" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">cumsum</span>(lambda0)), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Baseline Survival over Time"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-541"><a href="#cb47-541" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">expression</span>(<span class="fu">exp</span>(<span class="sc">-</span>Lambda[<span class="dv">0</span>] (t))), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-542"><a href="#cb47-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-543"><a href="#cb47-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-544"><a href="#cb47-544" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Proportional hazards assumption</span></span>
<span id="cb47-545"><a href="#cb47-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-548"><a href="#cb47-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-549"><a href="#cb47-549" aria-hidden="true" tabindex="-1"></a>lambda1 <span class="ot">&lt;-</span> lambda0<span class="sc">*</span><span class="fl">1.5</span></span>
<span id="cb47-550"><a href="#cb47-550" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, lambda0, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>), <span class="at">main=</span><span class="st">"Proportional Hazards for Two Groups"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-551"><a href="#cb47-551" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, lambda1, <span class="at">col=</span><span class="st">"Red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-552"><a href="#cb47-552" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">c</span>(<span class="fu">expression</span>(lambda[<span class="dv">0</span>] (t)), <span class="fu">expression</span>(lambda[<span class="dv">1</span>] (t) <span class="sc">==</span> <span class="fl">1.5</span><span class="sc">*</span>lambda[<span class="dv">0</span>] (t))), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"Black"</span>,<span class="st">"Red"</span>))</span>
<span id="cb47-553"><a href="#cb47-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-554"><a href="#cb47-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-555"><a href="#cb47-555" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Proportional hazards assumption on log scale</span></span>
<span id="cb47-556"><a href="#cb47-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-559"><a href="#cb47-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-560"><a href="#cb47-560" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(lambda0), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"Log Hazard"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="dv">2</span>), <span class="at">main=</span><span class="st">"Proportional Hazards for Two Groups, log scale"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-561"><a href="#cb47-561" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">log</span>(lambda1), <span class="at">col=</span><span class="st">"Red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb47-562"><a href="#cb47-562" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">log</span>(lambda[<span class="dv">0</span>] (t))), <span class="fu">expression</span>(<span class="fu">log</span>(lambda[<span class="dv">1</span>] (t)) <span class="sc">==</span> <span class="fu">log</span>(<span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">log</span>(lambda[<span class="dv">0</span>] (t)))), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"Black"</span>,<span class="st">"Red"</span>))</span>
<span id="cb47-563"><a href="#cb47-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-564"><a href="#cb47-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-565"><a href="#cb47-565" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comments on plots</span>
<span id="cb47-566"><a href="#cb47-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-567"><a href="#cb47-567" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Baseline hazard can follow any functional form. This is the "non-parametric" part of the Cox proportional hazards model</span>
<span id="cb47-568"><a href="#cb47-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-569"><a href="#cb47-569" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The cumulative hazard is a non-decreasing function that starts at 0 at time 0. It is bounded by $\infty$.</span>
<span id="cb47-570"><a href="#cb47-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-571"><a href="#cb47-571" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Survival is a function of the cumulative hazard. Survival is 1 at time 0 and decreases over time. It is bounded by $0$ and $1$.</span>
<span id="cb47-572"><a href="#cb47-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-573"><a href="#cb47-573" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For a dichotomous predictor variable (X is 0 or 1), the proportional hazards assumption is that $\lambda_1 (t) = e^{\beta_1} \lambda_0 (t)$</span>
<span id="cb47-574"><a href="#cb47-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-575"><a href="#cb47-575" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>In the plots I illustrated $e^{\beta_1} = 1.5$ ($\beta_1 = 0.4054$).</span>
<span id="cb47-576"><a href="#cb47-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-577"><a href="#cb47-577" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>On the hazard scale, this corresponds to $\lambda_1(t)$ always being $1.5$ times larger than $\lambda_0(t)$.</span>
<span id="cb47-578"><a href="#cb47-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-579"><a href="#cb47-579" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>On the log hazard scale, this corresponds to $log(\lambda_1(t))$ always being $log(1.5) = 0.4054$ units larger than $log(\lambda_0(t))$.</span>
<span id="cb47-580"><a href="#cb47-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-581"><a href="#cb47-581" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>The proportional hazards assumption is the "parametric" part of the Cox proportional hazards model. Hence, the Cox proportional hazards model is referred to as being "semi-parametric".</span>
<span id="cb47-582"><a href="#cb47-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-583"><a href="#cb47-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### Software</span></span>
<span id="cb47-584"><a href="#cb47-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-585"><a href="#cb47-585" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stata commands</span>
<span id="cb47-586"><a href="#cb47-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-587"><a href="#cb47-587" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"stset time event-indicator"</span>
<span id="cb47-588"><a href="#cb47-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-589"><a href="#cb47-589" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"stcox predictor, <span class="sc">\[</span>robust<span class="sc">\]</span>"</span>
<span id="cb47-590"><a href="#cb47-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-591"><a href="#cb47-591" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>R functions</span>
<span id="cb47-592"><a href="#cb47-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-593"><a href="#cb47-593" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Surv(time, event-indicator)"</span>
<span id="cb47-594"><a href="#cb47-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-595"><a href="#cb47-595" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"coxph(Surv(time, event-indicator) \~ predictor)"</span>
<span id="cb47-596"><a href="#cb47-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-597"><a href="#cb47-597" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There is a robust option in coxph for calcluating robust standard error estimates. In my opinion the assumption of proportional hazards in the Cox model rarely (never?) holds completely, so the robust option can be a good default.</span>
<span id="cb47-598"><a href="#cb47-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-599"><a href="#cb47-599" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Lin, D. Y., and L. J. Wei. "The Robust Inference for the Cox Proportional Hazards Model." Journal of the American Statistical Association 84, no. 408 (1989): 1074--78. https://doi.org/10.2307/2290085.</span>
<span id="cb47-600"><a href="#cb47-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-601"><a href="#cb47-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example Analysis</span></span>
<span id="cb47-602"><a href="#cb47-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-603"><a href="#cb47-603" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Descriptives</span></span>
<span id="cb47-604"><a href="#cb47-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-605"><a href="#cb47-605" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prognostic values of nadir PSA relative to time in remission</span>
<span id="cb47-606"><a href="#cb47-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-607"><a href="#cb47-607" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>PSA dataset: 50 men who received hormonal treatment for advanced prostate cancer</span>
<span id="cb47-608"><a href="#cb47-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-609"><a href="#cb47-609" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Followed at least 24 months for clinical progression, but exact followup varies from subject to subject</span>
<span id="cb47-610"><a href="#cb47-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-611"><a href="#cb47-611" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Nadir PSA: lowest level of serum prostate specific antigen achieved post treatment</span>
<span id="cb47-612"><a href="#cb47-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-613"><a href="#cb47-613" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplots of censored data are not scientifically meaningful</span>
<span id="cb47-614"><a href="#cb47-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-615"><a href="#cb47-615" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is best to not generate them unless you do something to indicate the censored dataset</span>
<span id="cb47-616"><a href="#cb47-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-617"><a href="#cb47-617" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We can label censored data, but have to remember that the true value may be anywhere larger than that</span>
<span id="cb47-618"><a href="#cb47-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-621"><a href="#cb47-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-622"><a href="#cb47-622" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb47-623"><a href="#cb47-623" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb47-624"><a href="#cb47-624" aria-hidden="true" tabindex="-1"></a>psa <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(<span class="at">file=</span><span class="st">"data/psa.dta"</span>)</span>
<span id="cb47-625"><a href="#cb47-625" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>nadirpsa <span class="ot">&lt;-</span> psa<span class="sc">$</span>dirpsa</span>
<span id="cb47-626"><a href="#cb47-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-627"><a href="#cb47-627" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psa, <span class="fu">aes</span>(<span class="at">y=</span>obstime, <span class="at">x=</span>nadirpsa, <span class="at">color=</span>inrem)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb47-628"><a href="#cb47-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-629"><a href="#cb47-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-630"><a href="#cb47-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-631"><a href="#cb47-631" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Characterization of plot</span>
<span id="cb47-632"><a href="#cb47-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-633"><a href="#cb47-633" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Outliers: Can't tell</span>
<span id="cb47-634"><a href="#cb47-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-635"><a href="#cb47-635" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>First order trends</span>
<span id="cb47-636"><a href="#cb47-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-637"><a href="#cb47-637" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Downward trending slop</span>
<span id="cb47-638"><a href="#cb47-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-639"><a href="#cb47-639" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>No censoring at high nadir PSAs (high nadir PSA are all early events)</span>
<span id="cb47-640"><a href="#cb47-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-641"><a href="#cb47-641" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Second order trend: Must be curvilinear (but how much?)</span>
<span id="cb47-642"><a href="#cb47-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-643"><a href="#cb47-643" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Variability within groups: Highest variability within lowest PSA groups</span>
<span id="cb47-644"><a href="#cb47-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-645"><a href="#cb47-645" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Regression model</span></span>
<span id="cb47-646"><a href="#cb47-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-647"><a href="#cb47-647" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The usual coding of the outcome is survival is 1 for an event and 0 for a censored observation.</span>
<span id="cb47-648"><a href="#cb47-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-651"><a href="#cb47-651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-652"><a href="#cb47-652" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create an indicator variable for those who relapsed at any time point</span></span>
<span id="cb47-653"><a href="#cb47-653" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>relapse <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(psa<span class="sc">$</span>inrem<span class="sc">==</span><span class="st">"no"</span>)</span>
<span id="cb47-654"><a href="#cb47-654" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(psa, <span class="fu">table</span>(relapse, inrem))</span>
<span id="cb47-655"><a href="#cb47-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-656"><a href="#cb47-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-657"><a href="#cb47-657" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create a relapse variable to indicate if a subject has relapsed or not</span>
<span id="cb47-658"><a href="#cb47-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-659"><a href="#cb47-659" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define the outcome using "Surv(obstime, relapse)"</span>
<span id="cb47-660"><a href="#cb47-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-661"><a href="#cb47-661" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>obstime: Time to event (either time to relapse or time to censored)</span>
<span id="cb47-662"><a href="#cb47-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-663"><a href="#cb47-663" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>relapse: Failure indicator variable</span>
<span id="cb47-664"><a href="#cb47-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-667"><a href="#cb47-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-668"><a href="#cb47-668" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(obstime, relapse) <span class="sc">~</span> nadirpsa, <span class="at">data=</span>psa, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-669"><a href="#cb47-669" aria-hidden="true" tabindex="-1"></a>m1</span>
<span id="cb47-670"><a href="#cb47-670" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span>
<span id="cb47-671"><a href="#cb47-671" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m1))</span>
<span id="cb47-672"><a href="#cb47-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-673"><a href="#cb47-673" aria-hidden="true" tabindex="-1"></a><span class="co"># 10-unit change in nadir PSA</span></span>
<span id="cb47-674"><a href="#cb47-674" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m1)<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb47-675"><a href="#cb47-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-676"><a href="#cb47-676" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">confint.default</span>(m1))</span>
<span id="cb47-677"><a href="#cb47-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-678"><a href="#cb47-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-679"><a href="#cb47-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-680"><a href="#cb47-680" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpretation of output</span></span>
<span id="cb47-681"><a href="#cb47-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-682"><a href="#cb47-682" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>By default, R gives the hazard ratio and the coefficient for comparing groups who differ by one unit in the nadir psa covariate</span>
<span id="cb47-683"><a href="#cb47-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-684"><a href="#cb47-684" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$\textrm{Hazard ratio} = e^{\textrm{coeff}}$</span>
<span id="cb47-685"><a href="#cb47-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-686"><a href="#cb47-686" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\textrm{Hazard ratio} = 1.015^{\Delta nadir}$</span>
<span id="cb47-687"><a href="#cb47-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-688"><a href="#cb47-688" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimated hazard ratio for two groups differing by 1 in nadir PSA is found by exponentiating the slope</span>
<span id="cb47-689"><a href="#cb47-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-690"><a href="#cb47-690" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Groups 1 unit higher nadir PSA have instantaneous event rate $1.0157$ fold higher (1.6% higher)</span>
<span id="cb47-691"><a href="#cb47-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-692"><a href="#cb47-692" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Groups 10 units higher nadir PSA have instantaneous event rate $1.015^{10} = 1.166$ fold higher (16.6% higher)</span>
<span id="cb47-693"><a href="#cb47-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-694"><a href="#cb47-694" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Robust standard errors</span></span>
<span id="cb47-695"><a href="#cb47-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-696"><a href="#cb47-696" aria-hidden="true" tabindex="-1"></a>R allows for robust standard errors in the coxph function. Note that other functions for fitting Cox models in R may or may not have this functionality.</span>
<span id="cb47-697"><a href="#cb47-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-698"><a href="#cb47-698" aria-hidden="true" tabindex="-1"></a>"From proportional hazards regression analysis, we estimate that for each 1 ng/ml unit difference in nadir PSA, this risk of relapse is $1.6\%$ higher in the group with the higher nadir PSA. This estimate is highly statistically significant ($p &lt; 0.001$). A 95% CI suggests that this observation is not unusual if a group that has a 1 ng/ml higher nadir PSA might have risk of relapse that was anywhere from $0.9\%$ higher to $2.3\%$ higher than the group with lower nadir PSA."</span>
<span id="cb47-699"><a href="#cb47-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-700"><a href="#cb47-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inference with PH Regression</span></span>
<span id="cb47-701"><a href="#cb47-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-702"><a href="#cb47-702" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The ideas of Signal and Noise found in simple linear regression do not translate well to PH regression</span>
<span id="cb47-703"><a href="#cb47-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-704"><a href="#cb47-704" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We do not tend to quantify an error distribution with PH regression</span>
<span id="cb47-705"><a href="#cb47-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-706"><a href="#cb47-706" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Valid statistical inference (CIs, p-values) about *associations* requires three general assumptions</span>
<span id="cb47-707"><a href="#cb47-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-708"><a href="#cb47-708" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumptions about approximately Normal distributions for the parameter estimates</span>
<span id="cb47-709"><a href="#cb47-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-710"><a href="#cb47-710" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Large N</span>
<span id="cb47-711"><a href="#cb47-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-712"><a href="#cb47-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Need for either robust standard errors or classical regression</span>
<span id="cb47-713"><a href="#cb47-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-714"><a href="#cb47-714" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Definition of large depends on the underlying probability distribution</span>
<span id="cb47-715"><a href="#cb47-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-716"><a href="#cb47-716" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumptions about independence of observations</span>
<span id="cb47-717"><a href="#cb47-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-718"><a href="#cb47-718" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Classical regression: Independence of all observation</span>
<span id="cb47-719"><a href="#cb47-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-720"><a href="#cb47-720" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Robust standard errors: Correlated observations within identified clusters</span>
<span id="cb47-721"><a href="#cb47-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-722"><a href="#cb47-722" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumptions about variance of observations within groups</span>
<span id="cb47-723"><a href="#cb47-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-724"><a href="#cb47-724" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Classical regression: Mean-variance relationship for binary data</span>
<span id="cb47-725"><a href="#cb47-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-726"><a href="#cb47-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Proportional hazards considers the hazard of event at every time</span>
<span id="cb47-727"><a href="#cb47-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-728"><a href="#cb47-728" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Hence in order to satisfy this requirement, need proportional hazards and linearity of predictor</span>
<span id="cb47-729"><a href="#cb47-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-730"><a href="#cb47-730" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Robust standard errors</span>
<span id="cb47-731"><a href="#cb47-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-732"><a href="#cb47-732" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Allows unequal variance across groups</span>
<span id="cb47-733"><a href="#cb47-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-734"><a href="#cb47-734" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Hence, do not need linearity of predictor or proportional hazards</span>
<span id="cb47-735"><a href="#cb47-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-736"><a href="#cb47-736" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Valid statistical inference (CIs, p-values) about *hazard of response in specific groups* requires a further assumption</span>
<span id="cb47-737"><a href="#cb47-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-738"><a href="#cb47-738" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumption about the adequacy of the linear model</span>
<span id="cb47-739"><a href="#cb47-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-740"><a href="#cb47-740" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If we are trying to borrow information about the log hazards from neighboring groups, and we are assuming a straight line relationship, the straight line needs to be true</span>
<span id="cb47-741"><a href="#cb47-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-742"><a href="#cb47-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Needed for either classical or robust standard errors</span>
<span id="cb47-743"><a href="#cb47-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-744"><a href="#cb47-744" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Note that we can model transformations of the measured predictor</span>
<span id="cb47-745"><a href="#cb47-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-746"><a href="#cb47-746" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We rarely make inference about within group survival probabilities using the proportional hazards model</span>
<span id="cb47-747"><a href="#cb47-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-748"><a href="#cb47-748" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sometimes estimated survival curves are used descriptively</span>
<span id="cb47-749"><a href="#cb47-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-750"><a href="#cb47-750" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Use estimates of the baseline survival function</span>
<span id="cb47-751"><a href="#cb47-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-752"><a href="#cb47-752" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Exponentiate the baseline survival to find survival curve for specific covariate patterns</span>
<span id="cb47-753"><a href="#cb47-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-754"><a href="#cb47-754" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Relationship to survival</span>
<span id="cb47-755"><a href="#cb47-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-756"><a href="#cb47-756" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Hazard function determines the survival function.</span>
<span id="cb47-757"><a href="#cb47-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-758"><a href="#cb47-758" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For the Cox model</span>
<span id="cb47-759"><a href="#cb47-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-760"><a href="#cb47-760" aria-hidden="true" tabindex="-1"></a>        |                   |                                                                                              |</span>
<span id="cb47-761"><a href="#cb47-761" aria-hidden="true" tabindex="-1"></a>        |:-------------------------|:---------------------------------------------|</span>
<span id="cb47-762"><a href="#cb47-762" aria-hidden="true" tabindex="-1"></a>        | Hazard            | $\lambda(t | X_i) = \lambda_{0}(t) \times e^{\beta_1 \times X_i}$                            |</span>
<span id="cb47-763"><a href="#cb47-763" aria-hidden="true" tabindex="-1"></a>        | Cumulative Hazard | $\Lambda(t | X_i) = \displaystyle\int^t_0 \lambda_{0}(u) \times e^{\beta_1 \times X_i} \ du$ |</span>
<span id="cb47-764"><a href="#cb47-764" aria-hidden="true" tabindex="-1"></a>        | Survival Function | $S(t | X_i) = e^{-\Lambda(t|X_i)} = <span class="co">[</span><span class="ot">S_0(t)</span><span class="co">]</span>^{e^{\beta_1 \times X_i}}$                       |</span>
<span id="cb47-765"><a href="#cb47-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-766"><a href="#cb47-766" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Log-transformed nadir PSA</span></span>
<span id="cb47-767"><a href="#cb47-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-768"><a href="#cb47-768" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Suppose that you know based on prior experience or consultation with collaborators...</span>
<span id="cb47-769"><a href="#cb47-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-770"><a href="#cb47-770" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A constant difference in PSA would not be expected to confer the same increased risk</span>
<span id="cb47-771"><a href="#cb47-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-772"><a href="#cb47-772" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Comparing 4 ng/ml to 10 ng/ml is not the same as comparing 104 ng/ml to 110 ng/ml</span>
<span id="cb47-773"><a href="#cb47-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-774"><a href="#cb47-774" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A multiplicative effect on risk might be better</span>
<span id="cb47-775"><a href="#cb47-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-776"><a href="#cb47-776" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Same increase in risk for each doubling of nadir PSA</span>
<span id="cb47-777"><a href="#cb47-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-778"><a href="#cb47-778" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Achieve this model by using log transformed nadir PSA</span>
<span id="cb47-779"><a href="#cb47-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-782"><a href="#cb47-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-783"><a href="#cb47-783" aria-hidden="true" tabindex="-1"></a>psa<span class="sc">$</span>lognadirpsa <span class="ot">&lt;-</span> <span class="fu">log</span>(psa<span class="sc">$</span>nadirpsa)</span>
<span id="cb47-784"><a href="#cb47-784" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(obstime, relapse) <span class="sc">~</span> lognadirpsa, <span class="at">data=</span>psa, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-785"><a href="#cb47-785" aria-hidden="true" tabindex="-1"></a>m2</span>
<span id="cb47-786"><a href="#cb47-786" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb47-787"><a href="#cb47-787" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(m2))</span>
<span id="cb47-788"><a href="#cb47-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-789"><a href="#cb47-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-790"><a href="#cb47-790" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Hazard ratio is $1.55$ for a $e$-fold difference in nadir PSA ($e = 2.7183$)</span>
<span id="cb47-791"><a href="#cb47-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-792"><a href="#cb47-792" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is more easy to understand doubling, tripling, 5-fold, 10-fold increases</span>
<span id="cb47-793"><a href="#cb47-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-794"><a href="#cb47-794" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For doubling: $\textrm{HR} = 1.54^{log(2)} = 1.35$</span>
<span id="cb47-795"><a href="#cb47-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-796"><a href="#cb47-796" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For 5-fold: $\textrm{HR} = 1.54^{log(5)} = 1.99$</span>
<span id="cb47-797"><a href="#cb47-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-798"><a href="#cb47-798" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can similarly transform the upper and lower limits of the confidence interval</span>
<span id="cb47-799"><a href="#cb47-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-800"><a href="#cb47-800" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The confidence interval and statistical test given in the output is called a Wald test. Other tests (Score, Likelihood Ratio) are also possible.</span>
<span id="cb47-801"><a href="#cb47-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-802"><a href="#cb47-802" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>All tests are asymptotically equivalent</span>
<span id="cb47-803"><a href="#cb47-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-804"><a href="#cb47-804" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Wald test is easiest to obtain, but generally performs the poorest in small sample sizes. It is based on the coefficient estimate and standard error.</span>
<span id="cb47-805"><a href="#cb47-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-806"><a href="#cb47-806" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Likelihood Ratio test performs the best in small samples. We will discuss it later, including how to obtain the test using post-estimation commands.</span>
<span id="cb47-807"><a href="#cb47-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-808"><a href="#cb47-808" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Score test is not bad in small samples, but is often hard to obtain from software. It is exactly equal to the logrank test for binary outcomes and categorical predictors.</span>
<span id="cb47-809"><a href="#cb47-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-810"><a href="#cb47-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### Review: Interpretation of Slopes</span></span>
<span id="cb47-811"><a href="#cb47-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-812"><a href="#cb47-812" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Additive models</span></span>
<span id="cb47-813"><a href="#cb47-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-814"><a href="#cb47-814" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identity link function</span>
<span id="cb47-815"><a href="#cb47-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-816"><a href="#cb47-816" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb47-817"><a href="#cb47-817" aria-hidden="true" tabindex="-1"></a>| Parameter | Approach          |</span>
<span id="cb47-818"><a href="#cb47-818" aria-hidden="true" tabindex="-1"></a>|:----------|:------------------|</span>
<span id="cb47-819"><a href="#cb47-819" aria-hidden="true" tabindex="-1"></a>| Means     | Linear regression |</span>
<span id="cb47-820"><a href="#cb47-820" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-821"><a href="#cb47-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-822"><a href="#cb47-822" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of non-transformed slope: $\theta_X = \beta_0 + \beta_1 \times X$</span>
<span id="cb47-823"><a href="#cb47-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-824"><a href="#cb47-824" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$\beta_1$ : (Average) difference in summary measure between groups per 1 unit difference in $X$</span>
<span id="cb47-825"><a href="#cb47-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-826"><a href="#cb47-826" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$\Delta \times \beta_1$ : (Average) difference in summary measure between groups per $\Delta$ unit difference in $X$</span>
<span id="cb47-827"><a href="#cb47-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-828"><a href="#cb47-828" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation with log transformed slope: $\theta_X = \beta_0 + \beta_1 \times \textrm{log}(X)$</span>
<span id="cb47-829"><a href="#cb47-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-830"><a href="#cb47-830" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$\textrm{log}(k) \times \beta_1$ : (Average) difference in summary measure between groups per $k$-fold difference in $X$</span>
<span id="cb47-831"><a href="#cb47-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-832"><a href="#cb47-832" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Multiplicative models</span></span>
<span id="cb47-833"><a href="#cb47-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-834"><a href="#cb47-834" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Log link function</span>
<span id="cb47-835"><a href="#cb47-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-836"><a href="#cb47-836" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb47-837"><a href="#cb47-837" aria-hidden="true" tabindex="-1"></a>| Parameter       | Approach                              |</span>
<span id="cb47-838"><a href="#cb47-838" aria-hidden="true" tabindex="-1"></a>|:----------------|:--------------------------------------|</span>
<span id="cb47-839"><a href="#cb47-839" aria-hidden="true" tabindex="-1"></a>| Geometric means | Linear regression on log scale        |</span>
<span id="cb47-840"><a href="#cb47-840" aria-hidden="true" tabindex="-1"></a>| Odds            | Logistic regression                   |</span>
<span id="cb47-841"><a href="#cb47-841" aria-hidden="true" tabindex="-1"></a>| Rates           | Poisson regression                    |</span>
<span id="cb47-842"><a href="#cb47-842" aria-hidden="true" tabindex="-1"></a>| Hazards         | Proportional Hazards (Cox) regression |</span>
<span id="cb47-843"><a href="#cb47-843" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-844"><a href="#cb47-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-845"><a href="#cb47-845" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of non-transformed slope: $\textrm{log}(\theta_X) = \beta_0 + \beta_1 \times X$</span>
<span id="cb47-846"><a href="#cb47-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-847"><a href="#cb47-847" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$e^{\beta_1}$ : (Average) ratio of summary measure between groups per 1 unit difference in $X$</span>
<span id="cb47-848"><a href="#cb47-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-849"><a href="#cb47-849" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$e^{\Delta \times \beta_1}$ : (Average) ratio of summary measure between groups per $\Delta$ unit difference in $X$</span>
<span id="cb47-850"><a href="#cb47-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-851"><a href="#cb47-851" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation with log transformed slope: $\textrm{log}(\theta_X) = \beta_0 + \beta_1 \times \textrm{log}(X)$</span>
<span id="cb47-852"><a href="#cb47-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-853"><a href="#cb47-853" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$e^{\textrm{log}(k) \times \beta_1} = k^{\beta_1}$ : (Average) ratio of summary measure between groups per $k$-fold difference in $X$</span>
<span id="cb47-854"><a href="#cb47-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-855"><a href="#cb47-855" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parametric regression</span></span>
<span id="cb47-856"><a href="#cb47-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-857"><a href="#cb47-857" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fully-parametric models are less common than the semi-parametric Cox model because they are less flexible</span>
<span id="cb47-858"><a href="#cb47-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-859"><a href="#cb47-859" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>However, if they are a good fit to a particular dataset, they may</span>
<span id="cb47-860"><a href="#cb47-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-861"><a href="#cb47-861" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Estimate fewer parameters</span>
<span id="cb47-862"><a href="#cb47-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-863"><a href="#cb47-863" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Allow for better predictions (as long as the error distribution is correctly specified!)</span>
<span id="cb47-864"><a href="#cb47-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-865"><a href="#cb47-865" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Allow for comparison of survival estimates rather than hazards (accelerated failure time)</span>
<span id="cb47-866"><a href="#cb47-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-867"><a href="#cb47-867" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Two fundamental models used to describe the way that some factor might affect time to event</span>
<span id="cb47-868"><a href="#cb47-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-869"><a href="#cb47-869" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Proportional hazards (aka Cox model)</span>
<span id="cb47-870"><a href="#cb47-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-871"><a href="#cb47-871" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Accelerated failure time (less popular)</span>
<span id="cb47-872"><a href="#cb47-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-873"><a href="#cb47-873" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Accelerated Failure Time model</span>
<span id="cb47-874"><a href="#cb47-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-875"><a href="#cb47-875" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Comparisons across groups based on survival times rather than hazards</span>
<span id="cb47-876"><a href="#cb47-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-877"><a href="#cb47-877" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assume that a factor causes some subjects to spend their lifetime too fast</span>
<span id="cb47-878"><a href="#cb47-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-879"><a href="#cb47-879" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Basic idea: For every year in a reference group's lives, the other group ages "k" years</span>
<span id="cb47-880"><a href="#cb47-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-881"><a href="#cb47-881" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>e.g. 1 human year is about 7 dog years, so a 70 year old human is the same age as a 10 year old dog</span>
<span id="cb47-882"><a href="#cb47-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-883"><a href="#cb47-883" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>In AFT terminology, the probability that a human survives beyond 70 years is the same as the probability that a dog survives beyond 10 years</span>
<span id="cb47-884"><a href="#cb47-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-885"><a href="#cb47-885" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>From the framework, dogs are accelerating through life 7 times faster than a human. Equivalently, the lifespan of a human is stretched out to be 7 times longer than that of a dog.</span>
<span id="cb47-886"><a href="#cb47-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-887"><a href="#cb47-887" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumes that ratios of quantiles of survival distribution are constant across groups</span>
<span id="cb47-888"><a href="#cb47-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-889"><a href="#cb47-889" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>e.g. report median ratios: It takes 50% longer for half of the treated group to die than half of the control group</span>
<span id="cb47-890"><a href="#cb47-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-891"><a href="#cb47-891" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>AFT models include the parametric exponential, Weibull, and lognormal models</span>
<span id="cb47-892"><a href="#cb47-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-893"><a href="#cb47-893" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weibull model</span></span>
<span id="cb47-894"><a href="#cb47-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-895"><a href="#cb47-895" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Weibull model can also be interpreted as either a proportional hazard or accelerated failure time model. It is one of the few models that makes both the proportional hazards and accelerated failure time assumptions.</span>
<span id="cb47-896"><a href="#cb47-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-897"><a href="#cb47-897" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Weibull model accommodates monotonically increasing or decreasing hazards</span>
<span id="cb47-898"><a href="#cb47-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-899"><a href="#cb47-899" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The following gives the relationship between the hazard function, Survival function, distribution function and cumulative distribution function for four different shape parameters following a Weibull distribution with scale parameter held constant at 2</span>
<span id="cb47-900"><a href="#cb47-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-903"><a href="#cb47-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-904"><a href="#cb47-904" aria-hidden="true" tabindex="-1"></a>plot.data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb47-905"><a href="#cb47-905" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, .<span class="dv">1</span>),</span>
<span id="cb47-906"><a href="#cb47-906" aria-hidden="true" tabindex="-1"></a>  <span class="at">loc =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)</span>
<span id="cb47-907"><a href="#cb47-907" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-908"><a href="#cb47-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-909"><a href="#cb47-909" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">F (CDF)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">pweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb47-910"><a href="#cb47-910" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">f (PDF)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb47-911"><a href="#cb47-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">S =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">F (CDF)</span><span class="st">`</span>,</span>
<span id="cb47-912"><a href="#cb47-912" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">h = f / S</span><span class="st">`</span> <span class="ot">=</span> flexsurv<span class="sc">::</span><span class="fu">hweibull</span>(t, <span class="at">shape =</span> loc, <span class="at">scale =</span> <span class="dv">2</span>),</span>
<span id="cb47-913"><a href="#cb47-913" aria-hidden="true" tabindex="-1"></a>    <span class="at">loc =</span> <span class="fu">paste</span>(<span class="st">"shape:"</span>, loc)</span>
<span id="cb47-914"><a href="#cb47-914" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-915"><a href="#cb47-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-916"><a href="#cb47-916" aria-hidden="true" tabindex="-1"></a>plot.data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">t=</span><span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, .<span class="dv">1</span>),</span>
<span id="cb47-917"><a href="#cb47-917" aria-hidden="true" tabindex="-1"></a>                         <span class="at">loc=</span><span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>))</span>
<span id="cb47-918"><a href="#cb47-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-919"><a href="#cb47-919" aria-hidden="true" tabindex="-1"></a>plot.data2 <span class="ot">&lt;-</span> <span class="fu">with</span>(plot.data, </span>
<span id="cb47-920"><a href="#cb47-920" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>(<span class="at">t=</span><span class="fu">rep</span>(t,<span class="dv">4</span>),</span>
<span id="cb47-921"><a href="#cb47-921" aria-hidden="true" tabindex="-1"></a>                              <span class="at">loc=</span><span class="fu">rep</span>(loc,<span class="dv">4</span>),</span>
<span id="cb47-922"><a href="#cb47-922" aria-hidden="true" tabindex="-1"></a>                              <span class="at">value=</span><span class="cn">NA</span>,</span>
<span id="cb47-923"><a href="#cb47-923" aria-hidden="true" tabindex="-1"></a>                              <span class="at">type=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">each=</span><span class="fu">nrow</span>(plot.data))))</span>
<span id="cb47-924"><a href="#cb47-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-925"><a href="#cb47-925" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> </span>
<span id="cb47-926"><a href="#cb47-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">1</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb47-927"><a href="#cb47-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-928"><a href="#cb47-928" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>] <span class="ot">&lt;-</span> </span>
<span id="cb47-929"><a href="#cb47-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">2</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb47-930"><a href="#cb47-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-931"><a href="#cb47-931" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>] <span class="ot">&lt;-</span> </span>
<span id="cb47-932"><a href="#cb47-932" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">-</span><span class="fu">pweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">3</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb47-933"><a href="#cb47-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-934"><a href="#cb47-934" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>value[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>] <span class="ot">&lt;-</span> </span>
<span id="cb47-935"><a href="#cb47-935" aria-hidden="true" tabindex="-1"></a>  flexsurv<span class="sc">::</span><span class="fu">hweibull</span>(plot.data2<span class="sc">$</span>t[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>], <span class="at">shape =</span> plot.data2<span class="sc">$</span>loc[plot.data2<span class="sc">$</span>type<span class="sc">==</span><span class="dv">4</span>], <span class="at">scale =</span> <span class="dv">2</span>)</span>
<span id="cb47-936"><a href="#cb47-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-937"><a href="#cb47-937" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot.data2<span class="sc">$</span>type, <span class="at">levels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"F (CDF)"</span>,<span class="st">"f (PDF)"</span>, <span class="st">"S = 1 - F"</span>, <span class="st">"h = f / S"</span> ))</span>
<span id="cb47-938"><a href="#cb47-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-939"><a href="#cb47-939" aria-hidden="true" tabindex="-1"></a>plot.data2<span class="sc">$</span>loc2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"shape ="</span>, plot.data2<span class="sc">$</span>loc)</span>
<span id="cb47-940"><a href="#cb47-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-941"><a href="#cb47-941" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data2, <span class="fu">aes</span>(<span class="at">x=</span>t, <span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(type <span class="sc">~</span> loc2, <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb47-942"><a href="#cb47-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-943"><a href="#cb47-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-944"><a href="#cb47-944" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Weibull hazard and cumulative hazard at time $t$ with shape $p$ and scale $\lambda$ $(\lambda &gt; 0)$</span>
<span id="cb47-945"><a href="#cb47-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-946"><a href="#cb47-946" aria-hidden="true" tabindex="-1"></a>$$h(t) = λpt^{(p−1)}$$</span>
<span id="cb47-947"><a href="#cb47-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-948"><a href="#cb47-948" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$p$ is a shape parameter</span>
<span id="cb47-949"><a href="#cb47-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-950"><a href="#cb47-950" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$p&gt;1$ is an increasing hazard over time</span>
<span id="cb47-951"><a href="#cb47-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-952"><a href="#cb47-952" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$p=1$ is a constant hazard</span>
<span id="cb47-953"><a href="#cb47-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-954"><a href="#cb47-954" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$p&lt;1$ is a decreasing hazard</span>
<span id="cb47-955"><a href="#cb47-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-956"><a href="#cb47-956" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can model the scale as a function of covariates</span>
<span id="cb47-957"><a href="#cb47-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-958"><a href="#cb47-958" aria-hidden="true" tabindex="-1"></a>$$\textrm{where } \lambda = \textrm{exp}(\beta_0 + \beta_1 X_1 + \ldots + \beta_p X_p)$$</span>
<span id="cb47-959"><a href="#cb47-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-960"><a href="#cb47-960" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A special case of the Weibull model is the Exponential model. The Weibull reduces to the Exponential when the shape parameter is 1 ($p=1$). A shape parameter of 1 assumes the hazard is constant over time, and the cumulative hazard increases linearly with time.</span>
<span id="cb47-961"><a href="#cb47-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-962"><a href="#cb47-962" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This provides a method for checking if the Weibull can be reduced to an Exponential model. If we estimate the cumulative hazard without making parametric assumptions and plot versus time, we can see if it is increasing at a constant rate.</span>
<span id="cb47-963"><a href="#cb47-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-964"><a href="#cb47-964" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Nelson-Aalen estimator of the cumulative hazard (non-parametric)</span>
<span id="cb47-965"><a href="#cb47-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-966"><a href="#cb47-966" aria-hidden="true" tabindex="-1"></a>$$\hat{H}(t)=\sum_{i:t_i\leq t}\frac{d_i}{n_i}$$</span>
<span id="cb47-967"><a href="#cb47-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-968"><a href="#cb47-968" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>where $d_i$ is the number of events at time $t_i$, and $n_i$ is the number of individuals at risk just before time $t_i$</span>
<span id="cb47-969"><a href="#cb47-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-970"><a href="#cb47-970" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply this to the lung cancer dataset</span>
<span id="cb47-971"><a href="#cb47-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-974"><a href="#cb47-974" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-975"><a href="#cb47-975" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the non-parametric estimate of the cumulative hazard</span></span>
<span id="cb47-976"><a href="#cb47-976" aria-hidden="true" tabindex="-1"></a>n.risk <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>n.risk</span>
<span id="cb47-977"><a href="#cb47-977" aria-hidden="true" tabindex="-1"></a>n.evt <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>n.event</span>
<span id="cb47-978"><a href="#cb47-978" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">summary</span>(s1)<span class="sc">$</span>time</span>
<span id="cb47-979"><a href="#cb47-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-980"><a href="#cb47-980" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cumulative hazard versus time</span></span>
<span id="cb47-981"><a href="#cb47-981" aria-hidden="true" tabindex="-1"></a>na.haz <span class="ot">&lt;-</span> n.risk<span class="sc">/</span>n.evt</span>
<span id="cb47-982"><a href="#cb47-982" aria-hidden="true" tabindex="-1"></a>na.cumhaz <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(na.haz)</span>
<span id="cb47-983"><a href="#cb47-983" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time, na.cumhaz)</span>
<span id="cb47-984"><a href="#cb47-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-985"><a href="#cb47-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-986"><a href="#cb47-986" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cumulative hazard is increasing over time, but not at a constant rate. The Weibull may be appropriate, but the Exponential is not appropriate.</span>
<span id="cb47-987"><a href="#cb47-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-988"><a href="#cb47-988" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weibull example</span></span>
<span id="cb47-989"><a href="#cb47-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-990"><a href="#cb47-990" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Compare fit of Weibull (parametric) to Kaplan-Meier (non-parametric)</span></span>
<span id="cb47-991"><a href="#cb47-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-992"><a href="#cb47-992" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is the Weibull model a reasonable fit to the observed survival estimates?</span>
<span id="cb47-993"><a href="#cb47-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-996"><a href="#cb47-996" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-997"><a href="#cb47-997" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung, <span class="at">dist =</span> <span class="st">"weibull"</span>)</span>
<span id="cb47-998"><a href="#cb47-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-999"><a href="#cb47-999" aria-hidden="true" tabindex="-1"></a>pct <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">98</span><span class="sc">/</span><span class="dv">100</span></span>
<span id="cb47-1000"><a href="#cb47-1000" aria-hidden="true" tabindex="-1"></a>ptime1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">sex=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">'quantile'</span>,</span>
<span id="cb47-1001"><a href="#cb47-1001" aria-hidden="true" tabindex="-1"></a>                 <span class="at">p=</span>pct)</span>
<span id="cb47-1002"><a href="#cb47-1002" aria-hidden="true" tabindex="-1"></a>ptime2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">sex=</span><span class="dv">2</span>), <span class="at">type=</span><span class="st">'quantile'</span>,</span>
<span id="cb47-1003"><a href="#cb47-1003" aria-hidden="true" tabindex="-1"></a>                 <span class="at">p=</span>pct)</span>
<span id="cb47-1004"><a href="#cb47-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1005"><a href="#cb47-1005" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier fit</span></span>
<span id="cb47-1006"><a href="#cb47-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.sex, <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"Survival"</span>)</span>
<span id="cb47-1007"><a href="#cb47-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1008"><a href="#cb47-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ptime1, <span class="dv">1</span><span class="sc">-</span>pct, <span class="at">col=</span><span class="dv">1</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb47-1009"><a href="#cb47-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ptime2, <span class="dv">1</span><span class="sc">-</span>pct, <span class="at">col=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb47-1010"><a href="#cb47-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>), </span>
<span id="cb47-1011"><a href="#cb47-1011" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">"Kaplan-Meier, Male"</span>,<span class="st">"Weibull, Male"</span>,<span class="st">"Kaplan-Meier, Female"</span>,<span class="st">"Weibull, Female"</span>))</span>
<span id="cb47-1012"><a href="#cb47-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1013"><a href="#cb47-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1014"><a href="#cb47-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpretation of Weibull parameters</span></span>
<span id="cb47-1015"><a href="#cb47-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1016"><a href="#cb47-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Weibull model is both a proportional hazards and accelerated failure time model</span>
<span id="cb47-1017"><a href="#cb47-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1018"><a href="#cb47-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How the model is parameterized will either give a proportional hazards or accelerated failure time interpretation</span>
<span id="cb47-1019"><a href="#cb47-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1020"><a href="#cb47-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For the Weibull proportional hazards model with one covariate ($X$)</span>
<span id="cb47-1021"><a href="#cb47-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1022"><a href="#cb47-1022" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1023"><a href="#cb47-1023" aria-hidden="true" tabindex="-1"></a>        h(t) = \lambda p t^{p-1}</span>
<span id="cb47-1024"><a href="#cb47-1024" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1025"><a href="#cb47-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1026"><a href="#cb47-1026" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1027"><a href="#cb47-1027" aria-hidden="true" tabindex="-1"></a>        \lambda = \textrm{exp}(\beta_0 + \beta_1 X)</span>
<span id="cb47-1028"><a href="#cb47-1028" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1029"><a href="#cb47-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1030"><a href="#cb47-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For the Weibull accelerated failure time model with one covariate ($X$)</span>
<span id="cb47-1031"><a href="#cb47-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1032"><a href="#cb47-1032" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1033"><a href="#cb47-1033" aria-hidden="true" tabindex="-1"></a>        S(t) = exp(-\lambda t^p)</span>
<span id="cb47-1034"><a href="#cb47-1034" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1035"><a href="#cb47-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1036"><a href="#cb47-1036" aria-hidden="true" tabindex="-1"></a>        Solve for $t$</span>
<span id="cb47-1037"><a href="#cb47-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1038"><a href="#cb47-1038" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1039"><a href="#cb47-1039" aria-hidden="true" tabindex="-1"></a>        t = (-\textrm{ln} S(t))^{1/p} \times \frac{1}{\lambda^{1/p}}</span>
<span id="cb47-1040"><a href="#cb47-1040" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1041"><a href="#cb47-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1042"><a href="#cb47-1042" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1043"><a href="#cb47-1043" aria-hidden="true" tabindex="-1"></a>        \frac{1}{\lambda^{1/p}} = \textrm{exp}(\alpha_0 + \alpha_1 X)</span>
<span id="cb47-1044"><a href="#cb47-1044" aria-hidden="true" tabindex="-1"></a>        $$</span>
<span id="cb47-1045"><a href="#cb47-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1046"><a href="#cb47-1046" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>R 'survreg' default is to give the accelerate failure time parameterization. The acceleration factor (time ratio) is found by exponentiation of the slope as we have done with other models</span>
<span id="cb47-1047"><a href="#cb47-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1048"><a href="#cb47-1048" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare to males, females have survival quantiles that are 1.48 larger than males.  That is median survival time, 25th percentile of survival time, or \texit{any other} quantile of survival time is 1.48 times larger in females.</span>
<span id="cb47-1049"><a href="#cb47-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1052"><a href="#cb47-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-1053"><a href="#cb47-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb47-1054"><a href="#cb47-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit2))</span>
<span id="cb47-1055"><a href="#cb47-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint.default</span>(fit2))</span>
<span id="cb47-1056"><a href="#cb47-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1057"><a href="#cb47-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1060"><a href="#cb47-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-1061"><a href="#cb47-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># 25th, 50th, and 75th percentiles of survival time in males</span></span>
<span id="cb47-1062"><a href="#cb47-1062" aria-hidden="true" tabindex="-1"></a>ptime1[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span>
<span id="cb47-1063"><a href="#cb47-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1064"><a href="#cb47-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># 25th, 50th, and 75th percentiles of survival time in females</span></span>
<span id="cb47-1065"><a href="#cb47-1065" aria-hidden="true" tabindex="-1"></a>ptime2[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span>
<span id="cb47-1066"><a href="#cb47-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1067"><a href="#cb47-1067" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratios is constant (accelerated failure-time assumption)</span></span>
<span id="cb47-1068"><a href="#cb47-1068" aria-hidden="true" tabindex="-1"></a>ptime2[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)] <span class="sc">/</span> ptime1[pct<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0.25"</span>,<span class="st">"0.5"</span>,<span class="st">"0.75"</span>)]</span>
<span id="cb47-1069"><a href="#cb47-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1070"><a href="#cb47-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1071"><a href="#cb47-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To obtain the hazard ratio interpretation, the Weibull model needs to be reparameterized so the output coefficients can be directly interpreted. </span>
<span id="cb47-1072"><a href="#cb47-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1075"><a href="#cb47-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-1076"><a href="#cb47-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">ConvertWeibull</span>(fit2)</span>
<span id="cb47-1077"><a href="#cb47-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1078"><a href="#cb47-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1079"><a href="#cb47-1079" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Hazard ratio (females compared to males) is 0.592</span>
<span id="cb47-1080"><a href="#cb47-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1081"><a href="#cb47-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Females have decreased hazard of death at all time point.  Hazard of death in females divided by the hazard of death in males is 0.592 at all time points (proportional hazards)</span>
<span id="cb47-1082"><a href="#cb47-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1083"><a href="#cb47-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Summary interpretation of both PH and AFT</span>
<span id="cb47-1084"><a href="#cb47-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1085"><a href="#cb47-1085" aria-hidden="true" tabindex="-1"></a>From the Weibull regression model, we can estimate both the hazard ratio and acceleration factor.</span>
<span id="cb47-1086"><a href="#cb47-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1087"><a href="#cb47-1087" aria-hidden="true" tabindex="-1"></a>Comparing females to males, females have a 0.59 fold hazard (risk) of death compared to males. We are 95% confident the true hazard ratio is between a 0.43 and 0.82 fold increase. Since the hazard ratio does not contain 1, females are at a significantly decreased hazard of death compared to males.</span>
<span id="cb47-1088"><a href="#cb47-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1089"><a href="#cb47-1089" aria-hidden="true" tabindex="-1"></a>Comparing females to males, females have a median (or any other quantile) survival time that is 1.49 fold larger than the median (or other quantile) survival time in males. We are 95% confident that the true acceleration factor (time ratio) is between 1.16 and 1.91.</span>
<span id="cb47-1090"><a href="#cb47-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1091"><a href="#cb47-1091" aria-hidden="true" tabindex="-1"></a>The statements are more awkward when the hard ratio is less than 1. We could flip the estimates (e.g $0.5922^{-1}$) and say that the males have a 1.69 fold increased hazard (risk) of death compared to females.</span>
<span id="cb47-1092"><a href="#cb47-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1093"><a href="#cb47-1093" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that a hazard ratio greater than one is harmful for survival while an acceleration factor (time ratio) greater than one is beneficial for survival. One is the null values for both interpretations.</span>
<span id="cb47-1094"><a href="#cb47-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1095"><a href="#cb47-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other parametric models</span></span>
<span id="cb47-1096"><a href="#cb47-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1097"><a href="#cb47-1097" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Example shown here focused on a Weibull model as an introduction. We identified the Exponential distribution (a special case of the Weibull) is not a good fit.</span>
<span id="cb47-1098"><a href="#cb47-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1099"><a href="#cb47-1099" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Other (parametric) distributions are possible. Some have a proportional hazards interpretation (only) or an accelerated failure time interpretation (only). Other lack either of these interpretations, but are more flexible in how they model the hazard function. There is a trade-off between interpretability and flexibility.</span>
<span id="cb47-1100"><a href="#cb47-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1101"><a href="#cb47-1101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Goal is to pick a distribution with a corresponding hazard (cumulative hazard) that is appropriate model for your data, will be reproducible, and is ultimately interpretable.</span>
<span id="cb47-1102"><a href="#cb47-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1103"><a href="#cb47-1103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cox model is a good choice if you want to model associations and not concern yourself with the shape of the hazard function. This is a very common situation and why the Cox model is widely used.</span>
<span id="cb47-1104"><a href="#cb47-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1105"><a href="#cb47-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If goal is prediction, appropriate parametric models (perhaps with additional flexibility) may outperform the Cox model</span>
<span id="cb47-1106"><a href="#cb47-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1107"><a href="#cb47-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1108"><a href="#cb47-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian Time to Event Models</span></span>
<span id="cb47-1109"><a href="#cb47-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1110"><a href="#cb47-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1111"><a href="#cb47-1111" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Bayesian approaches to fitting survival models are often based on parametric approaches or approaches that attempt to mimic the Cox model</span>
<span id="cb47-1112"><a href="#cb47-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1113"><a href="#cb47-1113" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is relatively straight forward to fit Bayesian models using parametric distributions like Weibull</span>
<span id="cb47-1114"><a href="#cb47-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1115"><a href="#cb47-1115" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Models that attempt to recreate a Cox-like models are more complex because it can be difficult to recreate the flexibility of the baseline hazard function needed</span>
<span id="cb47-1116"><a href="#cb47-1116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-1117"><a href="#cb47-1117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-1118"><a href="#cb47-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">### Review: Bayesian Analysis</span></span>
<span id="cb47-1119"><a href="#cb47-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1120"><a href="#cb47-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The Bayesian Paradigm provides a framework for incorporating prior knowledge with observed data through the use of probability models. In this approach:</span>
<span id="cb47-1121"><a href="#cb47-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1122"><a href="#cb47-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Posterior distribution** is obtained by combining:</span>
<span id="cb47-1123"><a href="#cb47-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>The **Likelihood**: $L(\mathbf{\theta}; \mathbf{x})$, representing the probability of the observed data $\mathbf{x}$ given the model parameters $\mathbf{\theta}$.</span>
<span id="cb47-1124"><a href="#cb47-1124" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>The **Prior Distribution**: $\pi(\mathbf{\theta})$, reflecting prior beliefs or information about $\mathbf{\theta}$.</span>
<span id="cb47-1125"><a href="#cb47-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1126"><a href="#cb47-1126" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Mathematically, the posterior distribution is expressed as:</span>
<span id="cb47-1127"><a href="#cb47-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1128"><a href="#cb47-1128" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1129"><a href="#cb47-1129" aria-hidden="true" tabindex="-1"></a>p(\mathbf{\theta} \mid \text{data}) \propto L(\mathbf{\theta}; \mathbf{x}) \cdot \pi(\mathbf{\theta})</span>
<span id="cb47-1130"><a href="#cb47-1130" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1131"><a href="#cb47-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1132"><a href="#cb47-1132" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>This illustrates the key Bayesian principle: beliefs about $\mathbf{\theta}$ (the **posterior distribution**) are updated by combining new evidence (the **likelihood**) with prior knowledge (the **prior distribution**).</span>
<span id="cb47-1133"><a href="#cb47-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1134"><a href="#cb47-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Review: Linear Regression</span></span>
<span id="cb47-1135"><a href="#cb47-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1136"><a href="#cb47-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The Bayesian paradigm can be applied to the linear regression model, where the parameters of interest, $\boldsymbol{\theta} = (\boldsymbol{\beta}, \sigma)$, consist of:</span>
<span id="cb47-1137"><a href="#cb47-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1138"><a href="#cb47-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">   -   </span>$\boldsymbol{\beta}$: The regression coefficients (bold to emphasize their vector nature).</span>
<span id="cb47-1139"><a href="#cb47-1139" aria-hidden="true" tabindex="-1"></a><span class="ss">   -   </span>$\sigma$: The standard deviation of the residuals, representing the variability not explained by the model.</span>
<span id="cb47-1140"><a href="#cb47-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1141"><a href="#cb47-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Likelihood</span></span>
<span id="cb47-1142"><a href="#cb47-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1143"><a href="#cb47-1143" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In classical linear regression, the **Likelihood** $L(\boldsymbol{\theta}; \mathbf{x})$ is modeled as a Normal distribution with mean $\mathbf{X} \boldsymbol{\beta}$ and variance $\sigma^2$, where $\mathbf{X}$ is the design matrix of predictors.</span>
<span id="cb47-1144"><a href="#cb47-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1145"><a href="#cb47-1145" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The likelihood can be expressed as a product of individual likelihoods for each data point $i$, given by:</span>
<span id="cb47-1146"><a href="#cb47-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1147"><a href="#cb47-1147" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1148"><a href="#cb47-1148" aria-hidden="true" tabindex="-1"></a>L(\boldsymbol{\theta}; \mathbf{x}) = \prod_{i=1}^n L_i(\boldsymbol{\theta}; \mathbf{x}_i)</span>
<span id="cb47-1149"><a href="#cb47-1149" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1150"><a href="#cb47-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1151"><a href="#cb47-1151" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>For classical linear regression (assuming a Normal distribution) this becomes:</span>
<span id="cb47-1152"><a href="#cb47-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1153"><a href="#cb47-1153" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1154"><a href="#cb47-1154" aria-hidden="true" tabindex="-1"></a>L(\boldsymbol{\theta}; \mathbf{y}, \mathbf{X}) = \prod_{i=1}^n \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( -\frac{(y_i - \mathbf{x}_i^\top \boldsymbol{\beta})^2}{2 \sigma^2} \right)</span>
<span id="cb47-1155"><a href="#cb47-1155" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1156"><a href="#cb47-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1157"><a href="#cb47-1157" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$y_i$: Observed outcome for the $i$-th data point</span>
<span id="cb47-1158"><a href="#cb47-1158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mathbf{x}_i^T$: Row vector of predictors for the $i$-th data point.</span>
<span id="cb47-1159"><a href="#cb47-1159" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\boldsymbol{\beta}$: Coefficients for the predictors</span>
<span id="cb47-1160"><a href="#cb47-1160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\sigma^2$: Variance of the residuals.</span>
<span id="cb47-1161"><a href="#cb47-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1162"><a href="#cb47-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prior Distributions</span></span>
<span id="cb47-1163"><a href="#cb47-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1164"><a href="#cb47-1164" aria-hidden="true" tabindex="-1"></a>In the Bayesian framework, prior distributions are assigned to the parameters of interest to reflect prior beliefs or knowledge about their values before observing the data. For Bayesian linear regression, typical priors (but not the only priors) include:</span>
<span id="cb47-1165"><a href="#cb47-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1166"><a href="#cb47-1166" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**For** $\boldsymbol{\beta}$: A multivariate Normal distribution: $$</span>
<span id="cb47-1167"><a href="#cb47-1167" aria-hidden="true" tabindex="-1"></a>    \pi(\boldsymbol{\beta}) \sim \mathcal{N}(\boldsymbol{\mu}_\beta, \mathbf{\Sigma}_\beta)</span>
<span id="cb47-1168"><a href="#cb47-1168" aria-hidden="true" tabindex="-1"></a>    $$ where $\boldsymbol{\mu}_\beta$ is the mean vector and $\mathbf{\Sigma}_\beta$ is the covariance matrix, encoding the prior beliefs about $\boldsymbol{\beta}$.</span>
<span id="cb47-1169"><a href="#cb47-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1170"><a href="#cb47-1170" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**For** $\sigma$: An exponential distribution: $$</span>
<span id="cb47-1171"><a href="#cb47-1171" aria-hidden="true" tabindex="-1"></a>    \pi(\sigma) \sim \text{Exponential}(\lambda)</span>
<span id="cb47-1172"><a href="#cb47-1172" aria-hidden="true" tabindex="-1"></a>    $$ where $\lambda$ is a rate parameter. In **rstanarm** and **stan_glm**, $\lambda$ is weakly informative and scaled based on the data, often reflecting the standard deviation of the outcome variable.</span>
<span id="cb47-1173"><a href="#cb47-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1174"><a href="#cb47-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Posterior distribution</span></span>
<span id="cb47-1175"><a href="#cb47-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1176"><a href="#cb47-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>These priors, combined with the likelihood, form the basis for the posterior distribution, which is proportional to the product of the likelihood and the priors.</span>
<span id="cb47-1177"><a href="#cb47-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1178"><a href="#cb47-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>This model encodes several key assumptions:</span>
<span id="cb47-1179"><a href="#cb47-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1180"><a href="#cb47-1180" aria-hidden="true" tabindex="-1"></a>   1 **Linearity**: The relationship between the predictors and the outcome is linear, expressed as the expected value $\mathbb{E}<span class="co">[</span><span class="ot">Y</span><span class="co">]</span> = \mathbf{X} \boldsymbol{\beta}$.</span>
<span id="cb47-1181"><a href="#cb47-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1182"><a href="#cb47-1182" aria-hidden="true" tabindex="-1"></a>   2 **Homoskedasticity**: The variance of the residuals $\text{Var}(\varepsilon_i) = \sigma^2$ is constant across all levels of the predictors.</span>
<span id="cb47-1183"><a href="#cb47-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1184"><a href="#cb47-1184" aria-hidden="true" tabindex="-1"></a>   3 **Normality of the residuals**: $\epsilon_i \sim N(0, \sigma^2)$</span>
<span id="cb47-1185"><a href="#cb47-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1186"><a href="#cb47-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">### Review: Logistic Regression</span></span>
<span id="cb47-1187"><a href="#cb47-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1188"><a href="#cb47-1188" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The Bayesian Paradigm can be applied to the logistic regression model, where the parameters of interest are $\boldsymbol{\theta} = \boldsymbol{\beta}$,</span>
<span id="cb47-1189"><a href="#cb47-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1190"><a href="#cb47-1190" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In logistic regression, the Bayesian approach models the probability of a binary outcome $y_i \in <span class="sc">\{</span>0, 1<span class="sc">\}</span>$ as a function of the predictors $\mathbf{x}_i$ and the regression coefficients $\boldsymbol{\beta}$. The likelihood for the observed data is expressed as:</span>
<span id="cb47-1191"><a href="#cb47-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1192"><a href="#cb47-1192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1193"><a href="#cb47-1193" aria-hidden="true" tabindex="-1"></a>L(\boldsymbol{\beta}; \mathbf{y}, \mathbf{X}) = \prod_{i=1}^n \left( \pi_i \right)^{y_i} \left( 1 - \pi_i \right)^{1 - y_i}</span>
<span id="cb47-1194"><a href="#cb47-1194" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1195"><a href="#cb47-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1196"><a href="#cb47-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1197"><a href="#cb47-1197" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\pi_i = \text{logit}^{-1}(\mathbf{x}_i^\top \boldsymbol{\beta}) = \frac{\exp(\mathbf{x}_i^\top \boldsymbol{\beta})}{1 + \exp(\mathbf{x}_i^\top \boldsymbol{\beta})}$</span>
<span id="cb47-1198"><a href="#cb47-1198" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$y_i$: Observed binary outcome for the $i$-th data point.</span>
<span id="cb47-1199"><a href="#cb47-1199" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\mathbf{x}_i^\top$: Row vector of predictors for the $i$-th data point. </span>
<span id="cb47-1200"><a href="#cb47-1200" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\boldsymbol{\beta}$: Regression coefficients.</span>
<span id="cb47-1201"><a href="#cb47-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1202"><a href="#cb47-1202" aria-hidden="true" tabindex="-1"></a>This likelihood serves as the basis for updating the posterior distribution when combined with appropriate prior distributions on $\boldsymbol{\beta}$.</span>
<span id="cb47-1203"><a href="#cb47-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1204"><a href="#cb47-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1205"><a href="#cb47-1205" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>See <span class="co">[</span><span class="ot">Logistic Regression Notes</span><span class="co">](Lec04.Logistic.qmd#sec-bayeslogistic)</span> for additional details</span>
<span id="cb47-1206"><a href="#cb47-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1207"><a href="#cb47-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1208"><a href="#cb47-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Parametric Survival Analysis</span></span>
<span id="cb47-1209"><a href="#cb47-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1210"><a href="#cb47-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1211"><a href="#cb47-1211" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The Bayesian approach to parametric survival models follow a similar procedure to linear and logistic regression</span>
<span id="cb47-1212"><a href="#cb47-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1213"><a href="#cb47-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>A likelihood is specified based on the assumed underlying probability distribution</span>
<span id="cb47-1214"><a href="#cb47-1214" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1215"><a href="#cb47-1215" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1216"><a href="#cb47-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>Prior distributions are specified for the parameters in the model</span>
<span id="cb47-1217"><a href="#cb47-1217" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1218"><a href="#cb47-1218" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>The posterior distribution is updated combining the likelihood and the prior</span>
<span id="cb47-1219"><a href="#cb47-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1220"><a href="#cb47-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1221"><a href="#cb47-1221" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Weibull model, Bayesian approach</span></span>
<span id="cb47-1222"><a href="#cb47-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1223"><a href="#cb47-1223" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Suppose we assume a Weibull distribution for survival time.  The parameters of interest, $\boldsymbol{\theta}$, typically include:</span>
<span id="cb47-1224"><a href="#cb47-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1225"><a href="#cb47-1225" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>$\boldsymbol{\beta}$: Regression coefficients for covariates (bold to emphasize their vector nature) to impact the scale parameter of the Weibull distribution</span>
<span id="cb47-1226"><a href="#cb47-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1227"><a href="#cb47-1227" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>$p$: Shape parameter of the Weibull distribution.</span>
<span id="cb47-1228"><a href="#cb47-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1229"><a href="#cb47-1229" aria-hidden="true" tabindex="-1"></a>The likelihood for the observed survival data $(t_i, \delta_i)$ is expressed as:</span>
<span id="cb47-1230"><a href="#cb47-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1231"><a href="#cb47-1231" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1232"><a href="#cb47-1232" aria-hidden="true" tabindex="-1"></a>L(\boldsymbol{\theta}; \mathbf{t}, \boldsymbol{\delta}) = \prod_{i=1}^n \left<span class="co">[</span><span class="ot">h(t_i; \lambda, p)^{\delta_i} \cdot S(t_i; \lambda, p)^{1 - \delta_i}\right</span><span class="co">]</span>,</span>
<span id="cb47-1233"><a href="#cb47-1233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1234"><a href="#cb47-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1235"><a href="#cb47-1235" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb47-1236"><a href="#cb47-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1237"><a href="#cb47-1237" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$t_i$: Survival time for the $i$-th individual.</span>
<span id="cb47-1238"><a href="#cb47-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1239"><a href="#cb47-1239" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\delta_i$: Censoring indicator, where $\delta_i = 1$ if the event is observed and $\delta_i = 0$ if the data is censored.</span>
<span id="cb47-1240"><a href="#cb47-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1241"><a href="#cb47-1241" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\mathbf{t}$ and $\boldsymbol{\delta}$: Vectors of survival times and censoring indicators.</span>
<span id="cb47-1242"><a href="#cb47-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1243"><a href="#cb47-1243" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\lambda = \exp(\mathbf{X}\boldsymbol{\beta})$: Scale parameter is modeled as a function of covariates</span>
<span id="cb47-1244"><a href="#cb47-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1245"><a href="#cb47-1245" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prior Distributions</span></span>
<span id="cb47-1246"><a href="#cb47-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1247"><a href="#cb47-1247" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In the Bayesian framework, prior distributions are assigned to the model parameters:</span>
<span id="cb47-1248"><a href="#cb47-1248" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**For $\boldsymbol{\beta}$**: A multivariate Normal distribution:</span>
<span id="cb47-1249"><a href="#cb47-1249" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb47-1250"><a href="#cb47-1250" aria-hidden="true" tabindex="-1"></a>  \pi(\boldsymbol{\beta}) \sim \mathcal{N}(\boldsymbol{\mu}_\beta, \mathbf{\Sigma}_\beta),</span>
<span id="cb47-1251"><a href="#cb47-1251" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb47-1252"><a href="#cb47-1252" aria-hidden="true" tabindex="-1"></a>  where $\boldsymbol{\mu}_\beta$ is the mean vector and $\mathbf{\Sigma}_\beta$ is the covariance matrix.</span>
<span id="cb47-1253"><a href="#cb47-1253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1254"><a href="#cb47-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**For $p$**: Weakly informative prior, such as Gamma distributions or other appropriate priors based on prior knowledge.</span>
<span id="cb47-1255"><a href="#cb47-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1256"><a href="#cb47-1256" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>These priors combined with the likelihood provide the posterior distribution used for inference.</span>
<span id="cb47-1257"><a href="#cb47-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1258"><a href="#cb47-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1259"><a href="#cb47-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Cox-type Models for Time to Event Data</span></span>
<span id="cb47-1260"><a href="#cb47-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1261"><a href="#cb47-1261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is no direct analog of the Cox model in the Bayesian paradigm.  The reason for this relates to the partial likelihood.</span>
<span id="cb47-1262"><a href="#cb47-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1263"><a href="#cb47-1263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cox models are estimated by maximizing the partial likelihood, which does not include the baseline hazard function</span>
<span id="cb47-1264"><a href="#cb47-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1265"><a href="#cb47-1265" aria-hidden="true" tabindex="-1"></a>The partial likelihood for the Cox model is given by:</span>
<span id="cb47-1266"><a href="#cb47-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1267"><a href="#cb47-1267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1268"><a href="#cb47-1268" aria-hidden="true" tabindex="-1"></a>L_p(\boldsymbol{\beta}) = \prod_{i:\delta_i=1} h_0(t_i) \exp(\mathbf{x}_i^\top \boldsymbol{\beta}) \Bigg/ \sum_{j \in R(t_i)} h_0(t_i) \exp(\mathbf{x}_j^\top \boldsymbol{\beta}),</span>
<span id="cb47-1269"><a href="#cb47-1269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1270"><a href="#cb47-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1271"><a href="#cb47-1271" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb47-1272"><a href="#cb47-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1273"><a href="#cb47-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$h_0(t_i)$: Baseline hazard function at time $t_i$.</span>
<span id="cb47-1274"><a href="#cb47-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1275"><a href="#cb47-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\boldsymbol{\beta}$: Regression coefficients.</span>
<span id="cb47-1276"><a href="#cb47-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1277"><a href="#cb47-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\mathbf{x}_i$: Covariates for the $i$-th individual.</span>
<span id="cb47-1278"><a href="#cb47-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1279"><a href="#cb47-1279" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$R(t_i)$: Risk set at time $t_i$, i.e., individuals still at risk just before time $t_i$.</span>
<span id="cb47-1280"><a href="#cb47-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1281"><a href="#cb47-1281" aria-hidden="true" tabindex="-1"></a>The baseline hazard cancels out, so the partial likelihood simplifies to:</span>
<span id="cb47-1282"><a href="#cb47-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1283"><a href="#cb47-1283" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1284"><a href="#cb47-1284" aria-hidden="true" tabindex="-1"></a>L_p(\boldsymbol{\beta}) = \prod_{i:\delta_i=1} \frac{\exp(\mathbf{x}_i^\top \boldsymbol{\beta})}{\sum_{j \in R(t_i)} \exp(\mathbf{x}_j^\top \boldsymbol{\beta})}.</span>
<span id="cb47-1285"><a href="#cb47-1285" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-1286"><a href="#cb47-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1287"><a href="#cb47-1287" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Key point: In a frequentist analysis, $\beta$ is maximized irrespective of the baseline hazard</span>
<span id="cb47-1288"><a href="#cb47-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1289"><a href="#cb47-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In a Bayesian analysis, the unspecified baseline hazard function $h_0(t)$ cannot be ignored.  An additional approach is required to estimate the baseline hazard alongside $\boldsymbol{\beta}$. </span>
<span id="cb47-1290"><a href="#cb47-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1291"><a href="#cb47-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Methods often involve modeling the baseline hazard explicitly, such as using splines or piecewise constant functions.  Alternatively, latent processes can allow flexible modeling and full Bayesian inference.</span>
<span id="cb47-1292"><a href="#cb47-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1293"><a href="#cb47-1293" aria-hidden="true" tabindex="-1"></a><span class="ss">   1. </span>**Piecewise Exponential Model**: The time axis is divided into predefined intervals, and the baseline hazard is assumed to be constant within each interval. This approach offers flexibility while maintaining computational simplicity.</span>
<span id="cb47-1294"><a href="#cb47-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1297"><a href="#cb47-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-1298"><a href="#cb47-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-piecewise-exponential</span></span>
<span id="cb47-1299"><a href="#cb47-1299" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Piecewise Exponential Hazard Function"</span></span>
<span id="cb47-1300"><a href="#cb47-1300" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-1301"><a href="#cb47-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1302"><a href="#cb47-1302" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-1303"><a href="#cb47-1303" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_time =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb47-1304"><a href="#cb47-1304" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_time =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb47-1305"><a href="#cb47-1305" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">0.8</span>, <span class="fl">0.3</span>)</span>
<span id="cb47-1306"><a href="#cb47-1306" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-1307"><a href="#cb47-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> from_time, <span class="at">xend =</span> to_time, <span class="at">y =</span> hazard, <span class="at">yend =</span> hazard))  <span class="sc">+</span></span>
<span id="cb47-1308"><a href="#cb47-1308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-1309"><a href="#cb47-1309" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb47-1310"><a href="#cb47-1310" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Hazard"</span></span>
<span id="cb47-1311"><a href="#cb47-1311" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-1312"><a href="#cb47-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb47-1313"><a href="#cb47-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">1.6</span>)</span>
<span id="cb47-1314"><a href="#cb47-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1315"><a href="#cb47-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1316"><a href="#cb47-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1317"><a href="#cb47-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">   2. </span>**Spline-Based Methods**: The baseline hazard is modeled using splines, such as cubic splines or B-splines, allowing for a smooth and flexible representation of the hazard function over time.</span>
<span id="cb47-1318"><a href="#cb47-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1321"><a href="#cb47-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-1322"><a href="#cb47-1322" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spline-hazard</span></span>
<span id="cb47-1323"><a href="#cb47-1323" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Spline-Based Hazard Function"</span></span>
<span id="cb47-1324"><a href="#cb47-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1325"><a href="#cb47-1325" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb47-1326"><a href="#cb47-1326" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-1327"><a href="#cb47-1327" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb47-1328"><a href="#cb47-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1329"><a href="#cb47-1329" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time points and a base positive hazard function (example)</span></span>
<span id="cb47-1330"><a href="#cb47-1330" aria-hidden="true" tabindex="-1"></a>time_points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb47-1331"><a href="#cb47-1331" aria-hidden="true" tabindex="-1"></a>base_hazard <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time_points <span class="sc">-</span> <span class="fl">0.1</span> <span class="sc">*</span> time_points<span class="sc">^</span><span class="dv">2</span>)  <span class="co"># Ensure hazards are positive</span></span>
<span id="cb47-1332"><a href="#cb47-1332" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fu">length</span>(time_points), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.05</span>))  <span class="co"># Add positive noise</span></span>
<span id="cb47-1333"><a href="#cb47-1333" aria-hidden="true" tabindex="-1"></a>hazard_values <span class="ot">&lt;-</span> base_hazard <span class="sc">+</span> noise</span>
<span id="cb47-1334"><a href="#cb47-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1335"><a href="#cb47-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a cubic spline to the hazard function</span></span>
<span id="cb47-1336"><a href="#cb47-1336" aria-hidden="true" tabindex="-1"></a>spline_fit <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(time_points, hazard_values)</span>
<span id="cb47-1337"><a href="#cb47-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1338"><a href="#cb47-1338" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for plotting the spline</span></span>
<span id="cb47-1339"><a href="#cb47-1339" aria-hidden="true" tabindex="-1"></a>spline_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-1340"><a href="#cb47-1340" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> spline_fit<span class="sc">$</span>x,</span>
<span id="cb47-1341"><a href="#cb47-1341" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> spline_fit<span class="sc">$</span>y</span>
<span id="cb47-1342"><a href="#cb47-1342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-1343"><a href="#cb47-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1344"><a href="#cb47-1344" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the spline-based hazard function</span></span>
<span id="cb47-1345"><a href="#cb47-1345" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> spline_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard)) <span class="sc">+</span></span>
<span id="cb47-1346"><a href="#cb47-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb47-1347"><a href="#cb47-1347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-1348"><a href="#cb47-1348" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb47-1349"><a href="#cb47-1349" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Hazard"</span></span>
<span id="cb47-1350"><a href="#cb47-1350" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-1351"><a href="#cb47-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-1352"><a href="#cb47-1352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>)  <span class="co"># Set y-axis lower bound to 0</span></span>
<span id="cb47-1353"><a href="#cb47-1353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1354"><a href="#cb47-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1355"><a href="#cb47-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1356"><a href="#cb47-1356" aria-hidden="true" tabindex="-1"></a><span class="ss">   3. </span>**Dirichlet Process Priors**: The baseline hazard is modeled nonparametrically using a Dirichlet process prior. This approach provides flexibility in estimating the hazard function by letting the data inform its shape, while still incorporating prior beliefs.</span>
<span id="cb47-1357"><a href="#cb47-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1358"><a href="#cb47-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">   4. </span>**Others**: Machine learning and other approaches</span>
<span id="cb47-1359"><a href="#cb47-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1360"><a href="#cb47-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1361"><a href="#cb47-1361" aria-hidden="true" tabindex="-1"></a><span class="fu">### R-Related Software for Bayesian Survival Analysis</span></span>
<span id="cb47-1362"><a href="#cb47-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1363"><a href="#cb47-1363" aria-hidden="true" tabindex="-1"></a>There are several R packages that support Bayesian survival analysis.</span>
<span id="cb47-1364"><a href="#cb47-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1365"><a href="#cb47-1365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`stan_surv` in `rstanarm`**:</span>
<span id="cb47-1366"><a href="#cb47-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1367"><a href="#cb47-1367" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>This function implements Bayesian survival analysis using flexible parametric models. It can handle a variety of survival models, including those with user-specified baseline hazard functions</span>
<span id="cb47-1368"><a href="#cb47-1368" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1369"><a href="#cb47-1369" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>It is currently (March, 2025) available in the development version of <span class="in">`rstanarm`</span>, so I am not demonstrating it.</span>
<span id="cb47-1370"><a href="#cb47-1370" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1371"><a href="#cb47-1371" aria-hidden="true" tabindex="-1"></a><span class="ss">   *  </span><span class="co">[</span><span class="ot">Estimating Survival (Time-to-Event) Models with rstanarm</span><span class="co">](https://stan-dev.r-universe.dev/articles/rstanarm/surv.html)</span></span>
<span id="cb47-1372"><a href="#cb47-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1373"><a href="#cb47-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1374"><a href="#cb47-1374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`brms`**</span>
<span id="cb47-1375"><a href="#cb47-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1376"><a href="#cb47-1376" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>The <span class="in">`brms`</span> package allows for Bayesian survival models using flexible formula syntax</span>
<span id="cb47-1377"><a href="#cb47-1377" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1378"><a href="#cb47-1378" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>Supports parametric survival distributions and can be used to specify custom hazard models.</span>
<span id="cb47-1379"><a href="#cb47-1379" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1380"><a href="#cb47-1380" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span><span class="co">[</span><span class="ot">Bayesian Regression Models using STAN</span><span class="co">](https://paul-buerkner.github.io/brms/)</span></span>
<span id="cb47-1381"><a href="#cb47-1381" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-1382"><a href="#cb47-1382" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Both packages are use-friendly front ends for <span class="co">[</span><span class="ot">Stan: Software for Bayesian Analysis</span><span class="co">](https://mc-stan.org/)</span></span>
<span id="cb47-1383"><a href="#cb47-1383" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024-2025, James C Slaughter</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chrissl789/modern-regression/edit/main/notes/Lec08.Survival.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>