<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Slaughter">
<meta name="dcterms.date" content="2024-10-07">

<title>Flexible Modeling of Continuous Predictors – BIOS 6312 - Spring 2026</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/Lec12.ANOVA.Model.Choice.html" rel="next">
<link href="../notes/Set8.pdf" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Flexible Modeling of Continuous Predictors – BIOS 6312 - Spring 2026">
<meta property="og:description" content="Lecture 11">
<meta property="og:site_name" content="BIOS 6312 - Spring 2026">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec11.DoseResponse.html">Flexible Modeling of Continuous Predictors</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">BIOS 6312 - Spring 2026</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Course Information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/Lec01.Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductory Slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../officehours.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Office Hours</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec02.review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review of Key Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec03.SimpleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec04.Logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec05.Precision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precision of Statistical Intefence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec06.ConfoundingEffectModificationMediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confouding, Effect Modification, and Mediation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec07.MultivariableModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariable Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/EstimationAndInference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frequentist Estimation and Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set6.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec08.Survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec09.Poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec10.Modeling.Effect.Modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set8.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial and Ordinal Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec11.DoseResponse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Flexible Modeling of Continuous Predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec12.ANOVA.Model.Choice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA and Model Choice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Lec13.Prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Based Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/BayesDiagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Model Diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set13.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/Set14.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Bootstrap</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab1-linearregression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Linear regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab2-linearassumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Assumption in Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab3-logistic-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab4-precision-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Precision and adjustment for baseline</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab-weighted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(Mini) Lab: Weighted Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab5-multivariable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5: Multivariable Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab6-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 6: Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab7-effectmodification-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7: Poisson Regression and Effect Modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/Lab-DiscreteOutcomeRegression.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 8: Discrete Outcomes Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vanderbilt.box.com/s/rpftvmc9vua2w3gz3jy16phlnsojs6on" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Box folder with .qmd files</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Supplemental notes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/slr-derivations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SLR derivations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-diagnostics-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model diagnostics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/mlr-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLR matrix notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/log-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Log transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/model-selection-criteria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model selection criteria</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/ReviewMatrixAlgebra.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrix algebra review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supplemental/Baseline_Change_MACH.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Change from baseline and precision</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Statcomp2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Main directory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://statcomp2.app.vumc.org/modern-regression/lectures/data" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#flexible-models-of-continuous-predictors" id="toc-flexible-models-of-continuous-predictors" class="nav-link active" data-scroll-target="#flexible-models-of-continuous-predictors"><span class="header-section-number">1</span> Flexible models of continuous predictors</a>
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">1.1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#common-continuous-measures" id="toc-common-continuous-measures" class="nav-link" data-scroll-target="#common-continuous-measures"><span class="header-section-number">1.1.1</span> Common continuous measures</a></li>
  <li><a href="#scientific-questions-when-modeling-dose-response" id="toc-scientific-questions-when-modeling-dose-response" class="nav-link" data-scroll-target="#scientific-questions-when-modeling-dose-response"><span class="header-section-number">1.1.2</span> Scientific questions when modeling dose-response</a></li>
  </ul></li>
  <li><a href="#hierarchical-models" id="toc-hierarchical-models" class="nav-link" data-scroll-target="#hierarchical-models"><span class="header-section-number">1.2</span> Hierarchical Models</a>
  <ul class="collapse">
  <li><a href="#full-and-restricted-models" id="toc-full-and-restricted-models" class="nav-link" data-scroll-target="#full-and-restricted-models"><span class="header-section-number">1.2.1</span> Full and restricted models</a></li>
  <li><a href="#scientific-interpretation-of-full-versus-restricted-models" id="toc-scientific-interpretation-of-full-versus-restricted-models" class="nav-link" data-scroll-target="#scientific-interpretation-of-full-versus-restricted-models"><span class="header-section-number">1.2.2</span> Scientific interpretation of full versus restricted models</a>
  <ul class="collapse">
  <li><a href="#example-1-adjusted-effects" id="toc-example-1-adjusted-effects" class="nav-link" data-scroll-target="#example-1-adjusted-effects"><span class="header-section-number">1.2.2.1</span> Example 1: Adjusted effects</a></li>
  <li><a href="#example-2-tests-of-linearity" id="toc-example-2-tests-of-linearity" class="nav-link" data-scroll-target="#example-2-tests-of-linearity"><span class="header-section-number">1.2.2.2</span> Example 2: Tests of linearity</a></li>
  </ul></li>
  <li><a href="#statistical-comparison-of-full-and-reduced-models" id="toc-statistical-comparison-of-full-and-reduced-models" class="nav-link" data-scroll-target="#statistical-comparison-of-full-and-reduced-models"><span class="header-section-number">1.2.3</span> Statistical comparison of full and reduced models</a></li>
  <li><a href="#models-with-interactions-effect-modification" id="toc-models-with-interactions-effect-modification" class="nav-link" data-scroll-target="#models-with-interactions-effect-modification"><span class="header-section-number">1.2.4</span> Models with interactions (effect modification)</a>
  <ul class="collapse">
  <li><a href="#examples-of-different-scientific-tests-from-the-same-full-model" id="toc-examples-of-different-scientific-tests-from-the-same-full-model" class="nav-link" data-scroll-target="#examples-of-different-scientific-tests-from-the-same-full-model"><span class="header-section-number">1.2.4.1</span> Examples of different scientific tests from the same full model</a></li>
  <li><a href="#be-careful-when-making-data-driven-model-building-decisions" id="toc-be-careful-when-making-data-driven-model-building-decisions" class="nav-link" data-scroll-target="#be-careful-when-making-data-driven-model-building-decisions"><span class="header-section-number">1.2.4.2</span> Be careful when making data-driven model building decisions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#modeling-complex-dose-response" id="toc-modeling-complex-dose-response" class="nav-link" data-scroll-target="#modeling-complex-dose-response"><span class="header-section-number">1.3</span> Modeling Complex Dose-Response</a>
  <ul class="collapse">
  <li><a href="#s-shaped-dose-response-curves" id="toc-s-shaped-dose-response-curves" class="nav-link" data-scroll-target="#s-shaped-dose-response-curves"><span class="header-section-number">1.3.1</span> S-Shaped dose-response curves</a>
  <ul class="collapse">
  <li><a href="#loess-smoothing" id="toc-loess-smoothing" class="nav-link" data-scroll-target="#loess-smoothing"><span class="header-section-number">1.3.1.1</span> Loess smoothing</a></li>
  </ul></li>
  <li><a href="#linear-predictors" id="toc-linear-predictors" class="nav-link" data-scroll-target="#linear-predictors"><span class="header-section-number">1.3.2</span> Linear predictors</a></li>
  <li><a href="#types-of-transformations" id="toc-types-of-transformations" class="nav-link" data-scroll-target="#types-of-transformations"><span class="header-section-number">1.3.3</span> Types of transformations</a></li>
  <li><a href="#example-fev-and-height-association" id="toc-example-fev-and-height-association" class="nav-link" data-scroll-target="#example-fev-and-height-association"><span class="header-section-number">1.3.4</span> Example: FEV and Height association</a>
  <ul class="collapse">
  <li><a href="#example-log-fev-and-polynomial-height" id="toc-example-log-fev-and-polynomial-height" class="nav-link" data-scroll-target="#example-log-fev-and-polynomial-height"><span class="header-section-number">1.3.4.1</span> Example: log FEV and polynomial height</a></li>
  </ul></li>
  <li><a href="#dummy-variables" id="toc-dummy-variables" class="nav-link" data-scroll-target="#dummy-variables"><span class="header-section-number">1.3.5</span> Dummy Variables</a>
  <ul class="collapse">
  <li><a href="#example-mean-salary-by-field" id="toc-example-mean-salary-by-field" class="nav-link" data-scroll-target="#example-mean-salary-by-field"><span class="header-section-number">1.3.5.1</span> Example: Mean salary by Field</a></li>
  <li><a href="#continuous-variables" id="toc-continuous-variables" class="nav-link" data-scroll-target="#continuous-variables"><span class="header-section-number">1.3.5.2</span> Continuous variables</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#flexible-methods" id="toc-flexible-methods" class="nav-link" data-scroll-target="#flexible-methods"><span class="header-section-number">1.4</span> Flexible Methods</a>
  <ul class="collapse">
  <li><a href="#polyhomial-functions" id="toc-polyhomial-functions" class="nav-link" data-scroll-target="#polyhomial-functions"><span class="header-section-number">1.4.1</span> Polyhomial functions</a></li>
  <li><a href="#piecewise-linear-splines" id="toc-piecewise-linear-splines" class="nav-link" data-scroll-target="#piecewise-linear-splines"><span class="header-section-number">1.4.2</span> Piecewise Linear Splines</a>
  <ul class="collapse">
  <li><a href="#piecewise-linear-spline-interpretation-marginal-is-false-the-default" id="toc-piecewise-linear-spline-interpretation-marginal-is-false-the-default" class="nav-link" data-scroll-target="#piecewise-linear-spline-interpretation-marginal-is-false-the-default"><span class="header-section-number">1.4.2.1</span> Piecewise linear spline interpretation (marginal is FALSE, the default)</a></li>
  <li><a href="#piecewise-linear-spline-interpretation-marginal-is-true-the-default" id="toc-piecewise-linear-spline-interpretation-marginal-is-true-the-default" class="nav-link" data-scroll-target="#piecewise-linear-spline-interpretation-marginal-is-true-the-default"><span class="header-section-number">1.4.2.2</span> Piecewise linear spline interpretation (marginal is TRUE, the default)</a></li>
  </ul></li>
  <li><a href="#polynomial-splines" id="toc-polynomial-splines" class="nav-link" data-scroll-target="#polynomial-splines"><span class="header-section-number">1.4.3</span> Polynomial splines</a></li>
  </ul></li>
  <li><a href="#summary-comments" id="toc-summary-comments" class="nav-link" data-scroll-target="#summary-comments"><span class="header-section-number">1.5</span> Summary comments</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header">

<div class="right">
<!--
<a href="https://github.com/chrissl789/modern-regression/raw/main/Lec11.DoseResponse.qmd" target="_blank">View Code</a>
-->
<a href="https://statcomp2.app.vumc.org/modern-regression/lectures/Lec11.DoseResponse.qmd" target="_blank">Download Code</a>

</div>

<div class="quarto-title-block d-none d-lg-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/Lec02.review.html">Course Notes</a></li><li class="breadcrumb-item"><a href="../notes/Lec11.DoseResponse.html">Flexible Modeling of Continuous Predictors</a></li></ol></nav><div><h1 class="title">Flexible Modeling of Continuous Predictors</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lecture 11</p>
<p class="author">Chris Slaughter</p>

<p class="date">October 7, 2024</p>

</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lspline)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">source</span>(<span class="st">'pander_registry.R'</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">invisible</span>(e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="flexible-models-of-continuous-predictors" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Flexible models of continuous predictors</h1>
<section id="overview" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1.1</span> Overview</h2>
<ul>
<li><p>When covariates are measured on a continuous scale, we have many different approaches to analysis</p></li>
<li><p>To date, we have focused primarily on approaches that facilitate interpretation of our parameter estimates</p>
<ul>
<li>Untransformed
<ul>
<li>Additive changes</li>
<li>Compare group differing by <span class="math inline">\(X\)</span> units in the covariate of interest</li>
</ul></li>
<li>Log transformed
<ul>
<li>Fold (multiplicative) changes</li>
<li>Compares groups with a <span class="math inline">\(k\)</span>-fold difference in the covariate of interest</li>
</ul></li>
</ul></li>
<li><p>Flexible modeling of continuous covariates are another option</p>
<ul>
<li><p>Interpretation often relies on plots, except in special cases</p></li>
<li><p>It is best to pre-specify how we intend to model continuous covariates to avoid data-driven modeling decision</p></li>
</ul></li>
</ul>
<section id="common-continuous-measures" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="common-continuous-measures"><span class="header-section-number">1.1.1</span> Common continuous measures</h3>
<ul>
<li>Dose. Typically, dose of some treatment. Higher doses presumed to lead to greater (or lesser) response.</li>
<li>Exposure. Typically, greater precision (more power) to consider amount of exposure rather than just Exposed versus Unexposed</li>
<li>Many others. Age, serum cholesterol, blood pressure, height, etc.</li>
<li>“Dose-response” in the following notes that follow more generally refers to “doses” of any type of continuous covariate (“doses of age”, “doses of cholesterol”, etc.)</li>
</ul>
</section>
<section id="scientific-questions-when-modeling-dose-response" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="scientific-questions-when-modeling-dose-response"><span class="header-section-number">1.1.2</span> Scientific questions when modeling dose-response</h3>
<ul>
<li><p>We have many choices for modeling dose-response</p></li>
<li><p>Consider the scientific question when deciding on an appropriate model</p></li>
<li><p>How does the scientific question you want to answer relate to how you model the dose-response relationship?</p>
<ul>
<li>Models for detecting an association in subgroups defined by <span class="math inline">\(X\)</span></li>
<li>Models for estimating the mean response in subgroups defined by <span class="math inline">\(X\)</span></li>
<li>Models for predicting individual response in subgroups defined by <span class="math inline">\(X\)</span></li>
</ul></li>
<li><p>Will describe methods for</p>
<ul>
<li><p>Modeling complex dose-response curves</p></li>
<li><p>Flexible methods (non-parametric loess smooths, parameteric regression splines)</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="hierarchical-models" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="hierarchical-models"><span class="header-section-number">1.2</span> Hierarchical Models</h2>
<section id="full-and-restricted-models" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="full-and-restricted-models"><span class="header-section-number">1.2.1</span> Full and restricted models</h3>
<ul>
<li><p>When testing for associations, we are implicitly comparing two models</p>
<ul>
<li><p>“Full” model</p>
<ul>
<li><p>Usually corresponds to alternative hypothesis</p></li>
<li><p>Contains all terms in the “restricted” model plus some terms that we want to test for inclusion</p></li>
<li><p>Example: <span class="math inline">\(g(\theta) = \beta_0 + \beta_1 * X_1 + \beta_2 * X_2\)</span></p></li>
</ul></li>
<li><p>“Restricted” model</p>
<ul>
<li><p>Usually corresponds to the null hypothesis</p></li>
<li><p>Terms in the model are the subset of the terms in the full model that are not being tested</p></li>
<li><p>Example: <span class="math inline">\(g(\theta) = \beta_0 + \beta_1 * X_1\)</span></p></li>
</ul></li>
<li><p>Jargon: The restricted model is “nested” in the full model</p>
<ul>
<li><p>If we set some parameters in the full model equal to zero, we will get the restricted model</p></li>
<li><p>We have very good methods for testing differences between nested models</p>
<ul>
<li>Is a model with weight and height as predictors better than a model with just weight?</li>
</ul></li>
<li><p>Our methods are not as good for comparing models that are not nested</p>
<ul>
<li>Is a model with just weight as a predictor better than a model with just height as a predictor?</li>
</ul></li>
</ul></li>
<li><p>Non-nested models (e.g.&nbsp;<span class="math inline">\(X_1\)</span> is weight, <span class="math inline">\(X_2\)</span> is height)</p>
<ul>
<li><p><span class="math inline">\(g(\theta) = \beta_0 + \beta_1 * X_1\)</span></p></li>
<li><p><span class="math inline">\(g(\theta) = \gamma_0 + \gamma_2 * X_2\)</span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="scientific-interpretation-of-full-versus-restricted-models" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="scientific-interpretation-of-full-versus-restricted-models"><span class="header-section-number">1.2.2</span> Scientific interpretation of full versus restricted models</h3>
<ul>
<li><p>Our scientific interpretation of our statistical tests depends on the meaning of the restricted model compared to the full model</p>
<ul>
<li>Consider the the additional associations that are possible with the full model that are not possible with the restricted model</li>
</ul></li>
<li><p>Appears very straightforward when we are only considering one full model compared to one restricted model</p>
<ul>
<li><p>In practice, we may have many restricted models in mind</p></li>
<li><p>Multiple testing problem appears if we are considering many restricted models</p></li>
</ul></li>
</ul>
<section id="example-1-adjusted-effects" class="level4" data-number="1.2.2.1">
<h4 data-number="1.2.2.1" class="anchored" data-anchor-id="example-1-adjusted-effects"><span class="header-section-number">1.2.2.1</span> Example 1: Adjusted effects</h4>
<ul>
<li><p>Full model: FEV vs smoking, age, height</p></li>
<li><p>Restricted model: FEV vs age, height</p></li>
<li><p>If the full model provides no clear advantage over the restricted model, then we conclude that there is insufficient evidence to suggest an association between FEV and smoking when controlling for age and height</p></li>
<li><p>Note how carefully I stated the above</p>
<ul>
<li><p>“Insufficient evidence” (not evidence that smoking is not associated)</p></li>
<li><p>Conditional on controlling for age and height. Smoking, alone, may be an important predictor of FEV. The question answered by the full and reduced model is a comparison of FEV “among individuals of the same age and height but differing in smoking status” not just individuals who differ in smoking status.</p></li>
</ul></li>
</ul>
</section>
<section id="example-2-tests-of-linearity" class="level4" data-number="1.2.2.2">
<h4 data-number="1.2.2.2" class="anchored" data-anchor-id="example-2-tests-of-linearity"><span class="header-section-number">1.2.2.2</span> Example 2: Tests of linearity</h4>
<ul>
<li><p>Full model: Survival vs cholesterol and cholesterol<span class="math inline">\(^2\)</span></p>
<ul>
<li><p>Linear and quadratic terms for cholesterol</p></li>
<li><p>Model allows for a parabolic shape for chelesterol</p></li>
</ul></li>
<li><p>Restricted model: Survival vs cholesterol</p></li>
<li><p>If the full model provides no clear advantage over the restricted model, we conclude that there is insufficient evidence to suggest a U-shaped trend in survival with cholesterol</p></li>
<li><p>Note that a quadratic term does not include all possibilities for non-linearity. We will cover other (better) approaches later in the notes</p></li>
</ul>
</section>
</section>
<section id="statistical-comparison-of-full-and-reduced-models" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="statistical-comparison-of-full-and-reduced-models"><span class="header-section-number">1.2.3</span> Statistical comparison of full and reduced models</h3>
<ul>
<li><p>Wald test</p>
<ul>
<li><p>Fits only the full model</p></li>
<li><p>Tests if the parameter (or parameters) in the full model are equal to zero</p></li>
<li><p>Can be used for robust and non-robust standard error estimates (fit using GEE)</p></li>
</ul></li>
<li><p>Likelihood Ratio test</p>
<ul>
<li><p>Fits both the full and reduced model</p></li>
<li><p>Compares the likelihood functions to determine if they are significantly different</p></li>
<li><p>Can be used for non-robust models only (fit using likelihood)</p></li>
</ul></li>
<li><p>Score test</p>
<ul>
<li><p>Only fits the reduced model</p></li>
<li><p>Considers the gradient of the likelihood function. After fitting the reduced model, looks at what is left over to see if it can be predicted by additional covariates</p></li>
<li><p>Not generally reported in regression model setting, but some common tests are Score tests (e.g.&nbsp;log-rank test)</p></li>
</ul></li>
<li><p>In large samples, the Wald, Likelihood Ratio, and Score tests converge</p>
<ul>
<li>Given our focus on robust standard error estimates, we have used Wald tests almost exclusively</li>
</ul></li>
</ul>
</section>
<section id="models-with-interactions-effect-modification" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="models-with-interactions-effect-modification"><span class="header-section-number">1.2.4</span> Models with interactions (effect modification)</h3>
<ul>
<li><p>Models to test for effect modification (interactions) are hierarchical</p>
<ul>
<li><p>Full Model: Include the interactions</p></li>
<li><p>Reduced Model: Set the interactions to be tested in the full model to zero</p></li>
</ul></li>
<li><p>Best scientific approach is to pre-specify the statistical model that will be used for analysis</p></li>
<li><p>Sometimes we choose a relatively large model including interactions</p>
<ul>
<li><p>Allows us to address more questions (e.g.&nbsp;effect modification)</p></li>
<li><p>Sometimes gives greater precision</p>
<ul>
<li>Trade-offs between more parameters to estimate versus smaller within group variability</li>
</ul></li>
</ul></li>
<li><p>Deciding which parameters to test from the full model</p>
<ul>
<li><p>It can be difficult to decide the statistical test that corresponds to specific scientific questions</p></li>
<li><p>Need to consider the restricted model that corresponds to your null hypothesis</p>
<ul>
<li>Which parameters in the full model need to be set to zero to test your desired hypothesis</li>
</ul></li>
</ul></li>
</ul>
<section id="examples-of-different-scientific-tests-from-the-same-full-model" class="level4" data-number="1.2.4.1">
<h4 data-number="1.2.4.1" class="anchored" data-anchor-id="examples-of-different-scientific-tests-from-the-same-full-model"><span class="header-section-number">1.2.4.1</span> Examples of different scientific tests from the same full model</h4>
<ul>
<li><p>In the following examples, the full model is the same but we change the restricted model based on the scientific question</p>
<ul>
<li><p>Full model: Survival vs sex, smoking, sex-smoking interaction</p></li>
<li><p>Example Question 1: Is there effect modification?</p>
<ul>
<li><p>Restricted model: Survival vs sex and smoking</p>
<ul>
<li>Test that the sex-smoking interaction is zero</li>
</ul></li>
</ul></li>
<li><p>Example question 2: Is there an association between survival and sex?</p>
<ul>
<li><p>Restricted model: Survival vs smoking</p>
<ul>
<li><p>Test that parameters for sex and sex-smoking interaction are zero</p></li>
<li><p>Does sex effect survival in either smokers or non-smokers?</p></li>
</ul></li>
</ul></li>
<li><p>Example question 3: Is there an association between survival and smoking?</p>
<ul>
<li><p>Restricted model: Survival vs sex</p>
<ul>
<li>Test that parameters for smoking and sex-smoking interaction are zero</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="be-careful-when-making-data-driven-model-building-decisions" class="level4" data-number="1.2.4.2">
<h4 data-number="1.2.4.2" class="anchored" data-anchor-id="be-careful-when-making-data-driven-model-building-decisions"><span class="header-section-number">1.2.4.2</span> Be careful when making data-driven model building decisions</h4>
<ul>
<li><p>We are often tempted to remove parameters that are not statistically significant before proceeding to other tests</p>
<ul>
<li><p>You will find many textbooks that advocate using this analysis approach</p>
<ul>
<li><p>e.g.&nbsp;fit the interaction, if it is not significant, exclude it from the model</p></li>
<li><p>Such texts are invariable written by mathematicians with no understanding of the underlying science</p></li>
<li><p>When you work in the same scientific area, you will eventually “discover” false-positive assocations if you use this model building technique</p></li>
</ul></li>
<li><p>Such data-driven analyses tend to suggest that failure to reject the null means equivalence</p>
<ul>
<li><p>But, if you make this conclusion, you are wrong (large p-values do not indicate equivalence)</p></li>
<li><p>Abscence of evidence is not evidence of abscence</p></li>
</ul></li>
<li><p>A procedure where we fit one model, and then use the results to determine the next model we will fit tends to underestimate the true standard error</p>
<ul>
<li><p>A consequence of the genearl multiple testing problem</p></li>
<li><p>Will lead to declaring statistical significance more often than you should (inflates type-I error rate)</p></li>
<li><p>May also lead to parameter estimates that are biased away from the null</p>
<ul>
<li><p>Statistical significance increases as a function of the effect size and the inverse of the standard error</p></li>
<li><p>If, by chance, you see a large effect in your sample, you will be more likely to declare significance</p></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>How we interpret “negative” studies</p>
<ul>
<li><p>There are other many reasons for not rejecting the null hypothesis of zero slope</p>
<ul>
<li><p>There may be no association</p></li>
<li><p>There may be an association, but not in the parameter considered (i.e.&nbsp;the mean response)</p></li>
<li><p>There may be an association in the parameter considered, but the best fitting line has zero slope (a curvilinear association in the parameter)</p></li>
<li><p>There may be a first order trend in the parameter, but we lack sufficient statistical precision to be confident that it truly exists (a type-II error)</p></li>
</ul></li>
<li><p>Be careful to not just assume that it the first reason, no association</p></li>
<li><p>Statistically, there is no way of discriminating between these four possibilities unless you have an infinite sample size</p></li>
</ul></li>
</ul>
</section>
</section>
</section>
<section id="modeling-complex-dose-response" class="level2 page-columns page-full" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="modeling-complex-dose-response"><span class="header-section-number">1.3</span> Modeling Complex Dose-Response</h2>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figures/quote-all-models-are-approximations-essentially-all-models-are-wrong-but-some-are-useful-however-george-e-p-box-98-93-58.jpg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">All models are wrong, but some are useful.</figcaption>
</figure>
</div>
<section id="s-shaped-dose-response-curves" class="level3 page-columns page-full" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="s-shaped-dose-response-curves"><span class="header-section-number">1.3.1</span> S-Shaped dose-response curves</h3>
<ul>
<li>It is common in biology, medicine, and science to find “S-shaped” dose-response curves</li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y=</span><span class="dv">20</span> <span class="sc">+</span> <span class="dv">50</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">15</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span>n<span class="dv">-50</span>))))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plotdata<span class="sc">$</span>y <span class="ot">&lt;-</span> plotdata<span class="sc">$</span>y <span class="sc">+</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">4</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">S-shaped dose response curve fit with loess smoother</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>If we happen to sample over the entire range of <span class="math inline">\(X\)</span> (in this example, from 0 to 100), we will would observe all parts of the S-curve</p></li>
<li><p>However, if we were only to sample from a limited range of <span class="math inline">\(X\)</span>, we might observe only parts of the curve where it was approximately linear</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plotdata<span class="sc">$</span>xint <span class="ot">&lt;-</span> <span class="fu">cut</span>(plotdata<span class="sc">$</span>x, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">70</span>,<span class="dv">100</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> xint) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">The S-shaped dose response curve fit is approximately linear within three ranges of X.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Even if we expect a complex dose response relationship, we must also consider the range of dose that we are sampling over when considering the needed complexity of the model</li>
</ul>
<section id="loess-smoothing" class="level4" data-number="1.3.1.1">
<h4 data-number="1.3.1.1" class="anchored" data-anchor-id="loess-smoothing"><span class="header-section-number">1.3.1.1</span> Loess smoothing</h4>
<ul>
<li><p>The default smooth for ‘geom_smooth’ when there are fewer than 1000 data points is a loess smooth. These fits appear in the plots above</p></li>
<li><p>Loess is a non-parametric smooth where fitting is done locally.</p></li>
<li><p>That is, for the fit at point x, the fit is made using points in a neighborhood of x, weighted by their distance from x</p></li>
<li><p>There are arguments to control the degree of smoothing, or how close we consider points to be in the “neighborhood of x”</p></li>
<li><p>‘loess’ provides a nice visual representation to variety of data without having to specify a model</p></li>
<li><p>We will primarily be concerned with parametric smoothers as the parameters can be estimated (and in special cases interpreted) from multivariable regression models</p></li>
</ul>
</section>
</section>
<section id="linear-predictors" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="linear-predictors"><span class="header-section-number">1.3.2</span> Linear predictors</h3>
<ul>
<li><p>The most commonly-used regression models all consider “linear predictors”</p>
<ul>
<li><p>Linear refers to linear in the parameters (<span class="math inline">\(\beta\)</span>s), and is not a reference to transformations of the predictors</p></li>
<li><p>The modeled predictors can be transformations of the scientific measurements and still be linear (in the parameters). These models are linear (in the parameters)</p>
<ul>
<li><p><span class="math inline">\(g[\theta | X_i] = \beta_0 + \beta_1 \textrm{log}(X_i)\)</span></p></li>
<li><p><span class="math inline">\(g[\theta | X_i] = \beta_0 + \beta_1 X_i + \beta_2 X_i^2\)</span></p></li>
</ul></li>
<li><p>Examples of models that are <em>not</em> linear in the parameters (We do not consider such models)</p>
<ul>
<li><p><span class="math inline">\(g[\theta | X_i] = \beta_0 X_i^{\beta_1}\)</span></p></li>
<li><p><span class="math inline">\(g[\theta | X_i] = \beta_0 + \beta_1 \textrm{exp}(-\beta_2 X_i)\)</span></p></li>
<li><p><span class="math inline">\(g[\theta | X_i] = \frac{\beta_0 + \beta_1 X_i}{1 + \beta_2 X_i}\)</span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="types-of-transformations" class="level3 page-columns page-full" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="types-of-transformations"><span class="header-section-number">1.3.3</span> Types of transformations</h3>
<ul>
<li><p>We transform predictors to provide more flexible description of complex associations between the response and some scientific measure</p>
<ul>
<li><p>Threshold effects</p></li>
<li><p>Exponentially increasing effects</p></li>
<li><p>U-shaped functions</p></li>
<li><p>S-shaped functions</p></li>
<li><p>etc.</p></li>
</ul></li>
<li><p>Flexible modeling of continuous predictors was briefly covered in the notes on Poisson regression. We used a flexible dose-response model to examine the association between BMI and reflux rate by Esophagitis status</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bmi.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bmi.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Events are pH less than 4</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>bmi.data<span class="sc">$</span>events <span class="ot">&lt;-</span> bmi.data<span class="sc">$</span>totalmins4</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>m.spline2.adj <span class="ot">&lt;-</span> <span class="fu">glm</span>(events <span class="sc">~</span> <span class="fu">ns</span>(bmi,<span class="dv">4</span>) <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(totalmins)) <span class="sc">+</span> esop, <span class="at">data=</span>bmi.data, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>m.spline3.adj <span class="ot">&lt;-</span> <span class="fu">lm</span>(events <span class="sc">/</span> totalmins <span class="sc">~</span> <span class="fu">ns</span>(bmi,<span class="dv">4</span>) <span class="sc">+</span> esop, <span class="at">data=</span>bmi.data)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="fu">exp</span>(<span class="fu">predict</span>(m.spline2.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">totalmins=</span><span class="dv">720</span>, <span class="at">esop=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">"link"</span>)), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylab=</span><span class="st">"Predicted number of events per day"</span>, <span class="at">xlab=</span><span class="st">"BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">main=</span><span class="st">"Poisson Reg"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">4</span>, <span class="at">labels=</span><span class="cn">FALSE</span>, <span class="at">ticks=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="fu">c</span>(<span class="st">"Esophagitis Pos"</span>,<span class="st">"Esophagitis Neg"</span>), <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="fu">exp</span>(<span class="fu">predict</span>(m.spline2.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">totalmins=</span><span class="dv">720</span>, <span class="at">esop=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">"link"</span>)), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">720</span><span class="sc">*</span><span class="fu">predict</span>(m.spline3.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">esop=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">"response"</span>), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">'Blue'</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">xlab=</span><span class="st">"BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">main=</span><span class="st">"Linear Reg"</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">4</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">labels=</span><span class="cn">FALSE</span>, <span class="at">ticks=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">720</span><span class="sc">*</span><span class="fu">predict</span>(m.spline3.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">esop=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">"response"</span>), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">'Blue'</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="fu">c</span>(<span class="st">"Esophagitis Pos"</span>,<span class="st">"Esophagitis Neg"</span>), <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"Blue"</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>1:1 Transformations</p>
<ul>
<li><p>Sometimes we can transform 1 scientific measurement into 1 modeled predictor and acheve approximate linearity</p></li>
<li><p>Ex: log transformations will sometimes address apparent threshold effects</p></li>
</ul></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>logx <span class="ot">&lt;-</span> <span class="fu">log</span>(x)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">+</span> logx <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">main=</span><span class="st">"Untransformed"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(y<span class="sc">~</span>x), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logx, y, <span class="at">main=</span><span class="st">"Log Transformed X"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(y <span class="sc">~</span> logx), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Log transformation addresses threshold effect in untransformed X</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Ex: cubing height produces a more linear association with FEV</li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fev <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file=</span><span class="st">"data/FEV.csv"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fev<span class="sc">$</span>height, fev<span class="sc">$</span>fev, <span class="at">main=</span><span class="st">"Untransformed"</span>, <span class="at">pch=</span><span class="st">'.'</span>, <span class="at">xlab=</span><span class="st">"Height"</span>,<span class="at">ylab=</span><span class="st">"FEV"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(fev<span class="sc">$</span>fev <span class="sc">~</span> fev<span class="sc">$</span>height), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>height3 <span class="ot">&lt;-</span> fev<span class="sc">$</span>height<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fev<span class="sc">$</span>height3, fev<span class="sc">$</span>fev, <span class="at">main=</span><span class="st">"Cubed Height"</span>, <span class="at">pch=</span><span class="st">'.'</span>, <span class="at">xlab=</span><span class="st">"Height^3"</span>,<span class="at">ylab=</span><span class="st">"FEV"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(fev<span class="sc">$</span>fev <span class="sc">~</span> fev<span class="sc">$</span>height3), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Cubing height produces a more linear association with FEV</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>1:Many transformations</p>
<ul>
<li><p>Sometimes we transform 1 scientific measurement into several modeled predictors</p>
<ul>
<li><p>Polynomial regression</p></li>
<li><p>Dummy variables (factor or class variables)</p></li>
<li><p>Piecewise linear</p></li>
<li><p>Splines</p></li>
</ul></li>
</ul></li>
<li><p>Polynomial regression</p>
<ul>
<li><p>Fit linear term plus higher order terms (squared, cubic, …)</p></li>
<li><p>Can fit an arbitrarily-complex function</p>
<ul>
<li>An <span class="math inline">\(n\)</span>-th order polynomial can fit <span class="math inline">\(n+1\)</span> points exactly</li>
</ul></li>
<li><p>Generally, very difficult to interpret parameters</p>
<ul>
<li>I will usually graph functions when I want an interpretation</li>
</ul></li>
<li><p>Special uses</p>
<ul>
<li><p>2nd order (quadratic) model to look for U-shaped trends (e.g.&nbsp;alcohol consumption and cardiovascular risk? Potential hypothesis being that moderate consumption of alcohol beneficial relative to either no consumption or high consumption)</p></li>
<li><p>Tests for linearity achieved by testing that all higher order terms have parameters equal to zero (hierarchical model)</p></li>
<li><p>Full Model: <span class="math inline">\(g(\theta) = \beta_0 + \beta_1 * X + \beta_2 * X^2 + \beta_3 * X^3\)</span></p></li>
<li><p>Reduced Model: <span class="math inline">\(g(\theta) = \beta_0 + \beta_1 * X\)</span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="example-fev-and-height-association" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="example-fev-and-height-association"><span class="header-section-number">1.3.4</span> Example: FEV and Height association</h3>
<ul>
<li><p>We can try to assess whether any association between mean FEV and height follows a straight line association</p></li>
<li><p>Fit a third order (cubic) polynomial due to the known scientific relationship between volume and height (using robust standard error estimates)</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create squared and cubic terms</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>ht2 <span class="ot">&lt;-</span> fev<span class="sc">$</span>height<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>ht3 <span class="ot">&lt;-</span> fev<span class="sc">$</span>height<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fev <span class="sc">~</span> height <span class="sc">+</span> ht2 <span class="sc">+</span> ht3, <span class="at">data=</span>fev)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m1, <span class="at">vcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 19%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">4.5691e-01</td>
<td style="text-align: center;">1.2339e+01</td>
<td style="text-align: center;">0.037030</td>
<td style="text-align: center;">0.97047</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>height</strong></td>
<td style="text-align: center;">3.0595e-02</td>
<td style="text-align: center;">6.3266e-01</td>
<td style="text-align: center;">0.048359</td>
<td style="text-align: center;">0.96144</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>ht2</strong></td>
<td style="text-align: center;">-1.5222e-03</td>
<td style="text-align: center;">1.0746e-02</td>
<td style="text-align: center;">-0.141648</td>
<td style="text-align: center;">0.88740</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ht3</strong></td>
<td style="text-align: center;">2.5797e-05</td>
<td style="text-align: center;">6.0481e-05</td>
<td style="text-align: center;">0.426524</td>
<td style="text-align: center;">0.66987</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>From the model output, is height a significant predictor of FEV?</p></li>
<li><p>Note that the p-values for each term are not significant</p>
<ul>
<li><p>But each of these tests are addressing irrelevant questions</p>
<ul>
<li><p>height: After adjusting for the 2nd and 3rd order terms relationships, is the linear term important?</p></li>
<li><p>htsqr: After adjusting for the linear and 3rd order terms relationships, is the quadratic term important?</p></li>
<li><p>htcub: After adjusting for the linear and 2nd order terms relationships, is the cubic term important?</p></li>
</ul></li>
<li><p>We need to test if test the 2nd and 3rd order terms simultaneously</p>
<ul>
<li>Will test if height-FEV has a linear relationship</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m1, <span class="fu">c</span>(<span class="st">"ht2"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ht3"</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Linear hypothesis test</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Res.Df</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">652</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">650</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">30.641</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>We find clear evidence that the trend in mean FEV versus height is non-linear (<span class="math inline">\(p &lt; 0.001\)</span>)</p></li>
<li><p>Note that if we had seen <span class="math inline">\(p &gt; 0.05\)</span>, we could not be sure it was linear. The relationship may have been non-linear, but not in a way the cubic polynomial could detect</p></li>
</ul>
<section id="example-log-fev-and-polynomial-height" class="level4" data-number="1.3.4.1">
<h4 data-number="1.3.4.1" class="anchored" data-anchor-id="example-log-fev-and-polynomial-height"><span class="header-section-number">1.3.4.1</span> Example: log FEV and polynomial height</h4>
<ul>
<li><p>We can try to assess whether any association between mean log FEV and height follows a straight line relationship</p></li>
<li><p>Again, we will fit a third order (cubic) polynomial, but this time we do not have any good scientific justification for such a model</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>logfev <span class="ot">&lt;-</span> <span class="fu">log</span>(fev<span class="sc">$</span>fev)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logfev <span class="sc">~</span> height <span class="sc">+</span> ht2 <span class="sc">+</span> ht3, <span class="at">data=</span>fev)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m2, <span class="at">vcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 19%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-2.7918e+00</td>
<td style="text-align: center;">4.9700e+00</td>
<td style="text-align: center;">-0.561739</td>
<td style="text-align: center;">0.57449</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>height</strong></td>
<td style="text-align: center;">7.0664e-02</td>
<td style="text-align: center;">2.4759e-01</td>
<td style="text-align: center;">0.285404</td>
<td style="text-align: center;">0.77543</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>ht2</strong></td>
<td style="text-align: center;">-1.8281e-04</td>
<td style="text-align: center;">4.0899e-03</td>
<td style="text-align: center;">-0.044697</td>
<td style="text-align: center;">0.96436</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ht3</strong></td>
<td style="text-align: center;">3.2400e-07</td>
<td style="text-align: center;">2.2404e-05</td>
<td style="text-align: center;">0.014461</td>
<td style="text-align: center;">0.98847</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Note that again, the p-values for the individual terms are not significant and are still addressing uninteresting scientific questions</p></li>
<li><p>Test the squared and cubed terms simultaneously</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m2, <span class="fu">c</span>(<span class="st">"ht2"</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ht3"</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Linear hypothesis test</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Res.Df</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">652</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">650</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.29449</td>
<td style="text-align: center;">0.74501</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>We do not find clear evidence that the trend in mean log FEV versus height is non-linear</p>
<ul>
<li><p>This does not prove linearity because it could have been nonlinear in a way that a cubic polynomial could not detect</p></li>
<li><p>However, my guess it the cubic polynomial would have picked up most reasonable patterns of non-linearity likely to occur in this setting</p></li>
</ul></li>
<li><p>We have not addressed the question of whether log FEV is associated with height</p>
<ul>
<li><p>This question could have been addressed in the cubic model by</p>
<ul>
<li><p>Testing all three height-derived variable simultaneously</p></li>
<li><p>OR looking at the overall F-test (because only height variables are in the model)</p></li>
</ul></li>
<li><p>Another alternative would be to fit a model with only the linear term for height</p>
<ul>
<li><p>In general, it is a very bad idea to go fishing for models, so pick an approach beforehand and use that</p></li>
<li><p>If I suspected a complex dose-response relationship beforehand, I would fit the complex model and test all of the height coefficients</p></li>
<li><p>If I just cared about showing a first order trend, the following output would answer that question</p></li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logfev <span class="sc">~</span> height, <span class="at">data=</span>fev)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m3, <span class="at">vcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">-2.271312</td>
<td style="text-align: center;">0.068447</td>
<td style="text-align: center;">-33.184</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>height</strong></td>
<td style="text-align: center;">0.052119</td>
<td style="text-align: center;">0.001121</td>
<td style="text-align: center;">46.494</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="dummy-variables" class="level3 page-columns page-full" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="dummy-variables"><span class="header-section-number">1.3.5</span> Dummy Variables</h3>
<ul>
<li><p>Indicator variables for all but one group</p></li>
<li><p>This is the only appropriate method for modeling modeling nominal (unordered) categorical variables</p>
<ul>
<li><p>Example: Marital status using indicator for</p>
<ul>
<li><p>Married (married=1, everything else=0)</p></li>
<li><p>Widowed (widowed=1, everything else=0)</p></li>
<li><p>Divorced (divorced=1, everything else=0)</p></li>
<li><p>Single would then be the intercept</p></li>
</ul></li>
</ul></li>
<li><p>While it is the only approach for nominal variables, dummy variable coding is often used for other settings</p></li>
<li><p>Makes regression equivalent to Analysis of Variance (ANOVA)</p>
<ul>
<li><p>ANOVA is an old technique developed by R.A. Fisher in 1921</p></li>
<li><p>Can reproduce results of ANOVA exactly with regression, so ANOVA is of limited use today (but will find it around)</p></li>
</ul></li>
</ul>
<section id="example-mean-salary-by-field" class="level4" data-number="1.3.5.1">
<h4 data-number="1.3.5.1" class="anchored" data-anchor-id="example-mean-salary-by-field"><span class="header-section-number">1.3.5.1</span> Example: Mean salary by Field</h4>
<ul>
<li><p>Field is a nominal variable, so we must use dummy variables</p>
<ul>
<li>I decided to use Other as a reference group. By default, R will order alphabetically so Arts would have been the default reference group</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/salary.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> salary[salary<span class="sc">$</span>year<span class="sc">==</span><span class="dv">95</span>,]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>salary<span class="sc">$</span>field <span class="ot">&lt;-</span> <span class="fu">factor</span>(salary<span class="sc">$</span>field)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>salary<span class="sc">$</span>field <span class="ot">&lt;-</span> <span class="fu">relevel</span>(salary<span class="sc">$</span>field, <span class="at">ref=</span><span class="st">"Other"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> field, <span class="at">data=</span>salary)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m4, <span class="at">vcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">6291.6</td>
<td style="text-align: center;">61.01</td>
<td style="text-align: center;">103.1252</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>fieldArts</strong></td>
<td style="text-align: center;">-1013.6</td>
<td style="text-align: center;">104.73</td>
<td style="text-align: center;">-9.6775</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>fieldProf</strong></td>
<td style="text-align: center;">1225.0</td>
<td style="text-align: center;">133.56</td>
<td style="text-align: center;">9.1718</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m4, <span class="at">vcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">6171.97</td>
<td style="text-align: center;">6411.31</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>fieldArts</strong></td>
<td style="text-align: center;">-1218.99</td>
<td style="text-align: center;">-808.13</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>fieldProf</strong></td>
<td style="text-align: center;">963.05</td>
<td style="text-align: center;">1487.01</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Interpretation based on coding used</p>
<ul>
<li><p>Intercept corresponds to the mean salary in the Other field</p>
<ul>
<li><p>These faculty will have both arts==0 and prof==0</p></li>
<li><p>Estimated mean salary of $6292 per month (95% CI: [6172, 6411])</p></li>
<li><p>Highly statistically different from $0 per month (a worthless test)</p></li>
</ul></li>
<li><p>Slope for arts is difference in mean salary between Fine Arts and Other fields</p>
<ul>
<li><p>Fine Arts faculty will have arts==1 and prof==0; Other faculty will have arts==0 and prof==0</p></li>
<li><p>Estimated difference in mean salary is $1014 lower (95% CI: [808, 1219] lower salary)</p></li>
<li><p>Highly statistically different from $0 per month (a useful test, if we specified it a priori)</p></li>
</ul></li>
<li><p>Slope for prof is difference in mean salary between Professional and Other fields</p>
<ul>
<li><p>Professional faculty will have arts==0 and prof==1; Other faculty will have arts==0 and prof==0</p></li>
<li><p>Estimated difference in mean salary is $1225 higher (95% CI: [963, 1487] higher salary)</p></li>
<li><p>Highly statistically different from $0 per month (a useful test, if we specified it a priori)</p></li>
</ul></li>
</ul></li>
<li><p>Because we modeled the three groups with two predictors plus an intercept, the estimates agree exactly with the sample means</p>
<ul>
<li><p>No borrowing of information across field</p></li>
<li><p>If we had used a different reference group rather than Other, would also see agreement between model estimates and sample means</p></li>
</ul></li>
<li><p>Hypothesis test: To test for mean salary differences by field</p>
<ul>
<li><p>We have modeled field using two variables</p></li>
<li><p>Both slopes would have to be zero for there to be no association between field and mean salary</p></li>
<li><p>Want to simultaneously tests the two slopes</p></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m4, <span class="fu">c</span>(<span class="st">"fieldArts"</span>,<span class="st">"fieldProf"</span>),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Linear hypothesis test</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Res.Df</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1596</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">1594</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">121.08</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>We can conclude there is a there is a significant difference in salary comparing faculty with different fields (<span class="math inline">\(P&lt;0.001\)</span>)</li>
</ul>
</section>
<section id="continuous-variables" class="level4 page-columns page-full" data-number="1.3.5.2">
<h4 data-number="1.3.5.2" class="anchored" data-anchor-id="continuous-variables"><span class="header-section-number">1.3.5.2</span> Continuous variables</h4>
<ul>
<li><p>We can also use dummy variables to represent continuous variables</p>
<ul>
<li><p>Continuous variables measured at discrete levels (e.g.&nbsp;dose in an interventional experiment)</p></li>
<li><p>Continuous variables divided into categories (often a bad idea)</p></li>
</ul></li>
<li><p>Dummy variables will fit groups exactly</p>
<ul>
<li>If no other predictors in the model, parameter estimates correspond exactly to descriptive statistics</li>
</ul></li>
<li><p>With continuous variables, dummy variable coding assumes a step-function is true</p></li>
<li><p>Modeling with dummy variables ignores order of predictor of interest</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>m.dummy <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">factor</span>(age), <span class="at">data=</span>fev)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">19</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>ht.dummy <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.dummy, <span class="at">newdata=</span>newdata)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Red points are means at each level of age</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The red points in the plot represents the mean height by subgroups defined by years of age</p>
<ul>
<li><p>Dummy variables are used for each age (measured in years)</p></li>
<li><p>Step function (e.g.&nbsp;when age changes from 8.999 to 9.000, expected height increases)</p></li>
<li><p>Several ages have few subjects, which makes the estimates unreliable</p></li>
</ul></li>
<li><p>Do we really believe that average height of 18 year olds is less than the average height of 14, 15, 16, 17, and 19 year old?</p>
<ul>
<li>Probably not (the model is overfit)</li>
<li>By ignoring the ordering of age, we are not borrowing strength across adjacent age groups</li>
<li>When building model, we can decide how much information we want to borrow from nearby groups</li>
</ul></li>
<li><p>Predicted heights for observed ages from the dummy variable and two polynomial models</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>newdata[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">ht.dummy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>12</strong></td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">67.520</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>13</strong></td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">66.368</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>14</strong></td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">67.385</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>15</strong></td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">68.938</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>16</strong></td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">66.000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>17</strong></td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">67.833</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="flexible-methods" class="level2 page-columns page-full" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="flexible-methods"><span class="header-section-number">1.4</span> Flexible Methods</h2>
<ul>
<li><p>We have methods that can fit a wide variety of curve shapes</p>
<ul>
<li><p>Dummy variables: Step function with tiny steps</p></li>
<li><p>Polynomials: If high degree, allows many patterns of curvature</p></li>
<li><p>Splines: Piecewise linear or piecewise polynomial</p></li>
</ul></li>
</ul>
<section id="polyhomial-functions" class="level3 page-columns page-full" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="polyhomial-functions"><span class="header-section-number">1.4.1</span> Polyhomial functions</h3>
<ul>
<li><p>We can fit high order polynomials to flexibly model a continuous covariate</p></li>
<li><p>A continuous covariate with <span class="math inline">\(k\)</span> levels can be perfectly modeled using polynomials up to degree <span class="math inline">\(k-1\)</span>.</p></li>
<li><p>In the Height and Age dataset, there are 17 unique values of age (age is rounded to the nearest year), so we can perfectly model the means using polynomials up to degree 16</p>
<ul>
<li><p><span class="math inline">\(E[Height | Age = a] = \beta_0 + \beta_1 * a + \beta_2 * a^2 + \ldots + \beta_{16} * a^{16}\)</span></p></li>
<li><p>Each <span class="math inline">\(\beta\)</span> is difficult to interpret, but the predicted value at the integer levels of age make sense.</p></li>
<li><p>Predicted values of height at non-integer values of age (e.g.&nbsp;age of 18.5) may not make sense</p></li>
<li><p>Polynomials become especially unstable near the upper and lower bounds of the age distribution. Stability near the upper and lower bounds is a general concern in many spline approaches.</p></li>
</ul></li>
<li><p>A polynomial of lesser degree could also be considered. I show a model that includes polynomials for age up to degree 3 in the following plot. It is also less stable near the upper and lower bounds of age, but not as obviously so as the 16 degree polynomial.</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">poly</span>(x,<span class="dv">16</span>), <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">poly</span>(x,<span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">"Green"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Sixteen degree and three degree polynomial model</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>m.poly16 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">16</span>), <span class="at">data=</span>fev)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>m.poly3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">3</span>), <span class="at">data=</span>fev)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>ht.poly16 <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.poly16, newdata)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>ht.poly3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.poly3, newdata)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>newdata[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">ht.dummy</th>
<th style="text-align: center;">ht.poly16</th>
<th style="text-align: center;">ht.poly3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>12</strong></td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">67.520</td>
<td style="text-align: center;">67.520</td>
<td style="text-align: center;">67.288</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>13</strong></td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">66.368</td>
<td style="text-align: center;">66.368</td>
<td style="text-align: center;">67.745</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>14</strong></td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">67.385</td>
<td style="text-align: center;">67.385</td>
<td style="text-align: center;">67.829</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>15</strong></td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">68.938</td>
<td style="text-align: center;">68.937</td>
<td style="text-align: center;">67.513</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>16</strong></td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">66.000</td>
<td style="text-align: center;">66.000</td>
<td style="text-align: center;">66.768</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>17</strong></td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">67.833</td>
<td style="text-align: center;">67.833</td>
<td style="text-align: center;">65.566</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="piecewise-linear-splines" class="level3 page-columns page-full" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="piecewise-linear-splines"><span class="header-section-number">1.4.2</span> Piecewise Linear Splines</h3>
<ul>
<li><p>Piecewise linear curves</p>
<ul>
<li><p>Joined at “knots”</p></li>
<li><p>Straight lines in between the knots</p></li>
<li><p>Convenient parametrizations such that (1) coefficients are slopes of consecutive segments or (2) coefficients are slope changes at consecutive knots</p></li>
<li><p>Advantages</p>
<ul>
<li><p>Interpretability. Has the interpretation as the slope (or slope change) from the regression model, but within a range of <span class="math inline">\(X\)</span></p></li>
<li><p>Best to specify know locations in advance for desired scientific interpretation</p></li>
<li><p>Nested within a restriced model with a single slope term (hierarchcical structure allow comparisons of complex to simpler models)</p></li>
</ul></li>
<li><p>Disadvantages</p>
<ul>
<li>Abrupt change in slope at each knot location</li>
</ul></li>
</ul></li>
<li><p>Stata: <code>mkspline newvar0 knot1 newvar1 knot2 newvar2 ... knotp newvarp = oldvar</code></p>
<ul>
<li><p>Would then run regression using newvar0 … newvarp</p></li>
<li><p>Assumes straight lines between min and knot1; knot1 and knot2; etc.</p></li>
</ul></li>
<li><p>In R, we can use the lspline package to make the linear splines</p></li>
<li><p>The following results will look at age and height using linear splines with 2 knots and 4 knots</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">lspline</span>(x, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">lspline</span>(x, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">6.5</span>,<span class="fl">9.5</span>,<span class="fl">12.5</span>,<span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="st">"Green"</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Piecewise linear splines with 2 or 4 knots. Red points are mean height at each subgroup of age.</figcaption>
</figure>
</div>
</div>
</div>
<section id="piecewise-linear-spline-interpretation-marginal-is-false-the-default" class="level4" data-number="1.4.2.1">
<h4 data-number="1.4.2.1" class="anchored" data-anchor-id="piecewise-linear-spline-interpretation-marginal-is-false-the-default"><span class="header-section-number">1.4.2.1</span> Piecewise linear spline interpretation (marginal is FALSE, the default)</h4>
<ul>
<li>Focusing on the model with 2 knots for interpretation within age groups of [3 to 9], [10 to 15], and [16 to 19]
<ul>
<li>Knots at 9.5 and 15.5 define three age groups</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m.linspline.nonmar <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">lspline</span>(age, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>)), <span class="at">data=</span>fev)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m.linspline.nonmar, <span class="at">varcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">38.49107</td>
<td style="text-align: center;">0.813179</td>
<td style="text-align: center;">47.3341</td>
<td style="text-align: center;">0.00000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))1</strong></td>
<td style="text-align: center;">2.48855</td>
<td style="text-align: center;">0.099940</td>
<td style="text-align: center;">24.9005</td>
<td style="text-align: center;">0.00000</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))2</strong></td>
<td style="text-align: center;">1.08521</td>
<td style="text-align: center;">0.088609</td>
<td style="text-align: center;">12.2472</td>
<td style="text-align: center;">0.00000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))3</strong></td>
<td style="text-align: center;">-0.55308</td>
<td style="text-align: center;">0.371351</td>
<td style="text-align: center;">-1.4894</td>
<td style="text-align: center;">0.13687</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m.linspline.nonmar, <span class="at">varcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">36.89430</td>
<td style="text-align: center;">40.08785</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))1</strong></td>
<td style="text-align: center;">2.29231</td>
<td style="text-align: center;">2.68480</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))2</strong></td>
<td style="text-align: center;">0.91122</td>
<td style="text-align: center;">1.25921</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5))3</strong></td>
<td style="text-align: center;">-1.28228</td>
<td style="text-align: center;">0.17611</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>(Intercept) is the expect height when age is 0. Since this is outside the range of our data, it has no scientific interpretation.</p></li>
<li><p>The first slope term (‘lspline(age, knots = c(9.5, 15.5))1’) is the expected change in height comparing two individuals who differ in age by one year when both subjects are 9 years old or less. Comparing two children who are both 3 to 9 years old and differ in age by one year, the older child on average will be 2.49 inches taller than the younger child. We are 95% confident the true difference in height is between 2.29 and 2.68 inches taller.</p>
<ul>
<li><p>That is, the model assumes that the change in height comparing 3 to 4, 4 to 5, 5 to 6, 6 to 7, 7 to 8, 8 to 9 is the same (a similar growth rate over these age ranges)</p></li>
<li><p>The model borrow strength across the age ranges by assuming the same slope</p></li>
<li><p>The model borrows strength across the next age range by assuming the mean height at the knot (9.5 years) is the same at the upper end of first age group and the lower end of the second age group.</p></li>
</ul></li>
<li><p>The second slope term (‘lspline(age, knots = c(9.5, 15.5))2’) is the expected change in height comparing two individuals who differ in age by one year when both subjects are between 10 and 15 years old</p></li>
<li><p>The third slope term (‘lspline(age, knots = c(9.5, 15.5))3’) is the expected change in height comparing two individuals who differ in age by one year when both subjects are 16 years old or older</p></li>
<li><p>We can test if the age-height slope significantly changes with age category</p>
<ul>
<li><span class="math inline">\(H_0: \beta_1 = \beta_2, \beta_1 = \beta_3\)</span></li>
<li><span class="math inline">\(H_A\)</span>: At least one not equal</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m.linspline.nonmar, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="st">"lspline(age, knots = c(9.5, 15.5))1=lspline(age, knots = c(9.5, 15.5))2"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"lspline(age, knots = c(9.5, 15.5))1=lspline(age, knots = c(9.5, 15.5))3"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">vcov=</span><span class="fu">sandwich</span>(m.linspline.nonmar))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Linear hypothesis test</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Res.Df</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">652</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">650</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">85.721</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>We reject the null hypothesis (<span class="math inline">\(P&lt;0.001\)</span>) and conclude the linear spline model is a better fit than the restricted model, <span class="math inline">\(E[Height | Age = a] = \beta_0 + \beta_1 * a\)</span></p></li>
<li><p>The following is the basis matrix for the linear spline (non-marginal) for ages 3 to 19. It is relatively easy to calculate this matrix</p>
<ul>
<li>First columns is age</li>
<li>Second columns is max of 0 and (age minus the first knot)</li>
<li>Third columns is max of 0 and (age minus the second knot)</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">19</span>, <span class="fu">lspline</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">19</span>,  <span class="at">knots =</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">3.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">4.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">5.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">6.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">7.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">8.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">9.0</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">1.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">2.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">13</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">3.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">14</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">4.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">5.5</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">16</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">6.0</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">17</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">6.0</td>
<td style="text-align: center;">1.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">18</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">6.0</td>
<td style="text-align: center;">2.5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">19</td>
<td style="text-align: center;">9.5</td>
<td style="text-align: center;">6.0</td>
<td style="text-align: center;">3.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>We have transformed one measured predictor, age, into three predictors</li>
</ul>
</section>
<section id="piecewise-linear-spline-interpretation-marginal-is-true-the-default" class="level4" data-number="1.4.2.2">
<h4 data-number="1.4.2.2" class="anchored" data-anchor-id="piecewise-linear-spline-interpretation-marginal-is-true-the-default"><span class="header-section-number">1.4.2.2</span> Piecewise linear spline interpretation (marginal is TRUE, the default)</h4>
<ul>
<li>Focusing on the model with 3 knots for interpretation with age groups of [3 to 9], [10 to 15], and [16 to 19]
<ul>
<li>Knots at 9.5 and 15.5 define these age groups</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>m.linspline.mar <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">lspline</span>(age, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>), <span class="at">marginal=</span><span class="cn">TRUE</span>), <span class="at">data=</span>fev)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m.linspline.mar, <span class="at">varcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">38.4911</td>
<td style="text-align: center;">0.81318</td>
<td style="text-align: center;">47.3341</td>
<td style="text-align: center;">0.00000000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)1</strong></td>
<td style="text-align: center;">2.4886</td>
<td style="text-align: center;">0.09994</td>
<td style="text-align: center;">24.9005</td>
<td style="text-align: center;">0.00000000</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)2</strong></td>
<td style="text-align: center;">-1.4033</td>
<td style="text-align: center;">0.16335</td>
<td style="text-align: center;">-8.5911</td>
<td style="text-align: center;">0.00000000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)3</strong></td>
<td style="text-align: center;">-1.6383</td>
<td style="text-align: center;">0.42028</td>
<td style="text-align: center;">-3.8981</td>
<td style="text-align: center;">0.00010701</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m.linspline.mar, <span class="at">varcov=</span>sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2.5 %</th>
<th style="text-align: center;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">36.8943</td>
<td style="text-align: center;">40.08785</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)1</strong></td>
<td style="text-align: center;">2.2923</td>
<td style="text-align: center;">2.68480</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)2</strong></td>
<td style="text-align: center;">-1.7241</td>
<td style="text-align: center;">-1.08259</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>lspline(age, knots = c(9.5, 15.5), marginal = TRUE)3</strong></td>
<td style="text-align: center;">-2.4636</td>
<td style="text-align: center;">-0.81303</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>(Intercept) is the expect height when age is 0. Since this is outside the range of our data, it has no scientific interpretation.</p></li>
<li><p>The first slope term (‘lspline(age, knots = c(9.5, 15.5))1’) is the expected change in height comparing two individuals who differ in age by one year when both subjects are 9 years old or less.</p></li>
<li><p>The second slope term (‘lspline(age, knots = c(9.5, 15.5))2’) is the change in the age-height slope for 10 to 15 year olds versus 3 to 9 year olds. This output is useful for estimating and testing the slope changes over age.</p></li>
<li><p>The third slope term (‘lspline(age, knots = c(9.5, 15.5))3’) is the change in the age-height slope for 16 to 19 year olds versus 3 to 9 year olds. This output is useful for estimating and testing the slope changes over age.</p></li>
<li><p>Using this model, we can test if the age-height slope significantly changes with age category</p>
<ul>
<li><span class="math inline">\(H_0: \beta_2 = 0, \beta_3 = 0\)</span></li>
<li><span class="math inline">\(H_A\)</span>: At least one not equal</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m.linspline.mar, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="st">"lspline(age, knots = c(9.5, 15.5), marginal = TRUE)2"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"lspline(age, knots = c(9.5, 15.5), marginal = TRUE)3"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m.linspline.mar))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Linear hypothesis test</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Res.Df</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">652</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">650</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">85.721</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>This is the same scientific test as for the non-marginal model, just a different parameteriziation. So, we obtain the same inference (F-stat and p-values are identical).</li>
</ul>
</section>
</section>
<section id="polynomial-splines" class="level3 page-columns page-full" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="polynomial-splines"><span class="header-section-number">1.4.3</span> Polynomial splines</h3>
<ul>
<li><p>Polynomial splines introduces squared or cubic terms to increase the smoothness of the estimate. In particular, compare to linear splines, they are no abrupt changes in the slope at each knot point.</p></li>
<li><p>There are various types of polynomial splines, each with different formulas applied to generate the basis matrix for the regression model</p>
<ul>
<li>B-spline: ‘bs()’
<ul>
<li>Representing the family of piecewise polynomials with the specified interior knots and degree</li>
</ul></li>
<li>Natural Cubic spline ‘ns()’
<ul>
<li>Enforce the constraint that the function is linear beyond the boundary knots, which can either be supplied or default to the extremes of the data.</li>
</ul></li>
<li>Restricted Cubic spline ‘rcs()’
<ul>
<li>rcs is a also a linear tail-restricted cubic spline function</li>
</ul></li>
</ul></li>
<li><p>We can choose to modify several parameters, depending on the function</p>
<ul>
<li><p>Number of knots</p></li>
<li><p>Where to place the knots (or use defaults based on quantiles and number of knots)</p></li>
<li><p>Degree of the polynomial. In practice, rarely is a degree over 3 considered</p></li>
<li><p>Increasing the number of knots and the degree of the polynomial will increase the flexibility of the model</p></li>
</ul></li>
<li><p>Several different comparisons are shown in the following plots</p></li>
</ul>
<section id="b-spline-versus-polynomial-function" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="b-spline-versus-polynomial-function">B-spline versus polynomial function</h5>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">bs</span>(x,<span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">col=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"Red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"poly(x,3)"</span>,<span class="st">"bs(x,3)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">B-Spline with 3 degrees of freedom is the same as a 3 degree of polynomial. Two lines are not visible because the blue and green line are on top of each other.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="b-spline-versus-piecewise-linear-spline-function" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="b-spline-versus-piecewise-linear-spline-function">B-spline versus piecewise linear spline, function</h5>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">lspline</span>(x,<span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">bs</span>(x,<span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>), <span class="at">degree=</span><span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"lspline(x,knots=c(9.5, 15.5))"</span>,<span class="st">"bs(x,knots=c(9.5, 15.5)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">B-Spline with 3 degrees of freedom and knots at 9.5 and 15.5 compared to piecewise linear spline with knots at 9.5 and 15.5</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="b-spline-versus-natural-spline" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="b-spline-versus-natural-spline">B-spline versus natural spline</h5>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="at">df=</span><span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">bs</span>(x,<span class="dv">3</span>, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span>  </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"ns(x, df=3)"</span>,<span class="st">"bs(x,3, knots=c(9.5, 15.5)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">B-Spline with 3 degrees of freedom and knots at 9.5 and 15 compared to ns (3 df). The enforcement of the linearity constraint beyond the boundary knots is particular apparent for the natural spline at the low end of age.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="nautral-spline-versus-restricted-cubic-spline" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="nautral-spline-versus-restricted-cubic-spline">Nautral spline versus restricted cubic spline</h5>
<ul>
<li><p>Natural splines and restricted cubic spline are both cubic splines with restrictions of linearity beyond the boundary knot locations</p></li>
<li><p>They have different inputs which can result in different model fits</p></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">rcs</span>(x, <span class="at">parms=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">9.5</span>, <span class="fl">15.5</span>, <span class="dv">19</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span>  </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"ns(x, knots=c(9.5, 15.5)"</span>,<span class="st">"rcs(x, parms=c(0, 9.5, 15.5, 19)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Natrual spline (with knots at 3.5 and 9.5) compared with restricted cubic spline with parms set to give the same fit. Both spline approaches impose a linearity constraint at the tails. Fits are same using these inputs.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="at">df=</span><span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">rcs</span>(x, <span class="at">nk=</span><span class="dv">5</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span>  </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"ns(x, df=3)"</span>,<span class="st">"rcs(x, nk=5)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Natrual cubic spline (3 d.f) compared with restricted cubic spline using default inputs. Both spline approaches impose a linearity constraint at the tails, but with different default knot locations the fits are different.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="nautral-spline-versus-piecewise-linear-spline" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="nautral-spline-versus-piecewise-linear-spline">Nautral spline versus piecewise linear spline</h5>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>height)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="at">df=</span><span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Blue"</span>)) <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">lspline</span>(x, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>)), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>newdata, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>ht.dummy), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span>  </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Model"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Blue"</span>, <span class="st">"Green"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"ns(x, df=3)"</span>,<span class="st">"lspline(x, knots=c(9.5,15.5)"</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Natrual spline (3 d.f) compared with restricted cubic spline with knots at 9.5 and 15.5. Both spline approaches impose a linearity constraint at the tails.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="summary-comments" class="level2 page-columns page-full" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="summary-comments"><span class="header-section-number">1.5</span> Summary comments</h2>
<ul>
<li><p>There are a variety of methods for flexibly modeling continuous covariates</p></li>
<li><p>Approach you use should be pre-specified and based on scientific considerations</p></li>
<li><p>Splines for predictor of interest in an association study</p>
<ul>
<li><p>If you want to be able to write numerical summaries of your results, consider piecewise linear splines</p>
<ul>
<li><p>May provide an adequate summary of your results, particularly for comparison between two knots</p></li>
<li><p>Comparison between subgroups separated by a knot location more challenging as you have a change in slope</p></li>
<li><p>Formal test can be conducted to determine if the slope is significantly different on ranges of <span class="math inline">\(X\)</span> (hierarchical models)</p></li>
</ul></li>
<li><p>Best to pre-specify your knot locations based on relevant scientific meaning</p>
<ul>
<li><p>Lacking scientific reasons, it is OK to use quantiles as the quantiles are not related to the outcome (unsupervised learning)</p></li>
<li><p>Should not pick knot locations after looking at the outcome unless you have a plan for how to adjust your analysis for making data-driven decision (this type of adjustment is hard to do, so I recommend avoiding it)</p></li>
</ul></li>
</ul></li>
<li><p>Spline for estimating means or prediction of new observations</p>
<ul>
<li><p>Flexible methods most appropriate in this approach</p></li>
<li><p>Be careful of behavior of your splines at the extremes of your continuous covariates</p>
<ul>
<li>(Also, don’t extrapolate beyond the range of the date)</li>
</ul></li>
<li><p>Degrees of freedom, or allowed model complexity needs to be considered in terms of the effective sample size for the type of outcome you are studying</p></li>
</ul></li>
<li><p>Effective sample sizes</p>
<ul>
<li>Linear regression: Number of subjects</li>
<li>Logistic regression: Lesser of number of events and number of non-events</li>
<li>Cox regression: Number of events</li>
<li>Poisson regression: If counts are relatively continuous, more like linear regression. If counts are all small, more like Cox regression</li>
<li>Multinomial regression: Number of events in smallest categorical outcome level</li>
<li>Ordinal regression: If few severity events, more like logistic regression. If a wider range of severity, more like linear regression</li>
</ul></li>
<li><p>Allowed model complexity is, roughly, gain one available degree of freedom per every 10-15 of effective sample size</p>
<ul>
<li><p>Degrees of freedom can be spent on dummy variable, knot locations, and degree of polynomial</p></li>
<li><p>Degrees of freedom can be saved by constraints, such as the linearity constraint at the tails for natural splines and restricted cubic spline. These are popular splines because the constraint often saves degrees of freedom while improving the generalizability of the fit at the tails of the continuous distribution</p></li>
<li><p>These are approximatione, and the allowed model complexity can depend on other characteristics of the data too</p></li>
</ul></li>
<li><p>Splines for effect modification (continuous effect modifier and/or continuous predictor of interest)</p>
<ul>
<li><p>Choice of model should be dictated by scientific considerations first</p></li>
<li><p>Statistically, we have limited power to detect effect modification</p></li>
<li><p>Linear terms for modeling effect modification may suffice</p></li>
</ul></li>
<li><p>Flexible models for a precision variable</p>
<ul>
<li><p>Often most of the association of the precision variable with the outcome can be capture in a linear term</p></li>
<li><p>However, if justified, can consider a flexible model too</p></li>
<li><p>Goal of a precision variable is to explain residual variability in the outcome after accounting for the predictor of interest (and, possibly, confounders that are included in the model)</p></li>
</ul></li>
<li><p>Flexible models for confounders</p>
<ul>
<li><p>Often it is important to adjust for confounders adequately, so a spline or other flexible function can help</p></li>
<li><p>If we are not interested in interpreting the effect of the confounder, then we are free to model it a variety of different ways</p>
<ul>
<li><p>Argues for flexibly modeling continuous confounder (limited by the effective sample size)</p></li>
<li><p>Note that if the confounder effect really is a straight line, then a cubic spline with linearity constraints on the tails should also fit adequately</p></li>
</ul></li>
<li><p>There is not much to be lost and potentially much to be gained by pre-specifying a flexible model for a continuous confounder</p>
<ul>
<li><p>If it is a straight line, a flexibly spline or a linear tearm can capture the association (either would adjust for confounding)</p></li>
<li><p>If it is not a straight line, a flexible spline can capture the assocation while a linear term cannot (spline would more completly adjust for confouding)</p></li>
</ul></li>
</ul></li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fev, <span class="fu">aes</span>(<span class="at">x=</span>height, <span class="at">y=</span>logfev)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">formula=</span>y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="at">df=</span><span class="dv">3</span>), <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"Green"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Lec11.DoseResponse_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="margin-caption">Linear (sraight line) and natural spline (3 d.f.) fits to log of FEV and height. The relationship is approximately a straight line, which can be capture by either assuming a straight line association or allowing for a flexible fit.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Example interpretation for linear model with FEV as outcome, smoking the predictor of interest controlling for age and height. There are 654 observations in the dataset, so allowed model complexity is at least 43 degrees of freedom.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(fev) <span class="sc">/</span> <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 43.6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>smoker <span class="ot">&lt;-</span> (fev<span class="sc">$</span>smoke<span class="sc">==</span><span class="st">"current smoker"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>male <span class="ot">&lt;-</span> (fev<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fev <span class="sc">~</span> smoker <span class="sc">+</span> <span class="fu">ns</span>(age,<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ns</span>(height,<span class="dv">3</span>) <span class="sc">+</span> male, <span class="at">data=</span> fev)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m1, <span class="at">vcov=</span><span class="fu">sandwich</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>t test of coefficients</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">1.090121</td>
<td style="text-align: center;">0.071522</td>
<td style="text-align: center;">15.2418</td>
<td style="text-align: center;">0.0000e+00</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>smoker</strong></td>
<td style="text-align: center;">-0.147092</td>
<td style="text-align: center;">0.076797</td>
<td style="text-align: center;">-1.9153</td>
<td style="text-align: center;">5.5892e-02</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>ns(age, 3)1</strong></td>
<td style="text-align: center;">0.494765</td>
<td style="text-align: center;">0.102371</td>
<td style="text-align: center;">4.8330</td>
<td style="text-align: center;">1.6823e-06</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ns(age, 3)2</strong></td>
<td style="text-align: center;">0.506067</td>
<td style="text-align: center;">0.205409</td>
<td style="text-align: center;">2.4637</td>
<td style="text-align: center;">1.4011e-02</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>ns(age, 3)3</strong></td>
<td style="text-align: center;">0.807844</td>
<td style="text-align: center;">0.147608</td>
<td style="text-align: center;">5.4729</td>
<td style="text-align: center;">6.3400e-08</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ns(height, 3)1</strong></td>
<td style="text-align: center;">1.430324</td>
<td style="text-align: center;">0.088439</td>
<td style="text-align: center;">16.1731</td>
<td style="text-align: center;">0.0000e+00</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>ns(height, 3)2</strong></td>
<td style="text-align: center;">3.262242</td>
<td style="text-align: center;">0.215641</td>
<td style="text-align: center;">15.1281</td>
<td style="text-align: center;">0.0000e+00</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ns(height, 3)3</strong></td>
<td style="text-align: center;">2.709726</td>
<td style="text-align: center;">0.158847</td>
<td style="text-align: center;">17.0588</td>
<td style="text-align: center;">0.0000e+00</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>male</strong></td>
<td style="text-align: center;">0.096504</td>
<td style="text-align: center;">0.033492</td>
<td style="text-align: center;">2.8814</td>
<td style="text-align: center;">4.0906e-03</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>The betas for the naturally-splined terms (age, height) are difficult to interpret directly. We could test for age and or height effect if that was of scientific interest using the Wald approach.</p></li>
<li><p>For the predictor of interest, smoker, we have the usual interpretation in terms of holding other covariates constant. “Among subjects of the same age, height, and sex but differing in smoking status…” However, we may be controlling for the confounding effects of age and height effects more completely by using flexible spline functions.</p></li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/modern-regression\.chris-slaughter\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/Set8.pdf" class="pagination-link" aria-label="Multinomial and Ordinal Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multinomial and Ordinal Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/Lec12.ANOVA.Model.Choice.html" class="pagination-link" aria-label="ANOVA and Model Choice">
        <span class="nav-page-text">ANOVA and Model Choice</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Flexible Modeling of Continuous Predictors"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Lecture 11"</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="an">name:</span><span class="co"> Lec11.DoseResponse.qmd</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lspline)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">source</span>(<span class="st">'pander_registry.R'</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">invisible</span>(e))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># Flexible models of continuous predictors</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When covariates are measured on a continuous scale, we have many different approaches to analysis</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To date, we have focused primarily on approaches that facilitate interpretation of our parameter estimates</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Untransformed</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Additive changes</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Compare group differing by $X$ units in the covariate of interest</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Log transformed</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Fold (multiplicative) changes</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Compares groups with a $k$-fold difference in the covariate of interest</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flexible modeling of continuous covariates are another option</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Interpretation often relies on plots, except in special cases</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is best to pre-specify how we intend to model continuous covariates to avoid data-driven modeling decision</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common continuous measures</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dose. Typically, dose of some treatment. Higher doses presumed to lead to greater (or lesser) response.</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Exposure. Typically, greater precision (more power) to consider amount of exposure rather than just Exposed versus Unexposed</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Many others. Age, serum cholesterol, blood pressure, height, etc.</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Dose-response" in the following notes that follow more generally refers to "doses" of any type of continuous covariate ("doses of age", "doses of cholesterol", etc.)</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scientific questions when modeling dose-response</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have many choices for modeling dose-response</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider the scientific question when deciding on an appropriate model</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How does the scientific question you want to answer relate to how you model the dose-response relationship?</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Models for detecting an association in subgroups defined by $X$</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Models for estimating the mean response in subgroups defined by $X$</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Models for predicting individual response in subgroups defined by $X$</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Will describe methods for</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Modeling complex dose-response curves</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Flexible methods (non-parametric loess smooths, parameteric regression splines)</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hierarchical Models</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="fu">### Full and restricted models</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When testing for associations, we are implicitly comparing two models</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Full" model</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Usually corresponds to alternative hypothesis</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Contains all terms in the "restricted" model plus some terms that we want to test for inclusion</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Example: $g(\theta) = \beta_0 + \beta_1 * X_1 + \beta_2 * X_2$</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Restricted" model</span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Usually corresponds to the null hypothesis</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Terms in the model are the subset of the terms in the full model that are not being tested</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Example: $g(\theta) = \beta_0 + \beta_1 * X_1$</span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Jargon: The restricted model is "nested" in the full model</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If we set some parameters in the full model equal to zero, we will get the restricted model</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>We have very good methods for testing differences between nested models</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Is a model with weight and height as predictors better than a model with just weight?</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Our methods are not as good for comparing models that are not nested</span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Is a model with just weight as a predictor better than a model with just height as a predictor?</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Non-nested models (e.g. $X_1$ is weight, $X_2$ is height)</span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g(\theta) = \beta_0 + \beta_1 * X_1$</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g(\theta) = \gamma_0 + \gamma_2 * X_2$</span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scientific interpretation of full versus restricted models</span></span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Our scientific interpretation of our statistical tests depends on the meaning of the restricted model compared to the full model</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Consider the the additional associations that are possible with the full model that are not possible with the restricted model</span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Appears very straightforward when we are only considering one full model compared to one restricted model</span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In practice, we may have many restricted models in mind</span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Multiple testing problem appears if we are considering many restricted models</span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example 1: Adjusted effects</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Full model: FEV vs smoking, age, height</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Restricted model: FEV vs age, height</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the full model provides no clear advantage over the restricted model, then we conclude that there is insufficient evidence to suggest an association between FEV and smoking when controlling for age and height</span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note how carefully I stated the above</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Insufficient evidence" (not evidence that smoking is not associated)</span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Conditional on controlling for age and height. Smoking, alone, may be an important predictor of FEV. The question answered by the full and reduced model is a comparison of FEV "among individuals of the same age and height but differing in smoking status" not just individuals who differ in smoking status.</span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example 2: Tests of linearity</span></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Full model: Survival vs cholesterol and cholesterol$^2$</span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Linear and quadratic terms for cholesterol</span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Model allows for a parabolic shape for chelesterol</span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Restricted model: Survival vs cholesterol</span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the full model provides no clear advantage over the restricted model, we conclude that there is insufficient evidence to suggest a U-shaped trend in survival with cholesterol</span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that a quadratic term does not include all possibilities for non-linearity. We will cover other (better) approaches later in the notes</span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Statistical comparison of full and reduced models</span></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Wald test</span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Fits only the full model</span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Tests if the parameter (or parameters) in the full model are equal to zero</span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can be used for robust and non-robust standard error estimates (fit using GEE)</span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Likelihood Ratio test</span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Fits both the full and reduced model</span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Compares the likelihood functions to determine if they are significantly different</span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can be used for non-robust models only (fit using likelihood)</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Score test</span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Only fits the reduced model</span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Considers the gradient of the likelihood function. After fitting the reduced model, looks at what is left over to see if it can be predicted by additional covariates</span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Not generally reported in regression model setting, but some common tests are Score tests (e.g. log-rank test)</span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In large samples, the Wald, Likelihood Ratio, and Score tests converge</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Given our focus on robust standard error estimates, we have used Wald tests almost exclusively</span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models with interactions (effect modification)</span></span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Models to test for effect modification (interactions) are hierarchical</span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Full Model: Include the interactions</span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Reduced Model: Set the interactions to be tested in the full model to zero</span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Best scientific approach is to pre-specify the statistical model that will be used for analysis</span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sometimes we choose a relatively large model including interactions</span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Allows us to address more questions (e.g. effect modification)</span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sometimes gives greater precision</span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Trade-offs between more parameters to estimate versus smaller within group variability</span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Deciding which parameters to test from the full model</span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It can be difficult to decide the statistical test that corresponds to specific scientific questions</span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Need to consider the restricted model that corresponds to your null hypothesis</span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Which parameters in the full model need to be set to zero to test your desired hypothesis</span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Examples of different scientific tests from the same full model</span></span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the following examples, the full model is the same but we change the restricted model based on the scientific question</span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Full model: Survival vs sex, smoking, sex-smoking interaction</span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Example Question 1: Is there effect modification?</span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Restricted model: Survival vs sex and smoking</span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Test that the sex-smoking interaction is zero</span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Example question 2: Is there an association between survival and sex?</span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Restricted model: Survival vs smoking</span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Test that parameters for sex and sex-smoking interaction are zero</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Does sex effect survival in either smokers or non-smokers?</span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Example question 3: Is there an association between survival and smoking?</span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Restricted model: Survival vs sex</span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Test that parameters for smoking and sex-smoking interaction are zero</span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Be careful when making data-driven model building decisions</span></span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We are often tempted to remove parameters that are not statistically significant before proceeding to other tests</span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>You will find many textbooks that advocate using this analysis approach</span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>e.g. fit the interaction, if it is not significant, exclude it from the model</span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Such texts are invariable written by mathematicians with no understanding of the underlying science</span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>When you work in the same scientific area, you will eventually "discover" false-positive assocations if you use this model building technique</span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Such data-driven analyses tend to suggest that failure to reject the null means equivalence</span>
<span id="cb37-242"><a href="#cb37-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>But, if you make this conclusion, you are wrong (large p-values do not indicate equivalence)</span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Abscence of evidence is not evidence of abscence</span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A procedure where we fit one model, and then use the results to determine the next model we will fit tends to underestimate the true standard error</span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>A consequence of the genearl multiple testing problem</span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Will lead to declaring statistical significance more often than you should (inflates type-I error rate)</span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>May also lead to parameter estimates that are biased away from the null</span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Statistical significance increases as a function of the effect size and the inverse of the standard error</span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>If, by chance, you see a large effect in your sample, you will be more likely to declare significance</span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How we interpret "negative" studies</span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There are other many reasons for not rejecting the null hypothesis of zero slope</span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>There may be no association</span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>There may be an association, but not in the parameter considered (i.e. the mean response)</span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>There may be an association in the parameter considered, but the best fitting line has zero slope (a curvilinear association in the parameter)</span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>There may be a first order trend in the parameter, but we lack sufficient statistical precision to be confident that it truly exists (a type-II error)</span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Be careful to not just assume that it the first reason, no association</span>
<span id="cb37-272"><a href="#cb37-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-273"><a href="#cb37-273" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Statistically, there is no way of discriminating between these four possibilities unless you have an infinite sample size</span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modeling Complex Dose-Response</span></span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a><span class="al">![All models are wrong, but some are useful.](figures/quote-all-models-are-approximations-essentially-all-models-are-wrong-but-some-are-useful-however-george-e-p-box-98-93-58.jpg)</span></span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a><span class="fu">### S-Shaped dose-response curves</span></span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is common in biology, medicine, and science to find "S-shaped" dose-response curves</span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="S-shaped dose response curve fit with loess smoother"}</span></span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 100</span></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a><span class="in">plotdata &lt;- data.frame(x=1:n,</span></span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a><span class="in">                       y=20 + 50 / (1+exp(-.15*(1:n-50))))</span></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a><span class="in">plotdata$y &lt;- plotdata$y + rnorm(n,0,4)</span></span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(plotdata, aes(x=x, y=y)) + geom_point() + theme_bw() + geom_smooth()</span></span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we happen to sample over the entire range of $X$ (in this example, from 0 to 100), we will would observe all parts of the S-curve</span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-294"><a href="#cb37-294" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>However, if we were only to sample from a limited range of $X$, we might observe only parts of the curve where it was approximately linear</span>
<span id="cb37-295"><a href="#cb37-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="The S-shaped dose response curve fit is approximately linear within three ranges of X."}</span></span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a><span class="in">plotdata$xint &lt;- cut(plotdata$x, c(0,30,70,100))</span></span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(plotdata, aes(x=x, y=y)) + facet_wrap(~ xint) + geom_point() + theme_bw() + geom_smooth()</span></span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Even if we expect a complex dose response relationship, we must also consider the range of dose that we are sampling over when considering the needed complexity of the model</span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Loess smoothing</span></span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The default smooth for 'geom_smooth' when there are fewer than 1000 data points is a loess smooth. These fits appear in the plots above</span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Loess is a non-parametric smooth where fitting is done locally.</span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-309"><a href="#cb37-309" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>That is, for the fit at point x, the fit is made using points in a neighborhood of x, weighted by their distance from x</span>
<span id="cb37-310"><a href="#cb37-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There are arguments to control the degree of smoothing, or how close we consider points to be in the "neighborhood of x"</span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>'loess' provides a nice visual representation to variety of data without having to specify a model</span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We will primarily be concerned with parametric smoothers as the parameters can be estimated (and in special cases interpreted) from multivariable regression models</span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear predictors</span></span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The most commonly-used regression models all consider "linear predictors"</span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-321"><a href="#cb37-321" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Linear refers to linear in the parameters ($\beta$s), and is not a reference to transformations of the predictors</span>
<span id="cb37-322"><a href="#cb37-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The modeled predictors can be transformations of the scientific measurements and still be linear (in the parameters). These models are linear (in the parameters)</span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g<span class="co">[</span><span class="ot">\theta | X_i</span><span class="co">]</span> = \beta_0 + \beta_1 \textrm{log}(X_i)$</span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g<span class="co">[</span><span class="ot">\theta | X_i</span><span class="co">]</span> = \beta_0 + \beta_1 X_i + \beta_2 X_i^2$</span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Examples of models that are *not* linear in the parameters (We do not consider such models)</span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g<span class="co">[</span><span class="ot">\theta | X_i</span><span class="co">]</span> = \beta_0 X_i^{\beta_1}$</span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g<span class="co">[</span><span class="ot">\theta | X_i</span><span class="co">]</span> = \beta_0 + \beta_1 \textrm{exp}(-\beta_2 X_i)$</span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>$g<span class="co">[</span><span class="ot">\theta | X_i</span><span class="co">]</span> = \frac{\beta_0 + \beta_1 X_i}{1 + \beta_2 X_i}$</span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of transformations</span></span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-339"><a href="#cb37-339" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We transform predictors to provide more flexible description of complex associations between the response and some scientific measure</span>
<span id="cb37-340"><a href="#cb37-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Threshold effects</span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Exponentially increasing effects</span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>U-shaped functions</span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>S-shaped functions</span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>etc.</span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flexible modeling of continuous predictors was briefly covered in the notes on Poisson regression. We used a flexible dose-response model to examine the association between BMI and reflux rate by Esophagitis status</span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-355"><a href="#cb37-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-356"><a href="#cb37-356" aria-hidden="true" tabindex="-1"></a>bmi.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/bmi.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Events are pH less than 4</span></span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a>bmi.data<span class="sc">$</span>events <span class="ot">&lt;-</span> bmi.data<span class="sc">$</span>totalmins4</span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a>m.spline2.adj <span class="ot">&lt;-</span> <span class="fu">glm</span>(events <span class="sc">~</span> <span class="fu">ns</span>(bmi,<span class="dv">4</span>) <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(totalmins)) <span class="sc">+</span> esop, <span class="at">data=</span>bmi.data, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a>m.spline3.adj <span class="ot">&lt;-</span> <span class="fu">lm</span>(events <span class="sc">/</span> totalmins <span class="sc">~</span> <span class="fu">ns</span>(bmi,<span class="dv">4</span>) <span class="sc">+</span> esop, <span class="at">data=</span>bmi.data)</span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>))</span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="fu">exp</span>(<span class="fu">predict</span>(m.spline2.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">totalmins=</span><span class="dv">720</span>, <span class="at">esop=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">"link"</span>)), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylab=</span><span class="st">"Predicted number of events per day"</span>, <span class="at">xlab=</span><span class="st">"BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">main=</span><span class="st">"Poisson Reg"</span>)</span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">4</span>, <span class="at">labels=</span><span class="cn">FALSE</span>, <span class="at">ticks=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="fu">c</span>(<span class="st">"Esophagitis Pos"</span>,<span class="st">"Esophagitis Neg"</span>), <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="fu">exp</span>(<span class="fu">predict</span>(m.spline2.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">totalmins=</span><span class="dv">720</span>, <span class="at">esop=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">"link"</span>)), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">720</span><span class="sc">*</span><span class="fu">predict</span>(m.spline3.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">esop=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">"response"</span>), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">'Blue'</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">xlab=</span><span class="st">"BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">main=</span><span class="st">"Linear Reg"</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">4</span>)</span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">labels=</span><span class="cn">FALSE</span>, <span class="at">ticks=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">720</span><span class="sc">*</span><span class="fu">predict</span>(m.spline3.adj, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">esop=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">"response"</span>), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">'Blue'</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="fu">c</span>(<span class="st">"Esophagitis Pos"</span>,<span class="st">"Esophagitis Neg"</span>), <span class="at">inset=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"Blue"</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1:1 Transformations</span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sometimes we can transform 1 scientific measurement into 1 modeled predictor and acheve approximate linearity</span>
<span id="cb37-378"><a href="#cb37-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-379"><a href="#cb37-379" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Ex: log transformations will sometimes address apparent threshold effects</span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Log transformation addresses threshold effect in untransformed X"}</span></span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(33)</span></span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 200</span></span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- runif(n)</span></span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a><span class="in">logx &lt;- log(x)</span></span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 0 + logx + rnorm(n)</span></span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow=c(1,2))</span></span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a><span class="in">plot(x,y, main="Untransformed")</span></span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a><span class="in">lines(lowess(y~x), lwd=2)</span></span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a><span class="in">plot(logx, y, main="Log Transformed X")</span></span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a><span class="in">lines(lowess(y ~ logx), lwd=2)</span></span>
<span id="cb37-395"><a href="#cb37-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-396"><a href="#cb37-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ex: cubing height produces a more linear association with FEV</span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Cubing height produces a more linear association with FEV"}</span></span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a><span class="in">fev &lt;- read.csv(file="data/FEV.csv")</span></span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow=c(1,2))</span></span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a><span class="in">plot(fev$height, fev$fev, main="Untransformed", pch='.', xlab="Height",ylab="FEV")</span></span>
<span id="cb37-403"><a href="#cb37-403" aria-hidden="true" tabindex="-1"></a><span class="in">lines(lowess(fev$fev ~ fev$height), lwd=2)</span></span>
<span id="cb37-404"><a href="#cb37-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-405"><a href="#cb37-405" aria-hidden="true" tabindex="-1"></a><span class="in">fev$height3 &lt;- fev$height^3</span></span>
<span id="cb37-406"><a href="#cb37-406" aria-hidden="true" tabindex="-1"></a><span class="in">plot(fev$height3, fev$fev, main="Cubed Height", pch='.', xlab="Height^3",ylab="FEV")</span></span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a><span class="in">lines(lowess(fev$fev ~ fev$height3), lwd=2)</span></span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1:Many transformations</span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sometimes we transform 1 scientific measurement into several modeled predictors</span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Polynomial regression</span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Dummy variables (factor or class variables)</span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Piecewise linear</span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Splines</span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Polynomial regression</span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Fit linear term plus higher order terms (squared, cubic, ...)</span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can fit an arbitrarily-complex function</span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-428"><a href="#cb37-428" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>An $n$-th order polynomial can fit $n+1$ points exactly</span>
<span id="cb37-429"><a href="#cb37-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Generally, very difficult to interpret parameters</span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>I will usually graph functions when I want an interpretation</span>
<span id="cb37-433"><a href="#cb37-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-434"><a href="#cb37-434" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Special uses</span>
<span id="cb37-435"><a href="#cb37-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-436"><a href="#cb37-436" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>2nd order (quadratic) model to look for U-shaped trends (e.g. alcohol consumption and cardiovascular risk? Potential hypothesis being that moderate consumption of alcohol beneficial relative to either no consumption or high consumption)</span>
<span id="cb37-437"><a href="#cb37-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-438"><a href="#cb37-438" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Tests for linearity achieved by testing that all higher order terms have parameters equal to zero (hierarchical model)</span>
<span id="cb37-439"><a href="#cb37-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-440"><a href="#cb37-440" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Full Model: $g(\theta) = \beta_0 + \beta_1 * X + \beta_2 * X^2 + \beta_3 * X^3$</span>
<span id="cb37-441"><a href="#cb37-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-442"><a href="#cb37-442" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Reduced Model: $g(\theta) = \beta_0 + \beta_1 * X$</span>
<span id="cb37-443"><a href="#cb37-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-444"><a href="#cb37-444" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: FEV and Height association</span></span>
<span id="cb37-445"><a href="#cb37-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-446"><a href="#cb37-446" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can try to assess whether any association between mean FEV and height follows a straight line association</span>
<span id="cb37-447"><a href="#cb37-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-448"><a href="#cb37-448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit a third order (cubic) polynomial due to the known scientific relationship between volume and height (using robust standard error estimates)</span>
<span id="cb37-449"><a href="#cb37-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-452"><a href="#cb37-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-453"><a href="#cb37-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Create squared and cubic terms</span></span>
<span id="cb37-454"><a href="#cb37-454" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>ht2 <span class="ot">&lt;-</span> fev<span class="sc">$</span>height<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb37-455"><a href="#cb37-455" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>ht3 <span class="ot">&lt;-</span> fev<span class="sc">$</span>height<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb37-456"><a href="#cb37-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-457"><a href="#cb37-457" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fev <span class="sc">~</span> height <span class="sc">+</span> ht2 <span class="sc">+</span> ht3, <span class="at">data=</span>fev)</span>
<span id="cb37-458"><a href="#cb37-458" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m1, <span class="at">vcov=</span>sandwich)</span>
<span id="cb37-459"><a href="#cb37-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-460"><a href="#cb37-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-461"><a href="#cb37-461" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>From the model output, is height a significant predictor of FEV?</span>
<span id="cb37-462"><a href="#cb37-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-463"><a href="#cb37-463" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that the p-values for each term are not significant</span>
<span id="cb37-464"><a href="#cb37-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-465"><a href="#cb37-465" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>But each of these tests are addressing irrelevant questions</span>
<span id="cb37-466"><a href="#cb37-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-467"><a href="#cb37-467" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>height: After adjusting for the 2nd and 3rd order terms relationships, is the linear term important?</span>
<span id="cb37-468"><a href="#cb37-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-469"><a href="#cb37-469" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>htsqr: After adjusting for the linear and 3rd order terms relationships, is the quadratic term important?</span>
<span id="cb37-470"><a href="#cb37-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-471"><a href="#cb37-471" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>htcub: After adjusting for the linear and 2nd order terms relationships, is the cubic term important?</span>
<span id="cb37-472"><a href="#cb37-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-473"><a href="#cb37-473" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We need to test if test the 2nd and 3rd order terms simultaneously</span>
<span id="cb37-474"><a href="#cb37-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-475"><a href="#cb37-475" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Will test if height-FEV has a linear relationship</span>
<span id="cb37-476"><a href="#cb37-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-479"><a href="#cb37-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-480"><a href="#cb37-480" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m1, <span class="fu">c</span>(<span class="st">"ht2"</span>,</span>
<span id="cb37-481"><a href="#cb37-481" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ht3"</span>),</span>
<span id="cb37-482"><a href="#cb37-482" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m1))</span>
<span id="cb37-483"><a href="#cb37-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-484"><a href="#cb37-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-485"><a href="#cb37-485" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We find clear evidence that the trend in mean FEV versus height is non-linear ($p &lt; 0.001$)</span>
<span id="cb37-486"><a href="#cb37-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-487"><a href="#cb37-487" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that if we had seen $p &gt; 0.05$, we could not be sure it was linear. The relationship may have been non-linear, but not in a way the cubic polynomial could detect</span>
<span id="cb37-488"><a href="#cb37-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-489"><a href="#cb37-489" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: log FEV and polynomial height</span></span>
<span id="cb37-490"><a href="#cb37-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-491"><a href="#cb37-491" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can try to assess whether any association between mean log FEV and height follows a straight line relationship</span>
<span id="cb37-492"><a href="#cb37-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-493"><a href="#cb37-493" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Again, we will fit a third order (cubic) polynomial, but this time we do not have any good scientific justification for such a model</span>
<span id="cb37-494"><a href="#cb37-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-497"><a href="#cb37-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-498"><a href="#cb37-498" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>logfev <span class="ot">&lt;-</span> <span class="fu">log</span>(fev<span class="sc">$</span>fev)</span>
<span id="cb37-499"><a href="#cb37-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-500"><a href="#cb37-500" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logfev <span class="sc">~</span> height <span class="sc">+</span> ht2 <span class="sc">+</span> ht3, <span class="at">data=</span>fev)</span>
<span id="cb37-501"><a href="#cb37-501" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m2, <span class="at">vcov=</span>sandwich)</span>
<span id="cb37-502"><a href="#cb37-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-503"><a href="#cb37-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-504"><a href="#cb37-504" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that again, the p-values for the individual terms are not significant and are still addressing uninteresting scientific questions</span>
<span id="cb37-505"><a href="#cb37-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-506"><a href="#cb37-506" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test the squared and cubed terms simultaneously</span>
<span id="cb37-507"><a href="#cb37-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-510"><a href="#cb37-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-511"><a href="#cb37-511" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m2, <span class="fu">c</span>(<span class="st">"ht2"</span>,</span>
<span id="cb37-512"><a href="#cb37-512" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ht3"</span>),</span>
<span id="cb37-513"><a href="#cb37-513" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m2))</span>
<span id="cb37-514"><a href="#cb37-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-515"><a href="#cb37-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-516"><a href="#cb37-516" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We do not find clear evidence that the trend in mean log FEV versus height is non-linear</span>
<span id="cb37-517"><a href="#cb37-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-518"><a href="#cb37-518" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This does not prove linearity because it could have been nonlinear in a way that a cubic polynomial could not detect</span>
<span id="cb37-519"><a href="#cb37-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-520"><a href="#cb37-520" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>However, my guess it the cubic polynomial would have picked up most reasonable patterns of non-linearity likely to occur in this setting</span>
<span id="cb37-521"><a href="#cb37-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-522"><a href="#cb37-522" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have not addressed the question of whether log FEV is associated with height</span>
<span id="cb37-523"><a href="#cb37-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-524"><a href="#cb37-524" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This question could have been addressed in the cubic model by</span>
<span id="cb37-525"><a href="#cb37-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-526"><a href="#cb37-526" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Testing all three height-derived variable simultaneously</span>
<span id="cb37-527"><a href="#cb37-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-528"><a href="#cb37-528" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>OR looking at the overall F-test (because only height variables are in the model)</span>
<span id="cb37-529"><a href="#cb37-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-530"><a href="#cb37-530" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Another alternative would be to fit a model with only the linear term for height</span>
<span id="cb37-531"><a href="#cb37-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-532"><a href="#cb37-532" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>In general, it is a very bad idea to go fishing for models, so pick an approach beforehand and use that</span>
<span id="cb37-533"><a href="#cb37-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-534"><a href="#cb37-534" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If I suspected a complex dose-response relationship beforehand, I would fit the complex model and test all of the height coefficients</span>
<span id="cb37-535"><a href="#cb37-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-536"><a href="#cb37-536" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If I just cared about showing a first order trend, the following output would answer that question</span>
<span id="cb37-537"><a href="#cb37-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-540"><a href="#cb37-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-541"><a href="#cb37-541" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logfev <span class="sc">~</span> height, <span class="at">data=</span>fev)</span>
<span id="cb37-542"><a href="#cb37-542" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m3, <span class="at">vcov=</span>sandwich)</span>
<span id="cb37-543"><a href="#cb37-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-544"><a href="#cb37-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-545"><a href="#cb37-545" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dummy Variables</span></span>
<span id="cb37-546"><a href="#cb37-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-547"><a href="#cb37-547" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Indicator variables for all but one group</span>
<span id="cb37-548"><a href="#cb37-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-549"><a href="#cb37-549" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is the only appropriate method for modeling modeling nominal (unordered) categorical variables</span>
<span id="cb37-550"><a href="#cb37-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-551"><a href="#cb37-551" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Example: Marital status using indicator for</span>
<span id="cb37-552"><a href="#cb37-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-553"><a href="#cb37-553" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Married (married=1, everything else=0)</span>
<span id="cb37-554"><a href="#cb37-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-555"><a href="#cb37-555" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Widowed (widowed=1, everything else=0)</span>
<span id="cb37-556"><a href="#cb37-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-557"><a href="#cb37-557" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Divorced (divorced=1, everything else=0)</span>
<span id="cb37-558"><a href="#cb37-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-559"><a href="#cb37-559" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Single would then be the intercept</span>
<span id="cb37-560"><a href="#cb37-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-561"><a href="#cb37-561" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>While it is the only approach for nominal variables, dummy variable coding is often used for other settings</span>
<span id="cb37-562"><a href="#cb37-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-563"><a href="#cb37-563" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Makes regression equivalent to Analysis of Variance (ANOVA)</span>
<span id="cb37-564"><a href="#cb37-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-565"><a href="#cb37-565" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>ANOVA is an old technique developed by R.A. Fisher in 1921</span>
<span id="cb37-566"><a href="#cb37-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-567"><a href="#cb37-567" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can reproduce results of ANOVA exactly with regression, so ANOVA is of limited use today (but will find it around)</span>
<span id="cb37-568"><a href="#cb37-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-569"><a href="#cb37-569" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Mean salary by Field</span></span>
<span id="cb37-570"><a href="#cb37-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-571"><a href="#cb37-571" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Field is a nominal variable, so we must use dummy variables</span>
<span id="cb37-572"><a href="#cb37-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-573"><a href="#cb37-573" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>I decided to use Other as a reference group. By default, R will order alphabetically so Arts would have been the default reference group</span>
<span id="cb37-574"><a href="#cb37-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-577"><a href="#cb37-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-578"><a href="#cb37-578" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/salary.csv"</span>)</span>
<span id="cb37-579"><a href="#cb37-579" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> salary[salary<span class="sc">$</span>year<span class="sc">==</span><span class="dv">95</span>,]</span>
<span id="cb37-580"><a href="#cb37-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-581"><a href="#cb37-581" aria-hidden="true" tabindex="-1"></a>salary<span class="sc">$</span>field <span class="ot">&lt;-</span> <span class="fu">factor</span>(salary<span class="sc">$</span>field)</span>
<span id="cb37-582"><a href="#cb37-582" aria-hidden="true" tabindex="-1"></a>salary<span class="sc">$</span>field <span class="ot">&lt;-</span> <span class="fu">relevel</span>(salary<span class="sc">$</span>field, <span class="at">ref=</span><span class="st">"Other"</span>)</span>
<span id="cb37-583"><a href="#cb37-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-584"><a href="#cb37-584" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> field, <span class="at">data=</span>salary)</span>
<span id="cb37-585"><a href="#cb37-585" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m4, <span class="at">vcov=</span>sandwich)</span>
<span id="cb37-586"><a href="#cb37-586" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m4, <span class="at">vcov=</span>sandwich)</span>
<span id="cb37-587"><a href="#cb37-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-588"><a href="#cb37-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-589"><a href="#cb37-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-590"><a href="#cb37-590" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation based on coding used</span>
<span id="cb37-591"><a href="#cb37-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-592"><a href="#cb37-592" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Intercept corresponds to the mean salary in the Other field</span>
<span id="cb37-593"><a href="#cb37-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-594"><a href="#cb37-594" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>These faculty will have both arts==0 and prof==0</span>
<span id="cb37-595"><a href="#cb37-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-596"><a href="#cb37-596" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Estimated mean salary of \$6292 per month (95% CI: <span class="sc">\[</span>6172, 6411<span class="sc">\]</span>)</span>
<span id="cb37-597"><a href="#cb37-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-598"><a href="#cb37-598" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Highly statistically different from \$0 per month (a worthless test)</span>
<span id="cb37-599"><a href="#cb37-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-600"><a href="#cb37-600" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope for arts is difference in mean salary between Fine Arts and Other fields</span>
<span id="cb37-601"><a href="#cb37-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-602"><a href="#cb37-602" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Fine Arts faculty will have arts==1 and prof==0; Other faculty will have arts==0 and prof==0</span>
<span id="cb37-603"><a href="#cb37-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-604"><a href="#cb37-604" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Estimated difference in mean salary is \$1014 lower (95% CI: <span class="sc">\[</span>808, 1219<span class="sc">\]</span> lower salary)</span>
<span id="cb37-605"><a href="#cb37-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-606"><a href="#cb37-606" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Highly statistically different from \$0 per month (a useful test, if we specified it a priori)</span>
<span id="cb37-607"><a href="#cb37-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-608"><a href="#cb37-608" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Slope for prof is difference in mean salary between Professional and Other fields</span>
<span id="cb37-609"><a href="#cb37-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-610"><a href="#cb37-610" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Professional faculty will have arts==0 and prof==1; Other faculty will have arts==0 and prof==0</span>
<span id="cb37-611"><a href="#cb37-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-612"><a href="#cb37-612" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Estimated difference in mean salary is \$1225 higher (95% CI: <span class="sc">\[</span>963, 1487<span class="sc">\]</span> higher salary)</span>
<span id="cb37-613"><a href="#cb37-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-614"><a href="#cb37-614" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Highly statistically different from \$0 per month (a useful test, if we specified it a priori)</span>
<span id="cb37-615"><a href="#cb37-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-616"><a href="#cb37-616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Because we modeled the three groups with two predictors plus an intercept, the estimates agree exactly with the sample means</span>
<span id="cb37-617"><a href="#cb37-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-618"><a href="#cb37-618" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No borrowing of information across field</span>
<span id="cb37-619"><a href="#cb37-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-620"><a href="#cb37-620" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If we had used a different reference group rather than Other, would also see agreement between model estimates and sample means</span>
<span id="cb37-621"><a href="#cb37-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-622"><a href="#cb37-622" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Hypothesis test: To test for mean salary differences by field</span>
<span id="cb37-623"><a href="#cb37-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-624"><a href="#cb37-624" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We have modeled field using two variables</span>
<span id="cb37-625"><a href="#cb37-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-626"><a href="#cb37-626" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Both slopes would have to be zero for there to be no association between field and mean salary</span>
<span id="cb37-627"><a href="#cb37-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-628"><a href="#cb37-628" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Want to simultaneously tests the two slopes</span>
<span id="cb37-629"><a href="#cb37-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-632"><a href="#cb37-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-633"><a href="#cb37-633" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m4, <span class="fu">c</span>(<span class="st">"fieldArts"</span>,<span class="st">"fieldProf"</span>),</span>
<span id="cb37-634"><a href="#cb37-634" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m4))</span>
<span id="cb37-635"><a href="#cb37-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-636"><a href="#cb37-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-637"><a href="#cb37-637" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can conclude there is a there is a significant difference in salary comparing faculty with different fields ($P&lt;0.001$)</span>
<span id="cb37-638"><a href="#cb37-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-639"><a href="#cb37-639" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Continuous variables</span></span>
<span id="cb37-640"><a href="#cb37-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-641"><a href="#cb37-641" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can also use dummy variables to represent continuous variables</span>
<span id="cb37-642"><a href="#cb37-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-643"><a href="#cb37-643" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Continuous variables measured at discrete levels (e.g. dose in an interventional experiment)</span>
<span id="cb37-644"><a href="#cb37-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-645"><a href="#cb37-645" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Continuous variables divided into categories (often a bad idea)</span>
<span id="cb37-646"><a href="#cb37-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-647"><a href="#cb37-647" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dummy variables will fit groups exactly</span>
<span id="cb37-648"><a href="#cb37-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-649"><a href="#cb37-649" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If no other predictors in the model, parameter estimates correspond exactly to descriptive statistics</span>
<span id="cb37-650"><a href="#cb37-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-651"><a href="#cb37-651" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>With continuous variables, dummy variable coding assumes a step-function is true</span>
<span id="cb37-652"><a href="#cb37-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-653"><a href="#cb37-653" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modeling with dummy variables ignores order of predictor of interest</span>
<span id="cb37-654"><a href="#cb37-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-655"><a href="#cb37-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Red points are means at each level of age"}</span></span>
<span id="cb37-656"><a href="#cb37-656" aria-hidden="true" tabindex="-1"></a><span class="in">m.dummy &lt;- lm(height ~ factor(age), data=fev)</span></span>
<span id="cb37-657"><a href="#cb37-657" aria-hidden="true" tabindex="-1"></a><span class="in">newdata &lt;- data.frame(age=3:19)</span></span>
<span id="cb37-658"><a href="#cb37-658" aria-hidden="true" tabindex="-1"></a><span class="in">newdata$ht.dummy &lt;- predict(m.dummy, newdata=newdata)</span></span>
<span id="cb37-659"><a href="#cb37-659" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() +</span></span>
<span id="cb37-660"><a href="#cb37-660" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3)</span></span>
<span id="cb37-661"><a href="#cb37-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-662"><a href="#cb37-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-663"><a href="#cb37-663" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The red points in the plot represents the mean height by subgroups defined by years of age</span>
<span id="cb37-664"><a href="#cb37-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-665"><a href="#cb37-665" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Dummy variables are used for each age (measured in years)</span>
<span id="cb37-666"><a href="#cb37-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-667"><a href="#cb37-667" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Step function (e.g. when age changes from 8.999 to 9.000, expected height increases)</span>
<span id="cb37-668"><a href="#cb37-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-669"><a href="#cb37-669" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Several ages have few subjects, which makes the estimates unreliable</span>
<span id="cb37-670"><a href="#cb37-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-671"><a href="#cb37-671" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do we really believe that average height of 18 year olds is less than the average height of 14, 15, 16, 17, and 19 year old?</span>
<span id="cb37-672"><a href="#cb37-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-673"><a href="#cb37-673" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Probably not (the model is overfit)</span>
<span id="cb37-674"><a href="#cb37-674" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>By ignoring the ordering of age, we are not borrowing strength across adjacent age groups</span>
<span id="cb37-675"><a href="#cb37-675" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When building model, we can decide how much information we want to borrow from nearby groups</span>
<span id="cb37-676"><a href="#cb37-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-677"><a href="#cb37-677" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Predicted heights for observed ages from the dummy variable and two polynomial models</span>
<span id="cb37-678"><a href="#cb37-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-681"><a href="#cb37-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-682"><a href="#cb37-682" aria-hidden="true" tabindex="-1"></a>newdata[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>,]</span>
<span id="cb37-683"><a href="#cb37-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-684"><a href="#cb37-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-685"><a href="#cb37-685" aria-hidden="true" tabindex="-1"></a><span class="fu">## Flexible Methods</span></span>
<span id="cb37-686"><a href="#cb37-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-687"><a href="#cb37-687" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have methods that can fit a wide variety of curve shapes</span>
<span id="cb37-688"><a href="#cb37-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-689"><a href="#cb37-689" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Dummy variables: Step function with tiny steps</span>
<span id="cb37-690"><a href="#cb37-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-691"><a href="#cb37-691" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Polynomials: If high degree, allows many patterns of curvature</span>
<span id="cb37-692"><a href="#cb37-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-693"><a href="#cb37-693" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Splines: Piecewise linear or piecewise polynomial</span>
<span id="cb37-694"><a href="#cb37-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-695"><a href="#cb37-695" aria-hidden="true" tabindex="-1"></a><span class="fu">### Polyhomial functions</span></span>
<span id="cb37-696"><a href="#cb37-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-697"><a href="#cb37-697" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can fit high order polynomials to flexibly model a continuous covariate</span>
<span id="cb37-698"><a href="#cb37-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-699"><a href="#cb37-699" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A continuous covariate with $k$ levels can be perfectly modeled using polynomials up to degree $k-1$.</span>
<span id="cb37-700"><a href="#cb37-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-701"><a href="#cb37-701" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the Height and Age dataset, there are 17 unique values of age (age is rounded to the nearest year), so we can perfectly model the means using polynomials up to degree 16</span>
<span id="cb37-702"><a href="#cb37-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-703"><a href="#cb37-703" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$E<span class="co">[</span><span class="ot">Height | Age = a</span><span class="co">]</span> = \beta_0 + \beta_1 * a + \beta_2 * a^2 + \ldots + \beta_{16} * a^{16}$</span>
<span id="cb37-704"><a href="#cb37-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-705"><a href="#cb37-705" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each $\beta$ is difficult to interpret, but the predicted value at the integer levels of age make sense.</span>
<span id="cb37-706"><a href="#cb37-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-707"><a href="#cb37-707" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Predicted values of height at non-integer values of age (e.g. age of 18.5) may not make sense</span>
<span id="cb37-708"><a href="#cb37-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-709"><a href="#cb37-709" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Polynomials become especially unstable near the upper and lower bounds of the age distribution. Stability near the upper and lower bounds is a general concern in many spline approaches.</span>
<span id="cb37-710"><a href="#cb37-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-711"><a href="#cb37-711" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A polynomial of lesser degree could also be considered. I show a model that includes polynomials for age up to degree 3 in the following plot. It is also less stable near the upper and lower bounds of age, but not as obviously so as the 16 degree polynomial.</span>
<span id="cb37-712"><a href="#cb37-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-713"><a href="#cb37-713" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Sixteen degree and three degree polynomial model"}</span></span>
<span id="cb37-714"><a href="#cb37-714" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-715"><a href="#cb37-715" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ poly(x,16), se=FALSE) + </span></span>
<span id="cb37-716"><a href="#cb37-716" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ poly(x,3), se=FALSE, col="Green") +</span></span>
<span id="cb37-717"><a href="#cb37-717" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3)</span></span>
<span id="cb37-718"><a href="#cb37-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-719"><a href="#cb37-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-722"><a href="#cb37-722" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-723"><a href="#cb37-723" aria-hidden="true" tabindex="-1"></a>m.poly16 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">16</span>), <span class="at">data=</span>fev)</span>
<span id="cb37-724"><a href="#cb37-724" aria-hidden="true" tabindex="-1"></a>m.poly3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">3</span>), <span class="at">data=</span>fev)</span>
<span id="cb37-725"><a href="#cb37-725" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>ht.poly16 <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.poly16, newdata)</span>
<span id="cb37-726"><a href="#cb37-726" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>ht.poly3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.poly3, newdata)</span>
<span id="cb37-727"><a href="#cb37-727" aria-hidden="true" tabindex="-1"></a>newdata[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>,]</span>
<span id="cb37-728"><a href="#cb37-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-729"><a href="#cb37-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-730"><a href="#cb37-730" aria-hidden="true" tabindex="-1"></a><span class="fu">### Piecewise Linear Splines</span></span>
<span id="cb37-731"><a href="#cb37-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-732"><a href="#cb37-732" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Piecewise linear curves</span>
<span id="cb37-733"><a href="#cb37-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-734"><a href="#cb37-734" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Joined at "knots"</span>
<span id="cb37-735"><a href="#cb37-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-736"><a href="#cb37-736" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Straight lines in between the knots</span>
<span id="cb37-737"><a href="#cb37-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-738"><a href="#cb37-738" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Convenient parametrizations such that (1) coefficients are slopes of consecutive segments or (2) coefficients are slope changes at consecutive knots</span>
<span id="cb37-739"><a href="#cb37-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-740"><a href="#cb37-740" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Advantages</span>
<span id="cb37-741"><a href="#cb37-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-742"><a href="#cb37-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Interpretability. Has the interpretation as the slope (or slope change) from the regression model, but within a range of $X$</span>
<span id="cb37-743"><a href="#cb37-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-744"><a href="#cb37-744" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Best to specify know locations in advance for desired scientific interpretation</span>
<span id="cb37-745"><a href="#cb37-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-746"><a href="#cb37-746" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Nested within a restriced model with a single slope term (hierarchcical structure allow comparisons of complex to simpler models)</span>
<span id="cb37-747"><a href="#cb37-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-748"><a href="#cb37-748" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Disadvantages</span>
<span id="cb37-749"><a href="#cb37-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-750"><a href="#cb37-750" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Abrupt change in slope at each knot location</span>
<span id="cb37-751"><a href="#cb37-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-752"><a href="#cb37-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stata: <span class="in">`mkspline newvar0 knot1 newvar1 knot2 newvar2 ... knotp newvarp = oldvar`</span></span>
<span id="cb37-753"><a href="#cb37-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-754"><a href="#cb37-754" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Would then run regression using newvar0 ... newvarp</span>
<span id="cb37-755"><a href="#cb37-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-756"><a href="#cb37-756" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Assumes straight lines between min and knot1; knot1 and knot2; etc.</span>
<span id="cb37-757"><a href="#cb37-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-758"><a href="#cb37-758" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In R, we can use the lspline package to make the linear splines</span>
<span id="cb37-759"><a href="#cb37-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-760"><a href="#cb37-760" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The following results will look at age and height using linear splines with 2 knots and 4 knots</span>
<span id="cb37-761"><a href="#cb37-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-762"><a href="#cb37-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Piecewise linear splines with 2 or 4 knots.  Red points are mean height at each subgroup of age."}</span></span>
<span id="cb37-763"><a href="#cb37-763" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-764"><a href="#cb37-764" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ lspline(x, knots=c(9.5,15.5)), se=FALSE) + </span></span>
<span id="cb37-765"><a href="#cb37-765" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ lspline(x, knots=c(6.5,9.5,12.5,15.5)), se=FALSE, col="Green") +</span></span>
<span id="cb37-766"><a href="#cb37-766" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3)</span></span>
<span id="cb37-767"><a href="#cb37-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-768"><a href="#cb37-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-769"><a href="#cb37-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-770"><a href="#cb37-770" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Piecewise linear spline interpretation (marginal is FALSE, the default)</span></span>
<span id="cb37-771"><a href="#cb37-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-772"><a href="#cb37-772" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Focusing on the model with 2 knots for interpretation within age groups of <span class="sc">\[</span>3 to 9<span class="sc">\]</span>, <span class="sc">\[</span>10 to 15<span class="sc">\]</span>, and <span class="sc">\[</span>16 to 19<span class="sc">\]</span></span>
<span id="cb37-773"><a href="#cb37-773" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Knots at 9.5 and 15.5 define three age groups</span>
<span id="cb37-774"><a href="#cb37-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-777"><a href="#cb37-777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-778"><a href="#cb37-778" aria-hidden="true" tabindex="-1"></a>m.linspline.nonmar <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">lspline</span>(age, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>)), <span class="at">data=</span>fev)</span>
<span id="cb37-779"><a href="#cb37-779" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m.linspline.nonmar, <span class="at">varcov=</span>sandwich)</span>
<span id="cb37-780"><a href="#cb37-780" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m.linspline.nonmar, <span class="at">varcov=</span>sandwich)</span>
<span id="cb37-781"><a href="#cb37-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-782"><a href="#cb37-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-783"><a href="#cb37-783" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>(Intercept) is the expect height when age is 0. Since this is outside the range of our data, it has no scientific interpretation.</span>
<span id="cb37-784"><a href="#cb37-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-785"><a href="#cb37-785" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The first slope term ('lspline(age, knots = c(9.5, 15.5))1') is the expected change in height comparing two individuals who differ in age by one year when both subjects are 9 years old or less. Comparing two children who are both 3 to 9 years old and differ in age by one year, the older child on average will be 2.49 inches taller than the younger child. We are 95% confident the true difference in height is between 2.29 and 2.68 inches taller.</span>
<span id="cb37-786"><a href="#cb37-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-787"><a href="#cb37-787" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>That is, the model assumes that the change in height comparing 3 to 4, 4 to 5, 5 to 6, 6 to 7, 7 to 8, 8 to 9 is the same (a similar growth rate over these age ranges)</span>
<span id="cb37-788"><a href="#cb37-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-789"><a href="#cb37-789" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The model borrow strength across the age ranges by assuming the same slope</span>
<span id="cb37-790"><a href="#cb37-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-791"><a href="#cb37-791" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The model borrows strength across the next age range by assuming the mean height at the knot (9.5 years) is the same at the upper end of first age group and the lower end of the second age group.</span>
<span id="cb37-792"><a href="#cb37-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-793"><a href="#cb37-793" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The second slope term ('lspline(age, knots = c(9.5, 15.5))2') is the expected change in height comparing two individuals who differ in age by one year when both subjects are between 10 and 15 years old</span>
<span id="cb37-794"><a href="#cb37-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-795"><a href="#cb37-795" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The third slope term ('lspline(age, knots = c(9.5, 15.5))3') is the expected change in height comparing two individuals who differ in age by one year when both subjects are 16 years old or older</span>
<span id="cb37-796"><a href="#cb37-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-797"><a href="#cb37-797" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can test if the age-height slope significantly changes with age category</span>
<span id="cb37-798"><a href="#cb37-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-799"><a href="#cb37-799" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$H_0: \beta_1 = \beta_2, \beta_1 = \beta_3$</span>
<span id="cb37-800"><a href="#cb37-800" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$H_A$: At least one not equal</span>
<span id="cb37-801"><a href="#cb37-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-804"><a href="#cb37-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-805"><a href="#cb37-805" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m.linspline.nonmar, </span>
<span id="cb37-806"><a href="#cb37-806" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="st">"lspline(age, knots = c(9.5, 15.5))1=lspline(age, knots = c(9.5, 15.5))2"</span>,</span>
<span id="cb37-807"><a href="#cb37-807" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"lspline(age, knots = c(9.5, 15.5))1=lspline(age, knots = c(9.5, 15.5))3"</span>),</span>
<span id="cb37-808"><a href="#cb37-808" aria-hidden="true" tabindex="-1"></a>                  <span class="at">vcov=</span><span class="fu">sandwich</span>(m.linspline.nonmar))</span>
<span id="cb37-809"><a href="#cb37-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-810"><a href="#cb37-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-811"><a href="#cb37-811" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We reject the null hypothesis ($P&lt;0.001$) and conclude the linear spline model is a better fit than the restricted model, $E<span class="co">[</span><span class="ot">Height | Age = a</span><span class="co">]</span> = \beta_0 + \beta_1 * a$</span>
<span id="cb37-812"><a href="#cb37-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-813"><a href="#cb37-813" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The following is the basis matrix for the linear spline (non-marginal) for ages 3 to 19. It is relatively easy to calculate this matrix</span>
<span id="cb37-814"><a href="#cb37-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-815"><a href="#cb37-815" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>First columns is age</span>
<span id="cb37-816"><a href="#cb37-816" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Second columns is max of 0 and (age minus the first knot)</span>
<span id="cb37-817"><a href="#cb37-817" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Third columns is max of 0 and (age minus the second knot)</span>
<span id="cb37-818"><a href="#cb37-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-821"><a href="#cb37-821" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-822"><a href="#cb37-822" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">19</span>, <span class="fu">lspline</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">19</span>,  <span class="at">knots =</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">15.5</span>)))</span>
<span id="cb37-823"><a href="#cb37-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-824"><a href="#cb37-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-825"><a href="#cb37-825" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have transformed one measured predictor, age, into three predictors</span>
<span id="cb37-826"><a href="#cb37-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-827"><a href="#cb37-827" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Piecewise linear spline interpretation (marginal is TRUE, the default)</span></span>
<span id="cb37-828"><a href="#cb37-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-829"><a href="#cb37-829" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Focusing on the model with 3 knots for interpretation with age groups of <span class="sc">\[</span>3 to 9<span class="sc">\]</span>, <span class="sc">\[</span>10 to 15<span class="sc">\]</span>, and <span class="sc">\[</span>16 to 19<span class="sc">\]</span></span>
<span id="cb37-830"><a href="#cb37-830" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Knots at 9.5 and 15.5 define these age groups</span>
<span id="cb37-831"><a href="#cb37-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-834"><a href="#cb37-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-835"><a href="#cb37-835" aria-hidden="true" tabindex="-1"></a>m.linspline.mar <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> <span class="fu">lspline</span>(age, <span class="at">knots=</span><span class="fu">c</span>(<span class="fl">9.5</span>,<span class="fl">15.5</span>), <span class="at">marginal=</span><span class="cn">TRUE</span>), <span class="at">data=</span>fev)</span>
<span id="cb37-836"><a href="#cb37-836" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m.linspline.mar, <span class="at">varcov=</span>sandwich)</span>
<span id="cb37-837"><a href="#cb37-837" aria-hidden="true" tabindex="-1"></a><span class="fu">coefci</span>(m.linspline.mar, <span class="at">varcov=</span>sandwich)</span>
<span id="cb37-838"><a href="#cb37-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-839"><a href="#cb37-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-840"><a href="#cb37-840" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>(Intercept) is the expect height when age is 0. Since this is outside the range of our data, it has no scientific interpretation.</span>
<span id="cb37-841"><a href="#cb37-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-842"><a href="#cb37-842" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The first slope term ('lspline(age, knots = c(9.5, 15.5))1') is the expected change in height comparing two individuals who differ in age by one year when both subjects are 9 years old or less.</span>
<span id="cb37-843"><a href="#cb37-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-844"><a href="#cb37-844" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The second slope term ('lspline(age, knots = c(9.5, 15.5))2') is the change in the age-height slope for 10 to 15 year olds versus 3 to 9 year olds. This output is useful for estimating and testing the slope changes over age.</span>
<span id="cb37-845"><a href="#cb37-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-846"><a href="#cb37-846" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The third slope term ('lspline(age, knots = c(9.5, 15.5))3') is the change in the age-height slope for 16 to 19 year olds versus 3 to 9 year olds. This output is useful for estimating and testing the slope changes over age.</span>
<span id="cb37-847"><a href="#cb37-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-848"><a href="#cb37-848" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using this model, we can test if the age-height slope significantly changes with age category</span>
<span id="cb37-849"><a href="#cb37-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-850"><a href="#cb37-850" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$H_0: \beta_2 = 0, \beta_3 = 0$</span>
<span id="cb37-851"><a href="#cb37-851" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$H_A$: At least one not equal</span>
<span id="cb37-852"><a href="#cb37-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-855"><a href="#cb37-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-856"><a href="#cb37-856" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(m.linspline.mar, </span>
<span id="cb37-857"><a href="#cb37-857" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="st">"lspline(age, knots = c(9.5, 15.5), marginal = TRUE)2"</span>,</span>
<span id="cb37-858"><a href="#cb37-858" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"lspline(age, knots = c(9.5, 15.5), marginal = TRUE)3"</span>),</span>
<span id="cb37-859"><a href="#cb37-859" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov=</span><span class="fu">sandwich</span>(m.linspline.mar))</span>
<span id="cb37-860"><a href="#cb37-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-861"><a href="#cb37-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-862"><a href="#cb37-862" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is the same scientific test as for the non-marginal model, just a different parameteriziation. So, we obtain the same inference (F-stat and p-values are identical).</span>
<span id="cb37-863"><a href="#cb37-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-864"><a href="#cb37-864" aria-hidden="true" tabindex="-1"></a><span class="fu">### Polynomial splines</span></span>
<span id="cb37-865"><a href="#cb37-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-866"><a href="#cb37-866" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Polynomial splines introduces squared or cubic terms to increase the smoothness of the estimate. In particular, compare to linear splines, they are no abrupt changes in the slope at each knot point.</span>
<span id="cb37-867"><a href="#cb37-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-868"><a href="#cb37-868" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There are various types of polynomial splines, each with different formulas applied to generate the basis matrix for the regression model</span>
<span id="cb37-869"><a href="#cb37-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-870"><a href="#cb37-870" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>B-spline: 'bs()'</span>
<span id="cb37-871"><a href="#cb37-871" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Representing the family of piecewise polynomials with the specified interior knots and degree</span>
<span id="cb37-872"><a href="#cb37-872" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Natural Cubic spline 'ns()'</span>
<span id="cb37-873"><a href="#cb37-873" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Enforce the constraint that the function is linear beyond the boundary knots, which can either be supplied or default to the extremes of the data.</span>
<span id="cb37-874"><a href="#cb37-874" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Restricted Cubic spline 'rcs()'</span>
<span id="cb37-875"><a href="#cb37-875" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>rcs is a also a linear tail-restricted cubic spline function</span>
<span id="cb37-876"><a href="#cb37-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-877"><a href="#cb37-877" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can choose to modify several parameters, depending on the function</span>
<span id="cb37-878"><a href="#cb37-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-879"><a href="#cb37-879" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Number of knots</span>
<span id="cb37-880"><a href="#cb37-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-881"><a href="#cb37-881" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Where to place the knots (or use defaults based on quantiles and number of knots)</span>
<span id="cb37-882"><a href="#cb37-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-883"><a href="#cb37-883" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Degree of the polynomial. In practice, rarely is a degree over 3 considered</span>
<span id="cb37-884"><a href="#cb37-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-885"><a href="#cb37-885" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Increasing the number of knots and the degree of the polynomial will increase the flexibility of the model</span>
<span id="cb37-886"><a href="#cb37-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-887"><a href="#cb37-887" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Several different comparisons are shown in the following plots</span>
<span id="cb37-888"><a href="#cb37-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-889"><a href="#cb37-889" aria-hidden="true" tabindex="-1"></a><span class="fu">##### B-spline versus polynomial function</span></span>
<span id="cb37-890"><a href="#cb37-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-891"><a href="#cb37-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="B-Spline with 3 degrees of freedom is the same as a 3 degree of polynomial. Two lines are not visible because the blue and green line are on top of each other."}</span></span>
<span id="cb37-892"><a href="#cb37-892" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-893"><a href="#cb37-893" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ poly(x, 3), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-894"><a href="#cb37-894" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ bs(x,3), se=FALSE, aes(col="Green")) +</span></span>
<span id="cb37-895"><a href="#cb37-895" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="Red", size=3) + </span></span>
<span id="cb37-896"><a href="#cb37-896" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("poly(x,3)","bs(x,3)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-897"><a href="#cb37-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-898"><a href="#cb37-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-899"><a href="#cb37-899" aria-hidden="true" tabindex="-1"></a><span class="fu">##### B-spline versus piecewise linear spline, function</span></span>
<span id="cb37-900"><a href="#cb37-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-901"><a href="#cb37-901" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="B-Spline with 3 degrees of freedom and knots at 9.5 and 15.5 compared to piecewise linear spline with knots at 9.5 and 15.5"}</span></span>
<span id="cb37-902"><a href="#cb37-902" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-903"><a href="#cb37-903" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ lspline(x,knots=c(9.5, 15.5)), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-904"><a href="#cb37-904" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ bs(x,knots=c(9.5, 15.5), degree=3), se=FALSE, aes(color="Green")) +</span></span>
<span id="cb37-905"><a href="#cb37-905" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3) + </span></span>
<span id="cb37-906"><a href="#cb37-906" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("lspline(x,knots=c(9.5, 15.5))","bs(x,knots=c(9.5, 15.5)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-907"><a href="#cb37-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-908"><a href="#cb37-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-909"><a href="#cb37-909" aria-hidden="true" tabindex="-1"></a><span class="fu">##### B-spline versus natural spline</span></span>
<span id="cb37-910"><a href="#cb37-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-911"><a href="#cb37-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="B-Spline with 3 degrees of freedom and knots at 9.5 and 15 compared to ns (3 df).  The enforcement of the linearity constraint beyond the boundary knots is particular apparent for the natural spline at the low end of age."}</span></span>
<span id="cb37-912"><a href="#cb37-912" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-913"><a href="#cb37-913" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ ns(x, df=3), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-914"><a href="#cb37-914" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ bs(x,3, knots=c(9.5, 15.5)), se=FALSE, aes(color="Green")) +</span></span>
<span id="cb37-915"><a href="#cb37-915" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3)+  </span></span>
<span id="cb37-916"><a href="#cb37-916" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("ns(x, df=3)","bs(x,3, knots=c(9.5, 15.5)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-917"><a href="#cb37-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-918"><a href="#cb37-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-919"><a href="#cb37-919" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Nautral spline versus restricted cubic spline</span></span>
<span id="cb37-920"><a href="#cb37-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-921"><a href="#cb37-921" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Natural splines and restricted cubic spline are both cubic splines with restrictions of linearity beyond the boundary knot locations</span>
<span id="cb37-922"><a href="#cb37-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-923"><a href="#cb37-923" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>They have different inputs which can result in different model fits</span>
<span id="cb37-924"><a href="#cb37-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-925"><a href="#cb37-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Natrual spline (with knots at 3.5 and 9.5) compared with restricted cubic spline with parms set to give the same fit.  Both spline approaches impose a linearity constraint at the tails.  Fits are same using these inputs."}</span></span>
<span id="cb37-926"><a href="#cb37-926" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-927"><a href="#cb37-927" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ ns(x, knots=c(9.5, 15.5)), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-928"><a href="#cb37-928" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ rcs(x, parms=c(0, 9.5, 15.5, 19)), se=FALSE, aes(color="Green")) +</span></span>
<span id="cb37-929"><a href="#cb37-929" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3) +  </span></span>
<span id="cb37-930"><a href="#cb37-930" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("ns(x, knots=c(9.5, 15.5)","rcs(x, parms=c(0, 9.5, 15.5, 19)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-931"><a href="#cb37-931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-932"><a href="#cb37-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-933"><a href="#cb37-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Natrual cubic spline (3 d.f) compared with restricted cubic spline using default inputs.  Both spline approaches impose a linearity constraint at the tails, but with different default knot locations the fits are different."}</span></span>
<span id="cb37-934"><a href="#cb37-934" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-935"><a href="#cb37-935" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ ns(x, df=3), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-936"><a href="#cb37-936" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ rcs(x, nk=5), se=FALSE, aes(color="Green")) +</span></span>
<span id="cb37-937"><a href="#cb37-937" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3) +  </span></span>
<span id="cb37-938"><a href="#cb37-938" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("ns(x, df=3)","rcs(x, nk=5)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-939"><a href="#cb37-939" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-940"><a href="#cb37-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-941"><a href="#cb37-941" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Nautral spline versus piecewise linear spline</span></span>
<span id="cb37-942"><a href="#cb37-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-943"><a href="#cb37-943" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Natrual spline (3 d.f) compared with restricted cubic spline with knots at 9.5 and 15.5.  Both spline approaches impose a linearity constraint at the tails."}</span></span>
<span id="cb37-944"><a href="#cb37-944" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=age, y=height)) + geom_point() + theme_bw() + </span></span>
<span id="cb37-945"><a href="#cb37-945" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ ns(x, df=3), se=FALSE, aes(color="Blue")) + </span></span>
<span id="cb37-946"><a href="#cb37-946" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ lspline(x, knots=c(9.5,15.5)), se=FALSE, aes(color="Green")) +</span></span>
<span id="cb37-947"><a href="#cb37-947" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=newdata, aes(x=age, y=ht.dummy), col="red", size=3) +  </span></span>
<span id="cb37-948"><a href="#cb37-948" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(name="Model", values=c("Blue", "Green"), labels=c("ns(x, df=3)","lspline(x, knots=c(9.5,15.5)")) + theme(legend.position = c(0.8, 0.2))</span></span>
<span id="cb37-949"><a href="#cb37-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-950"><a href="#cb37-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-951"><a href="#cb37-951" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary comments</span></span>
<span id="cb37-952"><a href="#cb37-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-953"><a href="#cb37-953" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There are a variety of methods for flexibly modeling continuous covariates</span>
<span id="cb37-954"><a href="#cb37-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-955"><a href="#cb37-955" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Approach you use should be pre-specified and based on scientific considerations</span>
<span id="cb37-956"><a href="#cb37-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-957"><a href="#cb37-957" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Splines for predictor of interest in an association study</span>
<span id="cb37-958"><a href="#cb37-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-959"><a href="#cb37-959" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If you want to be able to write numerical summaries of your results, consider piecewise linear splines</span>
<span id="cb37-960"><a href="#cb37-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-961"><a href="#cb37-961" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>May provide an adequate summary of your results, particularly for comparison between two knots</span>
<span id="cb37-962"><a href="#cb37-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-963"><a href="#cb37-963" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Comparison between subgroups separated by a knot location more challenging as you have a change in slope</span>
<span id="cb37-964"><a href="#cb37-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-965"><a href="#cb37-965" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Formal test can be conducted to determine if the slope is significantly different on ranges of $X$ (hierarchical models)</span>
<span id="cb37-966"><a href="#cb37-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-967"><a href="#cb37-967" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Best to pre-specify your knot locations based on relevant scientific meaning</span>
<span id="cb37-968"><a href="#cb37-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-969"><a href="#cb37-969" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Lacking scientific reasons, it is OK to use quantiles as the quantiles are not related to the outcome (unsupervised learning)</span>
<span id="cb37-970"><a href="#cb37-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-971"><a href="#cb37-971" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Should not pick knot locations after looking at the outcome unless you have a plan for how to adjust your analysis for making data-driven decision (this type of adjustment is hard to do, so I recommend avoiding it)</span>
<span id="cb37-972"><a href="#cb37-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-973"><a href="#cb37-973" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spline for estimating means or prediction of new observations</span>
<span id="cb37-974"><a href="#cb37-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-975"><a href="#cb37-975" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Flexible methods most appropriate in this approach</span>
<span id="cb37-976"><a href="#cb37-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-977"><a href="#cb37-977" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Be careful of behavior of your splines at the extremes of your continuous covariates</span>
<span id="cb37-978"><a href="#cb37-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-979"><a href="#cb37-979" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>(Also, don't extrapolate beyond the range of the date)</span>
<span id="cb37-980"><a href="#cb37-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-981"><a href="#cb37-981" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Degrees of freedom, or allowed model complexity needs to be considered in terms of the effective sample size for the type of outcome you are studying</span>
<span id="cb37-982"><a href="#cb37-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-983"><a href="#cb37-983" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Effective sample sizes</span>
<span id="cb37-984"><a href="#cb37-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-985"><a href="#cb37-985" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Linear regression: Number of subjects</span>
<span id="cb37-986"><a href="#cb37-986" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Logistic regression: Lesser of number of events and number of non-events</span>
<span id="cb37-987"><a href="#cb37-987" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Cox regression: Number of events</span>
<span id="cb37-988"><a href="#cb37-988" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Poisson regression: If counts are relatively continuous, more like linear regression. If counts are all small, more like Cox regression</span>
<span id="cb37-989"><a href="#cb37-989" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Multinomial regression: Number of events in smallest categorical outcome level</span>
<span id="cb37-990"><a href="#cb37-990" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Ordinal regression: If few severity events, more like logistic regression. If a wider range of severity, more like linear regression</span>
<span id="cb37-991"><a href="#cb37-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-992"><a href="#cb37-992" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Allowed model complexity is, roughly, gain one available degree of freedom per every 10-15 of effective sample size</span>
<span id="cb37-993"><a href="#cb37-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-994"><a href="#cb37-994" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Degrees of freedom can be spent on dummy variable, knot locations, and degree of polynomial</span>
<span id="cb37-995"><a href="#cb37-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-996"><a href="#cb37-996" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Degrees of freedom can be saved by constraints, such as the linearity constraint at the tails for natural splines and restricted cubic spline. These are popular splines because the constraint often saves degrees of freedom while improving the generalizability of the fit at the tails of the continuous distribution</span>
<span id="cb37-997"><a href="#cb37-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-998"><a href="#cb37-998" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>These are approximatione, and the allowed model complexity can depend on other characteristics of the data too</span>
<span id="cb37-999"><a href="#cb37-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1000"><a href="#cb37-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Splines for effect modification (continuous effect modifier and/or continuous predictor of interest)</span>
<span id="cb37-1001"><a href="#cb37-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1002"><a href="#cb37-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Choice of model should be dictated by scientific considerations first</span>
<span id="cb37-1003"><a href="#cb37-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1004"><a href="#cb37-1004" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Statistically, we have limited power to detect effect modification</span>
<span id="cb37-1005"><a href="#cb37-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1006"><a href="#cb37-1006" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Linear terms for modeling effect modification may suffice</span>
<span id="cb37-1007"><a href="#cb37-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1008"><a href="#cb37-1008" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flexible models for a precision variable</span>
<span id="cb37-1009"><a href="#cb37-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1010"><a href="#cb37-1010" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Often most of the association of the precision variable with the outcome can be capture in a linear term</span>
<span id="cb37-1011"><a href="#cb37-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1012"><a href="#cb37-1012" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>However, if justified, can consider a flexible model too</span>
<span id="cb37-1013"><a href="#cb37-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1014"><a href="#cb37-1014" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Goal of a precision variable is to explain residual variability in the outcome after accounting for the predictor of interest (and, possibly, confounders that are included in the model)</span>
<span id="cb37-1015"><a href="#cb37-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1016"><a href="#cb37-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flexible models for confounders</span>
<span id="cb37-1017"><a href="#cb37-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1018"><a href="#cb37-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Often it is important to adjust for confounders adequately, so a spline or other flexible function can help</span>
<span id="cb37-1019"><a href="#cb37-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1020"><a href="#cb37-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If we are not interested in interpreting the effect of the confounder, then we are free to model it a variety of different ways</span>
<span id="cb37-1021"><a href="#cb37-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1022"><a href="#cb37-1022" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Argues for flexibly modeling continuous confounder (limited by the effective sample size)</span>
<span id="cb37-1023"><a href="#cb37-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1024"><a href="#cb37-1024" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Note that if the confounder effect really is a straight line, then a cubic spline with linearity constraints on the tails should also fit adequately</span>
<span id="cb37-1025"><a href="#cb37-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1026"><a href="#cb37-1026" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There is not much to be lost and potentially much to be gained by pre-specifying a flexible model for a continuous confounder</span>
<span id="cb37-1027"><a href="#cb37-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1028"><a href="#cb37-1028" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If it is a straight line, a flexibly spline or a linear tearm can capture the association (either would adjust for confounding)</span>
<span id="cb37-1029"><a href="#cb37-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1030"><a href="#cb37-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>If it is not a straight line, a flexible spline can capture the assocation while a linear term cannot (spline would more completly adjust for confouding)</span>
<span id="cb37-1031"><a href="#cb37-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1032"><a href="#cb37-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.cap="Linear (sraight line) and natural spline (3 d.f.) fits to log of FEV and height.  The relationship is approximately a straight line, which can be capture by either assuming a straight line association or allowing for a flexible fit."}</span></span>
<span id="cb37-1033"><a href="#cb37-1033" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fev, aes(x=height, y=logfev)) + geom_point() + geom_smooth(method=lm, se=FALSE) +</span></span>
<span id="cb37-1034"><a href="#cb37-1034" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method=lm, formula=y ~ ns(x, df=3), se=FALSE, color="Green")</span></span>
<span id="cb37-1035"><a href="#cb37-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1036"><a href="#cb37-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1037"><a href="#cb37-1037" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Example interpretation for linear model with FEV as outcome, smoking the predictor of interest controlling for age and height. There are 654 observations in the dataset, so allowed model complexity is at least 43 degrees of freedom.</span>
<span id="cb37-1038"><a href="#cb37-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1041"><a href="#cb37-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1042"><a href="#cb37-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(fev) <span class="sc">/</span> <span class="dv">15</span></span>
<span id="cb37-1043"><a href="#cb37-1043" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>smoker <span class="ot">&lt;-</span> (fev<span class="sc">$</span>smoke<span class="sc">==</span><span class="st">"current smoker"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb37-1044"><a href="#cb37-1044" aria-hidden="true" tabindex="-1"></a>fev<span class="sc">$</span>male <span class="ot">&lt;-</span> (fev<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>)<span class="sc">+</span><span class="dv">0</span></span>
<span id="cb37-1045"><a href="#cb37-1045" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fev <span class="sc">~</span> smoker <span class="sc">+</span> <span class="fu">ns</span>(age,<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ns</span>(height,<span class="dv">3</span>) <span class="sc">+</span> male, <span class="at">data=</span> fev)</span>
<span id="cb37-1046"><a href="#cb37-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(m1, <span class="at">vcov=</span><span class="fu">sandwich</span>(m1))</span>
<span id="cb37-1047"><a href="#cb37-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1048"><a href="#cb37-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1049"><a href="#cb37-1049" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The betas for the naturally-splined terms (age, height) are difficult to interpret directly. We could test for age and or height effect if that was of scientific interest using the Wald approach.</span>
<span id="cb37-1050"><a href="#cb37-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1051"><a href="#cb37-1051" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For the predictor of interest, smoker, we have the usual interpretation in terms of holding other covariates constant. "Among subjects of the same age, height, and sex but differing in smoking status..." However, we may be controlling for the confounding effects of age and height effects more completely by using flexible spline functions.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024-2026, James C Slaughter</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chrissl789/modern-regression/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>